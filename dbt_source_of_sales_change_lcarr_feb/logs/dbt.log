15:48:15.176158 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.stg__dim_same_store
15:48:15.187070 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.stg__dim_same_store"
15:48:15.187957 [debug] [Thread-1  ]: finished collecting timing info
15:48:15.188254 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.stg__dim_same_store
15:48:15.256736 [debug] [Thread-1  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.stg__dim_same_store"
15:48:15.257505 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_same_store"
15:48:15.257995 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.stg__dim_same_store: BEGIN
15:48:15.258204 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
15:48:15.258414 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
15:48:16.040160 [debug] [Thread-1  ]: SQL status: BEGIN in 0.78 seconds
15:48:16.040657 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_same_store"
15:48:16.040997 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.stg__dim_same_store: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__dim_same_store"} */


  create view "cfa"."public"."stg__dim_same_store__dbt_tmp" as (
    with fcr_loc_sales_elig as ( 
    select location_num,monthend_date,
    actual_days, avail_days
    from "cfa"."public"."lcarr_sosx_stg__dim_fcr_loc_sales_elig"
), dim_monthend_date as ( 
    select monthend_date,previous_year_monthend_date
    from "cfa"."public"."lcarr_sosx_calc__dim_monthend_date"
), dim_same_store as ( 
    select a.location_num, a.monthend_date, '1 month' as look_back_period, 
    a.actual_days, a.avail_days, b.previous_year_monthend_date,
    cast(a.actual_days as decimal)/a.avail_days as same_store_percent
    from fcr_loc_sales_elig a 
    inner join dim_monthend_date b using (monthend_date)
)
select * from dim_same_store
  ) with no schema binding;

15:48:16.119115 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.08 seconds
15:48:16.127500 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_same_store"
15:48:16.127873 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.stg__dim_same_store: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__dim_same_store"} */
alter table "cfa"."public"."lcarr_sosx_stg__dim_same_store" rename to "stg__dim_same_store__dbt_backup"
15:48:16.185686 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.06 seconds
15:48:16.231501 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_same_store"
15:48:16.231809 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.stg__dim_same_store: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__dim_same_store"} */
alter table "cfa"."public"."stg__dim_same_store__dbt_tmp" rename to "lcarr_sosx_stg__dim_same_store"
15:48:16.288525 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.06 seconds
15:48:16.291066 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.stg__dim_same_store: COMMIT
15:48:16.291523 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_same_store"
15:48:16.291893 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.stg__dim_same_store: COMMIT
15:48:16.347485 [debug] [Thread-2  ]: SQL status: DROP VIEW in 1.22 seconds
15:48:16.349134 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__dim_transaction_status: COMMIT
15:48:16.349512 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_transaction_status"
15:48:16.349783 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__dim_transaction_status: COMMIT
15:48:16.396090 [debug] [Thread-4  ]: SQL status: COMMIT in 1.6 seconds
15:48:18.597240 [debug] [Thread-2  ]: SQL status: COMMIT in 2.25 seconds
15:48:18.597583 [debug] [Thread-1  ]: SQL status: COMMIT in 2.31 seconds
15:48:18.597840 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_transaction_status"
15:48:18.598351 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__dim_transaction_status: BEGIN
15:48:18.660159 [debug] [Thread-2  ]: SQL status: BEGIN in 0.06 seconds
15:48:18.661277 [debug] [Thread-2  ]: finished collecting timing info
15:48:18.661757 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_transaction"
15:48:18.662134 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__dim_transaction_status: ROLLBACK
15:48:18.662406 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__fct_transaction: BEGIN
15:48:18.751626 [debug] [Thread-3  ]: SQL status: BEGIN in 0.09 seconds
15:48:18.755950 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_transaction"
15:48:18.756422 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__fct_transaction: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__fct_transaction"} */
drop view if exists "cfa"."public"."stg__fct_transaction__dbt_backup" cascade
15:48:18.791136 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__dim_transaction_status: Close
15:48:18.792369 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6d1c280-5e0f-4d6b-83df-6573bf08eb2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa716302b50>]}
15:48:18.793834 [info ] [Thread-2  ]: 8 of 55 OK created view model public.lcarr_sosx_stg__dim_transaction_status..... [[32mCREATE VIEW[0m in 12.29s]
15:48:18.794333 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.stg__dim_transaction_status
15:48:18.794626 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.calc__dim_price_index_1
15:48:18.794953 [info ] [Thread-2  ]: 12 of 55 START view model public.lcarr_sosx_calc__dim_price_index_1............. [RUN]
15:48:18.795957 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_1"
15:48:18.796479 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.calc__dim_price_index_1
15:48:18.796726 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.calc__dim_price_index_1
15:48:18.800596 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.calc__dim_price_index_1"
15:48:18.801573 [debug] [Thread-2  ]: finished collecting timing info
15:48:18.802035 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.calc__dim_price_index_1
15:48:18.874715 [debug] [Thread-2  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.calc__dim_price_index_1"
15:48:18.875491 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_1"
15:48:18.875756 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_1: BEGIN
15:48:18.875941 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
15:48:18.876133 [debug] [Thread-2  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
15:48:18.909125 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.15 seconds
15:48:18.911412 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__fct_transaction: COMMIT
15:48:18.911736 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_transaction"
15:48:18.911960 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__fct_transaction: COMMIT
15:48:19.781128 [debug] [Thread-2  ]: SQL status: BEGIN in 0.91 seconds
15:48:19.781640 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_1"
15:48:19.781909 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_1: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.calc__dim_price_index_1"} */


  create view "cfa"."public"."calc__dim_price_index_1__dbt_tmp" as (
    with fcs_adj_sales as ( 
    select location_num,monthend_date, 
    month_sales,adjusted_sales,month_sales_pg1,adjusted_sales_pg1
    from "cfa"."public"."lcarr_sosx_stg__dim_adj_sales"
), location_attributes as ( 
    select location_num, dma_name
    from "cfa"."public"."lcarr_sosx_stg__dim_location"
), fcs_adj_sales_loc as ( 
    select b.dma_name,a.location_num,a.monthend_date,'1 month' as look_back_period,
    a.month_sales,a.adjusted_sales,a.month_sales_pg1,a.adjusted_sales_pg1
    from fcs_adj_sales a 
    inner join location_attributes b using (location_num)
)
select * from fcs_adj_sales_loc
  ) with no schema binding;

15:48:20.015860 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.23 seconds
15:48:20.016285 [debug] [Thread-3  ]: SQL status: COMMIT in 1.1 seconds
15:48:20.020510 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_1"
15:48:20.020871 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_transaction"
15:48:20.021105 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_1: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.calc__dim_price_index_1"} */
alter table "cfa"."public"."lcarr_sosx_calc__dim_price_index_1" rename to "calc__dim_price_index_1__dbt_backup"
15:48:20.021409 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__fct_transaction: BEGIN
15:48:20.080084 [debug] [Thread-3  ]: SQL status: BEGIN in 0.06 seconds
15:48:20.080689 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.06 seconds
15:48:20.081383 [debug] [Thread-3  ]: finished collecting timing info
15:48:20.081661 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__error"
15:48:20.084410 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_1"
15:48:20.084730 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__fct_transaction: ROLLBACK
15:48:20.084960 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.calc__error: BEGIN
15:48:20.085350 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_1: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.calc__dim_price_index_1"} */
alter table "cfa"."public"."calc__dim_price_index_1__dbt_tmp" rename to "lcarr_sosx_calc__dim_price_index_1"
15:48:20.188774 [debug] [Thread-4  ]: SQL status: BEGIN in 0.1 seconds
15:48:20.189480 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.1 seconds
15:48:20.189819 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__fct_transaction: Close
15:48:20.193173 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__error"
15:48:20.194657 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_1: COMMIT
15:48:20.195117 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.calc__error: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.calc__error"} */
drop view if exists "cfa"."public"."calc__error__dbt_backup" cascade
15:48:20.195953 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6d1c280-5e0f-4d6b-83df-6573bf08eb2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa7163a4f70>]}
15:48:20.196209 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_1"
15:48:20.196956 [info ] [Thread-3  ]: 9 of 55 OK created view model public.lcarr_sosx_stg__fct_transaction............ [[32mCREATE VIEW[0m in 9.93s]
15:48:20.197192 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_1: COMMIT
15:48:20.197627 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.stg__fct_transaction
15:48:20.198141 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.stg__fct_item
15:48:20.198813 [info ] [Thread-3  ]: 13 of 55 START view model public.lcarr_sosx_stg__fct_item....................... [RUN]
15:48:20.199637 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.stg__fct_item"
15:48:20.199950 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.stg__fct_item
15:48:20.200172 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.stg__fct_item
15:48:20.208344 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.stg__fct_item"
15:48:20.209087 [debug] [Thread-3  ]: finished collecting timing info
15:48:20.209376 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.stg__fct_item
15:48:20.307535 [debug] [Thread-4  ]: SQL status: DROP VIEW in 0.11 seconds
15:48:20.317243 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.calc__error: COMMIT
15:48:20.317724 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__error"
15:48:20.318198 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.calc__error: COMMIT
15:48:20.377852 [debug] [Thread-3  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.stg__fct_item"
15:48:20.379057 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_item"
15:48:20.381776 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__fct_item: BEGIN
15:48:20.382095 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
15:48:20.382395 [debug] [Thread-3  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
15:48:21.137676 [debug] [Thread-3  ]: SQL status: BEGIN in 0.76 seconds
15:48:21.138207 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_item"
15:48:21.138670 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__fct_item: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__fct_item"} */


  create view "cfa"."public"."stg__fct_item__dbt_tmp" as (
    

with trans_status as ( 
    select status, cancelled_flg
    from "cfa"."public"."lcarr_sosx_stg__dim_transaction_status"
), item as (
    select business_date, location_num, trans_id,
    item_pin as pin, item_sold_count, item_promo_count
    from "cfa"."pos"."trans_item"
    inner join trans_status using (status)
    where trans_status.cancelled_flg is false
    and (business_date between '2022-02-01' and '2022-02-28'
    or business_date between '2021-02-01' and '2021-02-28'))

select *
from item
  ) with no schema binding;

15:48:21.215378 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.08 seconds
15:48:21.220637 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_item"
15:48:21.220979 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__fct_item: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__fct_item"} */
alter table "cfa"."public"."lcarr_sosx_stg__fct_item" rename to "stg__fct_item__dbt_backup"
15:48:21.280537 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.06 seconds
15:48:21.283978 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_item"
15:48:21.284252 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__fct_item: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__fct_item"} */
alter table "cfa"."public"."stg__fct_item__dbt_tmp" rename to "lcarr_sosx_stg__fct_item"
15:48:21.340585 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.06 seconds
15:48:21.342791 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__fct_item: COMMIT
15:48:21.343191 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_item"
15:48:21.343530 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__fct_item: COMMIT
15:48:23.456310 [debug] [Thread-2  ]: SQL status: COMMIT in 3.26 seconds
15:48:23.459432 [debug] [Thread-4  ]: SQL status: COMMIT in 3.14 seconds
15:48:23.460021 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__error"
15:48:23.460314 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.calc__error: BEGIN
15:48:23.464443 [debug] [Thread-3  ]: SQL status: COMMIT in 2.12 seconds
15:48:23.519355 [debug] [Thread-4  ]: SQL status: BEGIN in 0.06 seconds
15:48:23.520321 [debug] [Thread-4  ]: finished collecting timing info
15:48:23.520612 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_same_store"
15:48:23.520870 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.calc__error: ROLLBACK
15:48:23.521128 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.stg__dim_same_store: BEGIN
15:48:23.621026 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
15:48:23.621647 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.calc__error: Close
15:48:23.625240 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_same_store"
15:48:23.625640 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.stg__dim_same_store: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__dim_same_store"} */
drop view if exists "cfa"."public"."stg__dim_same_store__dbt_backup" cascade
15:48:23.626463 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6d1c280-5e0f-4d6b-83df-6573bf08eb2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa7163070a0>]}
15:48:23.626970 [info ] [Thread-4  ]: 10 of 55 OK created view model public.lcarr_sosx_calc__error.................... [[32mCREATE VIEW[0m in 10.20s]
15:48:23.627448 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.calc__error
15:48:23.627755 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.stg__fct_tender
15:48:23.628259 [info ] [Thread-4  ]: 14 of 55 START view model public.lcarr_sosx_stg__fct_tender..................... [RUN]
15:48:23.628973 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.stg__fct_tender"
15:48:23.629491 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.stg__fct_tender
15:48:23.629758 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.stg__fct_tender
15:48:23.638149 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.stg__fct_tender"
15:48:23.638978 [debug] [Thread-4  ]: finished collecting timing info
15:48:23.639317 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.stg__fct_tender
15:48:23.696498 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.07 seconds
15:48:23.703034 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.stg__dim_same_store: COMMIT
15:48:23.709705 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_same_store"
15:48:23.716606 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.stg__dim_same_store: COMMIT
15:48:23.719076 [debug] [Thread-4  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.stg__fct_tender"
15:48:23.720301 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_tender"
15:48:23.720644 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__fct_tender: BEGIN
15:48:23.720864 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
15:48:23.721102 [debug] [Thread-4  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
15:48:24.708547 [debug] [Thread-4  ]: SQL status: BEGIN in 0.99 seconds
15:48:24.709143 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_tender"
15:48:24.709547 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__fct_tender: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__fct_tender"} */


  create view "cfa"."public"."stg__fct_tender__dbt_tmp" as (
    

with trans_status as ( 
    select status, cancelled_flg
    from "cfa"."public"."lcarr_sosx_stg__dim_transaction_status"
), tender as (
    select business_date,location_num,trans_id,
        destination_code,destination_desc,tender_type,tender_description
    from "cfa"."pos"."trans_tender"
    inner join trans_status using (status)
    where trans_status.cancelled_flg is false
    and (business_date between '2022-02-01' and '2022-02-28'
    or business_date between '2021-02-01' and '2021-02-28'))

select *
from tender
  ) with no schema binding;

15:48:25.003208 [debug] [Thread-4  ]: SQL status: CREATE VIEW in 0.29 seconds
15:48:25.007488 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_tender"
15:48:25.007823 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__fct_tender: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__fct_tender"} */
alter table "cfa"."public"."lcarr_sosx_stg__fct_tender" rename to "stg__fct_tender__dbt_backup"
15:48:25.114554 [debug] [Thread-1  ]: SQL status: COMMIT in 1.4 seconds
15:48:25.115039 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_same_store"
15:48:25.115342 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.stg__dim_same_store: BEGIN
15:48:25.123220 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.12 seconds
15:48:25.127081 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_tender"
15:48:25.127403 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__fct_tender: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__fct_tender"} */
alter table "cfa"."public"."stg__fct_tender__dbt_tmp" rename to "lcarr_sosx_stg__fct_tender"
15:48:25.212966 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
15:48:25.213915 [debug] [Thread-1  ]: finished collecting timing info
15:48:25.214248 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_1"
15:48:25.214478 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.stg__dim_same_store: ROLLBACK
15:48:25.214700 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_1: BEGIN
15:48:25.257590 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.13 seconds
15:48:25.259343 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__fct_tender: COMMIT
15:48:25.259614 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_tender"
15:48:25.259803 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__fct_tender: COMMIT
15:48:25.313368 [debug] [Thread-2  ]: SQL status: BEGIN in 0.1 seconds
15:48:25.314083 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.stg__dim_same_store: Close
15:48:25.318188 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_1"
15:48:25.318807 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_1: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.calc__dim_price_index_1"} */
drop view if exists "cfa"."public"."calc__dim_price_index_1__dbt_backup" cascade
15:48:25.319669 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6d1c280-5e0f-4d6b-83df-6573bf08eb2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa716307160>]}
15:48:25.320447 [info ] [Thread-1  ]: 11 of 55 OK created view model public.lcarr_sosx_stg__dim_same_store............ [[32mCREATE VIEW[0m in 10.14s]
15:48:25.320890 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.stg__dim_same_store
15:48:25.321351 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.transaction
15:48:25.322257 [info ] [Thread-1  ]: 15 of 55 START table model public.lcarr_sosx_transaction........................ [RUN]
15:48:25.323208 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.transaction"
15:48:25.323681 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.transaction
15:48:25.324367 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.transaction
15:48:25.332511 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.transaction"
15:48:25.333486 [debug] [Thread-1  ]: finished collecting timing info
15:48:25.334000 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.transaction
15:48:25.474767 [debug] [Thread-1  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.transaction"
15:48:25.475555 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.transaction"
15:48:25.475808 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.transaction: BEGIN
15:48:25.475989 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
15:48:25.476509 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
15:48:26.297487 [debug] [Thread-1  ]: SQL status: BEGIN in 0.82 seconds
15:48:26.297953 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.transaction"
15:48:26.298222 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.transaction: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.transaction"} */


  create  table
    "cfa"."public"."transaction__dbt_tmp"
    
    
    
  as (
    with fct_transaction as ( 
    select business_date, location_num, trans_id,
    monthend_date, quarter, end_hour_min,
    destination_code, destination_desc, 
    tax_amount, delivery_tip, sales_sub_total,
    cfa_one_id, customer_hash
    from "cfa"."public"."lcarr_sosx_stg__fct_transaction"
), location as ( 
    select location_num, service_team_name, location_type_code,
        region_name, dma_name 
    from "cfa"."public"."lcarr_sosx_stg__dim_location"
), daypart as ( 
    select end_hour_min,daypart
    from "cfa"."public"."lcarr_sosx_stg__dim_daypart" 
), destination as ( 
    select destination_code, destination_desc, dest_alias
    from "cfa"."public"."lcarr_sosx_stg__dim_destination"
), transaction as ( 
    select business_date, location_num, trans_id, daypart,
        monthend_date, quarter,
        destination_code, destination_desc, dest_alias,
        service_team_name, location_type_code, 
        region_name, dma_name,
        cfa_one_id, customer_hash,
        tax_amount, delivery_tip, 
        sales_sub_total,
        case when customer_hash <> '' and customer_hash <> ' ' 
             and  customer_hash is not null
        then 1 else 0 end as visit_count
    from fct_transaction
    inner join location using (location_num)
    inner join destination using (destination_code,destination_desc) 
    inner join daypart using (end_hour_min)
)

select *
from transaction
  );
15:48:26.477970 [debug] [Thread-2  ]: SQL status: DROP VIEW in 1.16 seconds
15:48:26.479640 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_1: COMMIT
15:48:26.479982 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_1"
15:48:26.480245 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_1: COMMIT
15:48:32.815855 [debug] [Thread-4  ]: SQL status: COMMIT in 7.56 seconds
15:48:32.818825 [debug] [Thread-2  ]: SQL status: COMMIT in 6.34 seconds
15:48:32.819437 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_1"
15:48:32.819773 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_1: BEGIN
15:48:32.875558 [debug] [Thread-2  ]: SQL status: BEGIN in 0.06 seconds
15:48:32.877375 [debug] [Thread-2  ]: finished collecting timing info
15:48:32.877778 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_item"
15:48:32.878050 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_1: ROLLBACK
15:48:32.878304 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__fct_item: BEGIN
15:48:32.975631 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_1: Close
15:48:32.975971 [debug] [Thread-3  ]: SQL status: BEGIN in 0.1 seconds
15:48:32.979873 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_item"
15:48:32.980426 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6d1c280-5e0f-4d6b-83df-6573bf08eb2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa715e2d1f0>]}
15:48:32.980678 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__fct_item: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__fct_item"} */
drop view if exists "cfa"."public"."stg__fct_item__dbt_backup" cascade
15:48:32.981281 [info ] [Thread-2  ]: 12 of 55 OK created view model public.lcarr_sosx_calc__dim_price_index_1........ [[32mCREATE VIEW[0m in 14.18s]
15:48:32.981710 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.calc__dim_price_index_1
15:48:32.982081 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.stg__fct_same_store
15:48:32.982708 [info ] [Thread-2  ]: 16 of 55 START view model public.lcarr_sosx_stg__fct_same_store................. [RUN]
15:48:32.983611 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.stg__fct_same_store"
15:48:32.983979 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.stg__fct_same_store
15:48:32.984313 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.stg__fct_same_store
15:48:32.988637 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.stg__fct_same_store"
15:48:32.990042 [debug] [Thread-2  ]: finished collecting timing info
15:48:32.991101 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.stg__fct_same_store
15:48:33.069580 [debug] [Thread-2  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.stg__fct_same_store"
15:48:33.071909 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_same_store"
15:48:33.072209 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__fct_same_store: BEGIN
15:48:33.072686 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
15:48:33.072927 [debug] [Thread-2  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
15:48:33.098275 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.12 seconds
15:48:33.099827 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__fct_item: COMMIT
15:48:33.100110 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_item"
15:48:33.100332 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__fct_item: COMMIT
15:48:34.420678 [debug] [Thread-3  ]: SQL status: COMMIT in 1.32 seconds
15:48:34.421257 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_item"
15:48:34.421548 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__fct_item: BEGIN
15:48:34.482137 [debug] [Thread-3  ]: SQL status: BEGIN in 0.06 seconds
15:48:34.483252 [debug] [Thread-3  ]: finished collecting timing info
15:48:34.483799 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_tender"
15:48:34.484788 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__fct_item: ROLLBACK
15:48:34.485168 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__fct_tender: BEGIN
15:48:34.589212 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__fct_item: Close
15:48:34.590718 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6d1c280-5e0f-4d6b-83df-6573bf08eb2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa716402070>]}
15:48:34.592324 [info ] [Thread-3  ]: 13 of 55 OK created view model public.lcarr_sosx_stg__fct_item.................. [[32mCREATE VIEW[0m in 14.39s]
15:48:34.592906 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.stg__fct_item
15:48:34.593426 [debug] [Thread-2  ]: SQL status: BEGIN in 1.52 seconds
15:48:34.593660 [debug] [Thread-4  ]: SQL status: BEGIN in 0.11 seconds
15:48:34.594315 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_same_store"
15:48:34.594575 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.item
15:48:34.598298 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_tender"
15:48:34.598841 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__fct_same_store: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__fct_same_store"} */


  create view "cfa"."public"."stg__fct_same_store__dbt_tmp" as (
    with subset_1 as ( 
  select * 
  from "cfa"."public"."lcarr_sosx_stg__dim_same_store"
  where monthend_date = cast('02-28-2022' as date) 
), subset_2 as ( 
  select * 
  from "cfa"."public"."lcarr_sosx_stg__dim_same_store"
  where monthend_date = cast('02-28-2021' as date) 
), current_comparison as (
  select s1.location_num,
  s1.look_back_period,s1.monthend_date,
  s1.actual_days as current_actual_days,s1.avail_days as current_avail_days,
  s1.same_store_percent as current_same_store_percent,
  s1.previous_year_monthend_date,
  s2.monthend_date as date_check,
  s2.actual_days as previous_actual_days,
  s2.avail_days as previous_avail_days,
  s2.same_store_percent as previous_same_store_percent
  from subset_1 s1
  inner join subset_2 s2
  on s1.location_num = s2.location_num 
  and s1.look_back_period = s2.look_back_period
  and s1.previous_year_monthend_date = s2.monthend_date
), same_store_eligibility_calc as ( 
  select location_num,look_back_period,monthend_date,
  current_actual_days,current_avail_days,current_same_store_percent,
  previous_year_monthend_date,previous_actual_days,
  previous_avail_days,previous_same_store_percent,
  case when current_same_store_percent >= 0.90
  and previous_same_store_percent >= 0.90 then 1 else 0 end as same_store_eligible
  from current_comparison
), same_store_final_output as (
  select location_num,look_back_period,monthend_date,
  current_actual_days as actual_days,current_avail_days as avail_days,
  same_store_eligible from same_store_eligibility_calc
  union 
  select location_num,look_back_period,previous_year_monthend_date as monthend_date,
  previous_actual_days as actual_days,previous_avail_days as avail_days,
  same_store_eligible from same_store_eligibility_calc
)
select * from same_store_final_output
  ) with no schema binding;

15:48:34.599586 [info ] [Thread-3  ]: 17 of 55 START table model public.lcarr_sosx_item............................... [RUN]
15:48:34.600005 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__fct_tender: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__fct_tender"} */
drop view if exists "cfa"."public"."stg__fct_tender__dbt_backup" cascade
15:48:34.601419 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.item"
15:48:34.602457 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.item
15:48:34.602910 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.item
15:48:34.608194 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.item"
15:48:34.608911 [debug] [Thread-3  ]: finished collecting timing info
15:48:34.609138 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.item
15:48:34.680498 [debug] [Thread-3  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.item"
15:48:34.681245 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.item"
15:48:34.681492 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.item: BEGIN
15:48:34.681689 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
15:48:34.681880 [debug] [Thread-3  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
15:48:34.706700 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.11 seconds
15:48:34.713400 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_same_store"
15:48:34.713697 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__fct_same_store: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__fct_same_store"} */
alter table "cfa"."public"."lcarr_sosx_stg__fct_same_store" rename to "stg__fct_same_store__dbt_backup"
15:48:34.780200 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.07 seconds
15:48:34.785010 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_same_store"
15:48:34.785492 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__fct_same_store: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__fct_same_store"} */
alter table "cfa"."public"."stg__fct_same_store__dbt_tmp" rename to "lcarr_sosx_stg__fct_same_store"
15:48:34.842474 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.06 seconds
15:48:34.843965 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__fct_same_store: COMMIT
15:48:34.844370 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_same_store"
15:48:34.844682 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__fct_same_store: COMMIT
15:48:34.850698 [debug] [Thread-4  ]: SQL status: DROP VIEW in 0.25 seconds
15:48:34.852372 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__fct_tender: COMMIT
15:48:34.852807 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_tender"
15:48:34.853130 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__fct_tender: COMMIT
15:48:35.283203 [debug] [Thread-3  ]: SQL status: BEGIN in 0.6 seconds
15:48:35.283842 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.item"
15:48:35.284121 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.item: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.item"} */


  create  table
    "cfa"."public"."item__dbt_tmp"
    
    
    
  as (
    with fct_item as ( 
    select business_date, location_num, trans_id, pin,
    item_sold_count, item_promo_count
    from "cfa"."public"."lcarr_sosx_stg__fct_item"
), location as ( 
    select location_num, service_team_name, location_type_code,
    region_name, dma_name 
    from "cfa"."public"."lcarr_sosx_stg__dim_location"
), dim_item as ( 
    select pin, hierarchy_1
    from "cfa"."public"."lcarr_sosx_stg__dim_item"
), item as ( 
    select business_date, location_num, trans_id,
        sum(item_sold_count) as total_items_sold_count,
        sum(item_promo_count) as total_items_promo_count
    from fct_item
    inner join dim_item using (pin)
    inner join location using (location_num)
    where hierarchy_1 <> ''
        and hierarchy_1 <> ' '
        and hierarchy_1 is not null
        and hierarchy_1 not in ('Non-Food','Miscellaneous') 
    group by 1, 2, 3
)

select *
from item
  );
15:48:37.951553 [debug] [Thread-2  ]: SQL status: COMMIT in 3.11 seconds
15:48:37.954127 [debug] [Thread-4  ]: SQL status: COMMIT in 3.1 seconds
15:48:37.954611 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_tender"
15:48:37.954943 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__fct_tender: BEGIN
15:48:38.013106 [debug] [Thread-4  ]: SQL status: BEGIN in 0.06 seconds
15:48:38.014201 [debug] [Thread-4  ]: finished collecting timing info
15:48:38.014622 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_same_store"
15:48:38.015006 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__fct_tender: ROLLBACK
15:48:38.015339 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__fct_same_store: BEGIN
15:48:38.117549 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__fct_tender: Close
15:48:38.118787 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6d1c280-5e0f-4d6b-83df-6573bf08eb2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa71645ab50>]}
15:48:38.119885 [info ] [Thread-4  ]: 14 of 55 OK created view model public.lcarr_sosx_stg__fct_tender................ [[32mCREATE VIEW[0m in 14.49s]
15:48:38.120686 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.stg__fct_tender
15:48:38.122035 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.tender
15:48:38.123054 [info ] [Thread-4  ]: 18 of 55 START table model public.lcarr_sosx_tender............................. [RUN]
15:48:38.124151 [debug] [Thread-2  ]: SQL status: BEGIN in 0.11 seconds
15:48:38.125082 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.tender"
15:48:38.131217 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.tender
15:48:38.130924 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_same_store"
15:48:38.131835 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.tender
15:48:38.132341 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__fct_same_store: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__fct_same_store"} */
drop view if exists "cfa"."public"."stg__fct_same_store__dbt_backup" cascade
15:48:38.138505 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.tender"
15:48:38.139645 [debug] [Thread-4  ]: finished collecting timing info
15:48:38.140058 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.tender
15:48:38.278653 [debug] [Thread-4  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.tender"
15:48:38.280583 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.tender"
15:48:38.281009 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.tender: BEGIN
15:48:38.281303 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
15:48:38.281685 [debug] [Thread-4  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
15:48:38.879237 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.74 seconds
15:48:38.880894 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__fct_same_store: COMMIT
15:48:38.881170 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_same_store"
15:48:38.881418 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__fct_same_store: COMMIT
15:48:39.107582 [debug] [Thread-4  ]: SQL status: BEGIN in 0.83 seconds
15:48:39.107999 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.tender"
15:48:39.108522 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.tender: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.tender"} */


  create  table
    "cfa"."public"."tender__dbt_tmp"
    
    
    
  as (
    with fct_tender as ( 
    select business_date, location_num, trans_id,
    tender_description, destination_desc
    from "cfa"."public"."lcarr_sosx_stg__fct_tender"
), location as ( 
    select location_num, service_team_name, location_type_code,
    region_name, dma_name 
    from "cfa"."public"."lcarr_sosx_stg__dim_location"
), tender as ( 
    select business_date, location_num, trans_id, 
       -- destination_desc, tender_description, tender_type, 
       max(case when tender_description = 'Credit' then 1
            when tender_description in ('Exact Dollar', 'On Demand', 'CFA Card', '$20', 'Cash', 'Next Dollar', '$10') then 0
	        when tender_description not like '%Credit%'
	             or destination_desc='' or destination_desc=' ' or destination_desc is null
	             or destination_desc='Other' then 0
	   else 1 end) as credit_flag
 from fct_tender
 inner join location using (location_num) 
 group by 1, 2, 3
)

select *
from tender
  );
15:48:40.649281 [debug] [Thread-2  ]: SQL status: COMMIT in 1.77 seconds
15:48:40.649927 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_same_store"
15:48:40.650220 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__fct_same_store: BEGIN
15:48:40.733521 [debug] [Thread-2  ]: SQL status: BEGIN in 0.08 seconds
15:48:40.735530 [debug] [Thread-2  ]: finished collecting timing info
15:48:40.735833 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__fct_same_store: ROLLBACK
15:48:40.838332 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__fct_same_store: Close
15:48:40.839888 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6d1c280-5e0f-4d6b-83df-6573bf08eb2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa71649f850>]}
15:48:40.840423 [info ] [Thread-2  ]: 16 of 55 OK created view model public.lcarr_sosx_stg__fct_same_store............ [[32mCREATE VIEW[0m in 7.86s]
15:48:40.840899 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.stg__fct_same_store
15:48:40.841526 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.calc__dim_price_index_2
15:48:40.841904 [info ] [Thread-2  ]: 19 of 55 START view model public.lcarr_sosx_calc__dim_price_index_2............. [RUN]
15:48:40.842641 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_2"
15:48:40.842991 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.calc__dim_price_index_2
15:48:40.843242 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.calc__dim_price_index_2
15:48:40.847206 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.calc__dim_price_index_2"
15:48:40.848239 [debug] [Thread-2  ]: finished collecting timing info
15:48:40.848543 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.calc__dim_price_index_2
15:48:40.917914 [debug] [Thread-2  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.calc__dim_price_index_2"
15:48:40.918715 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_2"
15:48:40.918938 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_2: BEGIN
15:48:40.919166 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
15:48:40.919590 [debug] [Thread-2  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
15:48:41.697454 [debug] [Thread-2  ]: SQL status: BEGIN in 0.78 seconds
15:48:41.698045 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_2"
15:48:41.698316 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_2: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.calc__dim_price_index_2"} */


  create view "cfa"."public"."calc__dim_price_index_2__dbt_tmp" as (
    with add_same_store_flag as ( 
  SELECT a.dma_name,
  a.location_num,
  a.monthend_date,
  a.look_back_period,
  a.month_sales,
  a.adjusted_sales,
  a.month_sales_pg1,
  a.adjusted_sales_pg1,
  b.same_store_eligible
  FROM "cfa"."public"."lcarr_sosx_calc__dim_price_index_1" a
  inner join "cfa"."public"."lcarr_sosx_stg__fct_same_store" b
  on a.location_num = b.location_num
  and a.monthend_date = b.monthend_date 
), market_aggregation_all_stores as ( 
  select monthend_date,look_back_period,'All Stores' as same_store,
  sum(month_sales) as market_month_sales,
  sum(adjusted_sales) as market_adjusted_sales,
  sum(month_sales_pg1) as market_month_sales_pg1,
  sum(adjusted_sales_pg1) as market_adjusted_sales_pg1
  from add_same_store_flag
  group by 1,2
), market_aggregation_same_stores as ( 
  select monthend_date,look_back_period,'Same Stores' as same_store,
  sum(month_sales) as market_month_sales,
  sum(adjusted_sales) as market_adjusted_sales,
  sum(month_sales_pg1) as market_month_sales_pg1,
  sum(adjusted_sales_pg1) as market_adjusted_sales_pg1
  from add_same_store_flag
  where same_store_eligible = 1
  group by 1,2
), union_all_same_store as ( 
  select monthend_date,look_back_period,same_store,
  market_month_sales,market_adjusted_sales,
  market_month_sales_pg1,market_adjusted_sales_pg1
  from market_aggregation_all_stores
  union
  select monthend_date,look_back_period,same_store,
  market_month_sales,market_adjusted_sales,
  market_month_sales_pg1,market_adjusted_sales_pg1
  from market_aggregation_same_stores
), base_calcs as (
  SELECT monthend_date,look_back_period,same_store,
  market_month_sales,market_adjusted_sales,market_month_sales_pg1,market_adjusted_sales_pg1,
  case when market_adjusted_sales_pg1 = 0.00 then 0.00 else 
  cast(market_month_sales_pg1/market_adjusted_sales_pg1 as float) end as pg1_ratio,
  case when market_month_sales_pg1 = 0.00 then 0.00 else
  cast(market_month_sales/market_month_sales_pg1 as float) end as actual_vs_pg1
  from union_all_same_store
)
select * from base_calcs
  ) with no schema binding;

15:48:41.819713 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.12 seconds
15:48:41.823487 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_2"
15:48:41.823817 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_2: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.calc__dim_price_index_2"} */
alter table "cfa"."public"."lcarr_sosx_calc__dim_price_index_2" rename to "calc__dim_price_index_2__dbt_backup"
15:48:41.883625 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.06 seconds
15:48:41.887482 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_2"
15:48:41.887795 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_2: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.calc__dim_price_index_2"} */
alter table "cfa"."public"."calc__dim_price_index_2__dbt_tmp" rename to "lcarr_sosx_calc__dim_price_index_2"
15:48:41.946055 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.06 seconds
15:48:41.948219 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_2: COMMIT
15:48:41.948564 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_2"
15:48:41.948824 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_2: COMMIT
15:48:44.234129 [debug] [Thread-2  ]: SQL status: COMMIT in 2.29 seconds
15:48:44.234674 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_2"
15:48:44.234923 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_2: BEGIN
15:48:44.295145 [debug] [Thread-2  ]: SQL status: BEGIN in 0.06 seconds
15:48:44.298709 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_2"
15:48:44.299008 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_2: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.calc__dim_price_index_2"} */
drop view if exists "cfa"."public"."calc__dim_price_index_2__dbt_backup" cascade
15:48:44.848224 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.55 seconds
15:48:44.850066 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_2: COMMIT
15:48:44.850416 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_2"
15:48:44.850652 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_2: COMMIT
15:48:47.893182 [debug] [Thread-2  ]: SQL status: COMMIT in 3.04 seconds
15:48:47.893734 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_2"
15:48:47.894534 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_2: BEGIN
15:48:47.952602 [debug] [Thread-2  ]: SQL status: BEGIN in 0.06 seconds
15:48:47.953793 [debug] [Thread-2  ]: finished collecting timing info
15:48:47.954290 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_2: ROLLBACK
15:48:48.132941 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_2: Close
15:48:48.134302 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6d1c280-5e0f-4d6b-83df-6573bf08eb2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa71635cb80>]}
15:48:48.135039 [info ] [Thread-2  ]: 19 of 55 OK created view model public.lcarr_sosx_calc__dim_price_index_2........ [[32mCREATE VIEW[0m in 7.29s]
15:48:48.135703 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.calc__dim_price_index_2
15:48:48.136555 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.calc__dim_price_index_3
15:48:48.137042 [info ] [Thread-2  ]: 20 of 55 START view model public.lcarr_sosx_calc__dim_price_index_3............. [RUN]
15:48:48.137942 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_3"
15:48:48.138270 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.calc__dim_price_index_3
15:48:48.138580 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.calc__dim_price_index_3
15:48:48.144852 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.calc__dim_price_index_3"
15:48:48.153692 [debug] [Thread-2  ]: finished collecting timing info
15:48:48.154218 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.calc__dim_price_index_3
15:48:48.251856 [debug] [Thread-2  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.calc__dim_price_index_3"
15:48:48.252953 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_3"
15:48:48.253197 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_3: BEGIN
15:48:48.253379 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
15:48:48.253588 [debug] [Thread-2  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
15:48:48.904323 [debug] [Thread-2  ]: SQL status: BEGIN in 0.65 seconds
15:48:48.904829 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_3"
15:48:48.905594 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_3: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.calc__dim_price_index_3"} */


  create view "cfa"."public"."calc__dim_price_index_3__dbt_tmp" as (
    with min_monthend_date as ( 
    select look_back_period,same_store,min(monthend_date) as min_monthend_date
    from "cfa"."public"."lcarr_sosx_calc__dim_price_index_2"
    group by 1,2
), anchor_calc as ( 
    select m.look_back_period,m.same_store,m.min_monthend_date,bc.pg1_ratio as anchor_ratio
    from min_monthend_date m
    inner join "cfa"."public"."lcarr_sosx_calc__dim_price_index_2" bc 
    on m.look_back_period = bc.look_back_period
    and m.same_store = bc.same_store
    and m.min_monthend_date = bc.monthend_date
), market_big_join as (
    select bc.*, ac.min_monthend_date, ac.anchor_ratio
    from "cfa"."public"."lcarr_sosx_calc__dim_price_index_2" bc 
    inner join anchor_calc ac
    on bc.look_back_period = ac.look_back_period
    and bc.same_store = ac.same_store
), ratio_change as ( 
    select *, pg1_ratio/anchor_ratio as pg1_ratio_change
    from market_big_join
), price_index_final as ( 
    select look_back_period,monthend_date,same_store,actual_vs_pg1*pg1_ratio_change as price_index
    from ratio_change
)
select * from price_index_final
  ) with no schema binding;

15:48:48.985707 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.08 seconds
15:48:48.991296 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_3"
15:48:48.991631 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_3: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.calc__dim_price_index_3"} */
alter table "cfa"."public"."lcarr_sosx_calc__dim_price_index_3" rename to "calc__dim_price_index_3__dbt_backup"
15:48:49.052837 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.06 seconds
15:48:49.056577 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_3"
15:48:49.056952 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_3: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.calc__dim_price_index_3"} */
alter table "cfa"."public"."calc__dim_price_index_3__dbt_tmp" rename to "lcarr_sosx_calc__dim_price_index_3"
15:48:49.129645 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.07 seconds
15:48:49.132161 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_3: COMMIT
15:48:49.132744 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_3"
15:48:49.133095 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_3: COMMIT
15:48:51.150586 [debug] [Thread-2  ]: SQL status: COMMIT in 2.02 seconds
15:48:51.152348 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_3"
15:48:51.152776 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_3: BEGIN
15:48:51.243816 [debug] [Thread-2  ]: SQL status: BEGIN in 0.09 seconds
15:48:51.249604 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_3"
15:48:51.249923 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_3: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.calc__dim_price_index_3"} */
drop view if exists "cfa"."public"."calc__dim_price_index_3__dbt_backup" cascade
15:48:51.821290 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.57 seconds
15:48:51.822810 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_3: COMMIT
15:48:51.823073 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_3"
15:48:51.823286 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_3: COMMIT
15:48:53.771247 [debug] [Thread-2  ]: SQL status: COMMIT in 1.95 seconds
15:48:53.771734 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_3"
15:48:53.772921 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_3: BEGIN
15:48:53.837004 [debug] [Thread-2  ]: SQL status: BEGIN in 0.06 seconds
15:48:53.838084 [debug] [Thread-2  ]: finished collecting timing info
15:48:53.838424 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_3: ROLLBACK
15:48:53.941104 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_3: Close
15:48:53.942383 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6d1c280-5e0f-4d6b-83df-6573bf08eb2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa7162fc040>]}
15:48:53.942941 [info ] [Thread-2  ]: 20 of 55 OK created view model public.lcarr_sosx_calc__dim_price_index_3........ [[32mCREATE VIEW[0m in 5.80s]
15:48:53.943508 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.calc__dim_price_index_3
15:49:36.258799 [debug] [Thread-3  ]: SQL status: SELECT in 60.97 seconds
15:49:36.263177 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.item"
15:49:36.263537 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.item: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.item"} */
alter table "cfa"."public"."lcarr_sosx_item" rename to "item__dbt_backup"
15:49:36.331308 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.07 seconds
15:49:36.334831 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.item"
15:49:36.335159 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.item: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.item"} */
alter table "cfa"."public"."item__dbt_tmp" rename to "lcarr_sosx_item"
15:49:36.395643 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.06 seconds
15:49:36.403323 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.item: COMMIT
15:49:36.403732 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.item"
15:49:36.403971 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.item: COMMIT
15:49:38.498053 [debug] [Thread-3  ]: SQL status: COMMIT in 2.09 seconds
15:49:38.498836 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.item"
15:49:38.499142 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.item: BEGIN
15:49:38.643591 [debug] [Thread-3  ]: SQL status: BEGIN in 0.14 seconds
15:49:38.648179 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.item"
15:49:38.648582 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.item: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.item"} */
drop table if exists "cfa"."public"."item__dbt_backup" cascade
15:49:39.079430 [debug] [Thread-3  ]: SQL status: DROP TABLE in 0.43 seconds
15:49:39.081010 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.item: COMMIT
15:49:39.081322 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.item"
15:49:39.081547 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.item: COMMIT
15:49:40.464909 [debug] [Thread-3  ]: SQL status: COMMIT in 1.38 seconds
15:49:40.465788 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.item"
15:49:40.466079 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.item: BEGIN
15:49:40.524919 [debug] [Thread-3  ]: SQL status: BEGIN in 0.06 seconds
15:49:40.526277 [debug] [Thread-3  ]: finished collecting timing info
15:49:40.526621 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.item: ROLLBACK
15:49:40.626631 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.item: Close
15:49:40.628218 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6d1c280-5e0f-4d6b-83df-6573bf08eb2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa715e93490>]}
15:49:40.628956 [info ] [Thread-3  ]: 17 of 55 OK created table model public.lcarr_sosx_item.......................... [[32mSELECT[0m in 66.03s]
15:49:40.629617 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.item
15:49:42.532505 [debug] [Thread-4  ]: SQL status: SELECT in 63.42 seconds
15:49:42.537515 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.tender"
15:49:42.537848 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.tender: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.tender"} */
alter table "cfa"."public"."lcarr_sosx_tender" rename to "tender__dbt_backup"
15:49:42.598518 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.06 seconds
15:49:42.602383 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.tender"
15:49:42.602699 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.tender: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.tender"} */
alter table "cfa"."public"."tender__dbt_tmp" rename to "lcarr_sosx_tender"
15:49:42.663916 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.06 seconds
15:49:42.665681 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.tender: COMMIT
15:49:42.665985 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.tender"
15:49:42.666199 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.tender: COMMIT
15:49:45.676116 [debug] [Thread-4  ]: SQL status: COMMIT in 3.01 seconds
15:49:45.677233 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.tender"
15:49:45.677524 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.tender: BEGIN
15:49:45.737308 [debug] [Thread-4  ]: SQL status: BEGIN in 0.06 seconds
15:49:45.741791 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.tender"
15:49:45.742134 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.tender: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.tender"} */
drop table if exists "cfa"."public"."tender__dbt_backup" cascade
15:49:45.984052 [debug] [Thread-4  ]: SQL status: DROP TABLE in 0.24 seconds
15:49:45.985558 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.tender: COMMIT
15:49:45.985822 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.tender"
15:49:45.986041 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.tender: COMMIT
15:49:47.935129 [debug] [Thread-4  ]: SQL status: COMMIT in 1.95 seconds
15:49:47.935595 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.tender"
15:49:47.935889 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.tender: BEGIN
15:49:48.008458 [debug] [Thread-4  ]: SQL status: BEGIN in 0.07 seconds
15:49:48.009584 [debug] [Thread-4  ]: finished collecting timing info
15:49:48.009969 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.tender: ROLLBACK
15:49:48.133882 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.tender: Close
15:49:48.134903 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6d1c280-5e0f-4d6b-83df-6573bf08eb2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa715cc2550>]}
15:49:48.135388 [info ] [Thread-4  ]: 18 of 55 OK created table model public.lcarr_sosx_tender........................ [[32mSELECT[0m in 70.01s]
15:49:48.135821 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.tender
15:52:20.604902 [debug] [Thread-1  ]: SQL status: SELECT in 234.31 seconds
15:52:20.609763 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.transaction"
15:52:20.610178 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.transaction: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.transaction"} */
alter table "cfa"."public"."lcarr_sosx_transaction" rename to "transaction__dbt_backup"
15:52:20.672232 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.06 seconds
15:52:20.676520 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.transaction"
15:52:20.676964 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.transaction: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.transaction"} */
alter table "cfa"."public"."transaction__dbt_tmp" rename to "lcarr_sosx_transaction"
15:52:20.734345 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.06 seconds
15:52:20.736879 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.transaction: COMMIT
15:52:20.737186 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.transaction"
15:52:20.737389 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.transaction: COMMIT
15:52:23.577006 [debug] [Thread-1  ]: SQL status: COMMIT in 2.84 seconds
15:52:23.577704 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.transaction"
15:52:23.577938 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.transaction: BEGIN
15:52:23.639082 [debug] [Thread-1  ]: SQL status: BEGIN in 0.06 seconds
15:52:23.642845 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.transaction"
15:52:23.643152 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.transaction: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.transaction"} */
drop table if exists "cfa"."public"."transaction__dbt_backup" cascade
15:52:23.720724 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.08 seconds
15:52:23.722479 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.transaction: COMMIT
15:52:23.722989 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.transaction"
15:52:23.723352 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.transaction: COMMIT
15:52:24.613934 [debug] [Thread-1  ]: SQL status: COMMIT in 0.89 seconds
15:52:24.614397 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.transaction"
15:52:24.614679 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.transaction: BEGIN
15:52:24.675800 [debug] [Thread-1  ]: SQL status: BEGIN in 0.06 seconds
15:52:24.676676 [debug] [Thread-1  ]: finished collecting timing info
15:52:24.676959 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.transaction: ROLLBACK
15:52:24.778140 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.transaction: Close
15:52:24.779369 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6d1c280-5e0f-4d6b-83df-6573bf08eb2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa71616b6a0>]}
15:52:24.779939 [info ] [Thread-1  ]: 15 of 55 OK created table model public.lcarr_sosx_transaction................... [[32mSELECT[0m in 239.46s]
15:52:24.780369 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.transaction
15:52:24.781188 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.trans_detail
15:52:24.781851 [info ] [Thread-2  ]: 21 of 55 START table model public.lcarr_sosx_trans_detail....................... [RUN]
15:52:24.782750 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.trans_detail"
15:52:24.783690 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.trans_detail
15:52:24.784175 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.trans_detail
15:52:24.789370 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.trans_detail"
15:52:24.790471 [debug] [Thread-2  ]: finished collecting timing info
15:52:24.790872 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.trans_detail
15:52:24.864598 [debug] [Thread-2  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.trans_detail"
15:52:24.866003 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.trans_detail"
15:52:24.866302 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.trans_detail: BEGIN
15:52:24.866491 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
15:52:24.866683 [debug] [Thread-2  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
15:52:26.535606 [debug] [Thread-2  ]: SQL status: BEGIN in 1.67 seconds
15:52:26.536122 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.trans_detail"
15:52:26.536354 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.trans_detail: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.trans_detail"} */


  create  table
    "cfa"."public"."trans_detail__dbt_tmp"
    
    
    
  as (
    with transaction as
(select business_date, location_num, trans_id,
        tax_amount, delivery_tip, destination_desc, dest_alias, daypart,
        sales_sub_total, cfa_one_id, customer_hash, visit_count, quarter, 
        monthend_date, region_name, dma_name, location_type_code, service_team_name
 from "cfa"."public"."lcarr_sosx_transaction"
),

tender as
(select business_date, location_num, trans_id, 
        credit_flag
 from "cfa"."public"."lcarr_sosx_tender"
),

trans_detail as
(select business_date, location_num, trans_id, daypart,
        sales_sub_total, cfa_one_id, customer_hash, visit_count,
        destination_desc, dest_alias, credit_flag, quarter, 
        monthend_date, region_name, dma_name, location_type_code, service_team_name
 from transaction
 inner join tender using (business_date, location_num, trans_id)
)

select * 
from trans_detail
  );
15:55:23.196848 [debug] [Thread-2  ]: SQL status: SELECT in 176.66 seconds
15:55:23.201163 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.trans_detail"
15:55:23.201819 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.trans_detail: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.trans_detail"} */
alter table "cfa"."public"."lcarr_sosx_trans_detail" rename to "trans_detail__dbt_backup"
15:55:23.262236 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.06 seconds
15:55:23.266268 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.trans_detail"
15:55:23.267164 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.trans_detail: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.trans_detail"} */
alter table "cfa"."public"."trans_detail__dbt_tmp" rename to "lcarr_sosx_trans_detail"
15:55:23.332399 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.06 seconds
15:55:23.335876 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.trans_detail: COMMIT
15:55:23.336233 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.trans_detail"
15:55:23.336460 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.trans_detail: COMMIT
15:55:27.689920 [debug] [Thread-2  ]: SQL status: COMMIT in 4.35 seconds
15:55:27.690621 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.trans_detail"
15:55:27.690871 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.trans_detail: BEGIN
15:55:27.753081 [debug] [Thread-2  ]: SQL status: BEGIN in 0.06 seconds
15:55:27.758997 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.trans_detail"
15:55:27.759326 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.trans_detail: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.trans_detail"} */
drop table if exists "cfa"."public"."trans_detail__dbt_backup" cascade
15:55:27.870702 [debug] [Thread-2  ]: SQL status: DROP TABLE in 0.11 seconds
15:55:27.872355 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.trans_detail: COMMIT
15:55:27.872633 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.trans_detail"
15:55:27.872870 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.trans_detail: COMMIT
15:55:29.217563 [debug] [Thread-2  ]: SQL status: COMMIT in 1.34 seconds
15:55:29.218115 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.trans_detail"
15:55:29.218354 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.trans_detail: BEGIN
15:55:29.280778 [debug] [Thread-2  ]: SQL status: BEGIN in 0.06 seconds
15:55:29.281631 [debug] [Thread-2  ]: finished collecting timing info
15:55:29.281926 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.trans_detail: ROLLBACK
15:55:29.465835 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.trans_detail: Close
15:55:29.468211 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6d1c280-5e0f-4d6b-83df-6573bf08eb2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa7164c3160>]}
15:55:29.468849 [info ] [Thread-2  ]: 21 of 55 OK created table model public.lcarr_sosx_trans_detail.................. [[32mSELECT[0m in 184.69s]
15:55:29.469410 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.trans_detail
15:55:29.470311 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.trans_item
15:55:29.470905 [info ] [Thread-4  ]: 22 of 55 START table model public.lcarr_sosx_trans_item......................... [RUN]
15:55:29.471851 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.trans_item"
15:55:29.472165 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.trans_item
15:55:29.472453 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.trans_item
15:55:29.476544 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.trans_item"
15:55:29.478416 [debug] [Thread-4  ]: finished collecting timing info
15:55:29.478787 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.trans_item
15:55:29.548124 [debug] [Thread-4  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.trans_item"
15:55:29.549741 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.trans_item"
15:55:29.550173 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.trans_item: BEGIN
15:55:29.550370 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
15:55:29.550562 [debug] [Thread-4  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
15:55:30.276939 [debug] [Thread-4  ]: SQL status: BEGIN in 0.73 seconds
15:55:30.277328 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.trans_item"
15:55:30.277735 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.trans_item: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.trans_item"} */


  create  table
    "cfa"."public"."trans_item__dbt_tmp"
    
    
    
  as (
    with trans_detail as
(select business_date, location_num, trans_id, 
        sales_sub_total, cfa_one_id, customer_hash, 
        visit_count, credit_flag, quarter, destination_desc, daypart, 
        monthend_date, region_name, dma_name, location_type_code, service_team_name
 from "cfa"."public"."lcarr_sosx_trans_detail"
),

item as
(select business_date, location_num, trans_id, 
        total_items_sold_count, total_items_promo_count
 from "cfa"."public"."lcarr_sosx_item"
),

trans_item as
(select business_date, location_num, trans_id, 
        sales_sub_total, cfa_one_id, customer_hash, 
        visit_count, credit_flag, quarter, destination_desc, daypart, 
        monthend_date, region_name, dma_name, location_type_code, service_team_name,
        nvl(total_items_sold_count, 0) as total_items_sold_count, 
        nvl(total_items_promo_count, 0) as total_items_promo_count
 from trans_detail
 inner join item using (business_date, location_num, trans_id)
)

select *
from trans_item
  );
15:56:49.441563 [debug] [Thread-4  ]: SQL status: SELECT in 79.16 seconds
15:56:49.445341 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.trans_item"
15:56:49.445630 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.trans_item: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.trans_item"} */
alter table "cfa"."public"."lcarr_sosx_trans_item" rename to "trans_item__dbt_backup"
15:56:49.505055 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.06 seconds
15:56:49.508713 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.trans_item"
15:56:49.509002 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.trans_item: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.trans_item"} */
alter table "cfa"."public"."trans_item__dbt_tmp" rename to "lcarr_sosx_trans_item"
15:56:49.567669 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.06 seconds
15:56:49.570223 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.trans_item: COMMIT
15:56:49.570559 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.trans_item"
15:56:49.570792 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.trans_item: COMMIT
15:56:52.271233 [debug] [Thread-4  ]: SQL status: COMMIT in 2.7 seconds
15:56:52.271888 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.trans_item"
15:56:52.272141 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.trans_item: BEGIN
15:56:52.332288 [debug] [Thread-4  ]: SQL status: BEGIN in 0.06 seconds
15:56:52.336880 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.trans_item"
15:56:52.337256 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.trans_item: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.trans_item"} */
drop table if exists "cfa"."public"."trans_item__dbt_backup" cascade
15:56:52.402627 [debug] [Thread-4  ]: SQL status: DROP TABLE in 0.07 seconds
15:56:52.404394 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.trans_item: COMMIT
15:56:52.404754 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.trans_item"
15:56:52.405243 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.trans_item: COMMIT
15:56:53.472703 [debug] [Thread-4  ]: SQL status: COMMIT in 1.07 seconds
15:56:53.473487 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.trans_item"
15:56:53.473788 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.trans_item: BEGIN
15:56:53.574020 [debug] [Thread-4  ]: SQL status: BEGIN in 0.1 seconds
15:56:53.575019 [debug] [Thread-4  ]: finished collecting timing info
15:56:53.575354 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.trans_item: ROLLBACK
15:56:53.676325 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.trans_item: Close
15:56:53.677579 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6d1c280-5e0f-4d6b-83df-6573bf08eb2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa7164a7c70>]}
15:56:53.678244 [info ] [Thread-4  ]: 22 of 55 OK created table model public.lcarr_sosx_trans_item.................... [[32mSELECT[0m in 84.21s]
15:56:53.678894 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.trans_item
15:56:53.680893 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.ast_agg__all_groupings
15:56:53.681410 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct
15:56:53.681797 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.market_agg__all_groupings
15:56:53.682735 [info ] [Thread-3  ]: 23 of 55 START table model public.lcarr_sosx_ast_agg__all_groupings............. [RUN]
15:56:53.683118 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct
15:56:53.683845 [info ] [Thread-2  ]: 24 of 55 START table model public.lcarr_sosx_ast_agg__month_lookback_distinct... [RUN]
15:56:53.684845 [info ] [Thread-1  ]: 25 of 55 START table model public.lcarr_sosx_market_agg__all_groupings.......... [RUN]
15:56:53.686062 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.ast_agg__all_groupings"
15:56:53.686662 [info ] [Thread-4  ]: 26 of 55 START table model public.lcarr_sosx_market_agg__month_lookback_distinct [RUN]
15:56:53.687822 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct"
15:56:53.688828 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.market_agg__all_groupings"
15:56:53.689401 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.ast_agg__all_groupings
15:56:53.690604 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct"
15:56:53.691025 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct
15:56:53.691406 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.market_agg__all_groupings
15:56:53.691814 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.ast_agg__all_groupings
15:56:53.692192 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct
15:56:53.692566 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct
15:56:53.693099 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.market_agg__all_groupings
15:56:53.699572 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct
15:56:53.704415 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.ast_agg__all_groupings"
15:56:53.710402 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct"
15:56:53.717447 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.market_agg__all_groupings"
15:56:53.723251 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct"
15:56:53.724890 [debug] [Thread-4  ]: finished collecting timing info
15:56:53.725338 [debug] [Thread-1  ]: finished collecting timing info
15:56:53.725823 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct
15:56:53.726200 [debug] [Thread-2  ]: finished collecting timing info
15:56:53.726651 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.market_agg__all_groupings
15:56:53.726980 [debug] [Thread-3  ]: finished collecting timing info
15:56:53.739754 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct
15:56:53.758848 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.ast_agg__all_groupings
15:56:54.121435 [debug] [Thread-4  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct"
15:56:54.144008 [debug] [Thread-1  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.market_agg__all_groupings"
15:56:54.176164 [debug] [Thread-3  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.ast_agg__all_groupings"
15:56:54.194491 [debug] [Thread-2  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct"
15:56:54.195187 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct"
15:56:54.196989 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__all_groupings"
15:56:54.197427 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__all_groupings"
15:56:54.197861 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct: BEGIN
15:56:54.198236 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__all_groupings: BEGIN
15:56:54.198626 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct"
15:56:54.198911 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.ast_agg__all_groupings: BEGIN
15:56:54.199245 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
15:56:54.199597 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
15:56:54.199945 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct: BEGIN
15:56:54.200282 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
15:56:54.202448 [debug] [Thread-3  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
15:56:54.200706 [debug] [Thread-4  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
15:56:54.201081 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
15:56:54.201433 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
15:56:54.207012 [debug] [Thread-2  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
15:56:55.300667 [debug] [Thread-2  ]: SQL status: BEGIN in 1.1 seconds
15:56:55.301268 [debug] [Thread-4  ]: SQL status: BEGIN in 1.1 seconds
15:56:55.301647 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct"
15:56:55.301906 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct"
15:56:55.302212 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct"} */


  create  table
    "cfa"."public"."ast_agg__month_lookback_distinct__dbt_tmp"
    
    
    
  as (
    with one_month_set_up as (
  select a.region_name,a.service_team_name,a.dma_name,
  a.location_num,a.monthend_date,'1 month' as look_back_period,
  a.trans_id,a.cfa_one_id,a.customer_hash,
  a.location_type_code,a.daypart,a.destination_desc,
  b.same_store_eligible
  from "cfa"."public"."lcarr_sosx_trans_item" a
  inner join "cfa"."public"."lcarr_sosx_stg__fct_same_store" b
  on a.location_num = b.location_num
  and a.monthend_date = b.monthend_date 
  and b.look_back_period = '1 month'
)
select * from one_month_set_up
  );
15:56:55.302496 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct"} */


  create  table
    "cfa"."public"."market_agg__month_lookback_distinct__dbt_tmp"
    
    
    
  as (
    with one_month_set_up as (
  select a.region_name,a.service_team_name,a.dma_name,
  a.location_num,a.monthend_date,'1 month' as look_back_period,
  a.trans_id,a.cfa_one_id,a.customer_hash,
  a.location_type_code,a.daypart,a.destination_desc,
  b.same_store_eligible
  from "cfa"."public"."lcarr_sosx_trans_item" a
  inner join "cfa"."public"."lcarr_sosx_stg__fct_same_store" b
  on a.location_num = b.location_num
  and a.monthend_date = b.monthend_date 
  and b.look_back_period = '1 month'
)
select * from one_month_set_up
  );
15:56:55.357496 [debug] [Thread-3  ]: SQL status: BEGIN in 1.16 seconds
15:56:55.357921 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__all_groupings"
15:56:55.358190 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.ast_agg__all_groupings: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.ast_agg__all_groupings"} */


  create  table
    "cfa"."public"."ast_agg__all_groupings__dbt_tmp"
    
    
    
  as (
    with aggregations_all_groupings as (
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    location_type_code,daypart,destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    location_type_code,'All' as daypart,destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    location_type_code,'All' as daypart,'All' as destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    location_type_code,daypart,'All' as destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    'All' as location_type_code,daypart,'All' as destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    'All' as location_type_code,daypart,destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    'All' as location_type_code,'All' as daypart,destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
) 
select * from aggregations_all_groupings
  );
15:56:55.362933 [debug] [Thread-1  ]: SQL status: BEGIN in 1.16 seconds
15:56:55.363480 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__all_groupings"
15:56:55.363738 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__all_groupings: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__all_groupings"} */


  create  table
    "cfa"."public"."market_agg__all_groupings__dbt_tmp"
    
    
    
  as (
    with aggregations_all_groupings as (
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    location_type_code,daypart,destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    location_type_code,'All' as daypart,destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    location_type_code,'All' as daypart,'All' as destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    location_type_code,daypart,'All' as destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    'All' as location_type_code,daypart,'All' as destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    'All' as location_type_code,daypart,destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    'All' as location_type_code,'All' as daypart,destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
) 
select * from aggregations_all_groupings
  );
15:58:33.635833 [debug] [Thread-2  ]: SQL status: SELECT in 98.33 seconds
15:58:33.640031 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct"
15:58:33.640380 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct"} */
alter table "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct" rename to "ast_agg__month_lookback_distinct__dbt_backup"
15:58:33.721622 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.08 seconds
15:58:33.725160 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct"
15:58:33.725428 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct"} */
alter table "cfa"."public"."ast_agg__month_lookback_distinct__dbt_tmp" rename to "lcarr_sosx_ast_agg__month_lookback_distinct"
15:58:33.815080 [debug] [Thread-4  ]: SQL status: SELECT in 98.51 seconds
15:58:33.815738 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.09 seconds
15:58:33.820920 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct"
15:58:33.823068 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct: COMMIT
15:58:33.823381 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct"} */
alter table "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct" rename to "market_agg__month_lookback_distinct__dbt_backup"
15:58:33.823636 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct"
15:58:33.823979 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct: COMMIT
15:58:33.938245 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.11 seconds
15:58:33.942825 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct"
15:58:33.943160 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct"} */
alter table "cfa"."public"."market_agg__month_lookback_distinct__dbt_tmp" rename to "lcarr_sosx_market_agg__month_lookback_distinct"
15:58:34.113550 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.17 seconds
15:58:34.115648 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct: COMMIT
15:58:34.115973 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct"
15:58:34.116202 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct: COMMIT
15:58:38.640047 [debug] [Thread-2  ]: SQL status: COMMIT in 4.82 seconds
15:58:38.640518 [debug] [Thread-4  ]: SQL status: COMMIT in 4.52 seconds
15:58:38.640994 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct"
15:58:38.641471 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct: BEGIN
15:58:38.698630 [debug] [Thread-2  ]: SQL status: BEGIN in 0.06 seconds
15:58:38.702312 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct"
15:58:38.702610 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct"} */
drop table if exists "cfa"."public"."ast_agg__month_lookback_distinct__dbt_backup" cascade
15:58:39.354027 [debug] [Thread-2  ]: SQL status: DROP TABLE in 0.65 seconds
15:58:39.356380 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct: COMMIT
15:58:39.356781 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct"
15:58:39.357076 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct: COMMIT
15:58:40.651762 [debug] [Thread-2  ]: SQL status: COMMIT in 1.29 seconds
15:58:40.652225 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct"
15:58:40.652515 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct: BEGIN
15:58:40.732477 [debug] [Thread-2  ]: SQL status: BEGIN in 0.08 seconds
15:58:40.733903 [debug] [Thread-2  ]: finished collecting timing info
15:58:40.734405 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct"
15:58:40.734698 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct: ROLLBACK
15:58:40.735032 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct: BEGIN
15:58:40.959616 [debug] [Thread-4  ]: SQL status: BEGIN in 0.22 seconds
15:58:40.959989 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct: Close
15:58:40.963998 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct"
15:58:40.964540 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct"} */
drop table if exists "cfa"."public"."market_agg__month_lookback_distinct__dbt_backup" cascade
15:58:40.965239 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6d1c280-5e0f-4d6b-83df-6573bf08eb2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa7164144c0>]}
15:58:40.966017 [info ] [Thread-2  ]: 24 of 55 OK created table model public.lcarr_sosx_ast_agg__month_lookback_distinct [[32mSELECT[0m in 107.28s]
15:58:40.966457 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct
15:58:40.966843 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.national_agg__all_groupings
15:58:40.967364 [info ] [Thread-2  ]: 27 of 55 START table model public.lcarr_sosx_national_agg__all_groupings........ [RUN]
15:58:40.968195 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national_agg__all_groupings"
15:58:40.968422 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.national_agg__all_groupings
15:58:40.968632 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.national_agg__all_groupings
15:58:40.976186 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national_agg__all_groupings"
15:58:40.977182 [debug] [Thread-2  ]: finished collecting timing info
15:58:40.977471 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.national_agg__all_groupings
15:58:41.070421 [debug] [Thread-2  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.national_agg__all_groupings"
15:58:41.071272 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__all_groupings"
15:58:41.071580 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__all_groupings: BEGIN
15:58:41.071761 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
15:58:41.071991 [debug] [Thread-2  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
15:58:41.241456 [debug] [Thread-4  ]: SQL status: DROP TABLE in 0.28 seconds
15:58:41.242721 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct: COMMIT
15:58:41.242999 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct"
15:58:41.243199 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct: COMMIT
15:58:41.997388 [debug] [Thread-2  ]: SQL status: BEGIN in 0.93 seconds
15:58:41.997901 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__all_groupings"
15:58:41.998255 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__all_groupings: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__all_groupings"} */


  create  table
    "cfa"."public"."national_agg__all_groupings__dbt_tmp"
    
    
    
  as (
    with aggregations_all_groupings as (
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    location_type_code,daypart,destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    location_type_code,'All' as daypart,destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    location_type_code,'All' as daypart,'All' as destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    location_type_code,daypart,'All' as destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    'All' as location_type_code,daypart,'All' as destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    'All' as location_type_code,daypart,destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    'All' as location_type_code,'All' as daypart,destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
) 
select * from aggregations_all_groupings
  );
15:58:42.508676 [debug] [Thread-4  ]: SQL status: COMMIT in 1.27 seconds
15:58:42.509191 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct"
15:58:42.509702 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct: BEGIN
15:58:42.759595 [debug] [Thread-4  ]: SQL status: BEGIN in 0.25 seconds
15:58:42.760581 [debug] [Thread-4  ]: finished collecting timing info
15:58:42.760889 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct: ROLLBACK
15:58:42.865345 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct: Close
15:58:42.866463 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6d1c280-5e0f-4d6b-83df-6573bf08eb2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa715e95dc0>]}
15:58:42.866967 [info ] [Thread-4  ]: 26 of 55 OK created table model public.lcarr_sosx_market_agg__month_lookback_distinct [[32mSELECT[0m in 109.18s]
15:58:42.867494 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct
15:58:42.867930 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct
15:58:42.868804 [info ] [Thread-4  ]: 28 of 55 START table model public.lcarr_sosx_national_agg__month_lookback_distinct [RUN]
15:58:42.870494 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
15:58:42.870972 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct
15:58:42.871717 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct
15:58:42.876541 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
15:58:42.878636 [debug] [Thread-4  ]: finished collecting timing info
15:58:42.879129 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct
15:58:42.969930 [debug] [Thread-4  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
15:58:42.970721 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
15:58:42.970970 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct: BEGIN
15:58:42.971155 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
15:58:42.971349 [debug] [Thread-4  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
15:58:43.902828 [debug] [Thread-4  ]: SQL status: BEGIN in 0.93 seconds
15:58:43.903264 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
15:58:43.903532 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"} */


  create  table
    "cfa"."public"."national_agg__month_lookback_distinct__dbt_tmp"
    
    
    
  as (
    with one_month_set_up as (
  select a.region_name,a.service_team_name,a.dma_name,
  a.location_num,a.monthend_date,'1 month' as look_back_period,
  a.trans_id,a.cfa_one_id,a.customer_hash,
  a.location_type_code,a.daypart,a.destination_desc,
  b.same_store_eligible
  from "cfa"."public"."lcarr_sosx_trans_item" a
  inner join "cfa"."public"."lcarr_sosx_stg__fct_same_store" b
  on a.location_num = b.location_num
  and a.monthend_date = b.monthend_date 
  and b.look_back_period = '1 month'
)
select * from one_month_set_up
  );
16:00:50.589451 [debug] [Thread-4  ]: SQL status: SELECT in 126.69 seconds
16:00:50.593360 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
16:00:50.593659 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"} */
alter table "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct" rename to "national_agg__month_lookback_distinct__dbt_backup"
16:00:50.938039 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.34 seconds
16:00:50.940687 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
16:00:50.940994 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"} */
alter table "cfa"."public"."national_agg__month_lookback_distinct__dbt_tmp" rename to "lcarr_sosx_national_agg__month_lookback_distinct"
16:00:51.534047 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.59 seconds
16:00:51.538669 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct: COMMIT
16:00:51.539016 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
16:00:51.539241 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct: COMMIT
16:00:54.355060 [debug] [Thread-4  ]: SQL status: COMMIT in 2.82 seconds
16:00:54.356140 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
16:00:54.356437 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct: BEGIN
16:00:54.485783 [debug] [Thread-4  ]: SQL status: BEGIN in 0.13 seconds
16:00:54.491956 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
16:00:54.492375 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"} */
drop table if exists "cfa"."public"."national_agg__month_lookback_distinct__dbt_backup" cascade
16:00:54.616163 [debug] [Thread-4  ]: SQL status: DROP TABLE in 0.12 seconds
16:00:54.617879 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct: COMMIT
16:00:54.618293 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
16:00:54.618546 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct: COMMIT
16:00:56.618289 [debug] [Thread-4  ]: SQL status: COMMIT in 2.0 seconds
16:00:56.619086 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
16:00:56.619408 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct: BEGIN
16:00:56.905759 [debug] [Thread-4  ]: SQL status: BEGIN in 0.29 seconds
16:00:56.906689 [debug] [Thread-4  ]: finished collecting timing info
16:00:56.906976 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct: ROLLBACK
16:00:57.050016 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct: Close
16:00:57.051361 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6d1c280-5e0f-4d6b-83df-6573bf08eb2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa715ee0d60>]}
16:00:57.052071 [info ] [Thread-4  ]: 28 of 55 OK created table model public.lcarr_sosx_national_agg__month_lookback_distinct [[32mSELECT[0m in 134.18s]
16:00:57.052708 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct
16:00:57.053046 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.regional_agg__all_groupings
16:00:57.054888 [info ] [Thread-4  ]: 29 of 55 START table model public.lcarr_sosx_regional_agg__all_groupings........ [RUN]
16:00:57.055738 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.regional_agg__all_groupings"
16:00:57.056001 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.regional_agg__all_groupings
16:00:57.056414 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.regional_agg__all_groupings
16:00:57.062244 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.regional_agg__all_groupings"
16:00:57.063089 [debug] [Thread-4  ]: finished collecting timing info
16:00:57.063662 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.regional_agg__all_groupings
16:00:57.137452 [debug] [Thread-4  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.regional_agg__all_groupings"
16:00:57.138195 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional_agg__all_groupings"
16:00:57.138396 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.regional_agg__all_groupings: BEGIN
16:00:57.138611 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
16:00:57.138808 [debug] [Thread-4  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
16:00:58.518727 [debug] [Thread-4  ]: SQL status: BEGIN in 1.38 seconds
16:00:58.519229 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional_agg__all_groupings"
16:00:58.519451 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.regional_agg__all_groupings: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.regional_agg__all_groupings"} */


  create  table
    "cfa"."public"."regional_agg__all_groupings__dbt_tmp"
    
    
    
  as (
    with aggregations_all_groupings as (
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    location_type_code,daypart,destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    location_type_code,'All' as daypart,destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    location_type_code,'All' as daypart,'All' as destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    location_type_code,daypart,'All' as destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    'All' as location_type_code,daypart,'All' as destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    'All' as location_type_code,daypart,destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    'All' as location_type_code,'All' as daypart,destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
) 
select * from aggregations_all_groupings
  );
16:04:54.662402 [debug] [Thread-1  ]: SQL status: SELECT in 479.3 seconds
16:04:54.662956 [debug] [Thread-3  ]: SQL status: SELECT in 479.3 seconds
16:04:54.669503 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__all_groupings"
16:04:54.675474 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__all_groupings"
16:04:54.675891 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__all_groupings: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__all_groupings"} */
alter table "cfa"."public"."lcarr_sosx_market_agg__all_groupings" rename to "market_agg__all_groupings__dbt_backup"
16:04:54.676253 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.ast_agg__all_groupings: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.ast_agg__all_groupings"} */
alter table "cfa"."public"."lcarr_sosx_ast_agg__all_groupings" rename to "ast_agg__all_groupings__dbt_backup"
16:04:54.915365 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.24 seconds
16:04:54.915919 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.24 seconds
16:04:54.919187 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__all_groupings"
16:04:54.921714 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__all_groupings"
16:04:54.922021 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.ast_agg__all_groupings: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.ast_agg__all_groupings"} */
alter table "cfa"."public"."ast_agg__all_groupings__dbt_tmp" rename to "lcarr_sosx_ast_agg__all_groupings"
16:04:54.922294 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__all_groupings: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__all_groupings"} */
alter table "cfa"."public"."market_agg__all_groupings__dbt_tmp" rename to "lcarr_sosx_market_agg__all_groupings"
16:04:55.045200 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.12 seconds
16:04:55.045893 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.12 seconds
16:04:55.048235 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__all_groupings: COMMIT
16:04:55.050500 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.ast_agg__all_groupings: COMMIT
16:04:55.050827 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__all_groupings"
16:04:55.051063 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__all_groupings"
16:04:55.051274 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__all_groupings: COMMIT
16:04:55.051478 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.ast_agg__all_groupings: COMMIT
16:04:58.908708 [debug] [Thread-3  ]: SQL status: COMMIT in 3.86 seconds
16:04:58.909847 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__all_groupings"
16:04:58.910128 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.ast_agg__all_groupings: BEGIN
16:04:58.911022 [debug] [Thread-1  ]: SQL status: COMMIT in 3.86 seconds
16:04:58.966029 [debug] [Thread-3  ]: SQL status: BEGIN in 0.06 seconds
16:04:58.969963 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__all_groupings"
16:04:58.970276 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.ast_agg__all_groupings: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.ast_agg__all_groupings"} */
drop table if exists "cfa"."public"."ast_agg__all_groupings__dbt_backup" cascade
16:04:59.086393 [debug] [Thread-3  ]: SQL status: DROP TABLE in 0.12 seconds
16:04:59.087955 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.ast_agg__all_groupings: COMMIT
16:04:59.088253 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__all_groupings"
16:04:59.088511 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.ast_agg__all_groupings: COMMIT
16:05:02.021599 [debug] [Thread-3  ]: SQL status: COMMIT in 2.93 seconds
16:05:02.022057 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__all_groupings"
16:05:02.022337 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.ast_agg__all_groupings: BEGIN
16:05:02.079633 [debug] [Thread-3  ]: SQL status: BEGIN in 0.06 seconds
16:05:02.080517 [debug] [Thread-3  ]: finished collecting timing info
16:05:02.080805 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__all_groupings"
16:05:02.081057 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.ast_agg__all_groupings: ROLLBACK
16:05:02.081297 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__all_groupings: BEGIN
16:05:02.278539 [debug] [Thread-1  ]: SQL status: BEGIN in 0.2 seconds
16:05:02.279240 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.ast_agg__all_groupings: Close
16:05:02.285010 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__all_groupings"
16:05:02.285451 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__all_groupings: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__all_groupings"} */
drop table if exists "cfa"."public"."market_agg__all_groupings__dbt_backup" cascade
16:05:02.286169 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6d1c280-5e0f-4d6b-83df-6573bf08eb2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa716414e80>]}
16:05:02.286802 [info ] [Thread-3  ]: 23 of 55 OK created table model public.lcarr_sosx_ast_agg__all_groupings........ [[32mSELECT[0m in 488.60s]
16:05:02.287273 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.ast_agg__all_groupings
16:05:02.287620 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.regional_agg__month_lookback_distinct
16:05:02.289296 [info ] [Thread-3  ]: 30 of 55 START table model public.lcarr_sosx_regional_agg__month_lookback_distinct [RUN]
16:05:02.290222 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.regional_agg__month_lookback_distinct"
16:05:02.290484 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.regional_agg__month_lookback_distinct
16:05:02.290708 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.regional_agg__month_lookback_distinct
16:05:02.298398 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.regional_agg__month_lookback_distinct"
16:05:02.300227 [debug] [Thread-3  ]: finished collecting timing info
16:05:02.300686 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.regional_agg__month_lookback_distinct
16:05:02.350379 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.06 seconds
16:05:02.369146 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__all_groupings: COMMIT
16:05:02.378070 [debug] [Thread-3  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.regional_agg__month_lookback_distinct"
16:05:02.378392 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__all_groupings"
16:05:02.378809 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__all_groupings: COMMIT
16:05:02.380464 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional_agg__month_lookback_distinct"
16:05:02.380736 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.regional_agg__month_lookback_distinct: BEGIN
16:05:02.380920 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
16:05:02.381114 [debug] [Thread-3  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
16:05:03.151547 [debug] [Thread-3  ]: SQL status: BEGIN in 0.77 seconds
16:05:03.152138 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional_agg__month_lookback_distinct"
16:05:03.152447 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.regional_agg__month_lookback_distinct: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.regional_agg__month_lookback_distinct"} */


  create  table
    "cfa"."public"."regional_agg__month_lookback_distinct__dbt_tmp"
    
    
    
  as (
    with one_month_set_up as (
  select a.region_name,a.service_team_name,a.dma_name,
  a.location_num,a.monthend_date,'1 month' as look_back_period,
  a.trans_id,a.cfa_one_id,a.customer_hash,
  a.location_type_code,a.daypart,a.destination_desc,
  b.same_store_eligible
  from "cfa"."public"."lcarr_sosx_trans_item" a
  inner join "cfa"."public"."lcarr_sosx_stg__fct_same_store" b
  on a.location_num = b.location_num
  and a.monthend_date = b.monthend_date 
  and b.look_back_period = '1 month'
)
select * from one_month_set_up
  );
16:05:04.161513 [debug] [Thread-1  ]: SQL status: COMMIT in 1.78 seconds
16:05:04.162349 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__all_groupings"
16:05:04.162630 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__all_groupings: BEGIN
16:05:04.218286 [debug] [Thread-1  ]: SQL status: BEGIN in 0.06 seconds
16:05:04.219387 [debug] [Thread-1  ]: finished collecting timing info
16:05:04.219693 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__all_groupings: ROLLBACK
16:05:04.556124 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__all_groupings: Close
16:05:04.557656 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6d1c280-5e0f-4d6b-83df-6573bf08eb2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa71640fa30>]}
16:05:05.217173 [info ] [Thread-1  ]: 25 of 55 OK created table model public.lcarr_sosx_market_agg__all_groupings..... [[32mSELECT[0m in 490.87s]
16:05:05.217970 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.market_agg__all_groupings
16:05:05.218349 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs
16:05:05.218880 [info ] [Thread-1  ]: 31 of 55 START table model public.lcarr_sosx_ast_agg__hash_base_calcs........... [RUN]
16:05:05.220770 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs"
16:05:05.221264 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs
16:05:05.221650 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs
16:05:05.233874 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs"
16:05:05.235353 [debug] [Thread-1  ]: finished collecting timing info
16:05:05.236150 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs
16:05:05.308693 [debug] [Thread-1  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs"
16:05:05.309444 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs"
16:05:05.309662 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs: BEGIN
16:05:05.309909 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
16:05:05.310107 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
16:05:06.215131 [debug] [Thread-1  ]: SQL status: BEGIN in 0.91 seconds
16:05:06.215670 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs"
16:05:06.216096 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs"} */


  create  table
    "cfa"."public"."ast_agg__hash_base_calcs__dbt_tmp"
    
    
    
  as (
    with hash_base_calcs_all_store as (
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
), hash_base_calcs_same_store as (
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
)

select * from hash_base_calcs_all_store 
union 
select * from hash_base_calcs_same_store
  );
16:06:02.370312 [debug] [Thread-2  ]: SQL status: SELECT in 440.37 seconds
16:06:02.374159 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__all_groupings"
16:06:02.374527 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__all_groupings: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__all_groupings"} */
alter table "cfa"."public"."lcarr_sosx_national_agg__all_groupings" rename to "national_agg__all_groupings__dbt_backup"
16:06:02.429383 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.05 seconds
16:06:02.433121 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__all_groupings"
16:06:02.433426 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__all_groupings: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__all_groupings"} */
alter table "cfa"."public"."national_agg__all_groupings__dbt_tmp" rename to "lcarr_sosx_national_agg__all_groupings"
16:06:02.485535 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.05 seconds
16:06:02.487848 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__all_groupings: COMMIT
16:06:02.488184 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__all_groupings"
16:06:02.488408 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__all_groupings: COMMIT
16:06:04.116705 [debug] [Thread-2  ]: SQL status: COMMIT in 1.63 seconds
16:06:04.117458 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__all_groupings"
16:06:04.117785 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__all_groupings: BEGIN
16:06:04.170506 [debug] [Thread-2  ]: SQL status: BEGIN in 0.05 seconds
16:06:04.174341 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__all_groupings"
16:06:04.174668 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__all_groupings: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__all_groupings"} */
drop table if exists "cfa"."public"."national_agg__all_groupings__dbt_backup" cascade
16:06:04.272341 [debug] [Thread-2  ]: SQL status: DROP TABLE in 0.1 seconds
16:06:04.274042 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__all_groupings: COMMIT
16:06:04.274328 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__all_groupings"
16:06:04.274543 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__all_groupings: COMMIT
16:06:05.745076 [debug] [Thread-2  ]: SQL status: COMMIT in 1.47 seconds
16:06:05.745529 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__all_groupings"
16:06:05.745820 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__all_groupings: BEGIN
16:06:05.802610 [debug] [Thread-2  ]: SQL status: BEGIN in 0.06 seconds
16:06:05.805154 [debug] [Thread-2  ]: finished collecting timing info
16:06:05.805829 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__all_groupings: ROLLBACK
16:06:05.950707 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__all_groupings: Close
16:06:05.952112 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6d1c280-5e0f-4d6b-83df-6573bf08eb2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa71610a640>]}
16:06:05.952896 [info ] [Thread-2  ]: 27 of 55 OK created table model public.lcarr_sosx_national_agg__all_groupings... [[32mSELECT[0m in 444.98s]
16:06:05.953546 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.national_agg__all_groupings
16:06:05.953992 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.market_agg__hash_base_calcs
16:06:05.954748 [info ] [Thread-2  ]: 32 of 55 START table model public.lcarr_sosx_market_agg__hash_base_calcs........ [RUN]
16:06:05.955787 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.market_agg__hash_base_calcs"
16:06:05.956667 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.market_agg__hash_base_calcs
16:06:05.957049 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.market_agg__hash_base_calcs
16:06:05.971543 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.market_agg__hash_base_calcs"
16:06:05.974879 [debug] [Thread-2  ]: finished collecting timing info
16:06:05.975817 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.market_agg__hash_base_calcs
16:06:06.047756 [debug] [Thread-2  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.market_agg__hash_base_calcs"
16:06:06.048546 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__hash_base_calcs"
16:06:06.048884 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.market_agg__hash_base_calcs: BEGIN
16:06:06.049062 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
16:06:06.049246 [debug] [Thread-2  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
16:06:06.629310 [debug] [Thread-2  ]: SQL status: BEGIN in 0.58 seconds
16:06:06.629743 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__hash_base_calcs"
16:06:06.630440 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.market_agg__hash_base_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__hash_base_calcs"} */


  create  table
    "cfa"."public"."market_agg__hash_base_calcs__dbt_tmp"
    
    
    
  as (
    with hash_base_calcs_all_store as (
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
), hash_base_calcs_same_store as (
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
)

select * from hash_base_calcs_all_store 
union 
select * from hash_base_calcs_same_store
  );
16:06:56.330284 [debug] [Thread-3  ]: SQL status: SELECT in 113.18 seconds
16:06:56.334449 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional_agg__month_lookback_distinct"
16:06:56.334778 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.regional_agg__month_lookback_distinct: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.regional_agg__month_lookback_distinct"} */
alter table "cfa"."public"."lcarr_sosx_regional_agg__month_lookback_distinct" rename to "regional_agg__month_lookback_distinct__dbt_backup"
16:06:56.393851 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.06 seconds
16:06:56.397907 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional_agg__month_lookback_distinct"
16:06:56.398224 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.regional_agg__month_lookback_distinct: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.regional_agg__month_lookback_distinct"} */
alter table "cfa"."public"."regional_agg__month_lookback_distinct__dbt_tmp" rename to "lcarr_sosx_regional_agg__month_lookback_distinct"
16:06:56.452528 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.05 seconds
16:06:56.454835 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.regional_agg__month_lookback_distinct: COMMIT
16:06:56.455133 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional_agg__month_lookback_distinct"
16:06:56.455431 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.regional_agg__month_lookback_distinct: COMMIT
16:06:59.003552 [debug] [Thread-3  ]: SQL status: COMMIT in 2.55 seconds
16:06:59.004118 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional_agg__month_lookback_distinct"
16:06:59.004356 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.regional_agg__month_lookback_distinct: BEGIN
16:06:59.059756 [debug] [Thread-3  ]: SQL status: BEGIN in 0.06 seconds
16:06:59.063321 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional_agg__month_lookback_distinct"
16:06:59.063600 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.regional_agg__month_lookback_distinct: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.regional_agg__month_lookback_distinct"} */
drop table if exists "cfa"."public"."regional_agg__month_lookback_distinct__dbt_backup" cascade
16:06:59.135065 [debug] [Thread-3  ]: SQL status: DROP TABLE in 0.07 seconds
16:06:59.136590 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.regional_agg__month_lookback_distinct: COMMIT
16:06:59.136904 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional_agg__month_lookback_distinct"
16:06:59.137117 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.regional_agg__month_lookback_distinct: COMMIT
16:07:00.580070 [debug] [Thread-3  ]: SQL status: COMMIT in 1.44 seconds
16:07:00.580808 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional_agg__month_lookback_distinct"
16:07:00.581062 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.regional_agg__month_lookback_distinct: BEGIN
16:07:00.632376 [debug] [Thread-3  ]: SQL status: BEGIN in 0.05 seconds
16:07:00.633442 [debug] [Thread-3  ]: finished collecting timing info
16:07:00.633834 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.regional_agg__month_lookback_distinct: ROLLBACK
16:07:00.732310 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.regional_agg__month_lookback_distinct: Close
16:07:00.733640 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6d1c280-5e0f-4d6b-83df-6573bf08eb2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa7162bcb50>]}
16:07:00.734311 [info ] [Thread-3  ]: 30 of 55 OK created table model public.lcarr_sosx_regional_agg__month_lookback_distinct [[32mSELECT[0m in 118.44s]
16:07:00.734795 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.regional_agg__month_lookback_distinct
16:07:00.735178 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.national_agg__distinct_calcs
16:07:00.735670 [info ] [Thread-3  ]: 33 of 55 START table model public.lcarr_sosx_national_agg__distinct_calcs....... [RUN]
16:07:00.736737 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
16:07:00.737037 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.national_agg__distinct_calcs
16:07:00.737280 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.national_agg__distinct_calcs
16:07:00.746412 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
16:07:00.747458 [debug] [Thread-3  ]: finished collecting timing info
16:07:00.747911 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.national_agg__distinct_calcs
16:07:00.817528 [debug] [Thread-3  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
16:07:00.819793 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
16:07:00.820128 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_calcs: BEGIN
16:07:00.820308 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
16:07:00.820503 [debug] [Thread-3  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
16:07:01.647246 [debug] [Thread-3  ]: SQL status: BEGIN in 0.83 seconds
16:07:01.647767 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
16:07:01.648069 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"} */


  create  table
    "cfa"."public"."national_agg__distinct_calcs__dbt_tmp"
    
    
    
  as (
    with distinct_calcs_all_store as (
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
), distinct_calcs_same_store as (
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
)

select * from distinct_calcs_all_store 
union 
select * from distinct_calcs_same_store
  );
16:08:51.552935 [debug] [Thread-4  ]: SQL status: SELECT in 473.03 seconds
16:08:51.557352 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional_agg__all_groupings"
16:08:51.557671 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.regional_agg__all_groupings: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.regional_agg__all_groupings"} */
alter table "cfa"."public"."lcarr_sosx_regional_agg__all_groupings" rename to "regional_agg__all_groupings__dbt_backup"
16:08:51.647266 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.09 seconds
16:08:51.651919 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional_agg__all_groupings"
16:08:51.652259 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.regional_agg__all_groupings: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.regional_agg__all_groupings"} */
alter table "cfa"."public"."regional_agg__all_groupings__dbt_tmp" rename to "lcarr_sosx_regional_agg__all_groupings"
16:08:51.769178 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.12 seconds
16:08:51.771002 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.regional_agg__all_groupings: COMMIT
16:08:51.771250 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional_agg__all_groupings"
16:08:51.771438 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.regional_agg__all_groupings: COMMIT
16:08:53.568585 [debug] [Thread-4  ]: SQL status: COMMIT in 1.8 seconds
16:08:53.569324 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional_agg__all_groupings"
16:08:53.569669 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.regional_agg__all_groupings: BEGIN
16:08:53.621809 [debug] [Thread-4  ]: SQL status: BEGIN in 0.05 seconds
16:08:53.627270 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional_agg__all_groupings"
16:08:53.627561 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.regional_agg__all_groupings: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.regional_agg__all_groupings"} */
drop table if exists "cfa"."public"."regional_agg__all_groupings__dbt_backup" cascade
16:08:53.706883 [debug] [Thread-4  ]: SQL status: DROP TABLE in 0.08 seconds
16:08:53.708072 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.regional_agg__all_groupings: COMMIT
16:08:53.709076 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional_agg__all_groupings"
16:08:53.709288 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.regional_agg__all_groupings: COMMIT
16:08:55.715439 [debug] [Thread-4  ]: SQL status: COMMIT in 2.01 seconds
16:08:55.715907 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional_agg__all_groupings"
16:08:55.716220 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.regional_agg__all_groupings: BEGIN
16:08:55.770020 [debug] [Thread-4  ]: SQL status: BEGIN in 0.05 seconds
16:08:55.770998 [debug] [Thread-4  ]: finished collecting timing info
16:08:55.771440 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.regional_agg__all_groupings: ROLLBACK
16:08:55.867531 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.regional_agg__all_groupings: Close
16:08:55.879315 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6d1c280-5e0f-4d6b-83df-6573bf08eb2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa7164a7340>]}
16:08:55.880211 [info ] [Thread-4  ]: 29 of 55 OK created table model public.lcarr_sosx_regional_agg__all_groupings... [[32mSELECT[0m in 478.82s]
16:08:55.881029 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.regional_agg__all_groupings
16:08:55.881597 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.national_agg__hash_base_calcs
16:08:55.882322 [info ] [Thread-4  ]: 34 of 55 START table model public.lcarr_sosx_national_agg__hash_base_calcs...... [RUN]
16:08:55.883629 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
16:08:55.884036 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.national_agg__hash_base_calcs
16:08:55.884386 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.national_agg__hash_base_calcs
16:08:55.899585 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
16:08:55.900912 [debug] [Thread-4  ]: finished collecting timing info
16:08:55.901510 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.national_agg__hash_base_calcs
16:08:56.022263 [debug] [Thread-4  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
16:08:56.023842 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
16:08:56.024246 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__hash_base_calcs: BEGIN
16:08:56.024644 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
16:08:56.025049 [debug] [Thread-4  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
16:08:56.736339 [debug] [Thread-4  ]: SQL status: BEGIN in 0.71 seconds
16:08:56.736866 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
16:08:56.737148 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__hash_base_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"} */


  create  table
    "cfa"."public"."national_agg__hash_base_calcs__dbt_tmp"
    
    
    
  as (
    with hash_base_calcs_all_store as (
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
), hash_base_calcs_same_store as (
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
)

select * from hash_base_calcs_all_store 
union 
select * from hash_base_calcs_same_store
  );
16:40:20.286139 [debug] [Thread-2  ]: SQL status: SELECT in 2053.66 seconds
16:40:20.290738 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__hash_base_calcs"
16:40:20.291058 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.market_agg__hash_base_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__hash_base_calcs"} */
alter table "cfa"."public"."market_agg__hash_base_calcs__dbt_tmp" rename to "lcarr_sosx_market_agg__hash_base_calcs"
16:40:20.458115 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.17 seconds
16:40:20.463002 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.market_agg__hash_base_calcs: COMMIT
16:40:20.463340 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__hash_base_calcs"
16:40:20.463551 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.market_agg__hash_base_calcs: COMMIT
16:40:43.112549 [debug] [Thread-2  ]: SQL status: COMMIT in 22.65 seconds
16:40:43.113330 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__hash_base_calcs"
16:40:43.113610 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.market_agg__hash_base_calcs: BEGIN
16:40:43.195127 [debug] [Thread-2  ]: SQL status: BEGIN in 0.08 seconds
16:40:43.197812 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__hash_base_calcs"
16:40:43.198332 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.market_agg__hash_base_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__hash_base_calcs"} */
drop table if exists "cfa"."public"."market_agg__hash_base_calcs__dbt_backup" cascade
16:40:43.256845 [debug] [Thread-2  ]: SQL status: DROP TABLE in 0.06 seconds
16:40:43.258347 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.market_agg__hash_base_calcs: COMMIT
16:40:43.258675 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__hash_base_calcs"
16:40:43.258897 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.market_agg__hash_base_calcs: COMMIT
16:40:43.386237 [debug] [Thread-2  ]: SQL status: COMMIT in 0.13 seconds
16:40:43.386807 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__hash_base_calcs"
16:40:43.387251 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.market_agg__hash_base_calcs: BEGIN
16:40:43.441587 [debug] [Thread-2  ]: SQL status: BEGIN in 0.05 seconds
16:40:43.442411 [debug] [Thread-2  ]: finished collecting timing info
16:40:43.442673 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.market_agg__hash_base_calcs: ROLLBACK
16:40:43.551583 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.market_agg__hash_base_calcs: Close
16:40:43.552751 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6d1c280-5e0f-4d6b-83df-6573bf08eb2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa7163ee5b0>]}
16:40:43.553271 [info ] [Thread-2  ]: 32 of 55 OK created table model public.lcarr_sosx_market_agg__hash_base_calcs... [[32mSELECT[0m in 2077.60s]
16:40:43.553729 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.market_agg__hash_base_calcs
16:40:43.554108 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.ast_agg__month_lookback
16:40:43.554972 [info ] [Thread-2  ]: 35 of 55 START table model public.lcarr_sosx_ast_agg__month_lookback............ [RUN]
16:40:43.555940 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.ast_agg__month_lookback"
16:40:43.556310 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.ast_agg__month_lookback
16:40:43.556630 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.ast_agg__month_lookback
16:40:43.561880 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.ast_agg__month_lookback"
16:40:43.570905 [debug] [Thread-2  ]: finished collecting timing info
16:40:43.571390 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.ast_agg__month_lookback
16:40:43.647445 [debug] [Thread-2  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.ast_agg__month_lookback"
16:40:43.649735 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__month_lookback"
16:40:43.650238 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.ast_agg__month_lookback: BEGIN
16:40:43.650445 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
16:40:43.650638 [debug] [Thread-2  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
16:40:44.628853 [debug] [Thread-2  ]: SQL status: BEGIN in 0.98 seconds
16:40:44.629378 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__month_lookback"
16:40:44.629666 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.ast_agg__month_lookback: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.ast_agg__month_lookback"} */


  create  table
    "cfa"."public"."ast_agg__month_lookback__dbt_tmp"
    
    
    
  as (
    with add_month_lookback as (
  select quarter,region_name,service_team_name,dma_name,location_num,
  monthend_date,'1 month' as look_back_period,
  location_type_code,daypart,destination_desc,sales_sub_total,
  transactions,purchaser_visits,credit_txn,
  total_items_promo_count,total_items_sold_count
  from "cfa"."public"."lcarr_sosx_ast_agg__all_groupings"
)
select * from add_month_lookback
  );
16:40:47.757085 [debug] [Thread-2  ]: SQL status: SELECT in 3.13 seconds
16:40:47.761222 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__month_lookback"
16:40:47.761535 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.ast_agg__month_lookback: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.ast_agg__month_lookback"} */
alter table "cfa"."public"."ast_agg__month_lookback__dbt_tmp" rename to "lcarr_sosx_ast_agg__month_lookback"
16:40:47.814544 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.05 seconds
16:40:47.817275 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.ast_agg__month_lookback: COMMIT
16:40:47.817664 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__month_lookback"
16:40:47.817926 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.ast_agg__month_lookback: COMMIT
16:40:49.193031 [debug] [Thread-2  ]: SQL status: COMMIT in 1.37 seconds
16:40:49.193631 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__month_lookback"
16:40:49.193903 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.ast_agg__month_lookback: BEGIN
16:40:49.246768 [debug] [Thread-2  ]: SQL status: BEGIN in 0.05 seconds
16:40:49.249120 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__month_lookback"
16:40:49.249581 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.ast_agg__month_lookback: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.ast_agg__month_lookback"} */
drop table if exists "cfa"."public"."ast_agg__month_lookback__dbt_backup" cascade
16:40:49.302688 [debug] [Thread-2  ]: SQL status: DROP TABLE in 0.05 seconds
16:40:49.305090 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.ast_agg__month_lookback: COMMIT
16:40:49.305651 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__month_lookback"
16:40:49.306160 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.ast_agg__month_lookback: COMMIT
16:40:49.703703 [debug] [Thread-2  ]: SQL status: COMMIT in 0.4 seconds
16:40:49.704295 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__month_lookback"
16:40:49.704528 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.ast_agg__month_lookback: BEGIN
16:40:49.757450 [debug] [Thread-2  ]: SQL status: BEGIN in 0.05 seconds
16:40:49.758469 [debug] [Thread-2  ]: finished collecting timing info
16:40:49.758803 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.ast_agg__month_lookback: ROLLBACK
16:40:49.850263 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.ast_agg__month_lookback: Close
16:40:49.851568 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6d1c280-5e0f-4d6b-83df-6573bf08eb2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa7163444f0>]}
16:40:49.852277 [info ] [Thread-2  ]: 35 of 55 OK created table model public.lcarr_sosx_ast_agg__month_lookback....... [[32mSELECT[0m in 6.30s]
16:40:49.853010 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.ast_agg__month_lookback
16:40:49.853678 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.market_agg__month_lookback
16:40:49.854589 [info ] [Thread-2  ]: 36 of 55 START table model public.lcarr_sosx_market_agg__month_lookback......... [RUN]
16:40:49.855923 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback"
16:40:49.856317 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.market_agg__month_lookback
16:40:49.856658 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.market_agg__month_lookback
16:40:49.861901 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.market_agg__month_lookback"
16:40:49.862872 [debug] [Thread-2  ]: finished collecting timing info
16:40:49.863299 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.market_agg__month_lookback
16:40:49.987920 [debug] [Thread-2  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.market_agg__month_lookback"
16:40:49.992058 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback"
16:40:49.992498 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback: BEGIN
16:40:49.992805 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
16:40:49.993107 [debug] [Thread-2  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
16:40:50.557110 [debug] [Thread-2  ]: SQL status: BEGIN in 0.56 seconds
16:40:50.557704 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback"
16:40:50.558348 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__month_lookback"} */


  create  table
    "cfa"."public"."market_agg__month_lookback__dbt_tmp"
    
    
    
  as (
    with add_month_lookback as (
  select quarter,region_name,service_team_name,dma_name,location_num,
  monthend_date,'1 month' as look_back_period,
  location_type_code,daypart,destination_desc,sales_sub_total,
  transactions,purchaser_visits,credit_txn,
  total_items_promo_count,total_items_sold_count
  from "cfa"."public"."lcarr_sosx_market_agg__all_groupings"
)
select * from add_month_lookback
  );
16:40:53.626555 [debug] [Thread-2  ]: SQL status: SELECT in 3.07 seconds
16:40:53.640871 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback"
16:40:53.641223 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__month_lookback"} */
alter table "cfa"."public"."market_agg__month_lookback__dbt_tmp" rename to "lcarr_sosx_market_agg__month_lookback"
16:40:53.695442 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.05 seconds
16:40:53.697402 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback: COMMIT
16:40:53.697676 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback"
16:40:53.697891 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback: COMMIT
16:40:54.976297 [debug] [Thread-2  ]: SQL status: COMMIT in 1.28 seconds
16:40:54.977125 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback"
16:40:54.977404 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback: BEGIN
16:40:55.033315 [debug] [Thread-2  ]: SQL status: BEGIN in 0.06 seconds
16:40:55.036524 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback"
16:40:55.036962 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__month_lookback"} */
drop table if exists "cfa"."public"."market_agg__month_lookback__dbt_backup" cascade
16:40:55.087339 [debug] [Thread-2  ]: SQL status: DROP TABLE in 0.05 seconds
16:40:55.088848 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback: COMMIT
16:40:55.089171 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback"
16:40:55.089557 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback: COMMIT
16:40:55.217747 [debug] [Thread-2  ]: SQL status: COMMIT in 0.13 seconds
16:40:55.218407 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback"
16:40:55.218646 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback: BEGIN
16:40:55.272825 [debug] [Thread-2  ]: SQL status: BEGIN in 0.05 seconds
16:40:55.274047 [debug] [Thread-2  ]: finished collecting timing info
16:40:55.274405 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback: ROLLBACK
16:40:55.371933 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback: Close
16:40:55.373204 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6d1c280-5e0f-4d6b-83df-6573bf08eb2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa71610a310>]}
16:40:55.373921 [info ] [Thread-2  ]: 36 of 55 OK created table model public.lcarr_sosx_market_agg__month_lookback.... [[32mSELECT[0m in 5.52s]
16:40:55.374540 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.market_agg__month_lookback
16:40:55.375010 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.national_agg__month_lookback
16:40:55.375833 [info ] [Thread-2  ]: 37 of 55 START table model public.lcarr_sosx_national_agg__month_lookback....... [RUN]
16:40:55.378141 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback"
16:40:55.378499 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.national_agg__month_lookback
16:40:55.378895 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.national_agg__month_lookback
16:40:55.384400 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national_agg__month_lookback"
16:40:55.387663 [debug] [Thread-2  ]: finished collecting timing info
16:40:55.388190 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.national_agg__month_lookback
16:40:55.459944 [debug] [Thread-2  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.national_agg__month_lookback"
16:40:55.463558 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback"
16:40:55.463854 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback: BEGIN
16:40:55.464025 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
16:40:55.464209 [debug] [Thread-2  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
16:40:56.106095 [debug] [Thread-2  ]: SQL status: BEGIN in 0.64 seconds
16:40:56.106690 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback"
16:40:56.106957 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__month_lookback"} */


  create  table
    "cfa"."public"."national_agg__month_lookback__dbt_tmp"
    
    
    
  as (
    with add_month_lookback as (
  select quarter,region_name,service_team_name,dma_name,location_num,
  monthend_date,'1 month' as look_back_period,
  location_type_code,daypart,destination_desc,sales_sub_total,
  transactions,purchaser_visits,credit_txn,
  total_items_promo_count,total_items_sold_count
  from "cfa"."public"."lcarr_sosx_national_agg__all_groupings"
)
select * from add_month_lookback
  );
16:40:59.201529 [debug] [Thread-2  ]: SQL status: SELECT in 3.09 seconds
16:40:59.205128 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback"
16:40:59.205552 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__month_lookback"} */
alter table "cfa"."public"."lcarr_sosx_national_agg__month_lookback" rename to "national_agg__month_lookback__dbt_backup"
16:40:59.270510 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.06 seconds
16:40:59.274178 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback"
16:40:59.274445 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__month_lookback"} */
alter table "cfa"."public"."national_agg__month_lookback__dbt_tmp" rename to "lcarr_sosx_national_agg__month_lookback"
16:40:59.328818 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.05 seconds
16:40:59.333869 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback: COMMIT
16:40:59.334270 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback"
16:40:59.334700 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback: COMMIT
16:41:01.137681 [debug] [Thread-2  ]: SQL status: COMMIT in 1.8 seconds
16:41:01.138662 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback"
16:41:01.138983 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback: BEGIN
16:41:01.194455 [debug] [Thread-2  ]: SQL status: BEGIN in 0.06 seconds
16:41:01.199279 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback"
16:41:01.199598 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__month_lookback"} */
drop table if exists "cfa"."public"."national_agg__month_lookback__dbt_backup" cascade
16:41:01.378862 [debug] [Thread-2  ]: SQL status: DROP TABLE in 0.18 seconds
16:41:01.381092 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback: COMMIT
16:41:01.381507 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback"
16:41:01.381751 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback: COMMIT
16:41:03.370936 [debug] [Thread-2  ]: SQL status: COMMIT in 1.99 seconds
16:41:03.371547 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback"
16:41:03.371831 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback: BEGIN
16:41:03.425048 [debug] [Thread-2  ]: SQL status: BEGIN in 0.05 seconds
16:41:03.426089 [debug] [Thread-2  ]: finished collecting timing info
16:41:03.426422 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback: ROLLBACK
16:41:03.532932 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback: Close
16:41:03.534375 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6d1c280-5e0f-4d6b-83df-6573bf08eb2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa7164d6070>]}
16:41:03.534925 [info ] [Thread-2  ]: 37 of 55 OK created table model public.lcarr_sosx_national_agg__month_lookback.. [[32mSELECT[0m in 8.16s]
16:41:03.535442 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.national_agg__month_lookback
16:41:03.535782 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.regional_agg__hash_base_calcs
16:41:03.536342 [info ] [Thread-2  ]: 38 of 55 START table model public.lcarr_sosx_regional_agg__hash_base_calcs...... [RUN]
16:41:03.537340 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.regional_agg__hash_base_calcs"
16:41:03.537732 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.regional_agg__hash_base_calcs
16:41:03.538116 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.regional_agg__hash_base_calcs
16:41:03.546657 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.regional_agg__hash_base_calcs"
16:41:03.549587 [debug] [Thread-2  ]: finished collecting timing info
16:41:03.549915 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.regional_agg__hash_base_calcs
16:41:03.620054 [debug] [Thread-2  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.regional_agg__hash_base_calcs"
16:41:03.621752 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional_agg__hash_base_calcs"
16:41:03.622122 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.regional_agg__hash_base_calcs: BEGIN
16:41:03.622345 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
16:41:03.622551 [debug] [Thread-2  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
16:41:04.182729 [debug] [Thread-2  ]: SQL status: BEGIN in 0.56 seconds
16:41:04.183245 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional_agg__hash_base_calcs"
16:41:04.183659 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.regional_agg__hash_base_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.regional_agg__hash_base_calcs"} */


  create  table
    "cfa"."public"."regional_agg__hash_base_calcs__dbt_tmp"
    
    
    
  as (
    with hash_base_calcs_all_store as (
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_regional_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_regional_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_regional_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_regional_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_regional_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_regional_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_regional_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_regional_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
), hash_base_calcs_same_store as (
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_regional_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_regional_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_regional_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_regional_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_regional_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_regional_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_regional_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_regional_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
)

select * from hash_base_calcs_all_store 
union 
select * from hash_base_calcs_same_store
  );
16:43:31.784031 [debug] [Thread-4  ]: SQL status: SELECT in 2075.05 seconds
16:43:31.788049 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
16:43:31.788343 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__hash_base_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"} */
alter table "cfa"."public"."national_agg__hash_base_calcs__dbt_tmp" rename to "lcarr_sosx_national_agg__hash_base_calcs"
16:43:31.845969 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.06 seconds
16:43:31.848455 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__hash_base_calcs: COMMIT
16:43:31.848800 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
16:43:31.849066 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__hash_base_calcs: COMMIT
16:43:32.815659 [debug] [Thread-4  ]: SQL status: COMMIT in 0.97 seconds
16:43:32.816758 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
16:43:32.817812 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__hash_base_calcs: BEGIN
16:43:32.874798 [debug] [Thread-4  ]: SQL status: BEGIN in 0.06 seconds
16:43:32.877171 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
16:43:32.877610 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__hash_base_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"} */
drop table if exists "cfa"."public"."national_agg__hash_base_calcs__dbt_backup" cascade
16:43:32.930165 [debug] [Thread-4  ]: SQL status: DROP TABLE in 0.05 seconds
16:43:32.931698 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__hash_base_calcs: COMMIT
16:43:32.932067 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
16:43:32.932340 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__hash_base_calcs: COMMIT
16:43:33.286739 [debug] [Thread-4  ]: SQL status: COMMIT in 0.35 seconds
16:43:33.287401 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
16:43:33.287690 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__hash_base_calcs: BEGIN
16:43:33.342082 [debug] [Thread-4  ]: SQL status: BEGIN in 0.05 seconds
16:43:33.343018 [debug] [Thread-4  ]: finished collecting timing info
16:43:33.343316 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__hash_base_calcs: ROLLBACK
16:43:33.436653 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__hash_base_calcs: Close
16:43:33.437966 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6d1c280-5e0f-4d6b-83df-6573bf08eb2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa7162af0a0>]}
16:43:33.439328 [info ] [Thread-4  ]: 34 of 55 OK created table model public.lcarr_sosx_national_agg__hash_base_calcs. [[32mSELECT[0m in 2077.55s]
16:43:33.439874 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.national_agg__hash_base_calcs
16:43:33.440201 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.regional_agg__month_lookback
16:43:33.440692 [info ] [Thread-4  ]: 39 of 55 START table model public.lcarr_sosx_regional_agg__month_lookback....... [RUN]
16:43:33.441653 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.regional_agg__month_lookback"
16:43:33.441965 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.regional_agg__month_lookback
16:43:33.442210 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.regional_agg__month_lookback
16:43:33.445820 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.regional_agg__month_lookback"
16:43:33.448987 [debug] [Thread-4  ]: finished collecting timing info
16:43:33.449523 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.regional_agg__month_lookback
16:43:33.522943 [debug] [Thread-4  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.regional_agg__month_lookback"
16:43:33.524848 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional_agg__month_lookback"
16:43:33.525206 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.regional_agg__month_lookback: BEGIN
16:43:33.525447 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
16:43:33.525660 [debug] [Thread-4  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
16:43:34.172019 [debug] [Thread-4  ]: SQL status: BEGIN in 0.65 seconds
16:43:34.172685 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional_agg__month_lookback"
16:43:34.173033 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.regional_agg__month_lookback: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.regional_agg__month_lookback"} */


  create  table
    "cfa"."public"."regional_agg__month_lookback__dbt_tmp"
    
    
    
  as (
    with add_month_lookback as (
  select quarter,region_name,service_team_name,dma_name,location_num,
  monthend_date,'1 month' as look_back_period,
  location_type_code,daypart,destination_desc,sales_sub_total,
  transactions,purchaser_visits,credit_txn,
  total_items_promo_count,total_items_sold_count
  from "cfa"."public"."lcarr_sosx_regional_agg__all_groupings"
)
select * from add_month_lookback
  );
16:43:37.128033 [debug] [Thread-4  ]: SQL status: SELECT in 2.95 seconds
16:43:37.131783 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional_agg__month_lookback"
16:43:37.132112 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.regional_agg__month_lookback: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.regional_agg__month_lookback"} */
alter table "cfa"."public"."regional_agg__month_lookback__dbt_tmp" rename to "lcarr_sosx_regional_agg__month_lookback"
16:43:37.186991 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.05 seconds
16:43:37.189708 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.regional_agg__month_lookback: COMMIT
16:43:37.190074 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional_agg__month_lookback"
16:43:37.190448 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.regional_agg__month_lookback: COMMIT
16:43:38.595854 [debug] [Thread-4  ]: SQL status: COMMIT in 1.41 seconds
16:43:38.596645 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional_agg__month_lookback"
16:43:38.596974 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.regional_agg__month_lookback: BEGIN
16:43:38.663380 [debug] [Thread-4  ]: SQL status: BEGIN in 0.07 seconds
16:43:38.668239 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional_agg__month_lookback"
16:43:38.669047 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.regional_agg__month_lookback: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.regional_agg__month_lookback"} */
drop table if exists "cfa"."public"."regional_agg__month_lookback__dbt_backup" cascade
16:43:38.763153 [debug] [Thread-4  ]: SQL status: DROP TABLE in 0.09 seconds
16:43:38.764849 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.regional_agg__month_lookback: COMMIT
16:43:38.765197 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional_agg__month_lookback"
16:43:38.765464 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.regional_agg__month_lookback: COMMIT
16:43:38.886950 [debug] [Thread-4  ]: SQL status: COMMIT in 0.12 seconds
16:43:38.887390 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional_agg__month_lookback"
16:43:38.887630 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.regional_agg__month_lookback: BEGIN
16:43:38.940779 [debug] [Thread-4  ]: SQL status: BEGIN in 0.05 seconds
16:43:38.941835 [debug] [Thread-4  ]: finished collecting timing info
16:43:38.942308 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.regional_agg__month_lookback: ROLLBACK
16:43:39.038757 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.regional_agg__month_lookback: Close
16:43:39.040269 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6d1c280-5e0f-4d6b-83df-6573bf08eb2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa7164a7fa0>]}
16:43:39.041889 [info ] [Thread-4  ]: 39 of 55 OK created table model public.lcarr_sosx_regional_agg__month_lookback.. [[32mSELECT[0m in 5.60s]
16:43:39.042828 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.regional_agg__month_lookback
16:43:39.043549 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.market_agg__distinct_calcs
16:43:39.044544 [info ] [Thread-4  ]: 40 of 55 START table model public.lcarr_sosx_market_agg__distinct_calcs......... [RUN]
16:43:39.045540 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.market_agg__distinct_calcs"
16:43:39.045823 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.market_agg__distinct_calcs
16:43:39.046135 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.market_agg__distinct_calcs
16:43:39.064335 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.market_agg__distinct_calcs"
16:43:39.065124 [debug] [Thread-4  ]: finished collecting timing info
16:43:39.065390 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.market_agg__distinct_calcs
16:43:39.134135 [debug] [Thread-4  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.market_agg__distinct_calcs"
16:43:39.135745 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__distinct_calcs"
16:43:39.136077 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_calcs: BEGIN
16:43:39.136245 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
16:43:39.136424 [debug] [Thread-4  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
16:43:39.697679 [debug] [Thread-4  ]: SQL status: BEGIN in 0.56 seconds
16:43:39.698354 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__distinct_calcs"
16:43:39.698636 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__distinct_calcs"} */


  create  table
    "cfa"."public"."market_agg__distinct_calcs__dbt_tmp"
    
    
    
  as (
    with distinct_calcs_all_store as (
    select a.monthend_date,a.look_back_period,'All Stores' as same_store,
    a.location_type_code,a.daypart,a.destination_desc,
    count(distinct a.cfa_one_id) as unique_cfa_one_ids, 
    count(distinct a.customer_hash) as unique_hashes,
    count(a.customer_hash) as hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct" a
    inner join "cfa"."public"."lcarr_sosx_market_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
    where b.same_store = 'All Stores'
    group by 1,2,3,4,5,6,10
    union
    select a.monthend_date,a.look_back_period,'All Stores' as same_store,
    a.location_type_code,'All' as daypart,a.destination_desc,
    count(distinct a.cfa_one_id) as unique_cfa_one_ids, 
    count(distinct a.customer_hash) as unique_hashes,
    count(a.customer_hash) as hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct" a
    inner join "cfa"."public"."lcarr_sosx_market_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
    where b.same_store = 'All Stores'
    group by 1,2,3,4,5,6,10
    union
    select a.monthend_date,a.look_back_period,'All Stores' as same_store,
    a.location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct a.cfa_one_id) as unique_cfa_one_ids, 
    count(distinct a.customer_hash) as unique_hashes,
    count(a.customer_hash) as hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct" a
    inner join "cfa"."public"."lcarr_sosx_market_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
    where b.same_store = 'All Stores'
    group by 1,2,3,4,5,6,10
    union
    select a.monthend_date,a.look_back_period,'All Stores' as same_store,
    a.location_type_code,a.daypart,'All' as destination_desc,
    count(distinct a.cfa_one_id) as unique_cfa_one_ids, 
    count(distinct a.customer_hash) as unique_hashes,
    count(a.customer_hash) as hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct" a
    inner join "cfa"."public"."lcarr_sosx_market_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
    where b.same_store = 'All Stores'
    group by 1,2,3,4,5,6,10
    union
    select a.monthend_date,a.look_back_period,'All Stores' as same_store,
    'All' as location_type_code,a.daypart,'All' as destination_desc,
    count(distinct a.cfa_one_id) as unique_cfa_one_ids, 
    count(distinct a.customer_hash) as unique_hashes,
    count(a.customer_hash) as hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct" a
    inner join "cfa"."public"."lcarr_sosx_market_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
    where b.same_store = 'All Stores'
    group by 1,2,3,4,5,6,10
    union
    select a.monthend_date,a.look_back_period,'All Stores' as same_store,
    'All' as location_type_code,a.daypart,a.destination_desc,
    count(distinct a.cfa_one_id) as unique_cfa_one_ids, 
    count(distinct a.customer_hash) as unique_hashes,
    count(a.customer_hash) as hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct" a
    inner join "cfa"."public"."lcarr_sosx_market_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
    where b.same_store = 'All Stores'
    group by 1,2,3,4,5,6,10
    union
    select a.monthend_date,a.look_back_period,'All Stores' as same_store,
    'All' as location_type_code,'All' as daypart,a.destination_desc,
    count(distinct a.cfa_one_id) as unique_cfa_one_ids, 
    count(distinct a.customer_hash) as unique_hashes,
    count(a.customer_hash) as hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct" a
    inner join "cfa"."public"."lcarr_sosx_market_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
    where b.same_store = 'All Stores'
    group by 1,2,3,4,5,6,10
    union
    select a.monthend_date,a.look_back_period,'All Stores' as same_store,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct a.cfa_one_id) as unique_cfa_one_ids, 
    count(distinct a.customer_hash) as unique_hashes,
    count(a.customer_hash) as hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct" a
    inner join "cfa"."public"."lcarr_sosx_market_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
    where b.same_store = 'All Stores'
    group by 1,2,3,4,5,6,10
), distinct_calcs_same_store as (
    select a.monthend_date,a.look_back_period,'Same Stores' as same_store,
    a.location_type_code,a.daypart,a.destination_desc,
    count(distinct a.cfa_one_id) as unique_cfa_one_ids, 
    count(distinct a.customer_hash) as unique_hashes,
    count(a.customer_hash) as hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct" a
    inner join "cfa"."public"."lcarr_sosx_market_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
    where a.same_store_eligible = 1
    and b.same_store = 'Same Stores'
    group by 1,2,3,4,5,6,10
    union
    select a.monthend_date,a.look_back_period,'Same Stores' as same_store,
    a.location_type_code,'All' as daypart,a.destination_desc,
    count(distinct a.cfa_one_id) as unique_cfa_one_ids, 
    count(distinct a.customer_hash) as unique_hashes,
    count(a.customer_hash) as hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct" a
    inner join "cfa"."public"."lcarr_sosx_market_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
    where a.same_store_eligible = 1
    and b.same_store = 'Same Stores'
    group by 1,2,3,4,5,6,10
    union
    select a.monthend_date,a.look_back_period,'Same Stores' as same_store,
    a.location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct a.cfa_one_id) as unique_cfa_one_ids, 
    count(distinct a.customer_hash) as unique_hashes,
    count(a.customer_hash) as hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct" a
    inner join "cfa"."public"."lcarr_sosx_market_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
    where a.same_store_eligible = 1
    and b.same_store = 'Same Stores'
    group by 1,2,3,4,5,6,10
    union
    select a.monthend_date,a.look_back_period,'Same Stores' as same_store,
    a.location_type_code,a.daypart,'All' as destination_desc,
    count(distinct a.cfa_one_id) as unique_cfa_one_ids, 
    count(distinct a.customer_hash) as unique_hashes,
    count(a.customer_hash) as hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct" a
    inner join "cfa"."public"."lcarr_sosx_market_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
    where a.same_store_eligible = 1
    and b.same_store = 'Same Stores'
    group by 1,2,3,4,5,6,10
    union
    select a.monthend_date,a.look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,a.daypart,'All' as destination_desc,
    count(distinct a.cfa_one_id) as unique_cfa_one_ids, 
    count(distinct a.customer_hash) as unique_hashes,
    count(a.customer_hash) as hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct" a
    inner join "cfa"."public"."lcarr_sosx_market_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
    where a.same_store_eligible = 1
    and b.same_store = 'Same Stores'
    group by 1,2,3,4,5,6,10
    union
    select a.monthend_date,a.look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,a.daypart,a.destination_desc,
    count(distinct a.cfa_one_id) as unique_cfa_one_ids, 
    count(distinct a.customer_hash) as unique_hashes,
    count(a.customer_hash) as hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct" a
    inner join "cfa"."public"."lcarr_sosx_market_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
    where a.same_store_eligible = 1
    and b.same_store = 'Same Stores'
    group by 1,2,3,4,5,6,10
    union
    select a.monthend_date,a.look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,'All' as daypart,a.destination_desc,
    count(distinct a.cfa_one_id) as unique_cfa_one_ids, 
    count(distinct a.customer_hash) as unique_hashes,
    count(a.customer_hash) as hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct" a
    inner join "cfa"."public"."lcarr_sosx_market_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
    where a.same_store_eligible = 1
    and b.same_store = 'Same Stores'
    group by 1,2,3,4,5,6,10
    union
    select a.monthend_date,a.look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct a.cfa_one_id) as unique_cfa_one_ids, 
    count(distinct a.customer_hash) as unique_hashes,
    count(a.customer_hash) as hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct" a
    inner join "cfa"."public"."lcarr_sosx_market_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
    where a.same_store_eligible = 1
    and b.same_store = 'Same Stores'
    group by 1,2,3,4,5,6,10
)

select * from distinct_calcs_all_store 
union 
select * from distinct_calcs_same_store
  );
16:53:40.257260 [debug] [Thread-1  ]: SQL status: SELECT in 2914.04 seconds
16:53:40.262763 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs"
16:53:40.263088 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs"} */
alter table "cfa"."public"."ast_agg__hash_base_calcs__dbt_tmp" rename to "lcarr_sosx_ast_agg__hash_base_calcs"
16:53:40.315506 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.05 seconds
16:53:40.318195 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs: COMMIT
16:53:40.318859 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs"
16:53:40.319465 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs: COMMIT
16:53:43.816979 [debug] [Thread-1  ]: SQL status: COMMIT in 3.5 seconds
16:53:43.820255 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs"
16:53:43.820734 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs: BEGIN
16:53:43.871085 [debug] [Thread-1  ]: SQL status: BEGIN in 0.05 seconds
16:53:43.873222 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs"
16:53:43.873494 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs"} */
drop table if exists "cfa"."public"."ast_agg__hash_base_calcs__dbt_backup" cascade
16:53:43.925093 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.05 seconds
16:53:43.926541 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs: COMMIT
16:53:43.926784 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs"
16:53:43.926994 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs: COMMIT
16:53:44.057164 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
16:53:44.057772 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs"
16:53:44.058076 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs: BEGIN
16:53:44.110373 [debug] [Thread-1  ]: SQL status: BEGIN in 0.05 seconds
16:53:44.111334 [debug] [Thread-1  ]: finished collecting timing info
16:53:44.111580 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs: ROLLBACK
16:53:44.247344 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs: Close
16:53:44.248901 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6d1c280-5e0f-4d6b-83df-6573bf08eb2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa7163ff670>]}
16:53:44.249545 [info ] [Thread-1  ]: 31 of 55 OK created table model public.lcarr_sosx_ast_agg__hash_base_calcs...... [[32mSELECT[0m in 2919.03s]
16:53:44.250046 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs
16:53:44.250375 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.ast_agg__same_store_all_store
16:53:44.251096 [info ] [Thread-1  ]: 41 of 55 START table model public.lcarr_sosx_ast_agg__same_store_all_store...... [RUN]
16:53:44.252025 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.ast_agg__same_store_all_store"
16:53:44.252307 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.ast_agg__same_store_all_store
16:53:44.252544 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.ast_agg__same_store_all_store
16:53:44.256932 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.ast_agg__same_store_all_store"
16:53:44.259639 [debug] [Thread-1  ]: finished collecting timing info
16:53:44.260024 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.ast_agg__same_store_all_store
16:53:44.336831 [debug] [Thread-1  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.ast_agg__same_store_all_store"
16:53:44.339228 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__same_store_all_store"
16:53:44.339532 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__same_store_all_store: BEGIN
16:53:44.339703 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
16:53:44.339889 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
16:53:44.976177 [debug] [Thread-1  ]: SQL status: BEGIN in 0.64 seconds
16:53:44.976752 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__same_store_all_store"
16:53:44.977024 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__same_store_all_store: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.ast_agg__same_store_all_store"} */


  create  table
    "cfa"."public"."ast_agg__same_store_all_store__dbt_tmp"
    
    
    
  as (
    with transaction_same_store as (
  select a.*,b.same_store_eligible,b.actual_days,b.avail_days
  from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback" a
  left join "cfa"."public"."lcarr_sosx_stg__fct_same_store" b
  on a.location_num = b.location_num
  and a.look_back_period = b.look_back_period
  and a.monthend_date = b.monthend_date
  order by dma_name,location_num,look_back_period,location_type_code,daypart,destination_desc,monthend_date
), market_transaction_agg_all_stores as ( 
  select quarter,
  monthend_date,look_back_period,'All Stores' as same_store,
  location_type_code,daypart,destination_desc,
  sum(sales_sub_total) as sales_sub_total,
  sum(transactions) as transactions,sum(purchaser_visits) as purchaser_visits,
  sum(credit_txn) as credit_txn,sum(total_items_promo_count) as total_items_promo_count,
  sum(total_items_sold_count) as total_items_sold_count,
  sum(actual_days) as actual_days, 
  sum(avail_days) as avail_days
  from transaction_same_store
  group by 1,2,3,4,5,6,7
), market_transaction_agg_same_stores as ( 
  select quarter,
  monthend_date,look_back_period,'Same Stores' as same_store,
  location_type_code,daypart,destination_desc,
  sum(sales_sub_total) as sales_sub_total,
  sum(transactions) as transactions,sum(purchaser_visits) as purchaser_visits,
  sum(credit_txn) as credit_txn,sum(total_items_promo_count) as total_items_promo_count,
  sum(total_items_sold_count) as total_items_sold_count,
  sum(actual_days) as actual_days,
  sum(avail_days) as avail_days
  from transaction_same_store
  where same_store_eligible = 1 
  group by 1,2,3,4,5,6,7
), union_all_same_market_transactions as ( 
  select * from market_transaction_agg_all_stores
  union
  select * from market_transaction_agg_same_stores
)
select * from union_all_same_market_transactions
  );
16:53:47.240806 [debug] [Thread-1  ]: SQL status: SELECT in 2.26 seconds
16:53:47.244331 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__same_store_all_store"
16:53:47.244643 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__same_store_all_store: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.ast_agg__same_store_all_store"} */
alter table "cfa"."public"."ast_agg__same_store_all_store__dbt_tmp" rename to "lcarr_sosx_ast_agg__same_store_all_store"
16:53:47.296321 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.05 seconds
16:53:47.298727 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__same_store_all_store: COMMIT
16:53:47.299059 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__same_store_all_store"
16:53:47.299284 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__same_store_all_store: COMMIT
16:53:48.389775 [debug] [Thread-1  ]: SQL status: COMMIT in 1.09 seconds
16:53:48.390534 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__same_store_all_store"
16:53:48.390779 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__same_store_all_store: BEGIN
16:53:48.446179 [debug] [Thread-1  ]: SQL status: BEGIN in 0.06 seconds
16:53:48.448700 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__same_store_all_store"
16:53:48.449004 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__same_store_all_store: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.ast_agg__same_store_all_store"} */
drop table if exists "cfa"."public"."ast_agg__same_store_all_store__dbt_backup" cascade
16:53:48.514447 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.07 seconds
16:53:48.515952 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__same_store_all_store: COMMIT
16:53:48.516273 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__same_store_all_store"
16:53:48.516527 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__same_store_all_store: COMMIT
16:53:48.745118 [debug] [Thread-1  ]: SQL status: COMMIT in 0.23 seconds
16:53:48.745657 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__same_store_all_store"
16:53:48.745972 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__same_store_all_store: BEGIN
16:53:48.800907 [debug] [Thread-1  ]: SQL status: BEGIN in 0.05 seconds
16:53:48.802026 [debug] [Thread-1  ]: finished collecting timing info
16:53:48.802359 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__same_store_all_store: ROLLBACK
16:53:48.896732 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__same_store_all_store: Close
16:53:48.898453 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6d1c280-5e0f-4d6b-83df-6573bf08eb2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa7162c6340>]}
16:53:48.899113 [info ] [Thread-1  ]: 41 of 55 OK created table model public.lcarr_sosx_ast_agg__same_store_all_store. [[32mSELECT[0m in 4.65s]
16:53:48.899687 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.ast_agg__same_store_all_store
16:53:48.900267 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.market_agg__same_store_all_store
16:53:48.900921 [info ] [Thread-1  ]: 42 of 55 START table model public.lcarr_sosx_market_agg__same_store_all_store... [RUN]
16:53:48.901790 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.market_agg__same_store_all_store"
16:53:48.902192 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.market_agg__same_store_all_store
16:53:48.902709 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.market_agg__same_store_all_store
16:53:48.906932 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.market_agg__same_store_all_store"
16:53:48.907879 [debug] [Thread-1  ]: finished collecting timing info
16:53:48.908166 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.market_agg__same_store_all_store
16:53:48.986154 [debug] [Thread-1  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.market_agg__same_store_all_store"
16:53:48.986870 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__same_store_all_store"
16:53:48.987083 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__same_store_all_store: BEGIN
16:53:48.987303 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
16:53:48.987481 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
16:53:49.703898 [debug] [Thread-1  ]: SQL status: BEGIN in 0.72 seconds
16:53:49.704501 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__same_store_all_store"
16:53:49.704793 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__same_store_all_store: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__same_store_all_store"} */


  create  table
    "cfa"."public"."market_agg__same_store_all_store__dbt_tmp"
    
    
    
  as (
    with transaction_same_store as (
  select a.*,b.same_store_eligible,b.actual_days,b.avail_days
  from "cfa"."public"."lcarr_sosx_market_agg__month_lookback" a
  left join "cfa"."public"."lcarr_sosx_stg__fct_same_store" b
  on a.location_num = b.location_num
  and a.look_back_period = b.look_back_period
  and a.monthend_date = b.monthend_date
  order by dma_name,location_num,look_back_period,location_type_code,daypart,destination_desc,monthend_date
), market_transaction_agg_all_stores as ( 
  select quarter,
  monthend_date,look_back_period,'All Stores' as same_store,
  location_type_code,daypart,destination_desc,
  sum(sales_sub_total) as sales_sub_total,
  sum(transactions) as transactions,sum(purchaser_visits) as purchaser_visits,
  sum(credit_txn) as credit_txn,sum(total_items_promo_count) as total_items_promo_count,
  sum(total_items_sold_count) as total_items_sold_count,
  sum(actual_days) as actual_days, 
  sum(avail_days) as avail_days
  from transaction_same_store
  group by 1,2,3,4,5,6,7
), market_transaction_agg_same_stores as ( 
  select quarter,
  monthend_date,look_back_period,'Same Stores' as same_store,
  location_type_code,daypart,destination_desc,
  sum(sales_sub_total) as sales_sub_total,
  sum(transactions) as transactions,sum(purchaser_visits) as purchaser_visits,
  sum(credit_txn) as credit_txn,sum(total_items_promo_count) as total_items_promo_count,
  sum(total_items_sold_count) as total_items_sold_count,
  sum(actual_days) as actual_days,
  sum(avail_days) as avail_days
  from transaction_same_store
  where same_store_eligible = 1 
  group by 1,2,3,4,5,6,7
), union_all_same_market_transactions as ( 
  select * from market_transaction_agg_all_stores
  union
  select * from market_transaction_agg_same_stores
)
select * from union_all_same_market_transactions
  );
16:53:52.137935 [debug] [Thread-1  ]: SQL status: SELECT in 2.43 seconds
16:53:52.141458 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__same_store_all_store"
16:53:52.141754 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__same_store_all_store: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__same_store_all_store"} */
alter table "cfa"."public"."market_agg__same_store_all_store__dbt_tmp" rename to "lcarr_sosx_market_agg__same_store_all_store"
16:53:52.195566 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.05 seconds
16:53:52.198101 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__same_store_all_store: COMMIT
16:53:52.198651 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__same_store_all_store"
16:53:52.199630 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__same_store_all_store: COMMIT
16:53:53.123137 [debug] [Thread-1  ]: SQL status: COMMIT in 0.92 seconds
16:53:53.123955 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__same_store_all_store"
16:53:53.124231 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__same_store_all_store: BEGIN
16:53:53.184464 [debug] [Thread-1  ]: SQL status: BEGIN in 0.06 seconds
16:53:53.186921 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__same_store_all_store"
16:53:53.187230 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__same_store_all_store: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__same_store_all_store"} */
drop table if exists "cfa"."public"."market_agg__same_store_all_store__dbt_backup" cascade
16:53:53.241428 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.05 seconds
16:53:53.243171 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__same_store_all_store: COMMIT
16:53:53.243482 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__same_store_all_store"
16:53:53.243738 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__same_store_all_store: COMMIT
16:53:53.356030 [debug] [Thread-1  ]: SQL status: COMMIT in 0.11 seconds
16:53:53.356702 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__same_store_all_store"
16:53:53.356939 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__same_store_all_store: BEGIN
16:53:53.408757 [debug] [Thread-1  ]: SQL status: BEGIN in 0.05 seconds
16:53:53.409703 [debug] [Thread-1  ]: finished collecting timing info
16:53:53.410006 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__same_store_all_store: ROLLBACK
16:53:53.501319 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__same_store_all_store: Close
16:53:53.502560 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6d1c280-5e0f-4d6b-83df-6573bf08eb2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa7160e15e0>]}
16:53:53.503139 [info ] [Thread-1  ]: 42 of 55 OK created table model public.lcarr_sosx_market_agg__same_store_all_store [[32mSELECT[0m in 4.60s]
16:53:53.503592 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.market_agg__same_store_all_store
16:53:53.503945 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.national_agg__same_store_all_store
16:53:53.504421 [info ] [Thread-1  ]: 43 of 55 START table model public.lcarr_sosx_national_agg__same_store_all_store. [RUN]
16:53:53.505210 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"
16:53:53.505671 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.national_agg__same_store_all_store
16:53:53.505952 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.national_agg__same_store_all_store
16:53:53.509749 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"
16:53:53.511700 [debug] [Thread-1  ]: finished collecting timing info
16:53:53.512029 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.national_agg__same_store_all_store
16:53:53.582877 [debug] [Thread-1  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"
16:53:53.584645 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"
16:53:53.585024 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__same_store_all_store: BEGIN
16:53:53.585256 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
16:53:53.585454 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
16:53:54.163523 [debug] [Thread-1  ]: SQL status: BEGIN in 0.58 seconds
16:53:54.164285 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"
16:53:54.164620 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__same_store_all_store: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"} */


  create  table
    "cfa"."public"."national_agg__same_store_all_store__dbt_tmp"
    
    
    
  as (
    with transaction_same_store as (
  select a.*,b.same_store_eligible,b.actual_days,b.avail_days
  from "cfa"."public"."lcarr_sosx_national_agg__month_lookback" a
  left join "cfa"."public"."lcarr_sosx_stg__fct_same_store" b
  on a.location_num = b.location_num
  and a.look_back_period = b.look_back_period
  and a.monthend_date = b.monthend_date
  order by dma_name,location_num,look_back_period,location_type_code,daypart,destination_desc,monthend_date
), market_transaction_agg_all_stores as ( 
  select quarter,
  monthend_date,look_back_period,'All Stores' as same_store,
  location_type_code,daypart,destination_desc,
  sum(sales_sub_total) as sales_sub_total,
  sum(transactions) as transactions,sum(purchaser_visits) as purchaser_visits,
  sum(credit_txn) as credit_txn,sum(total_items_promo_count) as total_items_promo_count,
  sum(total_items_sold_count) as total_items_sold_count,
  sum(actual_days) as actual_days, 
  sum(avail_days) as avail_days
  from transaction_same_store
  group by 1,2,3,4,5,6,7
), market_transaction_agg_same_stores as ( 
  select quarter,
  monthend_date,look_back_period,'Same Stores' as same_store,
  location_type_code,daypart,destination_desc,
  sum(sales_sub_total) as sales_sub_total,
  sum(transactions) as transactions,sum(purchaser_visits) as purchaser_visits,
  sum(credit_txn) as credit_txn,sum(total_items_promo_count) as total_items_promo_count,
  sum(total_items_sold_count) as total_items_sold_count,
  sum(actual_days) as actual_days,
  sum(avail_days) as avail_days
  from transaction_same_store
  where same_store_eligible = 1 
  group by 1,2,3,4,5,6,7
), union_all_same_market_transactions as ( 
  select * from market_transaction_agg_all_stores
  union
  select * from market_transaction_agg_same_stores
)
select * from union_all_same_market_transactions
  );
16:53:55.571847 [debug] [Thread-1  ]: SQL status: SELECT in 1.41 seconds
16:53:55.582461 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"
16:53:55.582927 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__same_store_all_store: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"} */
alter table "cfa"."public"."national_agg__same_store_all_store__dbt_tmp" rename to "lcarr_sosx_national_agg__same_store_all_store"
16:53:55.649821 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.07 seconds
16:53:55.652030 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__same_store_all_store: COMMIT
16:53:55.652357 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"
16:53:55.652561 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__same_store_all_store: COMMIT
16:53:57.010230 [debug] [Thread-1  ]: SQL status: COMMIT in 1.36 seconds
16:53:57.011028 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"
16:53:57.011621 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__same_store_all_store: BEGIN
16:53:57.062611 [debug] [Thread-1  ]: SQL status: BEGIN in 0.05 seconds
16:53:57.065393 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"
16:53:57.065704 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__same_store_all_store: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"} */
drop table if exists "cfa"."public"."national_agg__same_store_all_store__dbt_backup" cascade
16:53:57.116626 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.05 seconds
16:53:57.118097 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__same_store_all_store: COMMIT
16:53:57.118353 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"
16:53:57.118570 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__same_store_all_store: COMMIT
16:53:57.224676 [debug] [Thread-1  ]: SQL status: COMMIT in 0.11 seconds
16:53:57.225257 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"
16:53:57.225511 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__same_store_all_store: BEGIN
16:53:57.280969 [debug] [Thread-1  ]: SQL status: BEGIN in 0.06 seconds
16:53:57.282043 [debug] [Thread-1  ]: finished collecting timing info
16:53:57.282527 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__same_store_all_store: ROLLBACK
16:53:57.373381 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__same_store_all_store: Close
16:53:57.374618 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6d1c280-5e0f-4d6b-83df-6573bf08eb2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa7165110a0>]}
16:53:57.375514 [info ] [Thread-1  ]: 43 of 55 OK created table model public.lcarr_sosx_national_agg__same_store_all_store [[32mSELECT[0m in 3.87s]
16:53:57.376214 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.national_agg__same_store_all_store
16:53:57.376615 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.regional_agg__same_store_all_store
16:53:57.377601 [info ] [Thread-1  ]: 44 of 55 START table model public.lcarr_sosx_regional_agg__same_store_all_store. [RUN]
16:53:57.378749 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.regional_agg__same_store_all_store"
16:53:57.379133 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.regional_agg__same_store_all_store
16:53:57.379465 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.regional_agg__same_store_all_store
16:53:57.387322 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.regional_agg__same_store_all_store"
16:53:57.388269 [debug] [Thread-1  ]: finished collecting timing info
16:53:57.389116 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.regional_agg__same_store_all_store
16:53:57.490549 [debug] [Thread-1  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.regional_agg__same_store_all_store"
16:53:57.491607 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional_agg__same_store_all_store"
16:53:57.492025 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.regional_agg__same_store_all_store: BEGIN
16:53:57.492353 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
16:53:57.492683 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
16:53:58.205867 [debug] [Thread-1  ]: SQL status: BEGIN in 0.71 seconds
16:53:58.206411 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional_agg__same_store_all_store"
16:53:58.206697 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.regional_agg__same_store_all_store: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.regional_agg__same_store_all_store"} */


  create  table
    "cfa"."public"."regional_agg__same_store_all_store__dbt_tmp"
    
    
    
  as (
    with transaction_same_store as (
  select a.*,b.same_store_eligible,b.actual_days,b.avail_days
  from "cfa"."public"."lcarr_sosx_regional_agg__month_lookback" a
  left join "cfa"."public"."lcarr_sosx_stg__fct_same_store" b
  on a.location_num = b.location_num
  and a.look_back_period = b.look_back_period
  and a.monthend_date = b.monthend_date
  order by dma_name,location_num,look_back_period,location_type_code,daypart,destination_desc,monthend_date
), market_transaction_agg_all_stores as ( 
  select quarter,
  monthend_date,look_back_period,'All Stores' as same_store,
  location_type_code,daypart,destination_desc,
  sum(sales_sub_total) as sales_sub_total,
  sum(transactions) as transactions,sum(purchaser_visits) as purchaser_visits,
  sum(credit_txn) as credit_txn,sum(total_items_promo_count) as total_items_promo_count,
  sum(total_items_sold_count) as total_items_sold_count,
  sum(actual_days) as actual_days, 
  sum(avail_days) as avail_days
  from transaction_same_store
  group by 1,2,3,4,5,6,7
), market_transaction_agg_same_stores as ( 
  select quarter,
  monthend_date,look_back_period,'Same Stores' as same_store,
  location_type_code,daypart,destination_desc,
  sum(sales_sub_total) as sales_sub_total,
  sum(transactions) as transactions,sum(purchaser_visits) as purchaser_visits,
  sum(credit_txn) as credit_txn,sum(total_items_promo_count) as total_items_promo_count,
  sum(total_items_sold_count) as total_items_sold_count,
  sum(actual_days) as actual_days,
  sum(avail_days) as avail_days
  from transaction_same_store
  where same_store_eligible = 1 
  group by 1,2,3,4,5,6,7
), union_all_same_market_transactions as ( 
  select * from market_transaction_agg_all_stores
  union
  select * from market_transaction_agg_same_stores
)
select * from union_all_same_market_transactions
  );
16:54:00.966701 [debug] [Thread-1  ]: SQL status: SELECT in 2.76 seconds
16:54:00.970097 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional_agg__same_store_all_store"
16:54:00.970515 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.regional_agg__same_store_all_store: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.regional_agg__same_store_all_store"} */
alter table "cfa"."public"."regional_agg__same_store_all_store__dbt_tmp" rename to "lcarr_sosx_regional_agg__same_store_all_store"
16:54:01.024425 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.05 seconds
16:54:01.027582 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.regional_agg__same_store_all_store: COMMIT
16:54:01.028287 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional_agg__same_store_all_store"
16:54:01.028649 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.regional_agg__same_store_all_store: COMMIT
16:54:01.996997 [debug] [Thread-1  ]: SQL status: COMMIT in 0.97 seconds
16:54:01.997730 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional_agg__same_store_all_store"
16:54:01.998067 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.regional_agg__same_store_all_store: BEGIN
16:54:02.078754 [debug] [Thread-1  ]: SQL status: BEGIN in 0.08 seconds
16:54:02.082196 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional_agg__same_store_all_store"
16:54:02.082513 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.regional_agg__same_store_all_store: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.regional_agg__same_store_all_store"} */
drop table if exists "cfa"."public"."regional_agg__same_store_all_store__dbt_backup" cascade
16:54:02.133851 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.05 seconds
16:54:02.135593 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.regional_agg__same_store_all_store: COMMIT
16:54:02.135955 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional_agg__same_store_all_store"
16:54:02.136226 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.regional_agg__same_store_all_store: COMMIT
16:54:02.242835 [debug] [Thread-1  ]: SQL status: COMMIT in 0.11 seconds
16:54:02.243333 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional_agg__same_store_all_store"
16:54:02.243603 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.regional_agg__same_store_all_store: BEGIN
16:54:02.295603 [debug] [Thread-1  ]: SQL status: BEGIN in 0.05 seconds
16:54:02.296517 [debug] [Thread-1  ]: finished collecting timing info
16:54:02.296804 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.regional_agg__same_store_all_store: ROLLBACK
16:54:02.524808 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.regional_agg__same_store_all_store: Close
16:54:02.526068 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6d1c280-5e0f-4d6b-83df-6573bf08eb2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa716445c70>]}
16:54:02.526676 [info ] [Thread-1  ]: 44 of 55 OK created table model public.lcarr_sosx_regional_agg__same_store_all_store [[32mSELECT[0m in 5.15s]
16:54:02.527269 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.regional_agg__same_store_all_store
16:54:02.527584 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.ast_agg__distinct_calcs
16:54:02.528094 [info ] [Thread-1  ]: 45 of 55 START table model public.lcarr_sosx_ast_agg__distinct_calcs............ [RUN]
16:54:02.528980 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.ast_agg__distinct_calcs"
16:54:02.529374 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.ast_agg__distinct_calcs
16:54:02.529778 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.ast_agg__distinct_calcs
16:54:02.541250 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.ast_agg__distinct_calcs"
16:54:02.542694 [debug] [Thread-1  ]: finished collecting timing info
16:54:02.543111 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.ast_agg__distinct_calcs
16:54:02.619431 [debug] [Thread-1  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.ast_agg__distinct_calcs"
16:54:02.625322 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__distinct_calcs"
16:54:02.625674 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__distinct_calcs: BEGIN
16:54:02.625888 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
16:54:02.626165 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
16:54:03.503725 [debug] [Thread-1  ]: SQL status: BEGIN in 0.88 seconds
16:54:03.504344 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__distinct_calcs"
16:54:03.504730 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__distinct_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.ast_agg__distinct_calcs"} */


  create  table
    "cfa"."public"."ast_agg__distinct_calcs__dbt_tmp"
    
    
    
  as (
    with distinct_calcs_all_store as (
    select a.monthend_date,a.look_back_period,'All Stores' as same_store,
    a.location_type_code,a.daypart,a.destination_desc,
    count(distinct a.cfa_one_id) as unique_cfa_one_ids, 
    count(distinct a.customer_hash) as unique_hashes,
    count(a.customer_hash) as hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct" a
    inner join "cfa"."public"."lcarr_sosx_ast_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
    where b.same_store = 'All Stores'
    group by 1,2,3,4,5,6,10
    union
    select a.monthend_date,a.look_back_period,'All Stores' as same_store,
    a.location_type_code,'All' as daypart,a.destination_desc,
    count(distinct a.cfa_one_id) as unique_cfa_one_ids, 
    count(distinct a.customer_hash) as unique_hashes,
    count(a.customer_hash) as hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct" a
    inner join "cfa"."public"."lcarr_sosx_ast_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
    where b.same_store = 'All Stores'
    group by 1,2,3,4,5,6,10
    union
    select a.monthend_date,a.look_back_period,'All Stores' as same_store,
    a.location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct a.cfa_one_id) as unique_cfa_one_ids, 
    count(distinct a.customer_hash) as unique_hashes,
    count(a.customer_hash) as hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct" a
    inner join "cfa"."public"."lcarr_sosx_ast_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
    where b.same_store = 'All Stores'
    group by 1,2,3,4,5,6,10
    union
    select a.monthend_date,a.look_back_period,'All Stores' as same_store,
    a.location_type_code,a.daypart,'All' as destination_desc,
    count(distinct a.cfa_one_id) as unique_cfa_one_ids, 
    count(distinct a.customer_hash) as unique_hashes,
    count(a.customer_hash) as hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct" a
    inner join "cfa"."public"."lcarr_sosx_ast_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
    where b.same_store = 'All Stores'
    group by 1,2,3,4,5,6,10
    union
    select a.monthend_date,a.look_back_period,'All Stores' as same_store,
    'All' as location_type_code,a.daypart,'All' as destination_desc,
    count(distinct a.cfa_one_id) as unique_cfa_one_ids, 
    count(distinct a.customer_hash) as unique_hashes,
    count(a.customer_hash) as hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct" a
    inner join "cfa"."public"."lcarr_sosx_ast_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
    where b.same_store = 'All Stores'
    group by 1,2,3,4,5,6,10
    union
    select a.monthend_date,a.look_back_period,'All Stores' as same_store,
    'All' as location_type_code,a.daypart,a.destination_desc,
    count(distinct a.cfa_one_id) as unique_cfa_one_ids, 
    count(distinct a.customer_hash) as unique_hashes,
    count(a.customer_hash) as hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct" a
    inner join "cfa"."public"."lcarr_sosx_ast_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
    where b.same_store = 'All Stores'
    group by 1,2,3,4,5,6,10
    union
    select a.monthend_date,a.look_back_period,'All Stores' as same_store,
    'All' as location_type_code,'All' as daypart,a.destination_desc,
    count(distinct a.cfa_one_id) as unique_cfa_one_ids, 
    count(distinct a.customer_hash) as unique_hashes,
    count(a.customer_hash) as hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct" a
    inner join "cfa"."public"."lcarr_sosx_ast_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
    where b.same_store = 'All Stores'
    group by 1,2,3,4,5,6,10
    union
    select a.monthend_date,a.look_back_period,'All Stores' as same_store,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct a.cfa_one_id) as unique_cfa_one_ids, 
    count(distinct a.customer_hash) as unique_hashes,
    count(a.customer_hash) as hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct" a
    inner join "cfa"."public"."lcarr_sosx_ast_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
    where b.same_store = 'All Stores'
    group by 1,2,3,4,5,6,10
), distinct_calcs_same_store as (
    select a.monthend_date,a.look_back_period,'Same Stores' as same_store,
    a.location_type_code,a.daypart,a.destination_desc,
    count(distinct a.cfa_one_id) as unique_cfa_one_ids, 
    count(distinct a.customer_hash) as unique_hashes,
    count(a.customer_hash) as hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct" a
    inner join "cfa"."public"."lcarr_sosx_ast_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
    where a.same_store_eligible = 1
    and b.same_store = 'Same Stores'
    group by 1,2,3,4,5,6,10
    union
    select a.monthend_date,a.look_back_period,'Same Stores' as same_store,
    a.location_type_code,'All' as daypart,a.destination_desc,
    count(distinct a.cfa_one_id) as unique_cfa_one_ids, 
    count(distinct a.customer_hash) as unique_hashes,
    count(a.customer_hash) as hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct" a
    inner join "cfa"."public"."lcarr_sosx_ast_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
    where a.same_store_eligible = 1
    and b.same_store = 'Same Stores'
    group by 1,2,3,4,5,6,10
    union
    select a.monthend_date,a.look_back_period,'Same Stores' as same_store,
    a.location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct a.cfa_one_id) as unique_cfa_one_ids, 
    count(distinct a.customer_hash) as unique_hashes,
    count(a.customer_hash) as hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct" a
    inner join "cfa"."public"."lcarr_sosx_ast_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
    where a.same_store_eligible = 1
    and b.same_store = 'Same Stores'
    group by 1,2,3,4,5,6,10
    union
    select a.monthend_date,a.look_back_period,'Same Stores' as same_store,
    a.location_type_code,a.daypart,'All' as destination_desc,
    count(distinct a.cfa_one_id) as unique_cfa_one_ids, 
    count(distinct a.customer_hash) as unique_hashes,
    count(a.customer_hash) as hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct" a
    inner join "cfa"."public"."lcarr_sosx_ast_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
    where a.same_store_eligible = 1
    and b.same_store = 'Same Stores'
    group by 1,2,3,4,5,6,10
    union
    select a.monthend_date,a.look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,a.daypart,'All' as destination_desc,
    count(distinct a.cfa_one_id) as unique_cfa_one_ids, 
    count(distinct a.customer_hash) as unique_hashes,
    count(a.customer_hash) as hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct" a
    inner join "cfa"."public"."lcarr_sosx_ast_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
    where a.same_store_eligible = 1
    and b.same_store = 'Same Stores'
    group by 1,2,3,4,5,6,10
    union
    select a.monthend_date,a.look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,a.daypart,a.destination_desc,
    count(distinct a.cfa_one_id) as unique_cfa_one_ids, 
    count(distinct a.customer_hash) as unique_hashes,
    count(a.customer_hash) as hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct" a
    inner join "cfa"."public"."lcarr_sosx_ast_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
    where a.same_store_eligible = 1
    and b.same_store = 'Same Stores'
    group by 1,2,3,4,5,6,10
    union
    select a.monthend_date,a.look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,'All' as daypart,a.destination_desc,
    count(distinct a.cfa_one_id) as unique_cfa_one_ids, 
    count(distinct a.customer_hash) as unique_hashes,
    count(a.customer_hash) as hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct" a
    inner join "cfa"."public"."lcarr_sosx_ast_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
    where a.same_store_eligible = 1
    and b.same_store = 'Same Stores'
    group by 1,2,3,4,5,6,10
    union
    select a.monthend_date,a.look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct a.cfa_one_id) as unique_cfa_one_ids, 
    count(distinct a.customer_hash) as unique_hashes,
    count(a.customer_hash) as hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct" a
    inner join "cfa"."public"."lcarr_sosx_ast_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
    where a.same_store_eligible = 1
    and b.same_store = 'Same Stores'
    group by 1,2,3,4,5,6,10
)

select * from distinct_calcs_all_store 
union 
select * from distinct_calcs_same_store
  );
17:02:19.642930 [debug] [Thread-2  ]: SQL status: SELECT in 1275.46 seconds
17:02:19.649465 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional_agg__hash_base_calcs"
17:02:19.649797 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.regional_agg__hash_base_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.regional_agg__hash_base_calcs"} */
alter table "cfa"."public"."regional_agg__hash_base_calcs__dbt_tmp" rename to "lcarr_sosx_regional_agg__hash_base_calcs"
17:02:19.738434 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.09 seconds
17:02:19.741157 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.regional_agg__hash_base_calcs: COMMIT
17:02:19.741456 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional_agg__hash_base_calcs"
17:02:19.741748 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.regional_agg__hash_base_calcs: COMMIT
17:02:25.302224 [debug] [Thread-2  ]: SQL status: COMMIT in 5.56 seconds
17:02:25.302979 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional_agg__hash_base_calcs"
17:02:25.303225 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.regional_agg__hash_base_calcs: BEGIN
17:02:25.364706 [debug] [Thread-2  ]: SQL status: BEGIN in 0.06 seconds
17:02:25.368357 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional_agg__hash_base_calcs"
17:02:25.368670 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.regional_agg__hash_base_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.regional_agg__hash_base_calcs"} */
drop table if exists "cfa"."public"."regional_agg__hash_base_calcs__dbt_backup" cascade
17:02:25.425731 [debug] [Thread-2  ]: SQL status: DROP TABLE in 0.06 seconds
17:02:25.427178 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.regional_agg__hash_base_calcs: COMMIT
17:02:25.427438 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional_agg__hash_base_calcs"
17:02:25.427661 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.regional_agg__hash_base_calcs: COMMIT
17:02:25.625330 [debug] [Thread-2  ]: SQL status: COMMIT in 0.2 seconds
17:02:25.626229 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional_agg__hash_base_calcs"
17:02:25.626520 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.regional_agg__hash_base_calcs: BEGIN
17:02:25.712998 [debug] [Thread-2  ]: SQL status: BEGIN in 0.09 seconds
17:02:25.714334 [debug] [Thread-2  ]: finished collecting timing info
17:02:25.714643 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.regional_agg__hash_base_calcs: ROLLBACK
17:02:25.831757 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.regional_agg__hash_base_calcs: Close
17:02:25.833216 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6d1c280-5e0f-4d6b-83df-6573bf08eb2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa715e06100>]}
17:02:25.833778 [info ] [Thread-2  ]: 38 of 55 OK created table model public.lcarr_sosx_regional_agg__hash_base_calcs. [[32mSELECT[0m in 1282.30s]
17:02:25.834245 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.regional_agg__hash_base_calcs
17:02:25.834852 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.regional_agg__distinct_calcs
17:02:25.835290 [info ] [Thread-2  ]: 46 of 55 START table model public.lcarr_sosx_regional_agg__distinct_calcs....... [RUN]
17:02:25.836183 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.regional_agg__distinct_calcs"
17:02:25.836498 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.regional_agg__distinct_calcs
17:02:25.836756 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.regional_agg__distinct_calcs
17:02:25.847803 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.regional_agg__distinct_calcs"
17:02:25.850996 [debug] [Thread-2  ]: finished collecting timing info
17:02:25.851666 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.regional_agg__distinct_calcs
17:02:25.923306 [debug] [Thread-2  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.regional_agg__distinct_calcs"
17:02:25.925159 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional_agg__distinct_calcs"
17:02:25.925591 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.regional_agg__distinct_calcs: BEGIN
17:02:25.925833 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
17:02:25.926030 [debug] [Thread-2  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
17:02:26.690514 [debug] [Thread-2  ]: SQL status: BEGIN in 0.76 seconds
17:02:26.690992 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional_agg__distinct_calcs"
17:02:26.691223 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.regional_agg__distinct_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.regional_agg__distinct_calcs"} */


  create  table
    "cfa"."public"."regional_agg__distinct_calcs__dbt_tmp"
    
    
    
  as (
    with distinct_calcs_all_store as (
    select a.monthend_date,a.look_back_period,'All Stores' as same_store,
    a.location_type_code,a.daypart,a.destination_desc,
    count(distinct a.cfa_one_id) as unique_cfa_one_ids, 
    count(distinct a.customer_hash) as unique_hashes,
    count(a.customer_hash) as hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_regional_agg__month_lookback_distinct" a
    inner join "cfa"."public"."lcarr_sosx_regional_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
    where b.same_store = 'All Stores'
    group by 1,2,3,4,5,6,10
    union
    select a.monthend_date,a.look_back_period,'All Stores' as same_store,
    a.location_type_code,'All' as daypart,a.destination_desc,
    count(distinct a.cfa_one_id) as unique_cfa_one_ids, 
    count(distinct a.customer_hash) as unique_hashes,
    count(a.customer_hash) as hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_regional_agg__month_lookback_distinct" a
    inner join "cfa"."public"."lcarr_sosx_regional_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
    where b.same_store = 'All Stores'
    group by 1,2,3,4,5,6,10
    union
    select a.monthend_date,a.look_back_period,'All Stores' as same_store,
    a.location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct a.cfa_one_id) as unique_cfa_one_ids, 
    count(distinct a.customer_hash) as unique_hashes,
    count(a.customer_hash) as hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_regional_agg__month_lookback_distinct" a
    inner join "cfa"."public"."lcarr_sosx_regional_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
    where b.same_store = 'All Stores'
    group by 1,2,3,4,5,6,10
    union
    select a.monthend_date,a.look_back_period,'All Stores' as same_store,
    a.location_type_code,a.daypart,'All' as destination_desc,
    count(distinct a.cfa_one_id) as unique_cfa_one_ids, 
    count(distinct a.customer_hash) as unique_hashes,
    count(a.customer_hash) as hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_regional_agg__month_lookback_distinct" a
    inner join "cfa"."public"."lcarr_sosx_regional_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
    where b.same_store = 'All Stores'
    group by 1,2,3,4,5,6,10
    union
    select a.monthend_date,a.look_back_period,'All Stores' as same_store,
    'All' as location_type_code,a.daypart,'All' as destination_desc,
    count(distinct a.cfa_one_id) as unique_cfa_one_ids, 
    count(distinct a.customer_hash) as unique_hashes,
    count(a.customer_hash) as hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_regional_agg__month_lookback_distinct" a
    inner join "cfa"."public"."lcarr_sosx_regional_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
    where b.same_store = 'All Stores'
    group by 1,2,3,4,5,6,10
    union
    select a.monthend_date,a.look_back_period,'All Stores' as same_store,
    'All' as location_type_code,a.daypart,a.destination_desc,
    count(distinct a.cfa_one_id) as unique_cfa_one_ids, 
    count(distinct a.customer_hash) as unique_hashes,
    count(a.customer_hash) as hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_regional_agg__month_lookback_distinct" a
    inner join "cfa"."public"."lcarr_sosx_regional_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
    where b.same_store = 'All Stores'
    group by 1,2,3,4,5,6,10
    union
    select a.monthend_date,a.look_back_period,'All Stores' as same_store,
    'All' as location_type_code,'All' as daypart,a.destination_desc,
    count(distinct a.cfa_one_id) as unique_cfa_one_ids, 
    count(distinct a.customer_hash) as unique_hashes,
    count(a.customer_hash) as hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_regional_agg__month_lookback_distinct" a
    inner join "cfa"."public"."lcarr_sosx_regional_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
    where b.same_store = 'All Stores'
    group by 1,2,3,4,5,6,10
    union
    select a.monthend_date,a.look_back_period,'All Stores' as same_store,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct a.cfa_one_id) as unique_cfa_one_ids, 
    count(distinct a.customer_hash) as unique_hashes,
    count(a.customer_hash) as hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_regional_agg__month_lookback_distinct" a
    inner join "cfa"."public"."lcarr_sosx_regional_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
    where b.same_store = 'All Stores'
    group by 1,2,3,4,5,6,10
), distinct_calcs_same_store as (
    select a.monthend_date,a.look_back_period,'Same Stores' as same_store,
    a.location_type_code,a.daypart,a.destination_desc,
    count(distinct a.cfa_one_id) as unique_cfa_one_ids, 
    count(distinct a.customer_hash) as unique_hashes,
    count(a.customer_hash) as hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_regional_agg__month_lookback_distinct" a
    inner join "cfa"."public"."lcarr_sosx_regional_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
    where a.same_store_eligible = 1
    and b.same_store = 'Same Stores'
    group by 1,2,3,4,5,6,10
    union
    select a.monthend_date,a.look_back_period,'Same Stores' as same_store,
    a.location_type_code,'All' as daypart,a.destination_desc,
    count(distinct a.cfa_one_id) as unique_cfa_one_ids, 
    count(distinct a.customer_hash) as unique_hashes,
    count(a.customer_hash) as hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_regional_agg__month_lookback_distinct" a
    inner join "cfa"."public"."lcarr_sosx_regional_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
    where a.same_store_eligible = 1
    and b.same_store = 'Same Stores'
    group by 1,2,3,4,5,6,10
    union
    select a.monthend_date,a.look_back_period,'Same Stores' as same_store,
    a.location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct a.cfa_one_id) as unique_cfa_one_ids, 
    count(distinct a.customer_hash) as unique_hashes,
    count(a.customer_hash) as hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_regional_agg__month_lookback_distinct" a
    inner join "cfa"."public"."lcarr_sosx_regional_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
    where a.same_store_eligible = 1
    and b.same_store = 'Same Stores'
    group by 1,2,3,4,5,6,10
    union
    select a.monthend_date,a.look_back_period,'Same Stores' as same_store,
    a.location_type_code,a.daypart,'All' as destination_desc,
    count(distinct a.cfa_one_id) as unique_cfa_one_ids, 
    count(distinct a.customer_hash) as unique_hashes,
    count(a.customer_hash) as hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_regional_agg__month_lookback_distinct" a
    inner join "cfa"."public"."lcarr_sosx_regional_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
    where a.same_store_eligible = 1
    and b.same_store = 'Same Stores'
    group by 1,2,3,4,5,6,10
    union
    select a.monthend_date,a.look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,a.daypart,'All' as destination_desc,
    count(distinct a.cfa_one_id) as unique_cfa_one_ids, 
    count(distinct a.customer_hash) as unique_hashes,
    count(a.customer_hash) as hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_regional_agg__month_lookback_distinct" a
    inner join "cfa"."public"."lcarr_sosx_regional_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
    where a.same_store_eligible = 1
    and b.same_store = 'Same Stores'
    group by 1,2,3,4,5,6,10
    union
    select a.monthend_date,a.look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,a.daypart,a.destination_desc,
    count(distinct a.cfa_one_id) as unique_cfa_one_ids, 
    count(distinct a.customer_hash) as unique_hashes,
    count(a.customer_hash) as hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_regional_agg__month_lookback_distinct" a
    inner join "cfa"."public"."lcarr_sosx_regional_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
    where a.same_store_eligible = 1
    and b.same_store = 'Same Stores'
    group by 1,2,3,4,5,6,10
    union
    select a.monthend_date,a.look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,'All' as daypart,a.destination_desc,
    count(distinct a.cfa_one_id) as unique_cfa_one_ids, 
    count(distinct a.customer_hash) as unique_hashes,
    count(a.customer_hash) as hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_regional_agg__month_lookback_distinct" a
    inner join "cfa"."public"."lcarr_sosx_regional_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
    where a.same_store_eligible = 1
    and b.same_store = 'Same Stores'
    group by 1,2,3,4,5,6,10
    union
    select a.monthend_date,a.look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct a.cfa_one_id) as unique_cfa_one_ids, 
    count(distinct a.customer_hash) as unique_hashes,
    count(a.customer_hash) as hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_regional_agg__month_lookback_distinct" a
    inner join "cfa"."public"."lcarr_sosx_regional_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
    where a.same_store_eligible = 1
    and b.same_store = 'Same Stores'
    group by 1,2,3,4,5,6,10
)

select * from distinct_calcs_all_store 
union 
select * from distinct_calcs_same_store
  );
17:34:12.044097 [debug] [Thread-4  ]: SQL status: SELECT in 3032.33 seconds
17:34:12.153091 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__distinct_calcs"
17:34:12.153600 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__distinct_calcs"} */
alter table "cfa"."public"."market_agg__distinct_calcs__dbt_tmp" rename to "lcarr_sosx_market_agg__distinct_calcs"
17:34:12.208963 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.06 seconds
17:34:12.213169 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_calcs: COMMIT
17:34:12.213602 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__distinct_calcs"
17:34:12.213823 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_calcs: COMMIT
17:34:13.766244 [debug] [Thread-4  ]: SQL status: COMMIT in 1.55 seconds
17:34:13.767826 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__distinct_calcs"
17:34:13.768343 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_calcs: BEGIN
17:34:13.842264 [debug] [Thread-4  ]: SQL status: BEGIN in 0.07 seconds
17:34:13.845622 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__distinct_calcs"
17:34:13.845980 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__distinct_calcs"} */
drop table if exists "cfa"."public"."market_agg__distinct_calcs__dbt_backup" cascade
17:34:13.913450 [debug] [Thread-4  ]: SQL status: DROP TABLE in 0.07 seconds
17:34:14.154213 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_calcs: COMMIT
17:34:14.154741 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__distinct_calcs"
17:34:14.155009 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_calcs: COMMIT
17:34:14.302387 [debug] [Thread-4  ]: SQL status: COMMIT in 0.15 seconds
17:34:14.303169 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__distinct_calcs"
17:34:14.303677 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_calcs: BEGIN
17:34:14.387327 [debug] [Thread-4  ]: SQL status: BEGIN in 0.08 seconds
17:34:14.388747 [debug] [Thread-4  ]: finished collecting timing info
17:34:14.389148 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_calcs: ROLLBACK
17:34:14.538500 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_calcs: Close
17:34:14.543420 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6d1c280-5e0f-4d6b-83df-6573bf08eb2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa716582760>]}
17:34:14.544253 [info ] [Thread-4  ]: 40 of 55 OK created table model public.lcarr_sosx_market_agg__distinct_calcs.... [[32mSELECT[0m in 3035.50s]
17:34:14.544906 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.market_agg__distinct_calcs
17:34:14.545790 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.market__big_join
17:34:14.546163 [info ] [Thread-4  ]: 47 of 55 START table model public.lcarr_sosx_market__big_join................... [RUN]
17:34:14.546887 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.market__big_join"
17:34:14.547172 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.market__big_join
17:34:14.547426 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.market__big_join
17:34:14.555565 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.market__big_join"
17:34:14.557238 [debug] [Thread-4  ]: finished collecting timing info
17:34:14.557601 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.market__big_join
17:34:14.632632 [debug] [Thread-4  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.market__big_join"
17:34:14.636163 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.market__big_join"
17:34:14.636514 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market__big_join: BEGIN
17:34:14.636724 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
17:34:14.636933 [debug] [Thread-4  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
17:34:15.356079 [debug] [Thread-4  ]: SQL status: BEGIN in 0.72 seconds
17:34:15.356540 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.market__big_join"
17:34:15.356860 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market__big_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market__big_join"} */


  create  table
    "cfa"."public"."market__big_join__dbt_tmp"
    
    
    
  as (
    with big_join as ( 
  select a.*, e.unique_cfa_one_ids, e.unique_hashes, e.hash_transactions, e.hash_per_customer,
  b.price_index, 
  d.previous_year_monthend_date
  from "cfa"."public"."lcarr_sosx_market_agg__same_store_all_store" a
  inner join "cfa"."public"."lcarr_sosx_calc__dim_price_index_3" b
  on a.look_back_period = b.look_back_period
  and a.monthend_date = b.monthend_date
  and a.same_store = b.same_store
  inner join "cfa"."public"."lcarr_sosx_calc__dim_monthend_date" d
  on a.monthend_date = d.monthend_date
  inner join "cfa"."public"."lcarr_sosx_market_agg__distinct_calcs" e
  on a.monthend_date = e.monthend_date
  and a.look_back_period = e.look_back_period
  and a.same_store = e.same_store
  and a.location_type_code = e.location_type_code
  and a.daypart = e.daypart
  and a.destination_desc = e.destination_desc
)
select * from big_join
  );
17:34:55.261582 [debug] [Thread-4  ]: SQL status: SELECT in 39.9 seconds
17:34:55.265090 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.market__big_join"
17:34:55.265583 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market__big_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market__big_join"} */
alter table "cfa"."public"."market__big_join__dbt_tmp" rename to "lcarr_sosx_market__big_join"
17:34:55.327562 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.06 seconds
17:34:55.329501 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market__big_join: COMMIT
17:34:55.329840 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.market__big_join"
17:34:55.330049 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market__big_join: COMMIT
17:34:57.136100 [debug] [Thread-4  ]: SQL status: COMMIT in 1.81 seconds
17:34:57.136906 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.market__big_join"
17:34:57.137200 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market__big_join: BEGIN
17:34:57.211169 [debug] [Thread-4  ]: SQL status: BEGIN in 0.07 seconds
17:34:57.213516 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.market__big_join"
17:34:57.213777 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market__big_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market__big_join"} */
drop table if exists "cfa"."public"."market__big_join__dbt_backup" cascade
17:34:57.265821 [debug] [Thread-4  ]: SQL status: DROP TABLE in 0.05 seconds
17:34:57.269673 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market__big_join: COMMIT
17:34:57.270040 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.market__big_join"
17:34:57.270278 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market__big_join: COMMIT
17:34:57.631846 [debug] [Thread-4  ]: SQL status: COMMIT in 0.36 seconds
17:34:57.632408 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.market__big_join"
17:34:57.632659 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market__big_join: BEGIN
17:34:57.686209 [debug] [Thread-4  ]: SQL status: BEGIN in 0.05 seconds
17:34:57.687229 [debug] [Thread-4  ]: finished collecting timing info
17:34:57.687528 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market__big_join: ROLLBACK
17:34:57.780239 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market__big_join: Close
17:34:57.781448 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6d1c280-5e0f-4d6b-83df-6573bf08eb2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa7164dc580>]}
17:34:57.782269 [info ] [Thread-4  ]: 47 of 55 OK created table model public.lcarr_sosx_market__big_join.............. [[32mSELECT[0m in 43.23s]
17:34:57.782749 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.market__big_join
17:34:57.783068 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.national_agg__distinct_join
17:34:57.783541 [info ] [Thread-4  ]: 48 of 55 START table model public.lcarr_sosx_national_agg__distinct_join........ [RUN]
17:34:57.784508 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_join"
17:34:57.784978 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.national_agg__distinct_join
17:34:57.785256 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.national_agg__distinct_join
17:34:57.794204 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national_agg__distinct_join"
17:34:57.807295 [debug] [Thread-4  ]: finished collecting timing info
17:34:57.807727 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.national_agg__distinct_join
17:34:57.877061 [debug] [Thread-4  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.national_agg__distinct_join"
17:34:57.878047 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_join"
17:34:57.878346 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_join: BEGIN
17:34:57.878566 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
17:34:57.878766 [debug] [Thread-4  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
17:34:58.677636 [debug] [Thread-4  ]: SQL status: BEGIN in 0.8 seconds
17:34:58.678308 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_join"
17:34:58.678985 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__distinct_join"} */


  create  table
    "cfa"."public"."national_agg__distinct_join__dbt_tmp"
    
    
    
  as (
    with distinct_calcs_join as (
    select a.monthend_date,a.look_back_period,a.same_store,
    a.location_type_code,a.daypart,a.destination_desc,
    a.unique_cfa_one_ids,a.unique_hashes,a.hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_market_agg__distinct_calcs" a
    inner join "cfa"."public"."lcarr_sosx_market_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period
    and a.same_store = b.same_store
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
) 
select * from distinct_calcs_join
  );
17:35:04.493158 [debug] [Thread-4  ]: SQL status: SELECT in 5.81 seconds
17:35:04.499340 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_join"
17:35:04.499990 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__distinct_join"} */
alter table "cfa"."public"."national_agg__distinct_join__dbt_tmp" rename to "lcarr_sosx_national_agg__distinct_join"
17:35:04.551604 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.05 seconds
17:35:04.554593 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_join: COMMIT
17:35:04.555145 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_join"
17:35:04.555498 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_join: COMMIT
17:35:05.641372 [debug] [Thread-4  ]: SQL status: COMMIT in 1.09 seconds
17:35:05.642263 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_join"
17:35:05.642551 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_join: BEGIN
17:35:05.695458 [debug] [Thread-4  ]: SQL status: BEGIN in 0.05 seconds
17:35:05.700225 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_join"
17:35:05.700587 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__distinct_join"} */
drop table if exists "cfa"."public"."national_agg__distinct_join__dbt_backup" cascade
17:35:05.749470 [debug] [Thread-4  ]: SQL status: DROP TABLE in 0.05 seconds
17:35:05.751163 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_join: COMMIT
17:35:05.751724 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_join"
17:35:05.752512 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_join: COMMIT
17:35:05.981640 [debug] [Thread-4  ]: SQL status: COMMIT in 0.23 seconds
17:35:05.982234 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_join"
17:35:05.982526 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_join: BEGIN
17:35:06.032284 [debug] [Thread-4  ]: SQL status: BEGIN in 0.05 seconds
17:35:06.033752 [debug] [Thread-4  ]: finished collecting timing info
17:35:06.034279 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_join: ROLLBACK
17:35:06.127499 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_join: Close
17:35:06.128944 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6d1c280-5e0f-4d6b-83df-6573bf08eb2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa7165a15b0>]}
17:35:06.129570 [info ] [Thread-4  ]: 48 of 55 OK created table model public.lcarr_sosx_national_agg__distinct_join... [[32mSELECT[0m in 8.34s]
17:35:06.130142 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.national_agg__distinct_join
17:35:06.130435 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.market__final_output
17:35:06.131057 [info ] [Thread-4  ]: 49 of 55 START table model public.lcarr_sosx_market__final_output............... [RUN]
17:35:06.131843 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.market__final_output"
17:35:06.132176 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.market__final_output
17:35:06.132550 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.market__final_output
17:35:06.136974 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.market__final_output"
17:35:06.137855 [debug] [Thread-4  ]: finished collecting timing info
17:35:06.138152 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.market__final_output
17:35:06.221170 [debug] [Thread-4  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.market__final_output"
17:35:06.222020 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.market__final_output"
17:35:06.222324 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market__final_output: BEGIN
17:35:06.222502 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
17:35:06.222686 [debug] [Thread-4  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
17:35:06.780336 [debug] [Thread-4  ]: SQL status: BEGIN in 0.56 seconds
17:35:06.780806 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.market__final_output"
17:35:06.781089 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market__final_output: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market__final_output"} */


  create  table
    "cfa"."public"."market__final_output__dbt_tmp"
    
    
    
  as (
    with twentytwo as (
select *
from "cfa"."public"."lcarr_sosx_market__big_join" 
where monthend_date = cast('02-28-2022' as date) 
), twentyone as ( 
select * 
from "cfa"."public"."lcarr_sosx_market__big_join"
where monthend_date = cast('02-28-2021' as date)
) 

select 'Market' as geolevel, 
a.quarter,
a.look_back_period,a.same_store,
a.location_type_code,a.daypart,a.destination_desc,
a.monthend_date as current_monthend_date,
a.sales_sub_total as current_sales_sub_total,
a.transactions as current_transactions,
a.purchaser_visits as current_purchaser_visits,
a.credit_txn as current_credit_txn,
a.total_items_promo_count as current_total_items_promo_count,
a.total_items_sold_count as current_total_items_sold_count,
a.actual_days as current_actual_days,
a.avail_days as current_avail_days,
a.price_index as current_price_index,
a.unique_cfa_one_ids as current_unique_cfa_one_ids,
a.unique_hashes as current_unique_hashes,
a.hash_transactions as current_hash_transactions,
a.hash_per_customer as current_hash_per_customer,
a.previous_year_monthend_date as check_date,
b.monthend_date as previous_monthend_date,
b.sales_sub_total as previous_sales_sub_total,
b.transactions as previous_transactions,
b.purchaser_visits as previous_purchaser_visits,
b.credit_txn as previous_credit_txn,
b.total_items_promo_count as previous_total_items_promo_count,
b.total_items_sold_count as previous_total_items_sold_count,
b.actual_days as previous_actual_days,
b.avail_days as previous_avail_days,
b.price_index as previous_price_index,
b.unique_cfa_one_ids as previous_unique_cfa_one_ids,
b.unique_hashes as previous_unique_hashes,
b.hash_transactions as previous_hash_transactions,
b.hash_per_customer as previous_hash_per_customer
from twentytwo a 
inner join twentyone b
on a.look_back_period = b.look_back_period 
and a.same_store = b.same_store 
and a.location_type_code = b.location_type_code 
and a.daypart = b.daypart
and a.destination_desc = b.destination_desc
and a.previous_year_monthend_date = b.monthend_date
order by same_store,location_type_code,daypart,destination_desc
  );
17:35:08.065695 [debug] [Thread-4  ]: SQL status: SELECT in 1.28 seconds
17:35:08.068909 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.market__final_output"
17:35:08.069186 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market__final_output: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market__final_output"} */
alter table "cfa"."public"."market__final_output__dbt_tmp" rename to "lcarr_sosx_market__final_output"
17:35:08.123710 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.05 seconds
17:35:08.126633 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market__final_output: COMMIT
17:35:08.127424 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.market__final_output"
17:35:08.127809 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market__final_output: COMMIT
17:35:09.117239 [debug] [Thread-4  ]: SQL status: COMMIT in 0.99 seconds
17:35:09.118544 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.market__final_output"
17:35:09.118907 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market__final_output: BEGIN
17:35:09.170959 [debug] [Thread-4  ]: SQL status: BEGIN in 0.05 seconds
17:35:09.173137 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.market__final_output"
17:35:09.173463 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market__final_output: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market__final_output"} */
drop table if exists "cfa"."public"."market__final_output__dbt_backup" cascade
17:35:09.224577 [debug] [Thread-4  ]: SQL status: DROP TABLE in 0.05 seconds
17:35:09.226778 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market__final_output: COMMIT
17:35:09.227119 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.market__final_output"
17:35:09.227339 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market__final_output: COMMIT
17:35:09.333747 [debug] [Thread-4  ]: SQL status: COMMIT in 0.11 seconds
17:35:09.334438 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.market__final_output"
17:35:09.334725 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market__final_output: BEGIN
17:35:09.404203 [debug] [Thread-4  ]: SQL status: BEGIN in 0.07 seconds
17:35:09.405145 [debug] [Thread-4  ]: finished collecting timing info
17:35:09.405494 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market__final_output: ROLLBACK
17:35:09.530407 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market__final_output: Close
17:35:09.531848 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6d1c280-5e0f-4d6b-83df-6573bf08eb2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa7165a1f10>]}
17:35:09.532388 [info ] [Thread-4  ]: 49 of 55 OK created table model public.lcarr_sosx_market__final_output.......... [[32mSELECT[0m in 3.40s]
17:35:09.532888 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.market__final_output
17:43:48.945486 [debug] [Thread-2  ]: SQL status: SELECT in 2482.25 seconds
17:43:48.953514 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional_agg__distinct_calcs"
17:43:48.953864 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.regional_agg__distinct_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.regional_agg__distinct_calcs"} */
alter table "cfa"."public"."regional_agg__distinct_calcs__dbt_tmp" rename to "lcarr_sosx_regional_agg__distinct_calcs"
17:43:49.007651 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.05 seconds
17:43:49.009939 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.regional_agg__distinct_calcs: COMMIT
17:43:49.010214 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional_agg__distinct_calcs"
17:43:49.010432 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.regional_agg__distinct_calcs: COMMIT
17:43:50.353960 [debug] [Thread-2  ]: SQL status: COMMIT in 1.34 seconds
17:43:50.354952 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional_agg__distinct_calcs"
17:43:50.355254 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.regional_agg__distinct_calcs: BEGIN
17:43:50.405914 [debug] [Thread-2  ]: SQL status: BEGIN in 0.05 seconds
17:43:50.408692 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional_agg__distinct_calcs"
17:43:50.409691 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.regional_agg__distinct_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.regional_agg__distinct_calcs"} */
drop table if exists "cfa"."public"."regional_agg__distinct_calcs__dbt_backup" cascade
17:43:50.461017 [debug] [Thread-2  ]: SQL status: DROP TABLE in 0.05 seconds
17:43:50.462462 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.regional_agg__distinct_calcs: COMMIT
17:43:50.462724 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional_agg__distinct_calcs"
17:43:50.462948 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.regional_agg__distinct_calcs: COMMIT
17:43:50.573186 [debug] [Thread-2  ]: SQL status: COMMIT in 0.11 seconds
17:43:50.573604 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional_agg__distinct_calcs"
17:43:50.573865 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.regional_agg__distinct_calcs: BEGIN
17:43:50.624535 [debug] [Thread-2  ]: SQL status: BEGIN in 0.05 seconds
17:43:50.625527 [debug] [Thread-2  ]: finished collecting timing info
17:43:50.625800 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.regional_agg__distinct_calcs: ROLLBACK
17:43:50.717311 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.regional_agg__distinct_calcs: Close
17:43:50.721719 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6d1c280-5e0f-4d6b-83df-6573bf08eb2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa7163daeb0>]}
17:43:50.722317 [info ] [Thread-2  ]: 46 of 55 OK created table model public.lcarr_sosx_regional_agg__distinct_calcs.. [[32mSELECT[0m in 2484.89s]
17:43:50.723768 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.regional_agg__distinct_calcs
17:43:50.724506 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.regional__big_join
17:43:50.724932 [info ] [Thread-4  ]: 50 of 55 START table model public.lcarr_sosx_regional__big_join................. [RUN]
17:43:50.725762 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.regional__big_join"
17:43:50.726052 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.regional__big_join
17:43:50.726288 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.regional__big_join
17:43:50.731648 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.regional__big_join"
17:43:50.749596 [debug] [Thread-4  ]: finished collecting timing info
17:43:50.749957 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.regional__big_join
17:43:50.820358 [debug] [Thread-4  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.regional__big_join"
17:43:50.821949 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional__big_join"
17:43:50.822343 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.regional__big_join: BEGIN
17:43:50.822537 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
17:43:50.822730 [debug] [Thread-4  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
17:43:51.607312 [debug] [Thread-4  ]: SQL status: BEGIN in 0.78 seconds
17:43:51.607808 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional__big_join"
17:43:51.608128 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.regional__big_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.regional__big_join"} */


  create  table
    "cfa"."public"."regional__big_join__dbt_tmp"
    
    
    
  as (
    with big_join as ( 
  select a.*, e.unique_cfa_one_ids, e.unique_hashes, e.hash_transactions, e.hash_per_customer,
  b.price_index, 
  d.previous_year_monthend_date
  from "cfa"."public"."lcarr_sosx_regional_agg__same_store_all_store" a
  inner join "cfa"."public"."lcarr_sosx_calc__dim_price_index_3" b
  on a.look_back_period = b.look_back_period
  and a.monthend_date = b.monthend_date
  and a.same_store = b.same_store
  inner join "cfa"."public"."lcarr_sosx_calc__dim_monthend_date" d
  on a.monthend_date = d.monthend_date
  inner join "cfa"."public"."lcarr_sosx_regional_agg__distinct_calcs" e
  on a.monthend_date = e.monthend_date
  and a.look_back_period = e.look_back_period
  and a.same_store = e.same_store
  and a.location_type_code = e.location_type_code
  and a.daypart = e.daypart
  and a.destination_desc = e.destination_desc
)
select * from big_join
  );
17:45:17.375050 [debug] [Thread-4  ]: SQL status: SELECT in 85.77 seconds
17:45:17.382435 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional__big_join"
17:45:17.382760 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.regional__big_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.regional__big_join"} */
alter table "cfa"."public"."regional__big_join__dbt_tmp" rename to "lcarr_sosx_regional__big_join"
17:45:17.436380 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.05 seconds
17:45:17.438659 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.regional__big_join: COMMIT
17:45:17.438942 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional__big_join"
17:45:17.439152 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.regional__big_join: COMMIT
17:45:21.910552 [debug] [Thread-4  ]: SQL status: COMMIT in 4.47 seconds
17:45:21.911270 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional__big_join"
17:45:21.911608 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.regional__big_join: BEGIN
17:45:21.971692 [debug] [Thread-4  ]: SQL status: BEGIN in 0.06 seconds
17:45:21.974235 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional__big_join"
17:45:21.974528 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.regional__big_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.regional__big_join"} */
drop table if exists "cfa"."public"."regional__big_join__dbt_backup" cascade
17:45:22.042294 [debug] [Thread-4  ]: SQL status: DROP TABLE in 0.07 seconds
17:45:22.043759 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.regional__big_join: COMMIT
17:45:22.044180 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional__big_join"
17:45:22.044512 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.regional__big_join: COMMIT
17:45:22.788310 [debug] [Thread-4  ]: SQL status: COMMIT in 0.74 seconds
17:45:22.788946 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional__big_join"
17:45:22.789291 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.regional__big_join: BEGIN
17:45:22.843238 [debug] [Thread-4  ]: SQL status: BEGIN in 0.05 seconds
17:45:22.844408 [debug] [Thread-4  ]: finished collecting timing info
17:45:22.844741 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.regional__big_join: ROLLBACK
17:45:22.936537 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.regional__big_join: Close
17:45:22.937727 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6d1c280-5e0f-4d6b-83df-6573bf08eb2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa7164a9070>]}
17:45:22.938269 [info ] [Thread-4  ]: 50 of 55 OK created table model public.lcarr_sosx_regional__big_join............ [[32mSELECT[0m in 92.21s]
17:45:22.938797 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.regional__big_join
17:45:22.939899 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.regional__final_output
17:45:22.940403 [info ] [Thread-2  ]: 51 of 55 START table model public.lcarr_sosx_regional__final_output............. [RUN]
17:45:22.943400 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.regional__final_output"
17:45:22.943732 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.regional__final_output
17:45:22.943974 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.regional__final_output
17:45:22.950405 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.regional__final_output"
17:45:22.952289 [debug] [Thread-2  ]: finished collecting timing info
17:45:22.952743 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.regional__final_output
17:45:23.028243 [debug] [Thread-2  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.regional__final_output"
17:45:23.029175 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional__final_output"
17:45:23.029495 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.regional__final_output: BEGIN
17:45:23.029740 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
17:45:23.029928 [debug] [Thread-2  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
17:45:23.801061 [debug] [Thread-2  ]: SQL status: BEGIN in 0.77 seconds
17:45:23.801553 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional__final_output"
17:45:23.801784 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.regional__final_output: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.regional__final_output"} */


  create  table
    "cfa"."public"."regional__final_output__dbt_tmp"
    
    
    
  as (
    with twentytwo as (
select *
from "cfa"."public"."lcarr_sosx_regional__big_join" 
where monthend_date = cast('02-28-2022' as date) 
), twentyone as ( 
select * 
from "cfa"."public"."lcarr_sosx_regional__big_join"
where monthend_date = cast('02-28-2021' as date)
) 

select 'Market' as geolevel, 
a.quarter,
a.look_back_period,a.same_store,
a.location_type_code,a.daypart,a.destination_desc,
a.monthend_date as current_monthend_date,
a.sales_sub_total as current_sales_sub_total,
a.transactions as current_transactions,
a.purchaser_visits as current_purchaser_visits,
a.credit_txn as current_credit_txn,
a.total_items_promo_count as current_total_items_promo_count,
a.total_items_sold_count as current_total_items_sold_count,
a.actual_days as current_actual_days,
a.avail_days as current_avail_days,
a.price_index as current_price_index,
a.unique_cfa_one_ids as current_unique_cfa_one_ids,
a.unique_hashes as current_unique_hashes,
a.hash_transactions as current_hash_transactions,
a.hash_per_customer as current_hash_per_customer,
a.previous_year_monthend_date as check_date,
b.monthend_date as previous_monthend_date,
b.sales_sub_total as previous_sales_sub_total,
b.transactions as previous_transactions,
b.purchaser_visits as previous_purchaser_visits,
b.credit_txn as previous_credit_txn,
b.total_items_promo_count as previous_total_items_promo_count,
b.total_items_sold_count as previous_total_items_sold_count,
b.actual_days as previous_actual_days,
b.avail_days as previous_avail_days,
b.price_index as previous_price_index,
b.unique_cfa_one_ids as previous_unique_cfa_one_ids,
b.unique_hashes as previous_unique_hashes,
b.hash_transactions as previous_hash_transactions,
b.hash_per_customer as previous_hash_per_customer
from twentytwo a 
inner join twentyone b
on a.look_back_period = b.look_back_period 
and a.same_store = b.same_store 
and a.location_type_code = b.location_type_code 
and a.daypart = b.daypart
and a.destination_desc = b.destination_desc
and a.previous_year_monthend_date = b.monthend_date
order by same_store,location_type_code,daypart,destination_desc
  );
17:45:49.361990 [debug] [Thread-2  ]: SQL status: SELECT in 25.56 seconds
17:45:49.365294 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional__final_output"
17:45:49.365598 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.regional__final_output: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.regional__final_output"} */
alter table "cfa"."public"."regional__final_output__dbt_tmp" rename to "lcarr_sosx_regional__final_output"
17:45:49.675399 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.31 seconds
17:45:49.677657 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.regional__final_output: COMMIT
17:45:49.677959 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional__final_output"
17:45:49.678211 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.regional__final_output: COMMIT
17:45:51.201357 [debug] [Thread-2  ]: SQL status: COMMIT in 1.52 seconds
17:45:51.202163 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional__final_output"
17:45:51.202460 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.regional__final_output: BEGIN
17:45:51.256961 [debug] [Thread-2  ]: SQL status: BEGIN in 0.05 seconds
17:45:51.259293 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional__final_output"
17:45:51.259597 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.regional__final_output: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.regional__final_output"} */
drop table if exists "cfa"."public"."regional__final_output__dbt_backup" cascade
17:45:51.338195 [debug] [Thread-2  ]: SQL status: DROP TABLE in 0.08 seconds
17:45:51.340850 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.regional__final_output: COMMIT
17:45:51.341242 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional__final_output"
17:45:51.341501 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.regional__final_output: COMMIT
17:45:51.529882 [debug] [Thread-2  ]: SQL status: COMMIT in 0.19 seconds
17:45:51.530350 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.regional__final_output"
17:45:51.530627 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.regional__final_output: BEGIN
17:45:51.583529 [debug] [Thread-2  ]: SQL status: BEGIN in 0.05 seconds
17:45:51.584529 [debug] [Thread-2  ]: finished collecting timing info
17:45:51.584816 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.regional__final_output: ROLLBACK
17:45:51.684270 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.regional__final_output: Close
17:45:51.685682 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6d1c280-5e0f-4d6b-83df-6573bf08eb2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa7164c0e80>]}
17:45:51.686417 [info ] [Thread-2  ]: 51 of 55 OK created table model public.lcarr_sosx_regional__final_output........ [[32mSELECT[0m in 28.74s]
17:45:51.687845 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.regional__final_output
17:59:40.350343 [debug] [Thread-3  ]: SQL status: SELECT in 6758.7 seconds
17:59:40.356041 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
17:59:40.357022 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"} */
alter table "cfa"."public"."national_agg__distinct_calcs__dbt_tmp" rename to "lcarr_sosx_national_agg__distinct_calcs"
17:59:40.408902 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.05 seconds
17:59:40.410820 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_calcs: COMMIT
17:59:40.411122 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
17:59:40.411312 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_calcs: COMMIT
17:59:41.575844 [debug] [Thread-3  ]: SQL status: COMMIT in 1.16 seconds
17:59:41.576969 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
17:59:41.577281 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_calcs: BEGIN
17:59:41.631983 [debug] [Thread-3  ]: SQL status: BEGIN in 0.05 seconds
17:59:41.634489 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
17:59:41.634822 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"} */
drop table if exists "cfa"."public"."national_agg__distinct_calcs__dbt_backup" cascade
17:59:41.685481 [debug] [Thread-3  ]: SQL status: DROP TABLE in 0.05 seconds
17:59:41.686776 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_calcs: COMMIT
17:59:41.687032 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
17:59:41.687244 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_calcs: COMMIT
17:59:44.340433 [debug] [Thread-3  ]: SQL status: COMMIT in 2.65 seconds
17:59:44.340907 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
17:59:44.341183 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_calcs: BEGIN
17:59:44.396972 [debug] [Thread-3  ]: SQL status: BEGIN in 0.06 seconds
17:59:44.400440 [debug] [Thread-3  ]: finished collecting timing info
17:59:44.401052 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_calcs: ROLLBACK
17:59:44.503737 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_calcs: Close
17:59:44.508703 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6d1c280-5e0f-4d6b-83df-6573bf08eb2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa7164ccaf0>]}
17:59:44.509408 [info ] [Thread-3  ]: 33 of 55 OK created table model public.lcarr_sosx_national_agg__distinct_calcs.. [[32mSELECT[0m in 6763.77s]
17:59:44.510122 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.national_agg__distinct_calcs
17:59:44.510886 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.national__big_join
17:59:44.511364 [info ] [Thread-4  ]: 52 of 55 START table model public.lcarr_sosx_national__big_join................. [RUN]
17:59:44.512077 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national__big_join"
17:59:44.512339 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.national__big_join
17:59:44.512578 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.national__big_join
17:59:44.516995 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national__big_join"
17:59:44.518502 [debug] [Thread-4  ]: finished collecting timing info
17:59:44.518884 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.national__big_join
17:59:44.593432 [debug] [Thread-4  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.national__big_join"
17:59:44.594333 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national__big_join"
17:59:44.594630 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national__big_join: BEGIN
17:59:44.594804 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
17:59:44.594984 [debug] [Thread-4  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
17:59:45.578244 [debug] [Thread-4  ]: SQL status: BEGIN in 0.98 seconds
17:59:45.578804 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national__big_join"
17:59:45.579109 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national__big_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national__big_join"} */


  create  table
    "cfa"."public"."national__big_join__dbt_tmp"
    
    
    
  as (
    with big_join as ( 
  select a.*, e.unique_cfa_one_ids, e.unique_hashes, e.hash_transactions, e.hash_per_customer,
  b.price_index, 
  d.previous_year_monthend_date
  from "cfa"."public"."lcarr_sosx_national_agg__same_store_all_store" a
  inner join "cfa"."public"."lcarr_sosx_calc__dim_price_index_3" b
  on a.look_back_period = b.look_back_period
  and a.monthend_date = b.monthend_date
  and a.same_store = b.same_store
  inner join "cfa"."public"."lcarr_sosx_calc__dim_monthend_date" d
  on a.monthend_date = d.monthend_date
  inner join "cfa"."public"."lcarr_sosx_national_agg__distinct_calcs" e
  on a.monthend_date = e.monthend_date
  and a.look_back_period = e.look_back_period
  and a.same_store = e.same_store
  and a.location_type_code = e.location_type_code
  and a.daypart = e.daypart
  and a.destination_desc = e.destination_desc
)
select * from big_join
  );
17:59:47.119304 [debug] [Thread-4  ]: Postgres adapter: Postgres error: column e.hash_per_customer does not exist

17:59:47.119815 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national__big_join: ROLLBACK
17:59:47.172449 [debug] [Thread-4  ]: finished collecting timing info
17:59:47.172896 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national__big_join: Close
17:59:47.174487 [debug] [Thread-4  ]: Database Error in model national__big_join (models/national/final_output/national__big_join.sql)
  column e.hash_per_customer does not exist
  compiled SQL at target/run/source_of_sales_change_lcarr/models/national/final_output/national__big_join.sql
17:59:47.174954 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6d1c280-5e0f-4d6b-83df-6573bf08eb2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa71643b400>]}
17:59:47.175413 [error] [Thread-4  ]: 52 of 55 ERROR creating table model public.lcarr_sosx_national__big_join........ [[31mERROR[0m in 2.66s]
17:59:47.175931 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.national__big_join
17:59:47.180389 [debug] [MainThread]: Acquiring new redshift connection "master"
17:59:47.180922 [debug] [MainThread]: Postgres adapter: Cancelling query 'model.source_of_sales_change_lcarr.ast_agg__distinct_calcs' (1093146966)
17:59:47.181303 [debug] [MainThread]: Using redshift connection "master"
17:59:47.181642 [debug] [MainThread]: On master: BEGIN
17:59:47.181960 [debug] [MainThread]: Opening a new connection, currently in state closed
17:59:47.182324 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
17:59:47.914102 [debug] [MainThread]: SQL status: BEGIN in 0.73 seconds
17:59:47.914613 [debug] [MainThread]: Using redshift connection "master"
17:59:47.914877 [debug] [MainThread]: On master: select pg_terminate_backend(1093146966)
17:59:48.026736 [debug] [MainThread]: SQL status: SELECT in 0.11 seconds
17:59:48.027393 [debug] [MainThread]: Postgres adapter: Cancel query 'model.source_of_sales_change_lcarr.ast_agg__distinct_calcs': (1,)
17:59:48.027778 [error] [MainThread]: CANCEL query model.source_of_sales_change_lcarr.ast_agg__distinct_calcs......... [[31mCANCEL[0m]
17:59:48.028191 [error] [MainThread]: CANCEL query model.source_of_sales_change_lcarr.regional__final_output.......... [[31mCANCEL[0m]
17:59:48.028652 [error] [MainThread]: CANCEL query model.source_of_sales_change_lcarr.national_agg__distinct_calcs.... [[31mCANCEL[0m]
17:59:48.029070 [error] [MainThread]: CANCEL query model.source_of_sales_change_lcarr.national__big_join.............. [[31mCANCEL[0m]
17:59:48.029543 [debug] [MainThread]: On master: ROLLBACK
17:59:48.121005 [debug] [MainThread]: On master: Close
17:59:48.642564 [debug] [Thread-1  ]: Postgres adapter: Postgres error: Query (201129935) cancelled on user's request

17:59:48.643234 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__distinct_calcs: ROLLBACK
17:59:48.645908 [debug] [Thread-1  ]: Failed to rollback 'model.source_of_sales_change_lcarr.ast_agg__distinct_calcs'
17:59:48.646665 [debug] [Thread-1  ]: finished collecting timing info
17:59:48.646967 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__distinct_calcs: Close
17:59:48.647375 [debug] [Thread-1  ]: Database Error in model ast_agg__distinct_calcs (models/ast/aggregations_distinct/ast_agg__distinct_calcs.sql)
  Query (201129935) cancelled on user's request
  compiled SQL at target/run/source_of_sales_change_lcarr/models/ast/aggregations_distinct/ast_agg__distinct_calcs.sql
17:59:48.647753 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6d1c280-5e0f-4d6b-83df-6573bf08eb2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa7163d14f0>]}
17:59:48.648203 [error] [Thread-1  ]: 45 of 55 ERROR creating table model public.lcarr_sosx_ast_agg__distinct_calcs... [[31mERROR[0m in 3946.12s]
17:59:48.648630 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.ast_agg__distinct_calcs
17:59:48.649076 [info ] [MainThread]: 
17:59:48.649506 [error] [MainThread]: [33mDatabase Error in model national__big_join (models/national/final_output/national__big_join.sql)[0m
17:59:48.650151 [error] [MainThread]:   column e.hash_per_customer does not exist
17:59:48.650537 [error] [MainThread]:   compiled SQL at target/run/source_of_sales_change_lcarr/models/national/final_output/national__big_join.sql
17:59:48.650932 [debug] [MainThread]: Connection 'master' was properly closed.
17:59:48.651155 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.ast_agg__distinct_calcs' was properly closed.
17:59:48.651348 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.regional__final_output' was properly closed.
17:59:48.651555 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.national_agg__distinct_calcs' was properly closed.
17:59:48.651740 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.national__big_join' was properly closed.
17:59:48.652127 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa7163d1f70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa7163d1eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa7163d1f40>]}


============================== 2022-06-23 18:58:58.689847 | 791ea44d-836d-4d3d-8fd2-19408b5f7c8c ==============================
18:58:58.689847 [info ] [MainThread]: Running with dbt=1.0.4
18:58:58.691084 [debug] [MainThread]: running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=None, defer=None, event_buffer_size=None, exclude=None, fail_fast=True, full_refresh=False, log_cache_events=False, log_format=None, partial_parse=None, printer_width=None, profile=None, profiles_dir='/Users/lindsay.carr/DBT/environments/redshift_discovery_crn_svc/', project_dir=None, record_timing_info=None, rpc_method='run', select=['national.aggregations_distinct.national_agg__distinct_calcs'], selector_name=None, send_anonymous_usage_stats=None, single_threaded=False, state=None, static_parser=None, target=None, threads=None, use_colors=None, use_experimental_parser=None, vars='{}', version_check=None, warn_error=None, which='run', write_json=None)
18:58:58.691613 [debug] [MainThread]: Tracking: tracking
18:58:58.774234 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc528ca3670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc528ca3a60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc528cb2070>]}
18:58:59.018800 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
18:58:59.019253 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
18:58:59.037709 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '791ea44d-836d-4d3d-8fd2-19408b5f7c8c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc528cc0ca0>]}
18:58:59.080682 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '791ea44d-836d-4d3d-8fd2-19408b5f7c8c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc528c2fa60>]}
18:58:59.081362 [info ] [MainThread]: Found 55 models, 4 tests, 0 snapshots, 0 analyses, 192 macros, 0 operations, 0 seed files, 11 sources, 0 exposures, 0 metrics
18:58:59.086530 [info ] [MainThread]: 
18:58:59.087549 [debug] [MainThread]: Acquiring new redshift connection "master"
18:58:59.088835 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa"
18:58:59.110297 [debug] [ThreadPool]: Using redshift connection "list_cfa"
18:58:59.111515 [debug] [ThreadPool]: On list_cfa: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa"} */

    select distinct nspname from pg_namespace
  
18:58:59.111932 [debug] [ThreadPool]: Opening a new connection, currently in state init
18:58:59.112278 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:59:00.460489 [debug] [ThreadPool]: SQL status: SELECT in 1.35 seconds
18:59:00.479205 [debug] [ThreadPool]: On list_cfa: Close
18:59:00.495437 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa_public"
18:59:00.510596 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
18:59:00.511014 [debug] [ThreadPool]: On list_cfa_public: BEGIN
18:59:00.511321 [debug] [ThreadPool]: Opening a new connection, currently in state closed
18:59:00.511650 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:59:01.248919 [debug] [ThreadPool]: SQL status: BEGIN in 0.74 seconds
18:59:01.249532 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
18:59:01.249963 [debug] [ThreadPool]: On list_cfa_public: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa_public"} */
select
      'cfa' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'cfa' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
18:59:01.800511 [debug] [ThreadPool]: SQL status: SELECT in 0.55 seconds
18:59:01.889076 [debug] [ThreadPool]: On list_cfa_public: ROLLBACK
18:59:01.976717 [debug] [ThreadPool]: On list_cfa_public: Close
18:59:02.031651 [debug] [MainThread]: Using redshift connection "master"
18:59:02.032092 [debug] [MainThread]: On master: BEGIN
18:59:02.032402 [debug] [MainThread]: Opening a new connection, currently in state init
18:59:02.032714 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:59:02.748206 [debug] [MainThread]: SQL status: BEGIN in 0.72 seconds
18:59:02.749112 [debug] [MainThread]: Using redshift connection "master"
18:59:02.749737 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
18:59:04.487885 [debug] [MainThread]: SQL status: SELECT in 1.74 seconds
18:59:04.506245 [debug] [MainThread]: On master: ROLLBACK
18:59:04.603551 [debug] [MainThread]: Using redshift connection "master"
18:59:04.604028 [debug] [MainThread]: On master: BEGIN
18:59:04.714081 [debug] [MainThread]: SQL status: BEGIN in 0.11 seconds
18:59:04.714717 [debug] [MainThread]: On master: COMMIT
18:59:04.715014 [debug] [MainThread]: Using redshift connection "master"
18:59:04.715286 [debug] [MainThread]: On master: COMMIT
18:59:04.825203 [debug] [MainThread]: SQL status: COMMIT in 0.11 seconds
18:59:04.825880 [debug] [MainThread]: On master: Close
18:59:04.826802 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
18:59:04.827263 [info ] [MainThread]: 
18:59:04.834861 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.national_agg__distinct_calcs
18:59:04.835389 [info ] [Thread-1  ]: 1 of 1 START table model public.lcarr_sosx_national_agg__distinct_calcs......... [RUN]
18:59:04.836137 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
18:59:04.836392 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.national_agg__distinct_calcs
18:59:04.836627 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.national_agg__distinct_calcs
18:59:04.846501 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
18:59:04.849630 [debug] [Thread-1  ]: finished collecting timing info
18:59:04.850029 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.national_agg__distinct_calcs
18:59:04.982145 [debug] [Thread-1  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
18:59:04.985006 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
18:59:04.985384 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_calcs: BEGIN
18:59:04.985640 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:59:04.985871 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:59:05.664270 [debug] [Thread-1  ]: SQL status: BEGIN in 0.68 seconds
18:59:05.664858 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
18:59:05.665126 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"} */


  create  table
    "cfa"."public"."national_agg__distinct_calcs__dbt_tmp"
    
    
    
  as (
    with distinct_calcs_all_store as (
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
), distinct_calcs_same_store as (
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
)

select * from distinct_calcs_all_store 
union 
select * from distinct_calcs_same_store
  );
20:33:33.335680 [debug] [MainThread]: Acquiring new redshift connection "master"
20:33:33.371192 [debug] [MainThread]: Postgres adapter: Cancelling query 'model.source_of_sales_change_lcarr.national_agg__distinct_calcs' (1093406430)
20:33:33.372783 [debug] [MainThread]: Using redshift connection "master"
20:33:33.373297 [debug] [MainThread]: On master: BEGIN
20:33:33.373655 [debug] [MainThread]: Opening a new connection, currently in state closed
20:33:33.375801 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
20:33:34.358252 [debug] [MainThread]: SQL status: BEGIN in 0.97 seconds
20:33:34.359678 [debug] [MainThread]: Using redshift connection "master"
20:33:34.360036 [debug] [MainThread]: On master: select pg_terminate_backend(1093406430)
20:33:34.415601 [debug] [MainThread]: SQL status: SELECT in 0.06 seconds
20:33:34.416364 [debug] [MainThread]: Postgres adapter: Cancel query 'model.source_of_sales_change_lcarr.national_agg__distinct_calcs': (1,)
20:33:34.423338 [error] [MainThread]: CANCEL query model.source_of_sales_change_lcarr.national_agg__distinct_calcs.... [[31mCANCEL[0m]
20:33:34.425005 [debug] [MainThread]: On master: ROLLBACK
20:33:34.578123 [debug] [MainThread]: On master: Close
20:45:45.229559 [debug] [Thread-1  ]: Postgres adapter: Postgres error: could not receive data from server: Operation timed out
SSL SYSCALL error: Operation timed out

20:45:45.236551 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_calcs: ROLLBACK
20:45:45.259793 [debug] [Thread-1  ]: Failed to rollback 'model.source_of_sales_change_lcarr.national_agg__distinct_calcs'
20:45:45.314617 [debug] [Thread-1  ]: finished collecting timing info
20:45:45.316968 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_calcs: Close
20:45:45.323182 [debug] [Thread-1  ]: Database Error in model national_agg__distinct_calcs (models/national/aggregations_distinct/national_agg__distinct_calcs.sql)
  could not receive data from server: Operation timed out
  SSL SYSCALL error: Operation timed out
  compiled SQL at target/run/source_of_sales_change_lcarr/models/national/aggregations_distinct/national_agg__distinct_calcs.sql
20:45:45.371212 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '791ea44d-836d-4d3d-8fd2-19408b5f7c8c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc5293c64c0>]}
20:45:45.419614 [error] [Thread-1  ]: 1 of 1 ERROR creating table model public.lcarr_sosx_national_agg__distinct_calcs [[31mERROR[0m in 6400.50s]
20:45:45.434527 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.national_agg__distinct_calcs
20:45:45.435907 [info ] [MainThread]: 
20:45:45.436818 [info ] [MainThread]: [33mExited because of keyboard interrupt.[0m
20:45:45.444472 [info ] [MainThread]: 
20:45:45.445924 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=0 SKIP=0 TOTAL=0
20:45:45.447588 [debug] [MainThread]: Connection 'master' was properly closed.
20:45:45.447971 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.national_agg__distinct_calcs' was properly closed.


============================== 2022-06-23 20:50:41.033159 | 00310e78-b91c-49a1-b171-d8362b53a834 ==============================
20:50:41.033159 [info ] [MainThread]: Running with dbt=1.0.4
20:50:41.034649 [debug] [MainThread]: running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=None, defer=None, event_buffer_size=None, exclude=None, fail_fast=True, full_refresh=False, log_cache_events=False, log_format=None, partial_parse=None, printer_width=None, profile=None, profiles_dir='/Users/lindsay.carr/DBT/environments/redshift_discovery_crn_svc/', project_dir=None, record_timing_info=None, rpc_method='run', select=['national.aggregations_distinct.national_agg__distinct_calcs'], selector_name=None, send_anonymous_usage_stats=None, single_threaded=False, state=None, static_parser=None, target=None, threads=None, use_colors=None, use_experimental_parser=None, vars='{}', version_check=None, warn_error=None, which='run', write_json=None)
20:50:41.035217 [debug] [MainThread]: Tracking: tracking
20:50:41.121373 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbca1ca3760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbca1ca3b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbca1c83760>]}
20:50:41.352057 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
20:50:41.353385 [debug] [MainThread]: Partial parsing: updated file: source_of_sales_change_lcarr://models/national/final_output/national__big_join.sql
20:50:41.416065 [debug] [MainThread]: 1699: static parser successfully parsed national/final_output/national__big_join.sql
20:50:41.466904 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '00310e78-b91c-49a1-b171-d8362b53a834', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbca1f45f40>]}
20:50:41.502224 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '00310e78-b91c-49a1-b171-d8362b53a834', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbca1e02be0>]}
20:50:41.502756 [info ] [MainThread]: Found 55 models, 4 tests, 0 snapshots, 0 analyses, 192 macros, 0 operations, 0 seed files, 11 sources, 0 exposures, 0 metrics
20:50:41.508003 [info ] [MainThread]: 
20:50:41.509072 [debug] [MainThread]: Acquiring new redshift connection "master"
20:50:41.510023 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa"
20:50:41.531460 [debug] [ThreadPool]: Using redshift connection "list_cfa"
20:50:41.531797 [debug] [ThreadPool]: On list_cfa: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa"} */

    select distinct nspname from pg_namespace
  
20:50:41.532025 [debug] [ThreadPool]: Opening a new connection, currently in state init
20:50:41.532297 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
20:50:42.460516 [debug] [ThreadPool]: SQL status: SELECT in 0.93 seconds
20:50:42.475111 [debug] [ThreadPool]: On list_cfa: Close
20:50:42.483926 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa_public"
20:50:42.498468 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
20:50:42.498942 [debug] [ThreadPool]: On list_cfa_public: BEGIN
20:50:42.499273 [debug] [ThreadPool]: Opening a new connection, currently in state closed
20:50:42.499631 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
20:50:43.286062 [debug] [ThreadPool]: SQL status: BEGIN in 0.79 seconds
20:50:43.286558 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
20:50:43.286933 [debug] [ThreadPool]: On list_cfa_public: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa_public"} */
select
      'cfa' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'cfa' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
20:50:43.627917 [debug] [ThreadPool]: SQL status: SELECT in 0.34 seconds
20:50:43.727172 [debug] [ThreadPool]: On list_cfa_public: ROLLBACK
20:50:43.817958 [debug] [ThreadPool]: On list_cfa_public: Close
20:50:43.880384 [debug] [MainThread]: Using redshift connection "master"
20:50:43.880864 [debug] [MainThread]: On master: BEGIN
20:50:43.881224 [debug] [MainThread]: Opening a new connection, currently in state init
20:50:43.881580 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
20:50:44.551205 [debug] [MainThread]: SQL status: BEGIN in 0.67 seconds
20:50:44.551686 [debug] [MainThread]: Using redshift connection "master"
20:50:44.552041 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
20:50:45.263057 [debug] [MainThread]: SQL status: SELECT in 0.71 seconds
20:50:45.295624 [debug] [MainThread]: On master: ROLLBACK
20:50:45.386505 [debug] [MainThread]: Using redshift connection "master"
20:50:45.386995 [debug] [MainThread]: On master: BEGIN
20:50:45.527019 [debug] [MainThread]: SQL status: BEGIN in 0.14 seconds
20:50:45.527454 [debug] [MainThread]: On master: COMMIT
20:50:45.527711 [debug] [MainThread]: Using redshift connection "master"
20:50:45.527932 [debug] [MainThread]: On master: COMMIT
20:50:45.619335 [debug] [MainThread]: SQL status: COMMIT in 0.09 seconds
20:50:45.620011 [debug] [MainThread]: On master: Close
20:50:45.620907 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
20:50:45.621452 [info ] [MainThread]: 
20:50:45.629250 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.national_agg__distinct_calcs
20:50:45.629767 [info ] [Thread-1  ]: 1 of 1 START table model public.lcarr_sosx_national_agg__distinct_calcs......... [RUN]
20:50:45.630547 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
20:50:45.630827 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.national_agg__distinct_calcs
20:50:45.631069 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.national_agg__distinct_calcs
20:50:45.642685 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
20:50:45.645458 [debug] [Thread-1  ]: finished collecting timing info
20:50:45.645874 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.national_agg__distinct_calcs
20:50:45.762382 [debug] [Thread-1  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
20:50:45.765419 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
20:50:45.765797 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_calcs: BEGIN
20:50:45.766062 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
20:50:45.766281 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
20:50:46.399848 [debug] [Thread-1  ]: SQL status: BEGIN in 0.63 seconds
20:50:46.400294 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
20:50:46.400582 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"} */


  create  table
    "cfa"."public"."national_agg__distinct_calcs__dbt_tmp"
    
    
    
  as (
    with distinct_calcs_all_store as (
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
), distinct_calcs_same_store as (
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
)

select * from distinct_calcs_all_store 
union 
select * from distinct_calcs_same_store
  );


============================== 2022-06-23 21:04:04.530670 | 5c172bbd-9c6f-40e9-9dee-686a60df903b ==============================
21:04:04.530670 [info ] [MainThread]: Running with dbt=1.0.4
21:04:04.532084 [debug] [MainThread]: running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=None, defer=None, event_buffer_size=None, exclude=None, fail_fast=True, full_refresh=False, log_cache_events=False, log_format=None, partial_parse=None, printer_width=None, profile=None, profiles_dir='/Users/lindsay.carr/DBT/environments/redshift_discovery_crn_svc/', project_dir=None, record_timing_info=None, rpc_method='run', select=['national.aggregations_distinct.national_agg__distinct_calcs'], selector_name=None, send_anonymous_usage_stats=None, single_threaded=False, state=None, static_parser=None, target=None, threads=None, use_colors=None, use_experimental_parser=None, vars='{}', version_check=None, warn_error=None, which='run', write_json=None)
21:04:04.532683 [debug] [MainThread]: Tracking: tracking
21:04:04.589300 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7c19481640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7c19481a30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7c194670a0>]}
21:04:04.840127 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
21:04:04.840618 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
21:04:04.859816 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5c172bbd-9c6f-40e9-9dee-686a60df903b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7c1949ec70>]}
21:04:04.901287 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5c172bbd-9c6f-40e9-9dee-686a60df903b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7c1940dc40>]}
21:04:04.902006 [info ] [MainThread]: Found 55 models, 4 tests, 0 snapshots, 0 analyses, 192 macros, 0 operations, 0 seed files, 11 sources, 0 exposures, 0 metrics
21:04:04.907345 [info ] [MainThread]: 
21:04:04.908446 [debug] [MainThread]: Acquiring new redshift connection "master"
21:04:04.909554 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa"
21:04:04.932787 [debug] [ThreadPool]: Using redshift connection "list_cfa"
21:04:04.933282 [debug] [ThreadPool]: On list_cfa: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa"} */

    select distinct nspname from pg_namespace
  
21:04:04.933657 [debug] [ThreadPool]: Opening a new connection, currently in state init
21:04:04.934025 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
21:04:05.943879 [debug] [ThreadPool]: SQL status: SELECT in 1.01 seconds
21:04:05.958652 [debug] [ThreadPool]: On list_cfa: Close
21:04:05.968995 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa_public"
21:04:05.982966 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
21:04:05.983426 [debug] [ThreadPool]: On list_cfa_public: BEGIN
21:04:05.983776 [debug] [ThreadPool]: Opening a new connection, currently in state closed
21:04:05.984118 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
21:04:06.603618 [debug] [ThreadPool]: SQL status: BEGIN in 0.62 seconds
21:04:06.604116 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
21:04:06.604529 [debug] [ThreadPool]: On list_cfa_public: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa_public"} */
select
      'cfa' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'cfa' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
21:04:06.999324 [debug] [ThreadPool]: SQL status: SELECT in 0.39 seconds
21:04:07.097981 [debug] [ThreadPool]: On list_cfa_public: ROLLBACK
21:04:07.352398 [debug] [ThreadPool]: On list_cfa_public: Close
21:04:07.413846 [debug] [MainThread]: Using redshift connection "master"
21:04:07.414296 [debug] [MainThread]: On master: BEGIN
21:04:07.414658 [debug] [MainThread]: Opening a new connection, currently in state init
21:04:07.415010 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
21:04:08.149802 [debug] [MainThread]: SQL status: BEGIN in 0.74 seconds
21:04:08.150296 [debug] [MainThread]: Using redshift connection "master"
21:04:08.150694 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
21:04:09.003161 [debug] [MainThread]: SQL status: SELECT in 0.85 seconds
21:04:09.038035 [debug] [MainThread]: On master: ROLLBACK
21:04:09.130410 [debug] [MainThread]: Using redshift connection "master"
21:04:09.130898 [debug] [MainThread]: On master: BEGIN
21:04:09.238211 [debug] [MainThread]: SQL status: BEGIN in 0.11 seconds
21:04:09.238727 [debug] [MainThread]: On master: COMMIT
21:04:09.239114 [debug] [MainThread]: Using redshift connection "master"
21:04:09.239465 [debug] [MainThread]: On master: COMMIT
21:04:09.333738 [debug] [MainThread]: SQL status: COMMIT in 0.09 seconds
21:04:09.334286 [debug] [MainThread]: On master: Close
21:04:09.335247 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
21:04:09.335936 [info ] [MainThread]: 
21:04:09.343497 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.national_agg__distinct_calcs
21:04:09.344189 [info ] [Thread-1  ]: 1 of 1 START table model public.lcarr_sosx_national_agg__distinct_calcs......... [RUN]
21:04:09.345232 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
21:04:09.345603 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.national_agg__distinct_calcs
21:04:09.345981 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.national_agg__distinct_calcs
21:04:09.357963 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
21:04:09.359998 [debug] [Thread-1  ]: finished collecting timing info
21:04:09.360562 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.national_agg__distinct_calcs
21:04:09.564322 [debug] [Thread-1  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
21:04:09.565967 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
21:04:09.566416 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_calcs: BEGIN
21:04:09.566810 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
21:04:09.567193 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
21:04:10.447631 [debug] [Thread-1  ]: SQL status: BEGIN in 0.88 seconds
21:04:10.448127 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
21:04:10.448480 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"} */


  create  table
    "cfa"."public"."national_agg__distinct_calcs__dbt_tmp"
    
    
    
  as (
    with distinct_calcs_all_store as (
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
), distinct_calcs_same_store as (
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
)

select * from distinct_calcs_all_store 
union 
select * from distinct_calcs_same_store
  );
08:01:12.913520 [debug] [Thread-1  ]: Postgres adapter: Postgres error: could not receive data from server: Operation timed out
SSL SYSCALL error: Operation timed out

08:01:13.012443 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_calcs: ROLLBACK
08:01:13.082961 [debug] [Thread-1  ]: Failed to rollback 'model.source_of_sales_change_lcarr.national_agg__distinct_calcs'
08:01:13.096050 [debug] [Thread-1  ]: finished collecting timing info
08:01:13.100522 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_calcs: Close
08:01:13.123612 [debug] [Thread-1  ]: Database Error in model national_agg__distinct_calcs (models/national/aggregations_distinct/national_agg__distinct_calcs.sql)
  could not receive data from server: Operation timed out
  SSL SYSCALL error: Operation timed out
  compiled SQL at target/run/source_of_sales_change_lcarr/models/national/aggregations_distinct/national_agg__distinct_calcs.sql
08:01:13.139619 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5c172bbd-9c6f-40e9-9dee-686a60df903b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7c19af4fa0>]}
08:01:13.162004 [error] [Thread-1  ]: 1 of 1 ERROR creating table model public.lcarr_sosx_national_agg__distinct_calcs [[31mERROR[0m in 39423.78s]
08:01:13.169880 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.national_agg__distinct_calcs
08:01:13.222277 [debug] [MainThread]: Acquiring new redshift connection "master"
08:01:13.222898 [error] [MainThread]: CANCEL query model.source_of_sales_change_lcarr.national_agg__distinct_calcs.... [[31mCANCEL[0m]
08:01:13.223730 [info ] [MainThread]: 
08:01:13.224252 [error] [MainThread]: [33mDatabase Error in model national_agg__distinct_calcs (models/national/aggregations_distinct/national_agg__distinct_calcs.sql)[0m
08:01:13.224662 [error] [MainThread]:   could not receive data from server: Operation timed out
08:01:13.225691 [error] [MainThread]:   SSL SYSCALL error: Operation timed out
08:01:13.226239 [error] [MainThread]:   compiled SQL at target/run/source_of_sales_change_lcarr/models/national/aggregations_distinct/national_agg__distinct_calcs.sql
08:01:13.226703 [debug] [MainThread]: Connection 'master' was properly closed.
08:01:13.226926 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.national_agg__distinct_calcs' was properly closed.
08:01:13.231480 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7c195ddca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7c19ad83a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7c19af4880>]}


============================== 2022-06-24 13:12:12.921984 | 620267d5-92ab-49c8-b424-88f94d7748ad ==============================
13:12:12.921984 [info ] [MainThread]: Running with dbt=1.0.4
13:12:12.924323 [debug] [MainThread]: running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=None, defer=None, event_buffer_size=None, exclude=None, fail_fast=True, full_refresh=False, log_cache_events=False, log_format=None, partial_parse=None, printer_width=None, profile=None, profiles_dir='/Users/lindsay.carr/DBT/environments/redshift_discovery_crn_svc/', project_dir=None, record_timing_info=None, rpc_method='run', select=None, selector_name=None, send_anonymous_usage_stats=None, single_threaded=False, state=None, static_parser=None, target=None, threads=None, use_colors=None, use_experimental_parser=None, vars='{}', version_check=None, warn_error=None, which='run', write_json=None)
13:12:12.924970 [debug] [MainThread]: Tracking: tracking
13:12:12.992846 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcba859c520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcba859c910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcba85b11f0>]}
13:12:13.349570 [debug] [MainThread]: Partial parsing enabled: 24 files deleted, 0 files added, 0 files changed.
13:12:13.350753 [debug] [MainThread]: Partial parsing: deleted file: source_of_sales_change_lcarr://models/regional/final_output/regional__final_output.sql
13:12:13.351457 [debug] [MainThread]: Partial parsing: deleted file: source_of_sales_change_lcarr://models/market/aggregations_distinct/market_agg__hash_base_calcs.sql
13:12:13.351813 [debug] [MainThread]: Partial parsing: deleted file: source_of_sales_change_lcarr://models/regional/aggregations_distinct/regional_agg__distinct_calcs.sql
13:12:13.352130 [debug] [MainThread]: Partial parsing: deleted file: source_of_sales_change_lcarr://models/ast/final_output/ast__big_join.sql
13:12:13.352507 [debug] [MainThread]: Partial parsing: deleted file: source_of_sales_change_lcarr://models/regional/aggregations_distinct/regional_agg__month_lookback_distinct.sql
13:12:13.352803 [debug] [MainThread]: Partial parsing: deleted file: source_of_sales_change_lcarr://models/ast/final_output/ast__final_output.sql
13:12:13.353093 [debug] [MainThread]: Partial parsing: deleted file: source_of_sales_change_lcarr://models/regional/final_output/regional__big_join.sql
13:12:13.353395 [debug] [MainThread]: Partial parsing: deleted file: source_of_sales_change_lcarr://models/ast/aggregations/ast_agg__all_groupings.sql
13:12:13.353681 [debug] [MainThread]: Partial parsing: deleted file: source_of_sales_change_lcarr://models/ast/aggregations/ast_agg__month_lookback.sql
13:12:13.353973 [debug] [MainThread]: Partial parsing: deleted file: source_of_sales_change_lcarr://models/market/final_output/market__big_join.sql
13:12:13.354363 [debug] [MainThread]: Partial parsing: deleted file: source_of_sales_change_lcarr://models/regional/aggregations/regional_agg__all_groupings.sql
13:12:13.354657 [debug] [MainThread]: Partial parsing: deleted file: source_of_sales_change_lcarr://models/market/aggregations/market_agg__all_groupings.sql
13:12:13.354951 [debug] [MainThread]: Partial parsing: deleted file: source_of_sales_change_lcarr://models/regional/aggregations_distinct/regional_agg__hash_base_calcs.sql
13:12:13.355283 [debug] [MainThread]: Partial parsing: deleted file: source_of_sales_change_lcarr://models/ast/aggregations_distinct/ast_agg__hash_base_calcs.sql
13:12:13.355697 [debug] [MainThread]: Partial parsing: deleted file: source_of_sales_change_lcarr://models/regional/aggregations/regional_agg__month_lookback.sql
13:12:13.356062 [debug] [MainThread]: Partial parsing: deleted file: source_of_sales_change_lcarr://models/market/aggregations_distinct/market_agg__month_lookback_distinct.sql
13:12:13.356371 [debug] [MainThread]: Partial parsing: deleted file: source_of_sales_change_lcarr://models/market/aggregations/market_agg__month_lookback.sql
13:12:13.356672 [debug] [MainThread]: Partial parsing: deleted file: source_of_sales_change_lcarr://models/market/aggregations/market_agg__same_store_all_store.sql
13:12:13.357030 [debug] [MainThread]: Partial parsing: deleted file: source_of_sales_change_lcarr://models/ast/aggregations_distinct/ast_agg__month_lookback_distinct.sql
13:12:13.357338 [debug] [MainThread]: Partial parsing: deleted file: source_of_sales_change_lcarr://models/regional/aggregations/regional_agg__same_store_all_store.sql
13:12:13.357723 [debug] [MainThread]: Partial parsing: deleted file: source_of_sales_change_lcarr://models/market/final_output/market__final_output.sql
13:12:13.358045 [debug] [MainThread]: Partial parsing: deleted file: source_of_sales_change_lcarr://models/ast/aggregations/ast_agg__same_store_all_store.sql
13:12:13.358354 [debug] [MainThread]: Partial parsing: deleted file: source_of_sales_change_lcarr://models/ast/aggregations_distinct/ast_agg__distinct_calcs.sql
13:12:13.358660 [debug] [MainThread]: Partial parsing: deleted file: source_of_sales_change_lcarr://models/market/aggregations_distinct/market_agg__distinct_calcs.sql
13:12:13.437886 [debug] [MainThread]: 1699: static parser successfully parsed national/final_output/national__final_output.sql
13:12:13.479064 [debug] [MainThread]: 1699: static parser successfully parsed national/final_output/national__big_join.sql
13:12:13.558126 [debug] [MainThread]: 1699: static parser successfully parsed national/aggregations_distinct/national_agg__distinct_join.sql
13:12:13.561513 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcba8720ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcba870aaf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcba85c20a0>]}


============================== 2022-06-24 13:18:02.884043 | 85a897cc-2a49-4920-9f86-06a477ddc387 ==============================
13:18:02.884043 [info ] [MainThread]: Running with dbt=1.0.4
13:18:02.886117 [debug] [MainThread]: running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=None, defer=None, event_buffer_size=None, exclude=None, fail_fast=True, full_refresh=False, log_cache_events=False, log_format=None, partial_parse=None, printer_width=None, profile=None, profiles_dir='/Users/lindsay.carr/DBT/environments/redshift_discovery_crn_svc/', project_dir=None, record_timing_info=None, rpc_method='run', select=None, selector_name=None, send_anonymous_usage_stats=None, single_threaded=False, state=None, static_parser=None, target=None, threads=None, use_colors=None, use_experimental_parser=None, vars='{}', version_check=None, warn_error=None, which='run', write_json=None)
13:18:02.886588 [debug] [MainThread]: Tracking: tracking
13:18:02.919956 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f829e4a3580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f829e4a3970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f829e4874f0>]}
13:18:03.085508 [debug] [MainThread]: Partial parsing enabled: 24 files deleted, 0 files added, 1 files changed.
13:18:03.086254 [debug] [MainThread]: Partial parsing: deleted file: source_of_sales_change_lcarr://models/regional/aggregations_distinct/regional_agg__month_lookback_distinct.sql
13:18:03.086534 [debug] [MainThread]: Partial parsing: deleted file: source_of_sales_change_lcarr://models/market/aggregations/market_agg__month_lookback.sql
13:18:03.086850 [debug] [MainThread]: Partial parsing: deleted file: source_of_sales_change_lcarr://models/market/aggregations/market_agg__all_groupings.sql
13:18:03.087108 [debug] [MainThread]: Partial parsing: deleted file: source_of_sales_change_lcarr://models/ast/aggregations_distinct/ast_agg__hash_base_calcs.sql
13:18:03.087301 [debug] [MainThread]: Partial parsing: deleted file: source_of_sales_change_lcarr://models/ast/final_output/ast__big_join.sql
13:18:03.087480 [debug] [MainThread]: Partial parsing: deleted file: source_of_sales_change_lcarr://models/regional/aggregations/regional_agg__all_groupings.sql
13:18:03.087827 [debug] [MainThread]: Partial parsing: deleted file: source_of_sales_change_lcarr://models/regional/aggregations/regional_agg__month_lookback.sql
13:18:03.088065 [debug] [MainThread]: Partial parsing: deleted file: source_of_sales_change_lcarr://models/ast/aggregations/ast_agg__all_groupings.sql
13:18:03.088630 [debug] [MainThread]: Partial parsing: deleted file: source_of_sales_change_lcarr://models/market/aggregations_distinct/market_agg__distinct_calcs.sql
13:18:03.088919 [debug] [MainThread]: Partial parsing: deleted file: source_of_sales_change_lcarr://models/regional/final_output/regional__final_output.sql
13:18:03.089169 [debug] [MainThread]: Partial parsing: deleted file: source_of_sales_change_lcarr://models/regional/aggregations_distinct/regional_agg__hash_base_calcs.sql
13:18:03.089457 [debug] [MainThread]: Partial parsing: deleted file: source_of_sales_change_lcarr://models/ast/aggregations_distinct/ast_agg__month_lookback_distinct.sql
13:18:03.089688 [debug] [MainThread]: Partial parsing: deleted file: source_of_sales_change_lcarr://models/ast/final_output/ast__final_output.sql
13:18:03.089865 [debug] [MainThread]: Partial parsing: deleted file: source_of_sales_change_lcarr://models/regional/aggregations/regional_agg__same_store_all_store.sql
13:18:03.090044 [debug] [MainThread]: Partial parsing: deleted file: source_of_sales_change_lcarr://models/ast/aggregations/ast_agg__month_lookback.sql
13:18:03.090215 [debug] [MainThread]: Partial parsing: deleted file: source_of_sales_change_lcarr://models/market/final_output/market__final_output.sql
13:18:03.090541 [debug] [MainThread]: Partial parsing: deleted file: source_of_sales_change_lcarr://models/regional/final_output/regional__big_join.sql
13:18:03.090762 [debug] [MainThread]: Partial parsing: deleted file: source_of_sales_change_lcarr://models/market/aggregations_distinct/market_agg__hash_base_calcs.sql
13:18:03.091062 [debug] [MainThread]: Partial parsing: deleted file: source_of_sales_change_lcarr://models/market/aggregations_distinct/market_agg__month_lookback_distinct.sql
13:18:03.091326 [debug] [MainThread]: Partial parsing: deleted file: source_of_sales_change_lcarr://models/market/final_output/market__big_join.sql
13:18:03.091507 [debug] [MainThread]: Partial parsing: deleted file: source_of_sales_change_lcarr://models/market/aggregations/market_agg__same_store_all_store.sql
13:18:03.091857 [debug] [MainThread]: Partial parsing: deleted file: source_of_sales_change_lcarr://models/ast/aggregations/ast_agg__same_store_all_store.sql
13:18:03.092118 [debug] [MainThread]: Partial parsing: deleted file: source_of_sales_change_lcarr://models/ast/aggregations_distinct/ast_agg__distinct_calcs.sql
13:18:03.092347 [debug] [MainThread]: Partial parsing: deleted file: source_of_sales_change_lcarr://models/regional/aggregations_distinct/regional_agg__distinct_calcs.sql
13:18:03.092705 [debug] [MainThread]: Partial parsing: updated file: source_of_sales_change_lcarr://models/national/aggregations_distinct/national_agg__distinct_join.sql
13:18:03.111555 [debug] [MainThread]: 1699: static parser successfully parsed national/final_output/national__final_output.sql
13:18:03.127742 [debug] [MainThread]: 1699: static parser successfully parsed national/final_output/national__big_join.sql
13:18:03.131666 [debug] [MainThread]: 1699: static parser successfully parsed national/aggregations_distinct/national_agg__distinct_join.sql
13:18:03.161141 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 9 unused configuration paths:
- models.source_of_sales_change_lcarr.ast.aggregations
- models.source_of_sales_change_lcarr.regional.aggregations_distinct
- models.source_of_sales_change_lcarr.regional.aggregations
- models.source_of_sales_change_lcarr.market.final_output
- models.source_of_sales_change_lcarr.ast.final_output
- models.source_of_sales_change_lcarr.regional.final_output
- models.source_of_sales_change_lcarr.market.aggregations_distinct
- models.source_of_sales_change_lcarr.market.aggregations
- models.source_of_sales_change_lcarr.ast.aggregations_distinct

13:18:03.170773 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '85a897cc-2a49-4920-9f86-06a477ddc387', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f829e4f7b80>]}
13:18:03.188960 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '85a897cc-2a49-4920-9f86-06a477ddc387', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f829e4f5cd0>]}
13:18:03.189416 [info ] [MainThread]: Found 31 models, 4 tests, 0 snapshots, 0 analyses, 192 macros, 0 operations, 0 seed files, 11 sources, 0 exposures, 0 metrics
13:18:03.192600 [info ] [MainThread]: 
13:18:03.193494 [debug] [MainThread]: Acquiring new redshift connection "master"
13:18:03.196277 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa"
13:18:03.218577 [debug] [ThreadPool]: Using redshift connection "list_cfa"
13:18:03.219082 [debug] [ThreadPool]: On list_cfa: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa"} */

    select distinct nspname from pg_namespace
  
13:18:03.219446 [debug] [ThreadPool]: Opening a new connection, currently in state init
13:18:03.220648 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
13:18:04.141162 [debug] [ThreadPool]: SQL status: SELECT in 0.92 seconds
13:18:04.155220 [debug] [ThreadPool]: On list_cfa: Close
13:18:04.161845 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa_public"
13:18:04.175661 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
13:18:04.176101 [debug] [ThreadPool]: On list_cfa_public: BEGIN
13:18:04.176421 [debug] [ThreadPool]: Opening a new connection, currently in state closed
13:18:04.176746 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
13:18:05.006087 [debug] [ThreadPool]: SQL status: BEGIN in 0.83 seconds
13:18:05.006693 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
13:18:05.007019 [debug] [ThreadPool]: On list_cfa_public: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa_public"} */
select
      'cfa' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'cfa' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
13:18:05.306382 [debug] [ThreadPool]: SQL status: SELECT in 0.3 seconds
13:18:05.388050 [debug] [ThreadPool]: On list_cfa_public: ROLLBACK
13:18:05.518178 [debug] [ThreadPool]: On list_cfa_public: Close
13:18:05.550721 [debug] [MainThread]: Using redshift connection "master"
13:18:05.550973 [debug] [MainThread]: On master: BEGIN
13:18:05.551148 [debug] [MainThread]: Opening a new connection, currently in state init
13:18:05.551419 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
13:18:06.238001 [debug] [MainThread]: SQL status: BEGIN in 0.69 seconds
13:18:06.238547 [debug] [MainThread]: Using redshift connection "master"
13:18:06.238825 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
13:18:07.068930 [debug] [MainThread]: SQL status: SELECT in 0.83 seconds
13:18:07.096028 [debug] [MainThread]: On master: ROLLBACK
13:18:07.255827 [debug] [MainThread]: Using redshift connection "master"
13:18:07.256360 [debug] [MainThread]: On master: BEGIN
13:18:07.408283 [debug] [MainThread]: SQL status: BEGIN in 0.15 seconds
13:18:07.408685 [debug] [MainThread]: On master: COMMIT
13:18:07.408917 [debug] [MainThread]: Using redshift connection "master"
13:18:07.409146 [debug] [MainThread]: On master: COMMIT
13:18:07.563511 [debug] [MainThread]: SQL status: COMMIT in 0.15 seconds
13:18:07.564064 [debug] [MainThread]: On master: Close
13:18:07.565021 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
13:18:07.565560 [info ] [MainThread]: 
13:18:07.579301 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.calc__dim_monthend_date
13:18:07.579617 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.stg__dim_adj_sales
13:18:07.579808 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.stg__dim_daypart
13:18:07.580099 [info ] [Thread-1  ]: 1 of 31 START view model public.lcarr_sosx_calc__dim_monthend_date.............. [RUN]
13:18:07.580286 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.stg__dim_destination
13:18:07.580588 [info ] [Thread-2  ]: 2 of 31 START view model public.lcarr_sosx_stg__dim_adj_sales................... [RUN]
13:18:07.580894 [info ] [Thread-3  ]: 3 of 31 START view model public.lcarr_sosx_stg__dim_daypart..................... [RUN]
13:18:07.581499 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.calc__dim_monthend_date"
13:18:07.584474 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.calc__dim_monthend_date
13:18:07.582841 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.stg__dim_adj_sales"
13:18:07.581857 [info ] [Thread-4  ]: 4 of 31 START view model public.lcarr_sosx_stg__dim_destination................. [RUN]
13:18:07.586279 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.stg__dim_daypart"
13:18:07.586961 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.calc__dim_monthend_date
13:18:07.588731 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.stg__dim_adj_sales
13:18:07.590095 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.stg__dim_destination"
13:18:07.590405 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.stg__dim_daypart
13:18:07.595107 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.calc__dim_monthend_date"
13:18:07.596041 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.stg__dim_adj_sales
13:18:07.596431 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.stg__dim_destination
13:18:07.596700 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.stg__dim_daypart
13:18:07.605237 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.stg__dim_adj_sales"
13:18:07.605592 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.stg__dim_destination
13:18:07.608353 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.stg__dim_daypart"
13:18:07.608636 [debug] [Thread-1  ]: finished collecting timing info
13:18:07.611687 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.stg__dim_destination"
13:18:07.612304 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.calc__dim_monthend_date
13:18:07.612740 [debug] [Thread-2  ]: finished collecting timing info
13:18:07.625592 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.stg__dim_adj_sales
13:18:07.644852 [debug] [Thread-4  ]: finished collecting timing info
13:18:07.645190 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.stg__dim_destination
13:18:07.645452 [debug] [Thread-3  ]: finished collecting timing info
13:18:07.678535 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.stg__dim_daypart
13:18:08.026667 [debug] [Thread-4  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.stg__dim_destination"
13:18:08.028572 [debug] [Thread-1  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.calc__dim_monthend_date"
13:18:08.028813 [debug] [Thread-2  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.stg__dim_adj_sales"
13:18:08.034317 [debug] [Thread-3  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.stg__dim_daypart"
13:18:08.036066 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_destination"
13:18:08.036866 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__dim_destination: BEGIN
13:18:08.036584 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_daypart"
13:18:08.036357 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_monthend_date"
13:18:08.037193 [debug] [Thread-4  ]: Opening a new connection, currently in state init
13:18:08.037499 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_adj_sales"
13:18:08.037686 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__dim_daypart: BEGIN
13:18:08.038485 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.calc__dim_monthend_date: BEGIN
13:18:08.038896 [debug] [Thread-4  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
13:18:08.039187 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__dim_adj_sales: BEGIN
13:18:08.039411 [debug] [Thread-3  ]: Opening a new connection, currently in state init
13:18:08.039636 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
13:18:08.040046 [debug] [Thread-2  ]: Opening a new connection, currently in state init
13:18:08.040401 [debug] [Thread-3  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
13:18:08.040864 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
13:18:08.041272 [debug] [Thread-2  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
13:18:08.769119 [debug] [Thread-4  ]: SQL status: BEGIN in 0.73 seconds
13:18:08.769648 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_destination"
13:18:08.770199 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__dim_destination: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__dim_destination"} */


  create view "cfa"."public"."stg__dim_destination__dbt_tmp" as (
    with dim_destination as
(select destination_code, destination_desc, dest_alias
 from "cfa"."common"."d_destination"
 ),

 refund_empty as 
 (select 'REFUND TRANS' as destination_code, '' as destination_desc, 
          'Refund' as dest_alias
 ),

 destination as
 (select destination_code, destination_desc, dest_alias from dim_destination
  union all
  select destination_code, destination_desc, dest_alias from refund_empty
)

select *
from destination
  ) with no schema binding;

13:18:08.774390 [debug] [Thread-1  ]: SQL status: BEGIN in 0.73 seconds
13:18:08.775195 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_monthend_date"
13:18:08.775737 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.calc__dim_monthend_date: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.calc__dim_monthend_date"} */


  create view "cfa"."public"."calc__dim_monthend_date__dbt_tmp" as (
    with dim_date_pull as ( 
    select distinct monthend_date,CAST(DATEADD(month, -11, monthend_date) as date) as comparison_monthend_date
    from "cfa"."public"."dim_date"
    where monthend_date >= CAST('01-01-2019' as date)
    and monthend_date < DATEADD(month,1,GETDATE())
), dim_date_calc_1 as ( 
    select monthend_date,comparison_monthend_date,
    DATEPART(day,comparison_monthend_date) as day_compare
    from dim_date_pull
), dim_date_calc_2 as ( 
    select monthend_date,
    CAST(DATEADD(day,-day_compare,comparison_monthend_date) as date) as previous_year_monthend_date 
    from dim_date_calc_1
)

select * from dim_date_calc_2
  ) with no schema binding;

13:18:08.798543 [debug] [Thread-3  ]: SQL status: BEGIN in 0.76 seconds
13:18:08.799020 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_daypart"
13:18:08.799280 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__dim_daypart: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__dim_daypart"} */


  create view "cfa"."public"."stg__dim_daypart__dbt_tmp" as (
    with dim_time as
(select hour_min as end_hour_min, daypart
 from "cfa"."apps"."time_d"
)

select *
from dim_time
  ) with no schema binding;

13:18:08.832898 [debug] [Thread-2  ]: SQL status: BEGIN in 0.79 seconds
13:18:08.833257 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_adj_sales"
13:18:08.833477 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__dim_adj_sales: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__dim_adj_sales"} */


  create view "cfa"."public"."stg__dim_adj_sales__dbt_tmp" as (
    with fcs_adjusted_sales as ( 
    SELECT location_num,
    monthend_date,
    month_sales,
    adjusted_sales,
    month_sales_pg1,
    adjusted_sales_pg1
    FROM "cfa"."prodmix_dl"."fcs_adjusted_sales" sales
    where monthend_date = CAST('2021-02-28' as date)
    or monthend_date = CAST('2022-02-28' as date)
)
select * from fcs_adjusted_sales
  ) with no schema binding;

13:18:08.850281 [debug] [Thread-4  ]: SQL status: CREATE VIEW in 0.08 seconds
13:18:08.859907 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_destination"
13:18:08.860201 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.08 seconds
13:18:08.860475 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__dim_destination: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__dim_destination"} */
alter table "cfa"."public"."lcarr_sosx_stg__dim_destination" rename to "stg__dim_destination__dbt_backup"
13:18:08.864814 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_monthend_date"
13:18:08.865286 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.calc__dim_monthend_date: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.calc__dim_monthend_date"} */
alter table "cfa"."public"."lcarr_sosx_calc__dim_monthend_date" rename to "calc__dim_monthend_date__dbt_backup"
13:18:08.890231 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.09 seconds
13:18:08.894111 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_daypart"
13:18:08.894407 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__dim_daypart: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__dim_daypart"} */
alter table "cfa"."public"."lcarr_sosx_stg__dim_daypart" rename to "stg__dim_daypart__dbt_backup"
13:18:08.909309 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.08 seconds
13:18:08.913598 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_adj_sales"
13:18:08.913911 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__dim_adj_sales: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__dim_adj_sales"} */
alter table "cfa"."public"."lcarr_sosx_stg__dim_adj_sales" rename to "stg__dim_adj_sales__dbt_backup"
13:18:08.921236 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.06 seconds
13:18:08.924401 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_destination"
13:18:08.924705 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__dim_destination: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__dim_destination"} */
alter table "cfa"."public"."stg__dim_destination__dbt_tmp" rename to "lcarr_sosx_stg__dim_destination"
13:18:08.927270 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.06 seconds
13:18:08.930352 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_monthend_date"
13:18:08.930628 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.calc__dim_monthend_date: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.calc__dim_monthend_date"} */
alter table "cfa"."public"."calc__dim_monthend_date__dbt_tmp" rename to "lcarr_sosx_calc__dim_monthend_date"
13:18:08.952573 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.06 seconds
13:18:08.956793 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_daypart"
13:18:08.957468 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__dim_daypart: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__dim_daypart"} */
alter table "cfa"."public"."stg__dim_daypart__dbt_tmp" rename to "lcarr_sosx_stg__dim_daypart"
13:18:08.969417 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.06 seconds
13:18:08.972980 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_adj_sales"
13:18:08.973294 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__dim_adj_sales: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__dim_adj_sales"} */
alter table "cfa"."public"."stg__dim_adj_sales__dbt_tmp" rename to "lcarr_sosx_stg__dim_adj_sales"
13:18:08.979879 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.05 seconds
13:18:08.990312 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__dim_destination: COMMIT
13:18:08.990867 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_destination"
13:18:08.991248 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__dim_destination: COMMIT
13:18:08.991620 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.06 seconds
13:18:08.993123 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.calc__dim_monthend_date: COMMIT
13:18:08.993365 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_monthend_date"
13:18:08.993546 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.calc__dim_monthend_date: COMMIT
13:18:09.014287 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.06 seconds
13:18:09.016431 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__dim_daypart: COMMIT
13:18:09.016760 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_daypart"
13:18:09.016965 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__dim_daypart: COMMIT
13:18:09.029571 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.06 seconds
13:18:09.031501 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__dim_adj_sales: COMMIT
13:18:09.031761 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_adj_sales"
13:18:09.031966 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__dim_adj_sales: COMMIT
13:18:12.097297 [debug] [Thread-4  ]: SQL status: COMMIT in 3.11 seconds
13:18:12.097965 [debug] [Thread-1  ]: SQL status: COMMIT in 3.1 seconds
13:18:12.098239 [debug] [Thread-2  ]: SQL status: COMMIT in 3.07 seconds
13:18:12.098827 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_destination"
13:18:12.099085 [debug] [Thread-3  ]: SQL status: COMMIT in 3.08 seconds
13:18:12.099818 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__dim_destination: BEGIN
13:18:12.160598 [debug] [Thread-4  ]: SQL status: BEGIN in 0.06 seconds
13:18:12.169381 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_destination"
13:18:12.169704 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__dim_destination: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__dim_destination"} */
drop view if exists "cfa"."public"."stg__dim_destination__dbt_backup" cascade
13:18:12.448340 [debug] [Thread-4  ]: SQL status: DROP VIEW in 0.28 seconds
13:18:12.449814 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__dim_destination: COMMIT
13:18:12.450087 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_destination"
13:18:12.450301 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__dim_destination: COMMIT
13:18:13.782196 [debug] [Thread-4  ]: SQL status: COMMIT in 1.33 seconds
13:18:13.782651 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_destination"
13:18:13.782897 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__dim_destination: BEGIN
13:18:13.842846 [debug] [Thread-4  ]: SQL status: BEGIN in 0.06 seconds
13:18:13.844406 [debug] [Thread-4  ]: finished collecting timing info
13:18:13.844777 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_monthend_date"
13:18:13.845118 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__dim_destination: ROLLBACK
13:18:13.845437 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.calc__dim_monthend_date: BEGIN
13:18:13.956997 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__dim_destination: Close
13:18:13.958609 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85a897cc-2a49-4920-9f86-06a477ddc387', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f829ec6caf0>]}
13:18:13.959185 [info ] [Thread-4  ]: 4 of 31 OK created view model public.lcarr_sosx_stg__dim_destination............ [[32mCREATE VIEW[0m in 6.37s]
13:18:13.959695 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.stg__dim_destination
13:18:13.960085 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig
13:18:13.960611 [info ] [Thread-4  ]: 5 of 31 START view model public.lcarr_sosx_stg__dim_fcr_loc_sales_elig.......... [RUN]
13:18:13.961504 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig"
13:18:13.961766 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig
13:18:13.962816 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig
13:18:13.963617 [debug] [Thread-1  ]: SQL status: BEGIN in 0.12 seconds
13:18:13.967489 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig"
13:18:13.973620 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_monthend_date"
13:18:13.974302 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.calc__dim_monthend_date: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.calc__dim_monthend_date"} */
drop view if exists "cfa"."public"."calc__dim_monthend_date__dbt_backup" cascade
13:18:13.975022 [debug] [Thread-4  ]: finished collecting timing info
13:18:13.975434 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig
13:18:14.051221 [debug] [Thread-4  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig"
13:18:14.051970 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig"
13:18:14.052302 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig: BEGIN
13:18:14.052488 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
13:18:14.052676 [debug] [Thread-4  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
13:18:14.247658 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.27 seconds
13:18:14.249473 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.calc__dim_monthend_date: COMMIT
13:18:14.249828 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_monthend_date"
13:18:14.250456 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.calc__dim_monthend_date: COMMIT
13:18:14.817667 [debug] [Thread-4  ]: SQL status: BEGIN in 0.77 seconds
13:18:14.818298 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig"
13:18:14.818577 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig"} */


  create view "cfa"."public"."stg__dim_fcr_loc_sales_elig__dbt_tmp" as (
    with fcr_loc_sales_elig as ( 
    select location_num,monthend_date,
    cm_num_actual_bus_days_cy as actual_days,
    cm_num_avail_bus_days_cy as avail_days
    from "cfa"."fin_lh"."fcr_locations_sales_eligibility" 
    where monthend_date >= cast('01-01-2021' as date)
)
select * from fcr_loc_sales_elig
  ) with no schema binding;

13:18:14.895122 [debug] [Thread-4  ]: SQL status: CREATE VIEW in 0.08 seconds
13:18:14.899012 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig"
13:18:14.899322 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig"} */
alter table "cfa"."public"."lcarr_sosx_stg__dim_fcr_loc_sales_elig" rename to "stg__dim_fcr_loc_sales_elig__dbt_backup"
13:18:15.020861 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.12 seconds
13:18:15.024216 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig"
13:18:15.024518 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig"} */
alter table "cfa"."public"."stg__dim_fcr_loc_sales_elig__dbt_tmp" rename to "lcarr_sosx_stg__dim_fcr_loc_sales_elig"
13:18:15.082628 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.06 seconds
13:18:15.084774 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig: COMMIT
13:18:15.085070 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig"
13:18:15.085287 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig: COMMIT
13:18:16.640981 [debug] [Thread-1  ]: SQL status: COMMIT in 2.39 seconds
13:18:16.641643 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_monthend_date"
13:18:16.642697 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.calc__dim_monthend_date: BEGIN
13:18:16.643548 [debug] [Thread-4  ]: SQL status: COMMIT in 1.56 seconds
13:18:16.707427 [debug] [Thread-1  ]: SQL status: BEGIN in 0.06 seconds
13:18:16.708198 [debug] [Thread-1  ]: finished collecting timing info
13:18:16.708483 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_adj_sales"
13:18:16.708746 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.calc__dim_monthend_date: ROLLBACK
13:18:16.709018 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__dim_adj_sales: BEGIN
13:18:16.946738 [debug] [Thread-2  ]: SQL status: BEGIN in 0.24 seconds
13:18:16.947095 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.calc__dim_monthend_date: Close
13:18:16.950363 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_adj_sales"
13:18:16.950805 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__dim_adj_sales: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__dim_adj_sales"} */
drop view if exists "cfa"."public"."stg__dim_adj_sales__dbt_backup" cascade
13:18:16.951626 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85a897cc-2a49-4920-9f86-06a477ddc387', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f829e621610>]}
13:18:16.952122 [info ] [Thread-1  ]: 1 of 31 OK created view model public.lcarr_sosx_calc__dim_monthend_date......... [[32mCREATE VIEW[0m in 9.37s]
13:18:16.952564 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.calc__dim_monthend_date
13:18:16.952960 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.stg__dim_item
13:18:16.953434 [info ] [Thread-1  ]: 6 of 31 START view model public.lcarr_sosx_stg__dim_item........................ [RUN]
13:18:16.954352 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.stg__dim_item"
13:18:16.954593 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.stg__dim_item
13:18:16.954804 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.stg__dim_item
13:18:16.959982 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.stg__dim_item"
13:18:16.960820 [debug] [Thread-1  ]: finished collecting timing info
13:18:16.961202 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.stg__dim_item
13:18:17.035123 [debug] [Thread-1  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.stg__dim_item"
13:18:17.035861 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_item"
13:18:17.036067 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.stg__dim_item: BEGIN
13:18:17.036982 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
13:18:17.037258 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
13:18:17.082405 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.13 seconds
13:18:17.084514 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__dim_adj_sales: COMMIT
13:18:17.084833 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_adj_sales"
13:18:17.085052 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__dim_adj_sales: COMMIT
13:18:17.688440 [debug] [Thread-1  ]: SQL status: BEGIN in 0.65 seconds
13:18:17.689102 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_item"
13:18:17.689649 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.stg__dim_item: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__dim_item"} */


  create view "cfa"."public"."stg__dim_item__dbt_tmp" as (
    with dim_item as
(select pin, hierarchy_1, short_name
 from "cfa"."apps"."dim_item")

select *
from dim_item
  ) with no schema binding;

13:18:17.770577 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.08 seconds
13:18:17.776676 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_item"
13:18:17.777050 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.stg__dim_item: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__dim_item"} */
alter table "cfa"."public"."lcarr_sosx_stg__dim_item" rename to "stg__dim_item__dbt_backup"
13:18:18.379621 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.6 seconds
13:18:18.384122 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_item"
13:18:18.384448 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.stg__dim_item: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__dim_item"} */
alter table "cfa"."public"."stg__dim_item__dbt_tmp" rename to "lcarr_sosx_stg__dim_item"
13:18:18.442211 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.06 seconds
13:18:18.444434 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.stg__dim_item: COMMIT
13:18:18.444744 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_item"
13:18:18.445248 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.stg__dim_item: COMMIT
13:18:20.909740 [debug] [Thread-2  ]: SQL status: COMMIT in 3.82 seconds
13:18:20.910251 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_adj_sales"
13:18:20.910570 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__dim_adj_sales: BEGIN
13:18:20.914269 [debug] [Thread-1  ]: SQL status: COMMIT in 2.47 seconds
13:18:20.972580 [debug] [Thread-2  ]: SQL status: BEGIN in 0.06 seconds
13:18:20.973456 [debug] [Thread-2  ]: finished collecting timing info
13:18:20.973774 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_daypart"
13:18:20.974068 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__dim_adj_sales: ROLLBACK
13:18:20.974337 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__dim_daypart: BEGIN
13:18:21.078788 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__dim_adj_sales: Close
13:18:21.079496 [debug] [Thread-3  ]: SQL status: BEGIN in 0.1 seconds
13:18:21.080466 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85a897cc-2a49-4920-9f86-06a477ddc387', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f829ebfe100>]}
13:18:21.086090 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_daypart"
13:18:21.086507 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__dim_daypart: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__dim_daypart"} */
drop view if exists "cfa"."public"."stg__dim_daypart__dbt_backup" cascade
13:18:21.087116 [info ] [Thread-2  ]: 2 of 31 OK created view model public.lcarr_sosx_stg__dim_adj_sales.............. [[32mCREATE VIEW[0m in 13.50s]
13:18:21.087949 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.stg__dim_adj_sales
13:18:21.088368 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.stg__dim_location
13:18:21.089010 [info ] [Thread-2  ]: 7 of 31 START view model public.lcarr_sosx_stg__dim_location.................... [RUN]
13:18:21.089996 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.stg__dim_location"
13:18:21.090223 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.stg__dim_location
13:18:21.090420 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.stg__dim_location
13:18:21.097493 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.stg__dim_location"
13:18:21.099361 [debug] [Thread-2  ]: finished collecting timing info
13:18:21.099912 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.stg__dim_location
13:18:21.194220 [debug] [Thread-2  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.stg__dim_location"
13:18:21.194948 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_location"
13:18:21.195158 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__dim_location: BEGIN
13:18:21.195343 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
13:18:21.195642 [debug] [Thread-2  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
13:18:21.252949 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.17 seconds
13:18:21.254638 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__dim_daypart: COMMIT
13:18:21.255047 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_daypart"
13:18:21.255378 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__dim_daypart: COMMIT
13:18:21.895010 [debug] [Thread-2  ]: SQL status: BEGIN in 0.7 seconds
13:18:21.895461 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_location"
13:18:21.895841 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__dim_location: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__dim_location"} */


  create view "cfa"."public"."stg__dim_location__dbt_tmp" as (
    with location as (
    select location_num, service_team_name,
        case when location_type_code in ('FSU','MALL','DTO') 
             then location_type_code 
        else 'SAT' end as location_type_code,
        region_name, dma_name 
    from "cfa"."public"."location_attributes"
    where concept_code = 'CFA'
)

select *
from location
  ) with no schema binding;

13:18:21.973132 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.08 seconds
13:18:21.978475 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_location"
13:18:21.978762 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__dim_location: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__dim_location"} */
alter table "cfa"."public"."lcarr_sosx_stg__dim_location" rename to "stg__dim_location__dbt_backup"
13:18:22.038829 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.06 seconds
13:18:22.044113 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_location"
13:18:22.044489 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__dim_location: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__dim_location"} */
alter table "cfa"."public"."stg__dim_location__dbt_tmp" rename to "lcarr_sosx_stg__dim_location"
13:18:22.102432 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.06 seconds
13:18:22.104336 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__dim_location: COMMIT
13:18:22.104876 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_location"
13:18:22.105534 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__dim_location: COMMIT
13:18:23.674611 [debug] [Thread-3  ]: SQL status: COMMIT in 2.42 seconds
13:18:23.675083 [debug] [Thread-2  ]: SQL status: COMMIT in 1.57 seconds
13:18:23.675330 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_daypart"
13:18:23.676221 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__dim_daypart: BEGIN
13:18:23.735033 [debug] [Thread-3  ]: SQL status: BEGIN in 0.06 seconds
13:18:23.735821 [debug] [Thread-3  ]: finished collecting timing info
13:18:23.736106 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig"
13:18:23.736358 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__dim_daypart: ROLLBACK
13:18:23.736598 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig: BEGIN
13:18:23.839103 [debug] [Thread-4  ]: SQL status: BEGIN in 0.1 seconds
13:18:23.839552 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__dim_daypart: Close
13:18:23.846446 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig"
13:18:23.846996 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig"} */
drop view if exists "cfa"."public"."stg__dim_fcr_loc_sales_elig__dbt_backup" cascade
13:18:23.847829 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85a897cc-2a49-4920-9f86-06a477ddc387', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f829ece3e80>]}
13:18:23.848381 [info ] [Thread-3  ]: 3 of 31 OK created view model public.lcarr_sosx_stg__dim_daypart................ [[32mCREATE VIEW[0m in 16.26s]
13:18:23.849189 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.stg__dim_daypart
13:18:23.849499 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.stg__dim_transaction_status
13:18:23.849993 [info ] [Thread-3  ]: 8 of 31 START view model public.lcarr_sosx_stg__dim_transaction_status.......... [RUN]
13:18:23.850948 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.stg__dim_transaction_status"
13:18:23.851229 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.stg__dim_transaction_status
13:18:23.851520 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.stg__dim_transaction_status
13:18:23.855506 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.stg__dim_transaction_status"
13:18:23.856459 [debug] [Thread-3  ]: finished collecting timing info
13:18:23.856754 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.stg__dim_transaction_status
13:18:23.943007 [debug] [Thread-3  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.stg__dim_transaction_status"
13:18:23.943857 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_transaction_status"
13:18:23.944094 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__dim_transaction_status: BEGIN
13:18:23.944344 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
13:18:23.944586 [debug] [Thread-3  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
13:18:24.152208 [debug] [Thread-4  ]: SQL status: DROP VIEW in 0.3 seconds
13:18:24.154037 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig: COMMIT
13:18:24.154329 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig"
13:18:24.154537 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig: COMMIT
13:18:24.832004 [debug] [Thread-3  ]: SQL status: BEGIN in 0.89 seconds
13:18:24.832580 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_transaction_status"
13:18:24.832916 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__dim_transaction_status: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__dim_transaction_status"} */


  create view "cfa"."public"."stg__dim_transaction_status__dbt_tmp" as (
    with trans_status as ( 
    select trans_status_id as status, cancelled_flg
    from "cfa"."pos"."transaction_status"
)

select * 
from trans_status
  ) with no schema binding;

13:18:24.913969 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.08 seconds
13:18:24.917549 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_transaction_status"
13:18:24.917825 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__dim_transaction_status: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__dim_transaction_status"} */
alter table "cfa"."public"."lcarr_sosx_stg__dim_transaction_status" rename to "stg__dim_transaction_status__dbt_backup"
13:18:24.975947 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.06 seconds
13:18:24.978934 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_transaction_status"
13:18:24.979210 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__dim_transaction_status: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__dim_transaction_status"} */
alter table "cfa"."public"."stg__dim_transaction_status__dbt_tmp" rename to "lcarr_sosx_stg__dim_transaction_status"
13:18:25.239203 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.26 seconds
13:18:25.239728 [debug] [Thread-4  ]: SQL status: COMMIT in 1.08 seconds
13:18:25.241110 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__dim_transaction_status: COMMIT
13:18:25.241405 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig"
13:18:25.241633 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_transaction_status"
13:18:25.241832 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig: BEGIN
13:18:25.242024 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__dim_transaction_status: COMMIT
13:18:25.303830 [debug] [Thread-4  ]: SQL status: BEGIN in 0.06 seconds
13:18:25.305559 [debug] [Thread-4  ]: finished collecting timing info
13:18:25.305935 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_item"
13:18:25.307307 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig: ROLLBACK
13:18:25.307631 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.stg__dim_item: BEGIN
13:18:25.371709 [debug] [Thread-1  ]: SQL status: BEGIN in 0.06 seconds
13:18:25.375340 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_item"
13:18:25.375632 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.stg__dim_item: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__dim_item"} */
drop view if exists "cfa"."public"."stg__dim_item__dbt_backup" cascade
13:18:25.418708 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig: Close
13:18:25.420032 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85a897cc-2a49-4920-9f86-06a477ddc387', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f829ec64670>]}
13:18:25.421528 [info ] [Thread-4  ]: 5 of 31 OK created view model public.lcarr_sosx_stg__dim_fcr_loc_sales_elig..... [[32mCREATE VIEW[0m in 11.46s]
13:18:25.423552 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig
13:18:25.424455 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.stg__fct_transaction
13:18:25.426069 [info ] [Thread-4  ]: 9 of 31 START view model public.lcarr_sosx_stg__fct_transaction................. [RUN]
13:18:25.427440 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.stg__fct_transaction"
13:18:25.427798 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.stg__fct_transaction
13:18:25.428096 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.stg__fct_transaction
13:18:25.441721 [info ] [Thread-4  ]: 2022-02-01
13:18:25.445246 [info ] [Thread-4  ]: 2022-02-28
13:18:25.447612 [info ] [Thread-4  ]: 
13:18:25.448751 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.stg__fct_transaction"
13:18:25.450095 [debug] [Thread-4  ]: finished collecting timing info
13:18:25.450545 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.stg__fct_transaction
13:18:25.552059 [debug] [Thread-4  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.stg__fct_transaction"
13:18:25.553231 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_transaction"
13:18:25.553511 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__fct_transaction: BEGIN
13:18:25.553757 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
13:18:25.554006 [debug] [Thread-4  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
13:18:26.332927 [debug] [Thread-4  ]: SQL status: BEGIN in 0.78 seconds
13:18:26.333399 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_transaction"
13:18:26.333642 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__fct_transaction: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__fct_transaction"} */


  create view "cfa"."public"."stg__fct_transaction__dbt_tmp" as (
    





with transaction as 
( 
    select business_date,location_num,trans_id,end_time,end_hour_min,
    date_part(qtr,business_date)||' '||date_part(year,business_date) as quarter,
    cast(last_day(business_date) as date) as monthend_date,
    destination_code,destination_desc,cfa_one_id,customer_hash,
    sales_sub_total,tax_amount,delivery_tip
    from "cfa"."pos"."trans_header"
    where cancelled_flg = 'false'
    and (business_date between '2022-02-01' and '2022-02-28'
    or business_date between '2021-02-01' and '2021-02-28'))

select *
from transaction
  ) with no schema binding;

13:18:26.432205 [debug] [Thread-1  ]: SQL status: DROP VIEW in 1.06 seconds
13:18:26.432732 [debug] [Thread-4  ]: SQL status: CREATE VIEW in 0.1 seconds
13:18:26.433038 [debug] [Thread-3  ]: SQL status: COMMIT in 1.19 seconds
13:18:26.434730 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.stg__dim_item: COMMIT
13:18:26.438723 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_transaction"
13:18:26.439365 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_item"
13:18:26.439625 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__fct_transaction: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__fct_transaction"} */
alter table "cfa"."public"."lcarr_sosx_stg__fct_transaction" rename to "stg__fct_transaction__dbt_backup"
13:18:26.439824 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.stg__dim_item: COMMIT
13:18:26.505830 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.07 seconds
13:18:26.509299 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_transaction"
13:18:26.509643 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__fct_transaction: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__fct_transaction"} */
alter table "cfa"."public"."stg__fct_transaction__dbt_tmp" rename to "lcarr_sosx_stg__fct_transaction"
13:18:26.569569 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.06 seconds
13:18:26.572199 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__fct_transaction: COMMIT
13:18:26.572623 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_transaction"
13:18:26.572951 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__fct_transaction: COMMIT
13:18:28.808111 [debug] [Thread-1  ]: SQL status: COMMIT in 2.37 seconds
13:18:28.808514 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_item"
13:18:28.808740 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.stg__dim_item: BEGIN
13:18:28.813187 [debug] [Thread-4  ]: SQL status: COMMIT in 2.24 seconds
13:18:28.871349 [debug] [Thread-1  ]: SQL status: BEGIN in 0.06 seconds
13:18:28.872280 [debug] [Thread-1  ]: finished collecting timing info
13:18:28.872698 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_location"
13:18:28.873072 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.stg__dim_item: ROLLBACK
13:18:28.873440 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__dim_location: BEGIN
13:18:28.980526 [debug] [Thread-2  ]: SQL status: BEGIN in 0.11 seconds
13:18:28.981050 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.stg__dim_item: Close
13:18:28.985872 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_location"
13:18:28.986545 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__dim_location: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__dim_location"} */
drop view if exists "cfa"."public"."stg__dim_location__dbt_backup" cascade
13:18:28.987620 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85a897cc-2a49-4920-9f86-06a477ddc387', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f829ec64310>]}
13:18:28.988576 [info ] [Thread-1  ]: 6 of 31 OK created view model public.lcarr_sosx_stg__dim_item................... [[32mCREATE VIEW[0m in 12.03s]
13:18:28.989828 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.stg__dim_item
13:18:28.990324 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.calc__error
13:18:28.991215 [info ] [Thread-1  ]: 10 of 31 START view model public.lcarr_sosx_calc__error......................... [RUN]
13:18:28.992198 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.calc__error"
13:18:28.992455 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.calc__error
13:18:28.992681 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.calc__error
13:18:28.997865 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.calc__error"
13:18:28.998883 [debug] [Thread-1  ]: finished collecting timing info
13:18:28.999152 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.calc__error
13:18:29.090481 [debug] [Thread-1  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.calc__error"
13:18:29.091448 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__error"
13:18:29.091716 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.calc__error: BEGIN
13:18:29.091939 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
13:18:29.092135 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
13:18:29.187471 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.2 seconds
13:18:29.188854 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__dim_location: COMMIT
13:18:29.189134 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_location"
13:18:29.189345 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__dim_location: COMMIT
13:18:29.823654 [debug] [Thread-1  ]: SQL status: BEGIN in 0.73 seconds
13:18:29.823975 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__error"
13:18:29.824173 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.calc__error: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.calc__error"} */


  create view "cfa"."public"."calc__error__dbt_tmp" as (
    with fcs_adj_sales as ( 
    select location_num,monthend_date, 
    month_sales,adjusted_sales,month_sales_pg1,adjusted_sales_pg1
    from "cfa"."public"."lcarr_sosx_stg__dim_adj_sales"
), location_attributes as ( 
    select location_num, dma_name
    from "cfa"."public"."lcarr_sosx_calc__dim_monthend_date"
), fcs_adj_sales_loc as ( 
    select b.dma_name,a.location_num,a.monthend_date,'1 month' as look_back_period,
    a.month_sales,a.adjusted_sales,a.month_sales_pg1,a.adjusted_sales_pg1
    from fcs_adj_sales a 
    inner join location_attributes b using (location_num)
)
select * from fcs_adj_sales_loc
  ) with no schema binding;

13:18:29.943428 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.12 seconds
13:18:29.949157 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__error"
13:18:29.950442 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.calc__error: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.calc__error"} */
alter table "cfa"."public"."lcarr_sosx_calc__error" rename to "calc__error__dbt_backup"
13:18:30.010023 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.06 seconds
13:18:30.017906 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__error"
13:18:30.018198 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.calc__error: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.calc__error"} */
alter table "cfa"."public"."calc__error__dbt_tmp" rename to "lcarr_sosx_calc__error"
13:18:30.220078 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.2 seconds
13:18:30.221505 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.calc__error: COMMIT
13:18:30.221751 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__error"
13:18:30.222210 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.calc__error: COMMIT
13:18:30.267486 [debug] [Thread-2  ]: SQL status: COMMIT in 1.08 seconds
13:18:30.267973 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_location"
13:18:30.268213 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__dim_location: BEGIN
13:18:30.329103 [debug] [Thread-2  ]: SQL status: BEGIN in 0.06 seconds
13:18:30.329999 [debug] [Thread-2  ]: finished collecting timing info
13:18:30.330311 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__dim_location: ROLLBACK
13:18:30.330616 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_transaction_status"
13:18:30.330936 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__dim_transaction_status: BEGIN
13:18:30.429627 [debug] [Thread-3  ]: SQL status: BEGIN in 0.1 seconds
13:18:30.430002 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__dim_location: Close
13:18:30.484398 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_transaction_status"
13:18:30.484998 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85a897cc-2a49-4920-9f86-06a477ddc387', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f829ec64490>]}
13:18:30.485260 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__dim_transaction_status: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__dim_transaction_status"} */
drop view if exists "cfa"."public"."stg__dim_transaction_status__dbt_backup" cascade
13:18:30.485842 [info ] [Thread-2  ]: 7 of 31 OK created view model public.lcarr_sosx_stg__dim_location............... [[32mCREATE VIEW[0m in 9.40s]
13:18:30.486726 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.stg__dim_location
13:18:30.487160 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.stg__dim_same_store
13:18:30.487971 [info ] [Thread-2  ]: 11 of 31 START view model public.lcarr_sosx_stg__dim_same_store................. [RUN]
13:18:30.489120 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.stg__dim_same_store"
13:18:30.489581 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.stg__dim_same_store
13:18:30.489922 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.stg__dim_same_store
13:18:30.495354 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.stg__dim_same_store"
13:18:30.496608 [debug] [Thread-2  ]: finished collecting timing info
13:18:30.497093 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.stg__dim_same_store
13:18:30.598070 [debug] [Thread-2  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.stg__dim_same_store"
13:18:30.598885 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_same_store"
13:18:30.599134 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__dim_same_store: BEGIN
13:18:30.599317 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
13:18:30.599523 [debug] [Thread-2  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
13:18:31.301933 [debug] [Thread-2  ]: SQL status: BEGIN in 0.7 seconds
13:18:31.302772 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_same_store"
13:18:31.303201 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__dim_same_store: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__dim_same_store"} */


  create view "cfa"."public"."stg__dim_same_store__dbt_tmp" as (
    with fcr_loc_sales_elig as ( 
    select location_num,monthend_date,
    actual_days, avail_days
    from "cfa"."public"."lcarr_sosx_stg__dim_fcr_loc_sales_elig"
), dim_monthend_date as ( 
    select monthend_date,previous_year_monthend_date
    from "cfa"."public"."lcarr_sosx_calc__dim_monthend_date"
), dim_same_store as ( 
    select a.location_num, a.monthend_date, '1 month' as look_back_period, 
    a.actual_days, a.avail_days, b.previous_year_monthend_date,
    cast(a.actual_days as decimal)/a.avail_days as same_store_percent
    from fcr_loc_sales_elig a 
    inner join dim_monthend_date b using (monthend_date)
)
select * from dim_same_store
  ) with no schema binding;

13:18:31.525690 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.22 seconds
13:18:31.529967 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_same_store"
13:18:31.530249 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__dim_same_store: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__dim_same_store"} */
alter table "cfa"."public"."lcarr_sosx_stg__dim_same_store" rename to "stg__dim_same_store__dbt_backup"
13:18:31.596487 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.07 seconds
13:18:31.600749 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_same_store"
13:18:31.601063 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__dim_same_store: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__dim_same_store"} */
alter table "cfa"."public"."stg__dim_same_store__dbt_tmp" rename to "lcarr_sosx_stg__dim_same_store"
13:18:31.663272 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.06 seconds
13:18:31.665392 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__dim_same_store: COMMIT
13:18:31.666431 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_same_store"
13:18:31.666690 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__dim_same_store: COMMIT
13:18:31.938689 [debug] [Thread-3  ]: SQL status: DROP VIEW in 1.45 seconds
13:18:31.940287 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__dim_transaction_status: COMMIT
13:18:31.940556 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_transaction_status"
13:18:31.940886 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__dim_transaction_status: COMMIT
13:18:34.312267 [debug] [Thread-1  ]: SQL status: COMMIT in 4.09 seconds
13:18:34.316530 [debug] [Thread-2  ]: SQL status: COMMIT in 2.65 seconds
13:18:34.318656 [debug] [Thread-3  ]: SQL status: COMMIT in 2.38 seconds
13:18:34.319170 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_transaction_status"
13:18:34.319402 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__dim_transaction_status: BEGIN
13:18:34.378490 [debug] [Thread-3  ]: SQL status: BEGIN in 0.06 seconds
13:18:34.379558 [debug] [Thread-3  ]: finished collecting timing info
13:18:34.379943 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_transaction"
13:18:34.380216 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__dim_transaction_status: ROLLBACK
13:18:34.380586 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__fct_transaction: BEGIN
13:18:34.481311 [debug] [Thread-4  ]: SQL status: BEGIN in 0.1 seconds
13:18:34.481847 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__dim_transaction_status: Close
13:18:34.485536 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_transaction"
13:18:34.485991 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__fct_transaction: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__fct_transaction"} */
drop view if exists "cfa"."public"."stg__fct_transaction__dbt_backup" cascade
13:18:34.488031 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85a897cc-2a49-4920-9f86-06a477ddc387', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f829ed6f9a0>]}
13:18:34.488698 [info ] [Thread-3  ]: 8 of 31 OK created view model public.lcarr_sosx_stg__dim_transaction_status..... [[32mCREATE VIEW[0m in 10.64s]
13:18:34.489399 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.stg__dim_transaction_status
13:18:34.489771 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.calc__dim_price_index_1
13:18:34.490471 [info ] [Thread-3  ]: 12 of 31 START view model public.lcarr_sosx_calc__dim_price_index_1............. [RUN]
13:18:34.491673 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_1"
13:18:34.491969 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.calc__dim_price_index_1
13:18:34.492316 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.calc__dim_price_index_1
13:18:34.498573 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.calc__dim_price_index_1"
13:18:34.499757 [debug] [Thread-3  ]: finished collecting timing info
13:18:34.500054 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.calc__dim_price_index_1
13:18:34.592221 [debug] [Thread-3  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.calc__dim_price_index_1"
13:18:34.593012 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_1"
13:18:34.593318 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_1: BEGIN
13:18:34.593603 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
13:18:34.593941 [debug] [Thread-3  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
13:18:34.788872 [debug] [Thread-4  ]: SQL status: DROP VIEW in 0.3 seconds
13:18:34.790483 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__fct_transaction: COMMIT
13:18:34.790778 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_transaction"
13:18:34.791276 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__fct_transaction: COMMIT
13:18:35.385305 [debug] [Thread-3  ]: SQL status: BEGIN in 0.79 seconds
13:18:35.386031 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_1"
13:18:35.386426 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_1: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.calc__dim_price_index_1"} */


  create view "cfa"."public"."calc__dim_price_index_1__dbt_tmp" as (
    with fcs_adj_sales as ( 
    select location_num,monthend_date, 
    month_sales,adjusted_sales,month_sales_pg1,adjusted_sales_pg1
    from "cfa"."public"."lcarr_sosx_stg__dim_adj_sales"
), location_attributes as ( 
    select location_num, dma_name
    from "cfa"."public"."lcarr_sosx_stg__dim_location"
), fcs_adj_sales_loc as ( 
    select b.dma_name,a.location_num,a.monthend_date,'1 month' as look_back_period,
    a.month_sales,a.adjusted_sales,a.month_sales_pg1,a.adjusted_sales_pg1
    from fcs_adj_sales a 
    inner join location_attributes b using (location_num)
)
select * from fcs_adj_sales_loc
  ) with no schema binding;

13:18:35.458784 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.07 seconds
13:18:35.463042 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_1"
13:18:35.463354 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_1: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.calc__dim_price_index_1"} */
alter table "cfa"."public"."lcarr_sosx_calc__dim_price_index_1" rename to "calc__dim_price_index_1__dbt_backup"
13:18:35.521762 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.06 seconds
13:18:35.526812 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_1"
13:18:35.527221 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_1: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.calc__dim_price_index_1"} */
alter table "cfa"."public"."calc__dim_price_index_1__dbt_tmp" rename to "lcarr_sosx_calc__dim_price_index_1"
13:18:35.583783 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.06 seconds
13:18:35.586192 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_1: COMMIT
13:18:35.586590 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_1"
13:18:35.586908 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_1: COMMIT
13:18:38.284217 [debug] [Thread-3  ]: SQL status: COMMIT in 2.7 seconds
13:18:38.284541 [debug] [Thread-4  ]: SQL status: COMMIT in 3.49 seconds
13:18:38.285145 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_transaction"
13:18:38.285462 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__fct_transaction: BEGIN
13:18:38.343166 [debug] [Thread-4  ]: SQL status: BEGIN in 0.06 seconds
13:18:38.344980 [debug] [Thread-4  ]: finished collecting timing info
13:18:38.345281 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__error"
13:18:38.345550 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__fct_transaction: ROLLBACK
13:18:38.345827 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.calc__error: BEGIN
13:18:38.456179 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__fct_transaction: Close
13:18:38.456681 [debug] [Thread-1  ]: SQL status: BEGIN in 0.11 seconds
13:18:38.461897 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__error"
13:18:38.462443 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85a897cc-2a49-4920-9f86-06a477ddc387', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f829ed88d90>]}
13:18:38.462896 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.calc__error: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.calc__error"} */
drop view if exists "cfa"."public"."calc__error__dbt_backup" cascade
13:18:38.463794 [info ] [Thread-4  ]: 9 of 31 OK created view model public.lcarr_sosx_stg__fct_transaction............ [[32mCREATE VIEW[0m in 13.04s]
13:18:38.464278 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.stg__fct_transaction
13:18:38.464763 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.stg__fct_item
13:18:38.465562 [info ] [Thread-4  ]: 13 of 31 START view model public.lcarr_sosx_stg__fct_item....................... [RUN]
13:18:38.466580 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.stg__fct_item"
13:18:38.467239 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.stg__fct_item
13:18:38.467579 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.stg__fct_item
13:18:38.474422 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.stg__fct_item"
13:18:38.475460 [debug] [Thread-4  ]: finished collecting timing info
13:18:38.475724 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.stg__fct_item
13:18:38.580693 [debug] [Thread-4  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.stg__fct_item"
13:18:38.581831 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_item"
13:18:38.582209 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__fct_item: BEGIN
13:18:38.582511 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
13:18:38.582820 [debug] [Thread-4  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
13:18:38.920757 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.46 seconds
13:18:38.922248 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.calc__error: COMMIT
13:18:38.922637 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__error"
13:18:38.922871 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.calc__error: COMMIT
13:18:39.258195 [debug] [Thread-4  ]: SQL status: BEGIN in 0.68 seconds
13:18:39.258578 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_item"
13:18:39.258810 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__fct_item: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__fct_item"} */


  create view "cfa"."public"."stg__fct_item__dbt_tmp" as (
    

with trans_status as ( 
    select status, cancelled_flg
    from "cfa"."public"."lcarr_sosx_stg__dim_transaction_status"
), item as (
    select business_date, location_num, trans_id,
    item_pin as pin, item_sold_count, item_promo_count
    from "cfa"."pos"."trans_item"
    inner join trans_status using (status)
    where trans_status.cancelled_flg is false
    and (business_date between '2022-02-01' and '2022-02-28'
    or business_date between '2021-02-01' and '2021-02-28'))

select *
from item
  ) with no schema binding;

13:18:39.336321 [debug] [Thread-4  ]: SQL status: CREATE VIEW in 0.08 seconds
13:18:39.342878 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_item"
13:18:39.343235 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__fct_item: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__fct_item"} */
alter table "cfa"."public"."lcarr_sosx_stg__fct_item" rename to "stg__fct_item__dbt_backup"
13:18:39.400267 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.06 seconds
13:18:39.403581 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_item"
13:18:39.403896 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__fct_item: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__fct_item"} */
alter table "cfa"."public"."stg__fct_item__dbt_tmp" rename to "lcarr_sosx_stg__fct_item"
13:18:39.460539 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.06 seconds
13:18:39.462411 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__fct_item: COMMIT
13:18:39.462696 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_item"
13:18:39.462891 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__fct_item: COMMIT
13:18:44.428744 [debug] [Thread-4  ]: SQL status: COMMIT in 4.97 seconds
13:18:44.429700 [debug] [Thread-1  ]: SQL status: COMMIT in 5.51 seconds
13:18:44.430834 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__error"
13:18:44.431182 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.calc__error: BEGIN
13:18:44.489598 [debug] [Thread-1  ]: SQL status: BEGIN in 0.06 seconds
13:18:44.490993 [debug] [Thread-1  ]: finished collecting timing info
13:18:44.491606 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.calc__error: ROLLBACK
13:18:44.492159 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_same_store"
13:18:44.492593 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__dim_same_store: BEGIN
13:18:44.594368 [debug] [Thread-2  ]: SQL status: BEGIN in 0.1 seconds
13:18:44.594734 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.calc__error: Close
13:18:44.601653 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_same_store"
13:18:44.602287 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__dim_same_store: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__dim_same_store"} */
drop view if exists "cfa"."public"."stg__dim_same_store__dbt_backup" cascade
13:18:44.604055 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85a897cc-2a49-4920-9f86-06a477ddc387', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f829ec648b0>]}
13:18:44.605447 [info ] [Thread-1  ]: 10 of 31 OK created view model public.lcarr_sosx_calc__error.................... [[32mCREATE VIEW[0m in 15.61s]
13:18:44.606233 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.calc__error
13:18:44.606623 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.stg__fct_tender
13:18:44.607261 [info ] [Thread-1  ]: 14 of 31 START view model public.lcarr_sosx_stg__fct_tender..................... [RUN]
13:18:44.608383 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.stg__fct_tender"
13:18:44.609036 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.stg__fct_tender
13:18:44.610108 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.stg__fct_tender
13:18:44.620341 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.stg__fct_tender"
13:18:44.624303 [debug] [Thread-1  ]: finished collecting timing info
13:18:44.624722 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.stg__fct_tender
13:18:44.743458 [debug] [Thread-1  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.stg__fct_tender"
13:18:44.757087 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_tender"
13:18:44.757521 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.stg__fct_tender: BEGIN
13:18:44.757845 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
13:18:44.758252 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
13:18:44.815244 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.21 seconds
13:18:44.816850 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__dim_same_store: COMMIT
13:18:44.817205 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_same_store"
13:18:44.817517 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__dim_same_store: COMMIT
13:18:45.516619 [debug] [Thread-1  ]: SQL status: BEGIN in 0.76 seconds
13:18:45.517016 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_tender"
13:18:45.517964 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.stg__fct_tender: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__fct_tender"} */


  create view "cfa"."public"."stg__fct_tender__dbt_tmp" as (
    

with trans_status as ( 
    select status, cancelled_flg
    from "cfa"."public"."lcarr_sosx_stg__dim_transaction_status"
), tender as (
    select business_date,location_num,trans_id,
        destination_code,destination_desc,tender_type,tender_description
    from "cfa"."pos"."trans_tender"
    inner join trans_status using (status)
    where trans_status.cancelled_flg is false
    and (business_date between '2022-02-01' and '2022-02-28'
    or business_date between '2021-02-01' and '2021-02-28'))

select *
from tender
  ) with no schema binding;

13:18:45.612540 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.09 seconds
13:18:45.616543 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_tender"
13:18:45.616823 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.stg__fct_tender: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__fct_tender"} */
alter table "cfa"."public"."lcarr_sosx_stg__fct_tender" rename to "stg__fct_tender__dbt_backup"
13:18:45.675503 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.06 seconds
13:18:45.679629 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_tender"
13:18:45.680037 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.stg__fct_tender: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__fct_tender"} */
alter table "cfa"."public"."stg__fct_tender__dbt_tmp" rename to "lcarr_sosx_stg__fct_tender"
13:18:45.735578 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.06 seconds
13:18:45.738659 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.stg__fct_tender: COMMIT
13:18:45.739134 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_tender"
13:18:45.739840 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.stg__fct_tender: COMMIT
13:18:47.807204 [debug] [Thread-2  ]: SQL status: COMMIT in 2.99 seconds
13:18:47.807695 [debug] [Thread-1  ]: SQL status: COMMIT in 2.07 seconds
13:18:47.808010 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__dim_same_store"
13:18:47.808535 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__dim_same_store: BEGIN
13:18:47.870264 [debug] [Thread-2  ]: SQL status: BEGIN in 0.06 seconds
13:18:47.871560 [debug] [Thread-2  ]: finished collecting timing info
13:18:47.872048 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__dim_same_store: ROLLBACK
13:18:47.872461 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_1"
13:18:47.872883 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_1: BEGIN
13:18:47.972350 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.stg__dim_same_store: Close
13:18:47.972763 [debug] [Thread-3  ]: SQL status: BEGIN in 0.1 seconds
13:18:47.977317 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_1"
13:18:47.977862 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85a897cc-2a49-4920-9f86-06a477ddc387', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f829ec64a00>]}
13:18:47.978388 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_1: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.calc__dim_price_index_1"} */
drop view if exists "cfa"."public"."calc__dim_price_index_1__dbt_backup" cascade
13:18:47.979342 [info ] [Thread-2  ]: 11 of 31 OK created view model public.lcarr_sosx_stg__dim_same_store............ [[32mCREATE VIEW[0m in 17.49s]
13:18:47.980036 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.stg__dim_same_store
13:18:47.980467 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.transaction
13:18:47.980947 [info ] [Thread-2  ]: 15 of 31 START table model public.lcarr_sosx_transaction........................ [RUN]
13:18:47.981683 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.transaction"
13:18:47.981898 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.transaction
13:18:47.982089 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.transaction
13:18:47.986041 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.transaction"
13:18:47.992727 [debug] [Thread-2  ]: finished collecting timing info
13:18:47.993403 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.transaction
13:18:48.097632 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.12 seconds
13:18:48.106679 [debug] [Thread-2  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.transaction"
13:18:48.107745 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_1: COMMIT
13:18:48.108408 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_1"
13:18:48.108643 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_1: COMMIT
13:18:48.110000 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.transaction"
13:18:48.110273 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.transaction: BEGIN
13:18:48.110495 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
13:18:48.110696 [debug] [Thread-2  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
13:18:48.873196 [debug] [Thread-2  ]: SQL status: BEGIN in 0.76 seconds
13:18:48.873639 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.transaction"
13:18:48.873960 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.transaction: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.transaction"} */


  create  table
    "cfa"."public"."transaction__dbt_tmp"
    
    
    
  as (
    with fct_transaction as ( 
    select business_date, location_num, trans_id,
    monthend_date, quarter, end_hour_min,
    destination_code, destination_desc, 
    tax_amount, delivery_tip, sales_sub_total,
    cfa_one_id, customer_hash
    from "cfa"."public"."lcarr_sosx_stg__fct_transaction"
), location as ( 
    select location_num, service_team_name, location_type_code,
        region_name, dma_name 
    from "cfa"."public"."lcarr_sosx_stg__dim_location"
), daypart as ( 
    select end_hour_min,daypart
    from "cfa"."public"."lcarr_sosx_stg__dim_daypart" 
), destination as ( 
    select destination_code, destination_desc, dest_alias
    from "cfa"."public"."lcarr_sosx_stg__dim_destination"
), transaction as ( 
    select business_date, location_num, trans_id, daypart,
        monthend_date, quarter,
        destination_code, destination_desc, dest_alias,
        service_team_name, location_type_code, 
        region_name, dma_name,
        cfa_one_id, customer_hash,
        tax_amount, delivery_tip, 
        sales_sub_total,
        case when customer_hash <> '' and customer_hash <> ' ' 
             and  customer_hash is not null
        then 1 else 0 end as visit_count
    from fct_transaction
    inner join location using (location_num)
    inner join destination using (destination_code,destination_desc) 
    inner join daypart using (end_hour_min)
)

select *
from transaction
  );
13:18:49.650656 [debug] [Thread-3  ]: SQL status: COMMIT in 1.54 seconds
13:18:49.651134 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_1"
13:18:49.651410 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_1: BEGIN
13:18:49.712668 [debug] [Thread-3  ]: SQL status: BEGIN in 0.06 seconds
13:18:49.713625 [debug] [Thread-3  ]: finished collecting timing info
13:18:49.713989 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_1: ROLLBACK
13:18:49.714325 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_item"
13:18:49.714835 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__fct_item: BEGIN
13:18:49.818193 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_1: Close
13:18:49.818753 [debug] [Thread-4  ]: SQL status: BEGIN in 0.1 seconds
13:18:49.823171 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_item"
13:18:49.823785 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85a897cc-2a49-4920-9f86-06a477ddc387', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f829ec64af0>]}
13:18:49.824074 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__fct_item: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__fct_item"} */
drop view if exists "cfa"."public"."stg__fct_item__dbt_backup" cascade
13:18:49.824832 [info ] [Thread-3  ]: 12 of 31 OK created view model public.lcarr_sosx_calc__dim_price_index_1........ [[32mCREATE VIEW[0m in 15.33s]
13:18:49.825345 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.calc__dim_price_index_1
13:18:49.825691 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.stg__fct_same_store
13:18:49.827056 [info ] [Thread-3  ]: 16 of 31 START view model public.lcarr_sosx_stg__fct_same_store................. [RUN]
13:18:49.827899 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.stg__fct_same_store"
13:18:49.828142 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.stg__fct_same_store
13:18:49.828361 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.stg__fct_same_store
13:18:49.832153 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.stg__fct_same_store"
13:18:49.833389 [debug] [Thread-3  ]: finished collecting timing info
13:18:49.833810 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.stg__fct_same_store
13:18:49.909006 [debug] [Thread-3  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.stg__fct_same_store"
13:18:49.909758 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_same_store"
13:18:49.909980 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__fct_same_store: BEGIN
13:18:49.910248 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
13:18:49.910681 [debug] [Thread-3  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
13:18:49.993804 [debug] [Thread-4  ]: SQL status: DROP VIEW in 0.17 seconds
13:18:49.995083 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__fct_item: COMMIT
13:18:49.995610 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_item"
13:18:49.996016 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__fct_item: COMMIT
13:18:50.692111 [debug] [Thread-3  ]: SQL status: BEGIN in 0.78 seconds
13:18:50.692623 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_same_store"
13:18:50.692902 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__fct_same_store: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__fct_same_store"} */


  create view "cfa"."public"."stg__fct_same_store__dbt_tmp" as (
    with subset_1 as ( 
  select * 
  from "cfa"."public"."lcarr_sosx_stg__dim_same_store"
  where monthend_date = cast('02-28-2022' as date) 
), subset_2 as ( 
  select * 
  from "cfa"."public"."lcarr_sosx_stg__dim_same_store"
  where monthend_date = cast('02-28-2021' as date) 
), current_comparison as (
  select s1.location_num,
  s1.look_back_period,s1.monthend_date,
  s1.actual_days as current_actual_days,s1.avail_days as current_avail_days,
  s1.same_store_percent as current_same_store_percent,
  s1.previous_year_monthend_date,
  s2.monthend_date as date_check,
  s2.actual_days as previous_actual_days,
  s2.avail_days as previous_avail_days,
  s2.same_store_percent as previous_same_store_percent
  from subset_1 s1
  inner join subset_2 s2
  on s1.location_num = s2.location_num 
  and s1.look_back_period = s2.look_back_period
  and s1.previous_year_monthend_date = s2.monthend_date
), same_store_eligibility_calc as ( 
  select location_num,look_back_period,monthend_date,
  current_actual_days,current_avail_days,current_same_store_percent,
  previous_year_monthend_date,previous_actual_days,
  previous_avail_days,previous_same_store_percent,
  case when current_same_store_percent >= 0.90
  and previous_same_store_percent >= 0.90 then 1 else 0 end as same_store_eligible
  from current_comparison
), same_store_final_output as (
  select location_num,look_back_period,monthend_date,
  current_actual_days as actual_days,current_avail_days as avail_days,
  same_store_eligible from same_store_eligibility_calc
  union 
  select location_num,look_back_period,previous_year_monthend_date as monthend_date,
  previous_actual_days as actual_days,previous_avail_days as avail_days,
  same_store_eligible from same_store_eligibility_calc
)
select * from same_store_final_output
  ) with no schema binding;

13:18:50.833336 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.14 seconds
13:18:50.837652 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_same_store"
13:18:50.837960 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__fct_same_store: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__fct_same_store"} */
alter table "cfa"."public"."lcarr_sosx_stg__fct_same_store" rename to "stg__fct_same_store__dbt_backup"
13:18:50.896569 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.06 seconds
13:18:50.899593 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_same_store"
13:18:50.900046 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__fct_same_store: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__fct_same_store"} */
alter table "cfa"."public"."stg__fct_same_store__dbt_tmp" rename to "lcarr_sosx_stg__fct_same_store"
13:18:50.980137 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.08 seconds
13:18:50.982079 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__fct_same_store: COMMIT
13:18:50.982466 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_same_store"
13:18:50.982677 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__fct_same_store: COMMIT
13:18:52.987188 [debug] [Thread-4  ]: SQL status: COMMIT in 2.99 seconds
13:18:52.987856 [debug] [Thread-3  ]: SQL status: COMMIT in 2.0 seconds
13:18:52.988173 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_item"
13:18:52.988702 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__fct_item: BEGIN
13:18:53.047884 [debug] [Thread-4  ]: SQL status: BEGIN in 0.06 seconds
13:18:53.048934 [debug] [Thread-4  ]: finished collecting timing info
13:18:53.049269 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_tender"
13:18:53.049556 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__fct_item: ROLLBACK
13:18:53.049815 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.stg__fct_tender: BEGIN
13:18:53.149344 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.stg__fct_item: Close
13:18:53.149975 [debug] [Thread-1  ]: SQL status: BEGIN in 0.1 seconds
13:18:53.154238 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_tender"
13:18:53.154881 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85a897cc-2a49-4920-9f86-06a477ddc387', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f829ec64c10>]}
13:18:53.155185 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.stg__fct_tender: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__fct_tender"} */
drop view if exists "cfa"."public"."stg__fct_tender__dbt_backup" cascade
13:18:53.155662 [info ] [Thread-4  ]: 13 of 31 OK created view model public.lcarr_sosx_stg__fct_item.................. [[32mCREATE VIEW[0m in 14.69s]
13:18:53.156995 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.stg__fct_item
13:18:53.157623 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.item
13:18:53.158070 [info ] [Thread-4  ]: 17 of 31 START table model public.lcarr_sosx_item............................... [RUN]
13:18:53.159062 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.item"
13:18:53.159424 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.item
13:18:53.159729 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.item
13:18:53.163861 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.item"
13:18:53.166895 [debug] [Thread-4  ]: finished collecting timing info
13:18:53.167851 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.item
13:18:53.234889 [debug] [Thread-4  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.item"
13:18:53.236694 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.item"
13:18:53.237674 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.item: BEGIN
13:18:53.237915 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
13:18:53.238141 [debug] [Thread-4  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
13:18:53.523804 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.37 seconds
13:18:53.525125 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.stg__fct_tender: COMMIT
13:18:53.525459 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_tender"
13:18:53.525872 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.stg__fct_tender: COMMIT
13:18:54.082249 [debug] [Thread-4  ]: SQL status: BEGIN in 0.84 seconds
13:18:54.082732 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.item"
13:18:54.082978 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.item: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.item"} */


  create  table
    "cfa"."public"."item__dbt_tmp"
    
    
    
  as (
    with fct_item as ( 
    select business_date, location_num, trans_id, pin,
    item_sold_count, item_promo_count
    from "cfa"."public"."lcarr_sosx_stg__fct_item"
), location as ( 
    select location_num, service_team_name, location_type_code,
    region_name, dma_name 
    from "cfa"."public"."lcarr_sosx_stg__dim_location"
), dim_item as ( 
    select pin, hierarchy_1
    from "cfa"."public"."lcarr_sosx_stg__dim_item"
), item as ( 
    select business_date, location_num, trans_id,
        sum(item_sold_count) as total_items_sold_count,
        sum(item_promo_count) as total_items_promo_count
    from fct_item
    inner join dim_item using (pin)
    inner join location using (location_num)
    where hierarchy_1 <> ''
        and hierarchy_1 <> ' '
        and hierarchy_1 is not null
        and hierarchy_1 not in ('Non-Food','Miscellaneous') 
    group by 1, 2, 3
)

select *
from item
  );
13:18:54.754606 [debug] [Thread-1  ]: SQL status: COMMIT in 1.23 seconds
13:18:54.755067 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_tender"
13:18:54.755303 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.stg__fct_tender: BEGIN
13:18:54.815174 [debug] [Thread-1  ]: SQL status: BEGIN in 0.06 seconds
13:18:54.816091 [debug] [Thread-1  ]: finished collecting timing info
13:18:54.816486 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_same_store"
13:18:54.816742 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.stg__fct_tender: ROLLBACK
13:18:54.817072 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__fct_same_store: BEGIN
13:18:54.921448 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.stg__fct_tender: Close
13:18:54.922333 [debug] [Thread-3  ]: SQL status: BEGIN in 0.1 seconds
13:18:54.927755 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_same_store"
13:18:54.928510 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85a897cc-2a49-4920-9f86-06a477ddc387', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f829ed84520>]}
13:18:54.928938 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__fct_same_store: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.stg__fct_same_store"} */
drop view if exists "cfa"."public"."stg__fct_same_store__dbt_backup" cascade
13:18:54.929737 [info ] [Thread-1  ]: 14 of 31 OK created view model public.lcarr_sosx_stg__fct_tender................ [[32mCREATE VIEW[0m in 10.32s]
13:18:54.930464 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.stg__fct_tender
13:18:54.931701 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.tender
13:18:54.932262 [info ] [Thread-1  ]: 18 of 31 START table model public.lcarr_sosx_tender............................. [RUN]
13:18:54.933224 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.tender"
13:18:54.933563 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.tender
13:18:54.933889 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.tender
13:18:54.939518 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.tender"
13:18:54.941197 [debug] [Thread-1  ]: finished collecting timing info
13:18:54.941573 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.tender
13:18:55.110385 [debug] [Thread-1  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.tender"
13:18:55.111960 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.tender"
13:18:55.112318 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.tender: BEGIN
13:18:55.112609 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
13:18:55.113075 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
13:18:55.122112 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.19 seconds
13:18:55.123768 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__fct_same_store: COMMIT
13:18:55.124174 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_same_store"
13:18:55.124503 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__fct_same_store: COMMIT
13:18:55.751910 [debug] [Thread-1  ]: SQL status: BEGIN in 0.64 seconds
13:18:55.752315 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.tender"
13:18:55.752536 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.tender: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.tender"} */


  create  table
    "cfa"."public"."tender__dbt_tmp"
    
    
    
  as (
    with fct_tender as ( 
    select business_date, location_num, trans_id,
    tender_description, destination_desc
    from "cfa"."public"."lcarr_sosx_stg__fct_tender"
), location as ( 
    select location_num, service_team_name, location_type_code,
    region_name, dma_name 
    from "cfa"."public"."lcarr_sosx_stg__dim_location"
), tender as ( 
    select business_date, location_num, trans_id, 
       -- destination_desc, tender_description, tender_type, 
       max(case when tender_description = 'Credit' then 1
            when tender_description in ('Exact Dollar', 'On Demand', 'CFA Card', '$20', 'Cash', 'Next Dollar', '$10') then 0
	        when tender_description not like '%Credit%'
	             or destination_desc='' or destination_desc=' ' or destination_desc is null
	             or destination_desc='Other' then 0
	   else 1 end) as credit_flag
 from fct_tender
 inner join location using (location_num) 
 group by 1, 2, 3
)

select *
from tender
  );
13:18:56.210632 [debug] [Thread-3  ]: SQL status: COMMIT in 1.09 seconds
13:18:56.211232 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.stg__fct_same_store"
13:18:56.211486 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__fct_same_store: BEGIN
13:18:56.269109 [debug] [Thread-3  ]: SQL status: BEGIN in 0.06 seconds
13:18:56.269999 [debug] [Thread-3  ]: finished collecting timing info
13:18:56.270432 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__fct_same_store: ROLLBACK
13:18:56.371805 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.stg__fct_same_store: Close
13:18:56.373084 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85a897cc-2a49-4920-9f86-06a477ddc387', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f829ed6faf0>]}
13:18:56.373645 [info ] [Thread-3  ]: 16 of 31 OK created view model public.lcarr_sosx_stg__fct_same_store............ [[32mCREATE VIEW[0m in 6.55s]
13:18:56.374106 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.stg__fct_same_store
13:18:56.374791 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.calc__dim_price_index_2
13:18:56.375232 [info ] [Thread-3  ]: 19 of 31 START view model public.lcarr_sosx_calc__dim_price_index_2............. [RUN]
13:18:56.375900 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_2"
13:18:56.376156 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.calc__dim_price_index_2
13:18:56.376683 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.calc__dim_price_index_2
13:18:56.380491 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.calc__dim_price_index_2"
13:18:56.383461 [debug] [Thread-3  ]: finished collecting timing info
13:18:56.383895 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.calc__dim_price_index_2
13:18:56.456072 [debug] [Thread-3  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.calc__dim_price_index_2"
13:18:56.459073 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_2"
13:18:56.459376 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_2: BEGIN
13:18:56.459552 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
13:18:56.459739 [debug] [Thread-3  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
13:18:57.158860 [debug] [Thread-3  ]: SQL status: BEGIN in 0.7 seconds
13:18:57.159403 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_2"
13:18:57.159706 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_2: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.calc__dim_price_index_2"} */


  create view "cfa"."public"."calc__dim_price_index_2__dbt_tmp" as (
    with add_same_store_flag as ( 
  SELECT a.dma_name,
  a.location_num,
  a.monthend_date,
  a.look_back_period,
  a.month_sales,
  a.adjusted_sales,
  a.month_sales_pg1,
  a.adjusted_sales_pg1,
  b.same_store_eligible
  FROM "cfa"."public"."lcarr_sosx_calc__dim_price_index_1" a
  inner join "cfa"."public"."lcarr_sosx_stg__fct_same_store" b
  on a.location_num = b.location_num
  and a.monthend_date = b.monthend_date 
), market_aggregation_all_stores as ( 
  select monthend_date,look_back_period,'All Stores' as same_store,
  sum(month_sales) as market_month_sales,
  sum(adjusted_sales) as market_adjusted_sales,
  sum(month_sales_pg1) as market_month_sales_pg1,
  sum(adjusted_sales_pg1) as market_adjusted_sales_pg1
  from add_same_store_flag
  group by 1,2
), market_aggregation_same_stores as ( 
  select monthend_date,look_back_period,'Same Stores' as same_store,
  sum(month_sales) as market_month_sales,
  sum(adjusted_sales) as market_adjusted_sales,
  sum(month_sales_pg1) as market_month_sales_pg1,
  sum(adjusted_sales_pg1) as market_adjusted_sales_pg1
  from add_same_store_flag
  where same_store_eligible = 1
  group by 1,2
), union_all_same_store as ( 
  select monthend_date,look_back_period,same_store,
  market_month_sales,market_adjusted_sales,
  market_month_sales_pg1,market_adjusted_sales_pg1
  from market_aggregation_all_stores
  union
  select monthend_date,look_back_period,same_store,
  market_month_sales,market_adjusted_sales,
  market_month_sales_pg1,market_adjusted_sales_pg1
  from market_aggregation_same_stores
), base_calcs as (
  SELECT monthend_date,look_back_period,same_store,
  market_month_sales,market_adjusted_sales,market_month_sales_pg1,market_adjusted_sales_pg1,
  case when market_adjusted_sales_pg1 = 0.00 then 0.00 else 
  cast(market_month_sales_pg1/market_adjusted_sales_pg1 as float) end as pg1_ratio,
  case when market_month_sales_pg1 = 0.00 then 0.00 else
  cast(market_month_sales/market_month_sales_pg1 as float) end as actual_vs_pg1
  from union_all_same_store
)
select * from base_calcs
  ) with no schema binding;

13:18:57.332883 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.17 seconds
13:18:57.336496 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_2"
13:18:57.336770 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_2: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.calc__dim_price_index_2"} */
alter table "cfa"."public"."lcarr_sosx_calc__dim_price_index_2" rename to "calc__dim_price_index_2__dbt_backup"
13:18:57.395499 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.06 seconds
13:18:57.399266 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_2"
13:18:57.399600 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_2: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.calc__dim_price_index_2"} */
alter table "cfa"."public"."calc__dim_price_index_2__dbt_tmp" rename to "lcarr_sosx_calc__dim_price_index_2"
13:18:57.455690 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.06 seconds
13:18:57.457907 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_2: COMMIT
13:18:57.458233 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_2"
13:18:57.458453 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_2: COMMIT
13:18:58.971952 [debug] [Thread-3  ]: SQL status: COMMIT in 1.51 seconds
13:18:58.972811 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_2"
13:18:58.973110 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_2: BEGIN
13:18:59.033938 [debug] [Thread-3  ]: SQL status: BEGIN in 0.06 seconds
13:18:59.040453 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_2"
13:18:59.040779 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_2: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.calc__dim_price_index_2"} */
drop view if exists "cfa"."public"."calc__dim_price_index_2__dbt_backup" cascade
13:18:59.177012 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.14 seconds
13:18:59.178581 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_2: COMMIT
13:18:59.179016 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_2"
13:18:59.179329 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_2: COMMIT
13:19:00.374906 [debug] [Thread-3  ]: SQL status: COMMIT in 1.2 seconds
13:19:00.376091 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_2"
13:19:00.376600 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_2: BEGIN
13:19:00.436210 [debug] [Thread-3  ]: SQL status: BEGIN in 0.06 seconds
13:19:00.437289 [debug] [Thread-3  ]: finished collecting timing info
13:19:00.437817 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_2: ROLLBACK
13:19:00.539130 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_2: Close
13:19:00.540529 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85a897cc-2a49-4920-9f86-06a477ddc387', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f829ecffdc0>]}
13:19:00.541325 [info ] [Thread-3  ]: 19 of 31 OK created view model public.lcarr_sosx_calc__dim_price_index_2........ [[32mCREATE VIEW[0m in 4.16s]
13:19:00.542121 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.calc__dim_price_index_2
13:19:00.543390 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.calc__dim_price_index_3
13:19:00.544360 [info ] [Thread-3  ]: 20 of 31 START view model public.lcarr_sosx_calc__dim_price_index_3............. [RUN]
13:19:00.545402 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_3"
13:19:00.545805 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.calc__dim_price_index_3
13:19:00.546242 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.calc__dim_price_index_3
13:19:00.551466 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.calc__dim_price_index_3"
13:19:00.553554 [debug] [Thread-3  ]: finished collecting timing info
13:19:00.553991 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.calc__dim_price_index_3
13:19:00.629566 [debug] [Thread-3  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.calc__dim_price_index_3"
13:19:00.630626 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_3"
13:19:00.630944 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_3: BEGIN
13:19:00.631152 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
13:19:00.631356 [debug] [Thread-3  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
13:19:01.906846 [debug] [Thread-3  ]: SQL status: BEGIN in 1.28 seconds
13:19:01.907444 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_3"
13:19:01.907695 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_3: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.calc__dim_price_index_3"} */


  create view "cfa"."public"."calc__dim_price_index_3__dbt_tmp" as (
    with min_monthend_date as ( 
    select look_back_period,same_store,min(monthend_date) as min_monthend_date
    from "cfa"."public"."lcarr_sosx_calc__dim_price_index_2"
    group by 1,2
), anchor_calc as ( 
    select m.look_back_period,m.same_store,m.min_monthend_date,bc.pg1_ratio as anchor_ratio
    from min_monthend_date m
    inner join "cfa"."public"."lcarr_sosx_calc__dim_price_index_2" bc 
    on m.look_back_period = bc.look_back_period
    and m.same_store = bc.same_store
    and m.min_monthend_date = bc.monthend_date
), market_big_join as (
    select bc.*, ac.min_monthend_date, ac.anchor_ratio
    from "cfa"."public"."lcarr_sosx_calc__dim_price_index_2" bc 
    inner join anchor_calc ac
    on bc.look_back_period = ac.look_back_period
    and bc.same_store = ac.same_store
), ratio_change as ( 
    select *, pg1_ratio/anchor_ratio as pg1_ratio_change
    from market_big_join
), price_index_final as ( 
    select look_back_period,monthend_date,same_store,actual_vs_pg1*pg1_ratio_change as price_index
    from ratio_change
)
select * from price_index_final
  ) with no schema binding;

13:19:01.985686 [debug] [Thread-3  ]: SQL status: CREATE VIEW in 0.08 seconds
13:19:01.989583 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_3"
13:19:01.989870 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_3: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.calc__dim_price_index_3"} */
alter table "cfa"."public"."lcarr_sosx_calc__dim_price_index_3" rename to "calc__dim_price_index_3__dbt_backup"
13:19:02.047715 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.06 seconds
13:19:02.051340 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_3"
13:19:02.051647 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_3: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.calc__dim_price_index_3"} */
alter table "cfa"."public"."calc__dim_price_index_3__dbt_tmp" rename to "lcarr_sosx_calc__dim_price_index_3"
13:19:02.107461 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.06 seconds
13:19:02.109272 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_3: COMMIT
13:19:02.109578 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_3"
13:19:02.109805 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_3: COMMIT
13:19:03.170181 [debug] [Thread-3  ]: SQL status: COMMIT in 1.06 seconds
13:19:03.170945 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_3"
13:19:03.171288 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_3: BEGIN
13:19:03.231476 [debug] [Thread-3  ]: SQL status: BEGIN in 0.06 seconds
13:19:03.235966 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_3"
13:19:03.236320 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_3: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.calc__dim_price_index_3"} */
drop view if exists "cfa"."public"."calc__dim_price_index_3__dbt_backup" cascade
13:19:03.359619 [debug] [Thread-3  ]: SQL status: DROP VIEW in 0.12 seconds
13:19:03.361263 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_3: COMMIT
13:19:03.361553 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_3"
13:19:03.361779 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_3: COMMIT
13:19:05.593677 [debug] [Thread-3  ]: SQL status: COMMIT in 2.23 seconds
13:19:05.594069 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_3"
13:19:05.594324 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_3: BEGIN
13:19:05.652418 [debug] [Thread-3  ]: SQL status: BEGIN in 0.06 seconds
13:19:05.653270 [debug] [Thread-3  ]: finished collecting timing info
13:19:05.653736 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_3: ROLLBACK
13:19:05.770259 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.calc__dim_price_index_3: Close
13:19:05.771537 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85a897cc-2a49-4920-9f86-06a477ddc387', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f829ec1c370>]}
13:19:05.772145 [info ] [Thread-3  ]: 20 of 31 OK created view model public.lcarr_sosx_calc__dim_price_index_3........ [[32mCREATE VIEW[0m in 5.23s]
13:19:05.772847 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.calc__dim_price_index_3
13:25:30.462329 [debug] [Thread-4  ]: SQL status: SELECT in 396.38 seconds
13:25:30.470451 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.item"
13:25:30.470777 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.item: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.item"} */
alter table "cfa"."public"."lcarr_sosx_item" rename to "item__dbt_backup"
13:25:30.549716 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.08 seconds
13:25:30.555271 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.item"
13:25:30.555913 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.item: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.item"} */
alter table "cfa"."public"."item__dbt_tmp" rename to "lcarr_sosx_item"
13:25:30.618362 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.06 seconds
13:25:30.631913 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.item: COMMIT
13:25:30.632408 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.item"
13:25:30.632771 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.item: COMMIT
13:25:35.824151 [debug] [Thread-4  ]: SQL status: COMMIT in 5.19 seconds
13:25:35.825046 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.item"
13:25:35.825653 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.item: BEGIN
13:25:35.892297 [debug] [Thread-4  ]: SQL status: BEGIN in 0.07 seconds
13:25:35.898128 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.item"
13:25:35.898954 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.item: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.item"} */
drop table if exists "cfa"."public"."item__dbt_backup" cascade
13:25:36.035175 [debug] [Thread-4  ]: SQL status: DROP TABLE in 0.14 seconds
13:25:36.036856 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.item: COMMIT
13:25:36.037141 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.item"
13:25:36.037356 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.item: COMMIT
13:25:37.231356 [debug] [Thread-4  ]: SQL status: COMMIT in 1.19 seconds
13:25:37.231817 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.item"
13:25:37.232098 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.item: BEGIN
13:25:37.480986 [debug] [Thread-4  ]: SQL status: BEGIN in 0.25 seconds
13:25:37.482017 [debug] [Thread-4  ]: finished collecting timing info
13:25:37.482336 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.item: ROLLBACK
13:25:37.580687 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.item: Close
13:25:37.583192 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85a897cc-2a49-4920-9f86-06a477ddc387', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f829ed26ca0>]}
13:25:37.583831 [info ] [Thread-4  ]: 17 of 31 OK created table model public.lcarr_sosx_item.......................... [[32mSELECT[0m in 404.42s]
13:25:37.584326 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.item
13:26:01.991630 [debug] [Thread-1  ]: SQL status: SELECT in 426.24 seconds
13:26:01.996125 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.tender"
13:26:01.996439 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.tender: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.tender"} */
alter table "cfa"."public"."lcarr_sosx_tender" rename to "tender__dbt_backup"
13:26:02.067593 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.07 seconds
13:26:02.072196 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.tender"
13:26:02.072530 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.tender: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.tender"} */
alter table "cfa"."public"."tender__dbt_tmp" rename to "lcarr_sosx_tender"
13:26:02.133761 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.06 seconds
13:26:02.135882 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.tender: COMMIT
13:26:02.136173 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.tender"
13:26:02.136388 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.tender: COMMIT
13:26:04.609195 [debug] [Thread-1  ]: SQL status: COMMIT in 2.47 seconds
13:26:04.610208 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.tender"
13:26:04.610526 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.tender: BEGIN
13:26:04.676077 [debug] [Thread-1  ]: SQL status: BEGIN in 0.07 seconds
13:26:04.679798 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.tender"
13:26:04.680096 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.tender: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.tender"} */
drop table if exists "cfa"."public"."tender__dbt_backup" cascade
13:26:05.495624 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.82 seconds
13:26:05.499646 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.tender: COMMIT
13:26:05.500144 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.tender"
13:26:05.500420 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.tender: COMMIT
13:26:06.390174 [debug] [Thread-1  ]: SQL status: COMMIT in 0.89 seconds
13:26:06.390816 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.tender"
13:26:06.391075 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.tender: BEGIN
13:26:06.450926 [debug] [Thread-1  ]: SQL status: BEGIN in 0.06 seconds
13:26:06.452504 [debug] [Thread-1  ]: finished collecting timing info
13:26:06.453024 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.tender: ROLLBACK
13:26:06.551722 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.tender: Close
13:26:06.554015 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85a897cc-2a49-4920-9f86-06a477ddc387', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f829eabda00>]}
13:26:06.554621 [info ] [Thread-1  ]: 18 of 31 OK created table model public.lcarr_sosx_tender........................ [[32mSELECT[0m in 431.62s]
13:26:06.555113 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.tender
13:26:21.229527 [debug] [Thread-2  ]: SQL status: SELECT in 452.36 seconds
13:26:21.233792 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.transaction"
13:26:21.234116 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.transaction: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.transaction"} */
alter table "cfa"."public"."lcarr_sosx_transaction" rename to "transaction__dbt_backup"
13:26:21.291286 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.06 seconds
13:26:21.294751 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.transaction"
13:26:21.295073 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.transaction: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.transaction"} */
alter table "cfa"."public"."transaction__dbt_tmp" rename to "lcarr_sosx_transaction"
13:26:21.361413 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.06 seconds
13:26:21.363896 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.transaction: COMMIT
13:26:21.364291 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.transaction"
13:26:21.364582 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.transaction: COMMIT
13:26:24.424312 [debug] [Thread-2  ]: SQL status: COMMIT in 3.06 seconds
13:26:24.425103 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.transaction"
13:26:24.425399 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.transaction: BEGIN
13:26:24.488334 [debug] [Thread-2  ]: SQL status: BEGIN in 0.06 seconds
13:26:24.494153 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.transaction"
13:26:24.494481 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.transaction: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.transaction"} */
drop table if exists "cfa"."public"."transaction__dbt_backup" cascade
13:26:24.951769 [debug] [Thread-2  ]: SQL status: DROP TABLE in 0.46 seconds
13:26:24.953699 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.transaction: COMMIT
13:26:24.954015 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.transaction"
13:26:24.954423 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.transaction: COMMIT
13:26:26.209171 [debug] [Thread-2  ]: SQL status: COMMIT in 1.25 seconds
13:26:26.209622 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.transaction"
13:26:26.209892 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.transaction: BEGIN
13:26:26.276318 [debug] [Thread-2  ]: SQL status: BEGIN in 0.07 seconds
13:26:26.277287 [debug] [Thread-2  ]: finished collecting timing info
13:26:26.277615 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.transaction: ROLLBACK
13:26:26.520349 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.transaction: Close
13:26:26.521908 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85a897cc-2a49-4920-9f86-06a477ddc387', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f829edbad60>]}
13:26:26.522524 [info ] [Thread-2  ]: 15 of 31 OK created table model public.lcarr_sosx_transaction................... [[32mSELECT[0m in 458.54s]
13:26:26.523383 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.transaction
13:26:26.526872 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.trans_detail
13:26:26.527494 [info ] [Thread-3  ]: 21 of 31 START table model public.lcarr_sosx_trans_detail....................... [RUN]
13:26:26.528439 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.trans_detail"
13:26:26.528893 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.trans_detail
13:26:26.529219 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.trans_detail
13:26:26.534468 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.trans_detail"
13:26:26.535451 [debug] [Thread-3  ]: finished collecting timing info
13:26:26.536064 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.trans_detail
13:26:26.624412 [debug] [Thread-3  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.trans_detail"
13:26:26.626685 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.trans_detail"
13:26:26.627076 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.trans_detail: BEGIN
13:26:26.627377 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
13:26:26.627602 [debug] [Thread-3  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
13:26:28.196767 [debug] [Thread-3  ]: SQL status: BEGIN in 1.57 seconds
13:26:28.197250 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.trans_detail"
13:26:28.197528 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.trans_detail: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.trans_detail"} */


  create  table
    "cfa"."public"."trans_detail__dbt_tmp"
    
    
    
  as (
    with transaction as
(select business_date, location_num, trans_id,
        tax_amount, delivery_tip, destination_desc, dest_alias, daypart,
        sales_sub_total, cfa_one_id, customer_hash, visit_count, quarter, 
        monthend_date, region_name, dma_name, location_type_code, service_team_name
 from "cfa"."public"."lcarr_sosx_transaction"
),

tender as
(select business_date, location_num, trans_id, 
        credit_flag
 from "cfa"."public"."lcarr_sosx_tender"
),

trans_detail as
(select business_date, location_num, trans_id, daypart,
        sales_sub_total, cfa_one_id, customer_hash, visit_count,
        destination_desc, dest_alias, credit_flag, quarter, 
        monthend_date, region_name, dma_name, location_type_code, service_team_name
 from transaction
 inner join tender using (business_date, location_num, trans_id)
)

select * 
from trans_detail
  );
13:35:01.784678 [debug] [Thread-3  ]: SQL status: SELECT in 513.59 seconds
13:35:01.791075 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.trans_detail"
13:35:01.792023 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.trans_detail: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.trans_detail"} */
alter table "cfa"."public"."lcarr_sosx_trans_detail" rename to "trans_detail__dbt_backup"
13:35:02.091197 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.3 seconds
13:35:02.098032 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.trans_detail"
13:35:02.098569 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.trans_detail: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.trans_detail"} */
alter table "cfa"."public"."trans_detail__dbt_tmp" rename to "lcarr_sosx_trans_detail"
13:35:02.156348 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.06 seconds
13:35:02.158219 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.trans_detail: COMMIT
13:35:02.158501 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.trans_detail"
13:35:02.158711 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.trans_detail: COMMIT
13:35:05.002659 [debug] [Thread-3  ]: SQL status: COMMIT in 2.84 seconds
13:35:05.003737 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.trans_detail"
13:35:05.004074 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.trans_detail: BEGIN
13:35:05.063128 [debug] [Thread-3  ]: SQL status: BEGIN in 0.06 seconds
13:35:05.067012 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.trans_detail"
13:35:05.067353 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.trans_detail: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.trans_detail"} */
drop table if exists "cfa"."public"."trans_detail__dbt_backup" cascade
13:35:05.169243 [debug] [Thread-3  ]: SQL status: DROP TABLE in 0.1 seconds
13:35:05.171977 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.trans_detail: COMMIT
13:35:05.172535 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.trans_detail"
13:35:05.172810 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.trans_detail: COMMIT
13:35:06.218111 [debug] [Thread-3  ]: SQL status: COMMIT in 1.05 seconds
13:35:06.218826 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.trans_detail"
13:35:06.219287 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.trans_detail: BEGIN
13:35:06.276881 [debug] [Thread-3  ]: SQL status: BEGIN in 0.06 seconds
13:35:06.278278 [debug] [Thread-3  ]: finished collecting timing info
13:35:06.278579 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.trans_detail: ROLLBACK
13:35:06.378680 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.trans_detail: Close
13:35:06.380244 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85a897cc-2a49-4920-9f86-06a477ddc387', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f829e61cac0>]}
13:35:06.380922 [info ] [Thread-3  ]: 21 of 31 OK created table model public.lcarr_sosx_trans_detail.................. [[32mSELECT[0m in 519.85s]
13:35:06.381404 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.trans_detail
13:35:06.382321 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.trans_item
13:35:06.382942 [info ] [Thread-1  ]: 22 of 31 START table model public.lcarr_sosx_trans_item......................... [RUN]
13:35:06.383792 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.trans_item"
13:35:06.384065 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.trans_item
13:35:06.384300 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.trans_item
13:35:06.388441 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.trans_item"
13:35:06.389801 [debug] [Thread-1  ]: finished collecting timing info
13:35:06.390194 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.trans_item
13:35:06.478773 [debug] [Thread-1  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.trans_item"
13:35:06.481405 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.trans_item"
13:35:06.481865 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.trans_item: BEGIN
13:35:06.482185 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
13:35:06.482405 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
13:35:08.348338 [debug] [Thread-1  ]: SQL status: BEGIN in 1.87 seconds
13:35:08.349176 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.trans_item"
13:35:08.349508 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.trans_item: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.trans_item"} */


  create  table
    "cfa"."public"."trans_item__dbt_tmp"
    
    
    
  as (
    with trans_detail as
(select business_date, location_num, trans_id, 
        sales_sub_total, cfa_one_id, customer_hash, 
        visit_count, credit_flag, quarter, destination_desc, daypart, 
        monthend_date, region_name, dma_name, location_type_code, service_team_name
 from "cfa"."public"."lcarr_sosx_trans_detail"
),

item as
(select business_date, location_num, trans_id, 
        total_items_sold_count, total_items_promo_count
 from "cfa"."public"."lcarr_sosx_item"
),

trans_item as
(select business_date, location_num, trans_id, 
        sales_sub_total, cfa_one_id, customer_hash, 
        visit_count, credit_flag, quarter, destination_desc, daypart, 
        monthend_date, region_name, dma_name, location_type_code, service_team_name,
        nvl(total_items_sold_count, 0) as total_items_sold_count, 
        nvl(total_items_promo_count, 0) as total_items_promo_count
 from trans_detail
 inner join item using (business_date, location_num, trans_id)
)

select *
from trans_item
  );
13:41:18.676179 [debug] [Thread-1  ]: SQL status: SELECT in 370.33 seconds
13:41:18.683345 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.trans_item"
13:41:18.683680 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.trans_item: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.trans_item"} */
alter table "cfa"."public"."lcarr_sosx_trans_item" rename to "trans_item__dbt_backup"
13:41:18.743448 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.06 seconds
13:41:18.747421 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.trans_item"
13:41:18.747763 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.trans_item: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.trans_item"} */
alter table "cfa"."public"."trans_item__dbt_tmp" rename to "lcarr_sosx_trans_item"
13:41:18.806567 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.06 seconds
13:41:18.810966 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.trans_item: COMMIT
13:41:18.811453 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.trans_item"
13:41:18.811693 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.trans_item: COMMIT
13:41:22.967955 [debug] [Thread-1  ]: SQL status: COMMIT in 4.16 seconds
13:41:22.968764 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.trans_item"
13:41:22.969002 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.trans_item: BEGIN
13:41:23.025420 [debug] [Thread-1  ]: SQL status: BEGIN in 0.06 seconds
13:41:23.030987 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.trans_item"
13:41:23.031628 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.trans_item: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.trans_item"} */
drop table if exists "cfa"."public"."trans_item__dbt_backup" cascade
13:41:23.178958 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.15 seconds
13:41:23.181585 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.trans_item: COMMIT
13:41:23.181904 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.trans_item"
13:41:23.182163 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.trans_item: COMMIT
13:41:25.426427 [debug] [Thread-1  ]: SQL status: COMMIT in 2.24 seconds
13:41:25.427198 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.trans_item"
13:41:25.427553 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.trans_item: BEGIN
13:41:25.488449 [debug] [Thread-1  ]: SQL status: BEGIN in 0.06 seconds
13:41:25.489807 [debug] [Thread-1  ]: finished collecting timing info
13:41:25.490198 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.trans_item: ROLLBACK
13:41:25.590283 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.trans_item: Close
13:41:25.591907 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85a897cc-2a49-4920-9f86-06a477ddc387', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f829ed26040>]}
13:41:25.592536 [info ] [Thread-1  ]: 22 of 31 OK created table model public.lcarr_sosx_trans_item.................... [[32mSELECT[0m in 379.21s]
13:41:25.593111 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.trans_item
13:41:25.594148 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.national_agg__all_groupings
13:41:25.594876 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct
13:41:25.595569 [info ] [Thread-4  ]: 23 of 31 START table model public.lcarr_sosx_national_agg__all_groupings........ [RUN]
13:41:25.596012 [info ] [Thread-3  ]: 24 of 31 START table model public.lcarr_sosx_national_agg__month_lookback_distinct [RUN]
13:41:25.596794 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national_agg__all_groupings"
13:41:25.597462 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
13:41:25.597686 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.national_agg__all_groupings
13:41:25.597952 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct
13:41:25.598248 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.national_agg__all_groupings
13:41:25.598638 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct
13:41:25.607517 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national_agg__all_groupings"
13:41:25.612388 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
13:41:25.613972 [debug] [Thread-3  ]: finished collecting timing info
13:41:25.614435 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct
13:41:25.626446 [debug] [Thread-4  ]: finished collecting timing info
13:41:25.638607 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.national_agg__all_groupings
13:41:25.770602 [debug] [Thread-3  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
13:41:25.786428 [debug] [Thread-4  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.national_agg__all_groupings"
13:41:25.793391 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
13:41:25.793982 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct: BEGIN
13:41:25.794392 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
13:41:25.794685 [debug] [Thread-3  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
13:41:25.794989 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__all_groupings"
13:41:25.795434 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__all_groupings: BEGIN
13:41:25.795736 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
13:41:25.796122 [debug] [Thread-4  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
13:41:26.578381 [debug] [Thread-3  ]: SQL status: BEGIN in 0.78 seconds
13:41:26.578934 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
13:41:26.579173 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"} */


  create  table
    "cfa"."public"."national_agg__month_lookback_distinct__dbt_tmp"
    
    
    
  as (
    with one_month_set_up as (
  select a.region_name,a.service_team_name,a.dma_name,
  a.location_num,a.monthend_date,'1 month' as look_back_period,
  a.trans_id,a.cfa_one_id,a.customer_hash,
  a.location_type_code,a.daypart,a.destination_desc,
  b.same_store_eligible
  from "cfa"."public"."lcarr_sosx_trans_item" a
  inner join "cfa"."public"."lcarr_sosx_stg__fct_same_store" b
  on a.location_num = b.location_num
  and a.monthend_date = b.monthend_date 
  and b.look_back_period = '1 month'
)
select * from one_month_set_up
  );
13:41:26.722008 [debug] [Thread-4  ]: SQL status: BEGIN in 0.93 seconds
13:41:26.722574 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__all_groupings"
13:41:26.722860 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__all_groupings: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__all_groupings"} */


  create  table
    "cfa"."public"."national_agg__all_groupings__dbt_tmp"
    
    
    
  as (
    with aggregations_all_groupings as (
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    location_type_code,daypart,destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    location_type_code,'All' as daypart,destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    location_type_code,'All' as daypart,'All' as destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    location_type_code,daypart,'All' as destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    'All' as location_type_code,daypart,'All' as destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    'All' as location_type_code,daypart,destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    'All' as location_type_code,'All' as daypart,destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
) 
select * from aggregations_all_groupings
  );
13:43:04.814752 [debug] [Thread-3  ]: SQL status: SELECT in 98.24 seconds
13:43:04.818910 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
13:43:04.820385 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"} */
alter table "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct" rename to "national_agg__month_lookback_distinct__dbt_backup"
13:43:05.092494 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.27 seconds
13:43:05.095761 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
13:43:05.096048 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"} */
alter table "cfa"."public"."national_agg__month_lookback_distinct__dbt_tmp" rename to "lcarr_sosx_national_agg__month_lookback_distinct"
13:43:05.401601 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.31 seconds
13:43:05.403632 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct: COMMIT
13:43:05.403932 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
13:43:05.404145 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct: COMMIT
13:43:09.183464 [debug] [Thread-3  ]: SQL status: COMMIT in 3.78 seconds
13:43:09.184516 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
13:43:09.184973 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct: BEGIN
13:43:09.248157 [debug] [Thread-3  ]: SQL status: BEGIN in 0.06 seconds
13:43:09.251912 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
13:43:09.252206 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"} */
drop table if exists "cfa"."public"."national_agg__month_lookback_distinct__dbt_backup" cascade
13:43:09.348478 [debug] [Thread-3  ]: SQL status: DROP TABLE in 0.1 seconds
13:43:09.350036 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct: COMMIT
13:43:09.350473 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
13:43:09.350711 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct: COMMIT
13:43:10.578123 [debug] [Thread-3  ]: SQL status: COMMIT in 1.23 seconds
13:43:10.578609 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
13:43:10.578887 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct: BEGIN
13:43:10.639744 [debug] [Thread-3  ]: SQL status: BEGIN in 0.06 seconds
13:43:10.640698 [debug] [Thread-3  ]: finished collecting timing info
13:43:10.640976 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct: ROLLBACK
13:43:10.809226 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct: Close
13:43:10.810667 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85a897cc-2a49-4920-9f86-06a477ddc387', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f829edc0130>]}
13:43:10.811290 [info ] [Thread-3  ]: 24 of 31 OK created table model public.lcarr_sosx_national_agg__month_lookback_distinct [[32mSELECT[0m in 105.21s]
13:43:10.811859 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct
13:43:10.812586 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.national_agg__distinct_calcs
13:43:10.812871 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.national_agg__hash_base_calcs
13:43:10.813742 [info ] [Thread-1  ]: 25 of 31 START table model public.lcarr_sosx_national_agg__distinct_calcs....... [RUN]
13:43:10.814646 [info ] [Thread-2  ]: 26 of 31 START table model public.lcarr_sosx_national_agg__hash_base_calcs...... [RUN]
13:43:10.815503 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
13:43:10.816132 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
13:43:10.816405 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.national_agg__distinct_calcs
13:43:10.816731 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.national_agg__hash_base_calcs
13:43:10.817000 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.national_agg__distinct_calcs
13:43:10.817251 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.national_agg__hash_base_calcs
13:43:10.829350 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
13:43:10.839952 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
13:43:10.841219 [debug] [Thread-2  ]: finished collecting timing info
13:43:10.841615 [debug] [Thread-1  ]: finished collecting timing info
13:43:10.842052 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.national_agg__hash_base_calcs
13:43:10.842654 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.national_agg__distinct_calcs
13:43:11.007434 [debug] [Thread-1  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
13:43:11.011814 [debug] [Thread-2  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
13:43:11.013504 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
13:43:11.013839 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__hash_base_calcs: BEGIN
13:43:11.014167 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
13:43:11.014369 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
13:43:11.014617 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_calcs: BEGIN
13:43:11.014835 [debug] [Thread-2  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
13:43:11.015124 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
13:43:11.015599 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
13:43:11.773052 [debug] [Thread-2  ]: SQL status: BEGIN in 0.76 seconds
13:43:11.773686 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
13:43:11.773932 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__hash_base_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"} */


  create  table
    "cfa"."public"."national_agg__hash_base_calcs__dbt_tmp"
    
    
    
  as (
    with hash_base_calcs_all_store as (
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
), hash_base_calcs_same_store as (
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
)

select * from hash_base_calcs_all_store 
union 
select * from hash_base_calcs_same_store
  );
13:43:11.833806 [debug] [Thread-1  ]: SQL status: BEGIN in 0.82 seconds
13:43:11.834386 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
13:43:11.834803 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"} */


  create  table
    "cfa"."public"."national_agg__distinct_calcs__dbt_tmp"
    
    
    
  as (
    with distinct_calcs_all_store as (
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
), distinct_calcs_same_store as (
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
)

select * from distinct_calcs_all_store 
union 
select * from distinct_calcs_same_store
  );
13:50:12.272257 [debug] [Thread-4  ]: SQL status: SELECT in 525.55 seconds
13:50:12.277964 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__all_groupings"
13:50:12.278349 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__all_groupings: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__all_groupings"} */
alter table "cfa"."public"."lcarr_sosx_national_agg__all_groupings" rename to "national_agg__all_groupings__dbt_backup"
13:50:12.343479 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.06 seconds
13:50:12.346903 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__all_groupings"
13:50:12.347308 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__all_groupings: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__all_groupings"} */
alter table "cfa"."public"."national_agg__all_groupings__dbt_tmp" rename to "lcarr_sosx_national_agg__all_groupings"
13:50:12.406231 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.06 seconds
13:50:12.411948 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__all_groupings: COMMIT
13:50:12.412333 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__all_groupings"
13:50:12.412595 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__all_groupings: COMMIT
13:50:14.450287 [debug] [Thread-4  ]: SQL status: COMMIT in 2.04 seconds
13:50:14.450886 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__all_groupings"
13:50:14.451279 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__all_groupings: BEGIN
13:50:14.564476 [debug] [Thread-4  ]: SQL status: BEGIN in 0.11 seconds
13:50:14.568559 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__all_groupings"
13:50:14.568894 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__all_groupings: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__all_groupings"} */
drop table if exists "cfa"."public"."national_agg__all_groupings__dbt_backup" cascade
13:50:14.879782 [debug] [Thread-4  ]: SQL status: DROP TABLE in 0.31 seconds
13:50:14.881105 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__all_groupings: COMMIT
13:50:14.881401 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__all_groupings"
13:50:14.881747 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__all_groupings: COMMIT
13:50:16.697901 [debug] [Thread-4  ]: SQL status: COMMIT in 1.82 seconds
13:50:16.698440 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__all_groupings"
13:50:16.698795 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__all_groupings: BEGIN
13:50:16.774306 [debug] [Thread-4  ]: SQL status: BEGIN in 0.08 seconds
13:50:16.776212 [debug] [Thread-4  ]: finished collecting timing info
13:50:16.776656 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__all_groupings: ROLLBACK
13:50:16.893353 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__all_groupings: Close
13:50:16.894616 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85a897cc-2a49-4920-9f86-06a477ddc387', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f829ecf3430>]}
13:50:16.895407 [info ] [Thread-4  ]: 23 of 31 OK created table model public.lcarr_sosx_national_agg__all_groupings... [[32mSELECT[0m in 531.30s]
13:50:16.896074 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.national_agg__all_groupings
13:50:16.896708 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.national_agg__month_lookback
13:50:16.897111 [info ] [Thread-3  ]: 27 of 31 START table model public.lcarr_sosx_national_agg__month_lookback....... [RUN]
13:50:16.898063 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback"
13:50:16.898529 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.national_agg__month_lookback
13:50:16.898927 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.national_agg__month_lookback
13:50:16.902952 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national_agg__month_lookback"
13:50:16.903773 [debug] [Thread-3  ]: finished collecting timing info
13:50:16.904066 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.national_agg__month_lookback
13:50:16.999631 [debug] [Thread-3  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.national_agg__month_lookback"
13:50:17.001720 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback"
13:50:17.002087 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback: BEGIN
13:50:17.002356 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
13:50:17.002573 [debug] [Thread-3  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
13:50:18.021860 [debug] [Thread-3  ]: SQL status: BEGIN in 1.02 seconds
13:50:18.022320 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback"
13:50:18.022594 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__month_lookback"} */


  create  table
    "cfa"."public"."national_agg__month_lookback__dbt_tmp"
    
    
    
  as (
    with add_month_lookback as (
  select quarter,region_name,service_team_name,dma_name,location_num,
  monthend_date,'1 month' as look_back_period,
  location_type_code,daypart,destination_desc,sales_sub_total,
  transactions,purchaser_visits,credit_txn,
  total_items_promo_count,total_items_sold_count
  from "cfa"."public"."lcarr_sosx_national_agg__all_groupings"
)
select * from add_month_lookback
  );
13:50:20.995414 [debug] [Thread-3  ]: SQL status: SELECT in 2.97 seconds
13:50:21.002265 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback"
13:50:21.002586 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__month_lookback"} */
alter table "cfa"."public"."lcarr_sosx_national_agg__month_lookback" rename to "national_agg__month_lookback__dbt_backup"
13:50:21.095922 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.09 seconds
13:50:21.099679 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback"
13:50:21.100012 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__month_lookback"} */
alter table "cfa"."public"."national_agg__month_lookback__dbt_tmp" rename to "lcarr_sosx_national_agg__month_lookback"
13:50:21.163580 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.06 seconds
13:50:21.165879 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback: COMMIT
13:50:21.166217 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback"
13:50:21.166468 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback: COMMIT
13:50:24.376692 [debug] [Thread-3  ]: SQL status: COMMIT in 3.21 seconds
13:50:24.377605 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback"
13:50:24.377860 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback: BEGIN
13:50:24.501465 [debug] [Thread-3  ]: SQL status: BEGIN in 0.12 seconds
13:50:24.505733 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback"
13:50:24.506120 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__month_lookback"} */
drop table if exists "cfa"."public"."national_agg__month_lookback__dbt_backup" cascade
13:50:24.622365 [debug] [Thread-3  ]: SQL status: DROP TABLE in 0.12 seconds
13:50:24.624099 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback: COMMIT
13:50:24.624411 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback"
13:50:24.624674 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback: COMMIT
13:50:25.761448 [debug] [Thread-3  ]: SQL status: COMMIT in 1.14 seconds
13:50:25.761988 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback"
13:50:25.762261 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback: BEGIN
13:50:25.821027 [debug] [Thread-3  ]: SQL status: BEGIN in 0.06 seconds
13:50:25.822090 [debug] [Thread-3  ]: finished collecting timing info
13:50:25.822379 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback: ROLLBACK
13:50:25.922210 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback: Close
13:50:25.923733 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85a897cc-2a49-4920-9f86-06a477ddc387', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f829eac0850>]}
13:50:25.924282 [info ] [Thread-3  ]: 27 of 31 OK created table model public.lcarr_sosx_national_agg__month_lookback.. [[32mSELECT[0m in 9.03s]
13:50:25.924755 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.national_agg__month_lookback
13:50:25.925360 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.national_agg__same_store_all_store
13:50:25.925861 [info ] [Thread-4  ]: 28 of 31 START table model public.lcarr_sosx_national_agg__same_store_all_store. [RUN]
13:50:25.926576 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"
13:50:25.926835 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.national_agg__same_store_all_store
13:50:25.927179 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.national_agg__same_store_all_store
13:50:25.932257 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"
13:50:25.935179 [debug] [Thread-4  ]: finished collecting timing info
13:50:25.935546 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.national_agg__same_store_all_store
13:50:26.028888 [debug] [Thread-4  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"
13:50:26.031549 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"
13:50:26.031921 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__same_store_all_store: BEGIN
13:50:26.032146 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
13:50:26.032361 [debug] [Thread-4  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
13:50:26.747381 [debug] [Thread-4  ]: SQL status: BEGIN in 0.72 seconds
13:50:26.748652 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"
13:50:26.749062 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__same_store_all_store: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"} */


  create  table
    "cfa"."public"."national_agg__same_store_all_store__dbt_tmp"
    
    
    
  as (
    with transaction_same_store as (
  select a.*,b.same_store_eligible,b.actual_days,b.avail_days
  from "cfa"."public"."lcarr_sosx_national_agg__month_lookback" a
  left join "cfa"."public"."lcarr_sosx_stg__fct_same_store" b
  on a.location_num = b.location_num
  and a.look_back_period = b.look_back_period
  and a.monthend_date = b.monthend_date
  order by dma_name,location_num,look_back_period,location_type_code,daypart,destination_desc,monthend_date
), market_transaction_agg_all_stores as ( 
  select quarter,
  monthend_date,look_back_period,'All Stores' as same_store,
  location_type_code,daypart,destination_desc,
  sum(sales_sub_total) as sales_sub_total,
  sum(transactions) as transactions,sum(purchaser_visits) as purchaser_visits,
  sum(credit_txn) as credit_txn,sum(total_items_promo_count) as total_items_promo_count,
  sum(total_items_sold_count) as total_items_sold_count,
  sum(actual_days) as actual_days, 
  sum(avail_days) as avail_days
  from transaction_same_store
  group by 1,2,3,4,5,6,7
), market_transaction_agg_same_stores as ( 
  select quarter,
  monthend_date,look_back_period,'Same Stores' as same_store,
  location_type_code,daypart,destination_desc,
  sum(sales_sub_total) as sales_sub_total,
  sum(transactions) as transactions,sum(purchaser_visits) as purchaser_visits,
  sum(credit_txn) as credit_txn,sum(total_items_promo_count) as total_items_promo_count,
  sum(total_items_sold_count) as total_items_sold_count,
  sum(actual_days) as actual_days,
  sum(avail_days) as avail_days
  from transaction_same_store
  where same_store_eligible = 1 
  group by 1,2,3,4,5,6,7
), union_all_same_market_transactions as ( 
  select * from market_transaction_agg_all_stores
  union
  select * from market_transaction_agg_same_stores
)
select * from union_all_same_market_transactions
  );
13:50:30.502626 [debug] [Thread-4  ]: SQL status: SELECT in 3.75 seconds
13:50:30.506263 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"
13:50:30.506553 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__same_store_all_store: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"} */
alter table "cfa"."public"."lcarr_sosx_national_agg__same_store_all_store" rename to "national_agg__same_store_all_store__dbt_backup"
13:50:30.611525 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.1 seconds
13:50:30.616262 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"
13:50:30.616614 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__same_store_all_store: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"} */
alter table "cfa"."public"."national_agg__same_store_all_store__dbt_tmp" rename to "lcarr_sosx_national_agg__same_store_all_store"
13:50:30.674884 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.06 seconds
13:50:30.677007 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__same_store_all_store: COMMIT
13:50:30.677452 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"
13:50:30.677702 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__same_store_all_store: COMMIT
13:50:35.024786 [debug] [Thread-4  ]: SQL status: COMMIT in 4.35 seconds
13:50:35.025798 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"
13:50:35.026082 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__same_store_all_store: BEGIN
13:50:35.086338 [debug] [Thread-4  ]: SQL status: BEGIN in 0.06 seconds
13:50:35.090512 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"
13:50:35.090846 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__same_store_all_store: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"} */
drop table if exists "cfa"."public"."national_agg__same_store_all_store__dbt_backup" cascade
13:50:35.221680 [debug] [Thread-4  ]: SQL status: DROP TABLE in 0.13 seconds
13:50:35.223410 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__same_store_all_store: COMMIT
13:50:35.223673 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"
13:50:35.223884 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__same_store_all_store: COMMIT
13:50:42.500504 [debug] [Thread-4  ]: SQL status: COMMIT in 7.28 seconds
13:50:42.501051 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"
13:50:42.501469 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__same_store_all_store: BEGIN
13:50:42.560115 [debug] [Thread-4  ]: SQL status: BEGIN in 0.06 seconds
13:50:42.561145 [debug] [Thread-4  ]: finished collecting timing info
13:50:42.561447 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__same_store_all_store: ROLLBACK
13:50:42.662516 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__same_store_all_store: Close
13:50:42.666120 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85a897cc-2a49-4920-9f86-06a477ddc387', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f829ec1c970>]}
13:50:42.667316 [info ] [Thread-4  ]: 28 of 31 OK created table model public.lcarr_sosx_national_agg__same_store_all_store [[32mSELECT[0m in 16.74s]
13:50:42.668434 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.national_agg__same_store_all_store
15:07:47.210862 [debug] [Thread-2  ]: SQL status: SELECT in 5075.43 seconds
15:07:47.380462 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
15:07:47.381005 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__hash_base_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"} */
alter table "cfa"."public"."lcarr_sosx_national_agg__hash_base_calcs" rename to "national_agg__hash_base_calcs__dbt_backup"
15:07:47.442035 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.06 seconds
15:07:47.450963 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
15:07:47.451335 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__hash_base_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"} */
alter table "cfa"."public"."national_agg__hash_base_calcs__dbt_tmp" rename to "lcarr_sosx_national_agg__hash_base_calcs"
15:07:47.513338 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.06 seconds
15:07:47.522708 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__hash_base_calcs: COMMIT
15:07:47.523199 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
15:07:47.523415 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__hash_base_calcs: COMMIT
15:07:48.892320 [debug] [Thread-2  ]: SQL status: COMMIT in 1.37 seconds
15:07:48.893278 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
15:07:48.893512 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__hash_base_calcs: BEGIN
15:07:48.952238 [debug] [Thread-2  ]: SQL status: BEGIN in 0.06 seconds
15:07:48.960200 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
15:07:48.960536 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__hash_base_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"} */
drop table if exists "cfa"."public"."national_agg__hash_base_calcs__dbt_backup" cascade
15:07:49.023765 [debug] [Thread-2  ]: SQL status: DROP TABLE in 0.06 seconds
15:07:49.026638 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__hash_base_calcs: COMMIT
15:07:49.026960 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
15:07:49.027170 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__hash_base_calcs: COMMIT
15:07:50.212602 [debug] [Thread-2  ]: SQL status: COMMIT in 1.19 seconds
15:07:50.213220 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
15:07:50.213515 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__hash_base_calcs: BEGIN
15:07:50.272670 [debug] [Thread-2  ]: SQL status: BEGIN in 0.06 seconds
15:07:50.277930 [debug] [Thread-2  ]: finished collecting timing info
15:07:50.279463 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__hash_base_calcs: ROLLBACK
15:07:50.383772 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__hash_base_calcs: Close
15:07:50.400400 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85a897cc-2a49-4920-9f86-06a477ddc387', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f829ecbfb50>]}
15:07:51.469418 [info ] [Thread-2  ]: 26 of 31 OK created table model public.lcarr_sosx_national_agg__hash_base_calcs. [[32mSELECT[0m in 5079.58s]
15:07:51.471363 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.national_agg__hash_base_calcs
15:44:49.016569 [debug] [Thread-1  ]: SQL status: SELECT in 7297.18 seconds
15:44:49.039059 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
15:44:49.039655 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"} */
alter table "cfa"."public"."lcarr_sosx_national_agg__distinct_calcs" rename to "national_agg__distinct_calcs__dbt_backup"
15:44:49.107495 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.07 seconds
15:44:49.112746 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
15:44:49.113072 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"} */
alter table "cfa"."public"."national_agg__distinct_calcs__dbt_tmp" rename to "lcarr_sosx_national_agg__distinct_calcs"
15:44:49.169755 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.06 seconds
15:44:49.180815 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_calcs: COMMIT
15:44:49.181239 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
15:44:49.181533 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_calcs: COMMIT
15:44:50.386739 [debug] [Thread-1  ]: SQL status: COMMIT in 1.2 seconds
15:44:50.387392 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
15:44:50.387689 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_calcs: BEGIN
15:44:50.446200 [debug] [Thread-1  ]: SQL status: BEGIN in 0.06 seconds
15:44:50.492890 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
15:44:50.493224 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"} */
drop table if exists "cfa"."public"."national_agg__distinct_calcs__dbt_backup" cascade
15:44:50.553728 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.06 seconds
15:44:50.556638 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_calcs: COMMIT
15:44:50.556957 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
15:44:50.557180 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_calcs: COMMIT
15:44:51.707463 [debug] [Thread-1  ]: SQL status: COMMIT in 1.15 seconds
15:44:51.707909 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
15:44:51.708214 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_calcs: BEGIN
15:44:51.773595 [debug] [Thread-1  ]: SQL status: BEGIN in 0.07 seconds
15:44:51.777158 [debug] [Thread-1  ]: finished collecting timing info
15:44:51.777686 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_calcs: ROLLBACK
15:44:52.024393 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_calcs: Close
15:44:52.032311 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85a897cc-2a49-4920-9f86-06a477ddc387', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f829ed31f10>]}
15:44:52.034891 [info ] [Thread-1  ]: 25 of 31 OK created table model public.lcarr_sosx_national_agg__distinct_calcs.. [[32mSELECT[0m in 7301.22s]
15:44:52.035491 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.national_agg__distinct_calcs
15:44:52.053795 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.national_agg__distinct_join
15:44:52.056664 [info ] [Thread-3  ]: 29 of 31 START table model public.lcarr_sosx_national_agg__distinct_join........ [RUN]
15:44:52.060359 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_join"
15:44:52.060847 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.national_agg__distinct_join
15:44:52.063898 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.national_agg__distinct_join
15:44:52.103539 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national_agg__distinct_join"
15:44:52.107390 [debug] [Thread-3  ]: finished collecting timing info
15:44:52.107871 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.national_agg__distinct_join
15:44:52.200766 [debug] [Thread-3  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.national_agg__distinct_join"
15:44:52.201598 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_join"
15:44:52.201833 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_join: BEGIN
15:44:52.202050 [debug] [Thread-3  ]: Opening a new connection, currently in state closed
15:44:52.202361 [debug] [Thread-3  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
15:44:52.921141 [debug] [Thread-3  ]: SQL status: BEGIN in 0.72 seconds
15:44:52.921839 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_join"
15:44:52.922173 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__distinct_join"} */


  create  table
    "cfa"."public"."national_agg__distinct_join__dbt_tmp"
    
    
    
  as (
    with distinct_calcs_join as (
    select a.monthend_date,a.look_back_period,a.same_store,
    a.location_type_code,a.daypart,a.destination_desc,
    a.unique_cfa_one_ids,a.unique_hashes,a.hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_national_agg__distinct_calcs" a
    inner join "cfa"."public"."lcarr_sosx_national_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period
    and a.same_store = b.same_store
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
) 
select * from distinct_calcs_join
  );
15:44:53.556961 [debug] [Thread-3  ]: SQL status: SELECT in 0.63 seconds
15:44:53.563014 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_join"
15:44:53.563331 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__distinct_join"} */
alter table "cfa"."public"."lcarr_sosx_national_agg__distinct_join" rename to "national_agg__distinct_join__dbt_backup"
15:44:53.621009 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.06 seconds
15:44:53.624576 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_join"
15:44:53.624979 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__distinct_join"} */
alter table "cfa"."public"."national_agg__distinct_join__dbt_tmp" rename to "lcarr_sosx_national_agg__distinct_join"
15:44:53.683353 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.06 seconds
15:44:53.687770 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_join: COMMIT
15:44:53.688095 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_join"
15:44:53.688313 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_join: COMMIT
15:44:54.710726 [debug] [Thread-3  ]: SQL status: COMMIT in 1.02 seconds
15:44:54.711519 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_join"
15:44:54.711897 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_join: BEGIN
15:44:54.802651 [debug] [Thread-3  ]: SQL status: BEGIN in 0.09 seconds
15:44:54.806290 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_join"
15:44:54.806596 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__distinct_join"} */
drop table if exists "cfa"."public"."national_agg__distinct_join__dbt_backup" cascade
15:44:54.866755 [debug] [Thread-3  ]: SQL status: DROP TABLE in 0.06 seconds
15:44:54.868193 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_join: COMMIT
15:44:54.868466 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_join"
15:44:54.868670 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_join: COMMIT
15:44:55.920549 [debug] [Thread-3  ]: SQL status: COMMIT in 1.05 seconds
15:44:55.921099 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_join"
15:44:55.921327 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_join: BEGIN
15:44:55.981017 [debug] [Thread-3  ]: SQL status: BEGIN in 0.06 seconds
15:44:55.981961 [debug] [Thread-3  ]: finished collecting timing info
15:44:55.982313 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_join: ROLLBACK
15:44:56.086766 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_join: Close
15:44:56.088525 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85a897cc-2a49-4920-9f86-06a477ddc387', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f829ea6cca0>]}
15:44:56.089239 [info ] [Thread-3  ]: 29 of 31 OK created table model public.lcarr_sosx_national_agg__distinct_join... [[32mSELECT[0m in 4.03s]
15:44:56.089724 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.national_agg__distinct_join
15:44:56.090466 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.national__big_join
15:44:56.090956 [info ] [Thread-2  ]: 30 of 31 START table model public.lcarr_sosx_national__big_join................. [RUN]
15:44:56.091770 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national__big_join"
15:44:56.092026 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.national__big_join
15:44:56.092252 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.national__big_join
15:44:56.097940 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national__big_join"
15:44:56.101817 [debug] [Thread-2  ]: finished collecting timing info
15:44:56.102201 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.national__big_join
15:44:56.190902 [debug] [Thread-2  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.national__big_join"
15:44:56.193049 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.national__big_join"
15:44:56.193412 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national__big_join: BEGIN
15:44:56.193671 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
15:44:56.193889 [debug] [Thread-2  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
15:44:56.925700 [debug] [Thread-2  ]: SQL status: BEGIN in 0.73 seconds
15:44:56.926163 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.national__big_join"
15:44:56.926378 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national__big_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national__big_join"} */


  create  table
    "cfa"."public"."national__big_join__dbt_tmp"
    
    
    
  as (
    with big_join as ( 
  select a.*, e.unique_cfa_one_ids, e.unique_hashes, e.hash_transactions, e.hash_per_customer,
  b.price_index, 
  d.previous_year_monthend_date
  from "cfa"."public"."lcarr_sosx_national_agg__same_store_all_store" a
  inner join "cfa"."public"."lcarr_sosx_calc__dim_price_index_3" b
  on a.look_back_period = b.look_back_period
  and a.monthend_date = b.monthend_date
  and a.same_store = b.same_store
  inner join "cfa"."public"."lcarr_sosx_calc__dim_monthend_date" d
  on a.monthend_date = d.monthend_date
  inner join "cfa"."public"."lcarr_sosx_national_agg__distinct_join" e
  on a.monthend_date = e.monthend_date
  and a.look_back_period = e.look_back_period
  and a.same_store = e.same_store
  and a.location_type_code = e.location_type_code
  and a.daypart = e.daypart
  and a.destination_desc = e.destination_desc
)
select * from big_join
  );
15:46:19.835958 [debug] [Thread-2  ]: SQL status: SELECT in 82.91 seconds
15:46:19.839509 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.national__big_join"
15:46:19.840510 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national__big_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national__big_join"} */
alter table "cfa"."public"."national__big_join__dbt_tmp" rename to "lcarr_sosx_national__big_join"
15:46:20.018713 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.18 seconds
15:46:20.023224 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national__big_join: COMMIT
15:46:20.023565 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.national__big_join"
15:46:20.023773 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national__big_join: COMMIT
15:46:21.455673 [debug] [Thread-2  ]: SQL status: COMMIT in 1.43 seconds
15:46:21.456682 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.national__big_join"
15:46:21.456989 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national__big_join: BEGIN
15:46:21.517697 [debug] [Thread-2  ]: SQL status: BEGIN in 0.06 seconds
15:46:21.521689 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.national__big_join"
15:46:21.522025 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national__big_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national__big_join"} */
drop table if exists "cfa"."public"."national__big_join__dbt_backup" cascade
15:46:21.577706 [debug] [Thread-2  ]: SQL status: DROP TABLE in 0.06 seconds
15:46:21.580699 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national__big_join: COMMIT
15:46:21.581088 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.national__big_join"
15:46:21.581348 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national__big_join: COMMIT
15:46:21.781399 [debug] [Thread-2  ]: SQL status: COMMIT in 0.2 seconds
15:46:21.782124 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.national__big_join"
15:46:21.782361 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national__big_join: BEGIN
15:46:21.843064 [debug] [Thread-2  ]: SQL status: BEGIN in 0.06 seconds
15:46:21.844160 [debug] [Thread-2  ]: finished collecting timing info
15:46:21.844500 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national__big_join: ROLLBACK
15:46:21.948749 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national__big_join: Close
15:46:21.950180 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85a897cc-2a49-4920-9f86-06a477ddc387', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f829ec06f40>]}
15:46:21.950928 [info ] [Thread-2  ]: 30 of 31 OK created table model public.lcarr_sosx_national__big_join............ [[32mSELECT[0m in 85.86s]
15:46:21.951523 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.national__big_join
15:46:21.955117 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.national__final_output
15:46:21.956755 [info ] [Thread-4  ]: 31 of 31 START table model public.lcarr_sosx_national__final_output............. [RUN]
15:46:21.958405 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national__final_output"
15:46:21.958744 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.national__final_output
15:46:21.958982 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.national__final_output
15:46:21.968051 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national__final_output"
15:46:21.969492 [debug] [Thread-4  ]: finished collecting timing info
15:46:21.970007 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.national__final_output
15:46:22.056107 [debug] [Thread-4  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.national__final_output"
15:46:22.057807 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national__final_output"
15:46:22.058103 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national__final_output: BEGIN
15:46:22.058305 [debug] [Thread-4  ]: Opening a new connection, currently in state closed
15:46:22.058519 [debug] [Thread-4  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
15:46:22.962128 [debug] [Thread-4  ]: SQL status: BEGIN in 0.9 seconds
15:46:22.962469 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national__final_output"
15:46:22.962800 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national__final_output: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national__final_output"} */


  create  table
    "cfa"."public"."national__final_output__dbt_tmp"
    
    
    
  as (
    with twentytwo as (
select *
from "cfa"."public"."lcarr_sosx_national__big_join" 
where monthend_date = cast('02-28-2022' as date) 
), twentyone as ( 
select * 
from "cfa"."public"."lcarr_sosx_national__big_join"
where monthend_date = cast('02-28-2021' as date)
) 

select 'Market' as geolevel, 
a.quarter,
a.look_back_period,a.same_store,
a.location_type_code,a.daypart,a.destination_desc,
a.monthend_date as current_monthend_date,
a.sales_sub_total as current_sales_sub_total,
a.transactions as current_transactions,
a.purchaser_visits as current_purchaser_visits,
a.credit_txn as current_credit_txn,
a.total_items_promo_count as current_total_items_promo_count,
a.total_items_sold_count as current_total_items_sold_count,
a.actual_days as current_actual_days,
a.avail_days as current_avail_days,
a.price_index as current_price_index,
a.unique_cfa_one_ids as current_unique_cfa_one_ids,
a.unique_hashes as current_unique_hashes,
a.hash_transactions as current_hash_transactions,
a.hash_per_customer as current_hash_per_customer,
a.previous_year_monthend_date as check_date,
b.monthend_date as previous_monthend_date,
b.sales_sub_total as previous_sales_sub_total,
b.transactions as previous_transactions,
b.purchaser_visits as previous_purchaser_visits,
b.credit_txn as previous_credit_txn,
b.total_items_promo_count as previous_total_items_promo_count,
b.total_items_sold_count as previous_total_items_sold_count,
b.actual_days as previous_actual_days,
b.avail_days as previous_avail_days,
b.price_index as previous_price_index,
b.unique_cfa_one_ids as previous_unique_cfa_one_ids,
b.unique_hashes as previous_unique_hashes,
b.hash_transactions as previous_hash_transactions,
b.hash_per_customer as previous_hash_per_customer
from twentytwo a 
inner join twentyone b
on a.look_back_period = b.look_back_period 
and a.same_store = b.same_store 
and a.location_type_code = b.location_type_code 
and a.daypart = b.daypart
and a.destination_desc = b.destination_desc
and a.previous_year_monthend_date = b.monthend_date
order by same_store,location_type_code,daypart,destination_desc
  );
15:46:33.304225 [debug] [Thread-4  ]: SQL status: SELECT in 10.34 seconds
15:46:33.310582 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national__final_output"
15:46:33.310974 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national__final_output: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national__final_output"} */
alter table "cfa"."public"."national__final_output__dbt_tmp" rename to "lcarr_sosx_national__final_output"
15:46:33.546872 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.24 seconds
15:46:33.548823 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national__final_output: COMMIT
15:46:33.549118 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national__final_output"
15:46:33.549326 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national__final_output: COMMIT
15:46:35.773026 [debug] [Thread-4  ]: SQL status: COMMIT in 2.22 seconds
15:46:35.775986 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national__final_output"
15:46:35.776418 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national__final_output: BEGIN
15:46:35.876578 [debug] [Thread-4  ]: SQL status: BEGIN in 0.1 seconds
15:46:35.885767 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national__final_output"
15:46:35.886095 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national__final_output: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national__final_output"} */
drop table if exists "cfa"."public"."national__final_output__dbt_backup" cascade
15:46:35.955554 [debug] [Thread-4  ]: SQL status: DROP TABLE in 0.07 seconds
15:46:35.957462 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national__final_output: COMMIT
15:46:35.958936 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national__final_output"
15:46:35.959235 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national__final_output: COMMIT
15:46:37.142103 [debug] [Thread-4  ]: SQL status: COMMIT in 1.18 seconds
15:46:37.142647 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national__final_output"
15:46:37.142877 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national__final_output: BEGIN
15:46:37.246671 [debug] [Thread-4  ]: SQL status: BEGIN in 0.1 seconds
15:46:37.247554 [debug] [Thread-4  ]: finished collecting timing info
15:46:37.247877 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national__final_output: ROLLBACK
15:46:37.448329 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national__final_output: Close
15:46:37.449791 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85a897cc-2a49-4920-9f86-06a477ddc387', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f829edfb0a0>]}
15:46:37.450516 [info ] [Thread-4  ]: 31 of 31 OK created table model public.lcarr_sosx_national__final_output........ [[32mSELECT[0m in 15.49s]
15:46:37.451019 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.national__final_output
15:46:37.478484 [debug] [MainThread]: Acquiring new redshift connection "master"
15:46:37.482034 [debug] [MainThread]: Using redshift connection "master"
15:46:37.482576 [debug] [MainThread]: On master: BEGIN
15:46:37.483181 [debug] [MainThread]: Opening a new connection, currently in state closed
15:46:37.484079 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
15:46:40.176155 [debug] [MainThread]: SQL status: BEGIN in 2.69 seconds
15:46:40.176726 [debug] [MainThread]: On master: COMMIT
15:46:40.176984 [debug] [MainThread]: Using redshift connection "master"
15:46:40.177190 [debug] [MainThread]: On master: COMMIT
15:46:40.334988 [debug] [MainThread]: SQL status: COMMIT in 0.16 seconds
15:46:40.336297 [debug] [MainThread]: On master: Close
15:46:40.343808 [info ] [MainThread]: 
15:46:40.344522 [info ] [MainThread]: Finished running 17 view models, 14 table models in 8917.14s.
15:46:40.345320 [debug] [MainThread]: Connection 'master' was properly closed.
15:46:40.346463 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.national_agg__distinct_calcs' was properly closed.
15:46:40.346702 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.national__big_join' was properly closed.
15:46:40.346901 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.national_agg__distinct_join' was properly closed.
15:46:40.347093 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.national__final_output' was properly closed.
15:46:40.425468 [info ] [MainThread]: 
15:46:40.425999 [info ] [MainThread]: [32mCompleted successfully[0m
15:46:40.426666 [info ] [MainThread]: 
15:46:40.427246 [info ] [MainThread]: Done. PASS=31 WARN=0 ERROR=0 SKIP=0 TOTAL=31
15:46:40.436256 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f829ec38df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f829ec51880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f829ec51a00>]}


============================== 2022-06-24 18:27:13.014894 | 881c6724-3039-44bf-8777-2decef69de63 ==============================
18:27:13.014894 [info ] [MainThread]: Running with dbt=1.0.4
18:27:13.020531 [debug] [MainThread]: running dbt with arguments Namespace(cls=<class 'dbt.task.compile.CompileTask'>, debug=None, defer=None, event_buffer_size=None, exclude=None, fail_fast=True, full_refresh=False, log_cache_events=False, log_format=None, parse_only=False, partial_parse=None, printer_width=None, profile=None, profiles_dir='/Users/lindsay.carr/DBT/environments/redshift_discovery_crn_svc/', project_dir=None, record_timing_info=None, rpc_method='compile', select=None, selector_name=None, send_anonymous_usage_stats=None, single_threaded=False, state=None, static_parser=None, target=None, threads=None, use_colors=None, use_experimental_parser=None, vars='{}', version_check=None, warn_error=None, which='compile', write_json=None)
18:27:13.021071 [debug] [MainThread]: Tracking: tracking
18:27:13.088247 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9373d5e520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9373d5e910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9373d71160>]}
18:27:13.196077 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
18:27:13.196808 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '881c6724-3039-44bf-8777-2decef69de63', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9373ce18e0>]}
18:27:13.340660 [debug] [MainThread]: Parsing macros/get_custom_alias.sql
18:27:13.343263 [debug] [MainThread]: Parsing macros/catalog.sql
18:27:13.375798 [debug] [MainThread]: Parsing macros/relations.sql
18:27:13.377195 [debug] [MainThread]: Parsing macros/adapters.sql
18:27:13.458808 [debug] [MainThread]: Parsing macros/materializations/snapshot_merge.sql
18:27:13.460261 [debug] [MainThread]: Parsing macros/catalog.sql
18:27:13.465057 [debug] [MainThread]: Parsing macros/relations.sql
18:27:13.467994 [debug] [MainThread]: Parsing macros/adapters.sql
18:27:13.529953 [debug] [MainThread]: Parsing macros/materializations/snapshot_merge.sql
18:27:13.533943 [debug] [MainThread]: Parsing macros/materializations/hooks.sql
18:27:13.552801 [debug] [MainThread]: Parsing macros/materializations/configs.sql
18:27:13.558394 [debug] [MainThread]: Parsing macros/materializations/snapshots/snapshot_merge.sql
18:27:13.562226 [debug] [MainThread]: Parsing macros/materializations/snapshots/strategies.sql
18:27:13.605754 [debug] [MainThread]: Parsing macros/materializations/snapshots/helpers.sql
18:27:13.633251 [debug] [MainThread]: Parsing macros/materializations/snapshots/snapshot.sql
18:27:13.666280 [debug] [MainThread]: Parsing macros/materializations/tests/test.sql
18:27:13.678618 [debug] [MainThread]: Parsing macros/materializations/tests/helpers.sql
18:27:13.683457 [debug] [MainThread]: Parsing macros/materializations/tests/where_subquery.sql
18:27:13.687856 [debug] [MainThread]: Parsing macros/materializations/models/incremental/column_helpers.sql
18:27:13.697645 [debug] [MainThread]: Parsing macros/materializations/models/incremental/merge.sql
18:27:13.712922 [debug] [MainThread]: Parsing macros/materializations/models/incremental/is_incremental.sql
18:27:13.714890 [debug] [MainThread]: Parsing macros/materializations/models/incremental/incremental.sql
18:27:13.727627 [debug] [MainThread]: Parsing macros/materializations/models/incremental/on_schema_change.sql
18:27:13.750100 [debug] [MainThread]: Parsing macros/materializations/models/table/table.sql
18:27:13.760485 [debug] [MainThread]: Parsing macros/materializations/models/table/create_table_as.sql
18:27:13.764948 [debug] [MainThread]: Parsing macros/materializations/models/view/view.sql
18:27:13.774949 [debug] [MainThread]: Parsing macros/materializations/models/view/helpers.sql
18:27:13.776935 [debug] [MainThread]: Parsing macros/materializations/models/view/create_or_replace_view.sql
18:27:13.780659 [debug] [MainThread]: Parsing macros/materializations/models/view/create_view_as.sql
18:27:13.783793 [debug] [MainThread]: Parsing macros/materializations/seeds/seed.sql
18:27:13.792601 [debug] [MainThread]: Parsing macros/materializations/seeds/helpers.sql
18:27:13.813097 [debug] [MainThread]: Parsing macros/get_custom_name/get_custom_alias.sql
18:27:13.815091 [debug] [MainThread]: Parsing macros/get_custom_name/get_custom_schema.sql
18:27:13.818279 [debug] [MainThread]: Parsing macros/get_custom_name/get_custom_database.sql
18:27:13.820291 [debug] [MainThread]: Parsing macros/generic_test_sql/relationships.sql
18:27:13.821375 [debug] [MainThread]: Parsing macros/generic_test_sql/not_null.sql
18:27:13.822035 [debug] [MainThread]: Parsing macros/generic_test_sql/unique.sql
18:27:13.822862 [debug] [MainThread]: Parsing macros/generic_test_sql/accepted_values.sql
18:27:13.824844 [debug] [MainThread]: Parsing macros/etc/statement.sql
18:27:13.830212 [debug] [MainThread]: Parsing macros/etc/datetime.sql
18:27:13.841619 [debug] [MainThread]: Parsing macros/adapters/schema.sql
18:27:13.844259 [debug] [MainThread]: Parsing macros/adapters/indexes.sql
18:27:13.847412 [debug] [MainThread]: Parsing macros/adapters/relation.sql
18:27:13.860413 [debug] [MainThread]: Parsing macros/adapters/freshness.sql
18:27:13.863883 [debug] [MainThread]: Parsing macros/adapters/persist_docs.sql
18:27:13.869360 [debug] [MainThread]: Parsing macros/adapters/metadata.sql
18:27:13.878585 [debug] [MainThread]: Parsing macros/adapters/columns.sql
18:27:13.890407 [debug] [MainThread]: Parsing tests/generic/builtin.sql
18:27:14.146112 [debug] [MainThread]: 1699: static parser successfully parsed region/final_output/region__big_join.sql
18:27:14.160153 [debug] [MainThread]: 1699: static parser successfully parsed region/final_output/region__final_output.sql
18:27:14.162800 [debug] [MainThread]: 1603: static parser failed on region/aggregations/region_agg__all_groupings.sql
18:27:14.168549 [debug] [MainThread]: 1602: parser fallback to jinja rendering on region/aggregations/region_agg__all_groupings.sql
18:27:14.170143 [debug] [MainThread]: 1699: static parser successfully parsed region/aggregations/region_agg__month_lookback.sql
18:27:14.173040 [debug] [MainThread]: 1699: static parser successfully parsed region/aggregations/region_agg__same_store_all_store.sql
18:27:14.176097 [debug] [MainThread]: 1699: static parser successfully parsed region/aggregations_distinct/region_agg__month_lookback_distinct.sql
18:27:14.178873 [debug] [MainThread]: 1603: static parser failed on region/aggregations_distinct/region_agg__distinct_calcs.sql
18:27:14.185216 [debug] [MainThread]: 1602: parser fallback to jinja rendering on region/aggregations_distinct/region_agg__distinct_calcs.sql
18:27:14.186743 [debug] [MainThread]: 1699: static parser successfully parsed region/aggregations_distinct/region_agg__distinct_join.sql
18:27:14.189600 [debug] [MainThread]: 1603: static parser failed on region/aggregations_distinct/region_agg__hash_base_calcs.sql
18:27:14.196652 [debug] [MainThread]: 1602: parser fallback to jinja rendering on region/aggregations_distinct/region_agg__hash_base_calcs.sql
18:27:14.198285 [debug] [MainThread]: 1699: static parser successfully parsed national/final_output/national__final_output.sql
18:27:14.200792 [debug] [MainThread]: 1699: static parser successfully parsed national/final_output/national__big_join.sql
18:27:14.203369 [debug] [MainThread]: 1603: static parser failed on national/aggregations/national_agg__all_groupings.sql
18:27:14.209552 [debug] [MainThread]: 1602: parser fallback to jinja rendering on national/aggregations/national_agg__all_groupings.sql
18:27:14.211076 [debug] [MainThread]: 1699: static parser successfully parsed national/aggregations/national_agg__same_store_all_store.sql
18:27:14.213602 [debug] [MainThread]: 1699: static parser successfully parsed national/aggregations/national_agg__month_lookback.sql
18:27:14.215942 [debug] [MainThread]: 1699: static parser successfully parsed national/aggregations_distinct/national_agg__distinct_join.sql
18:27:14.218714 [debug] [MainThread]: 1603: static parser failed on national/aggregations_distinct/national_agg__hash_base_calcs.sql
18:27:14.225598 [debug] [MainThread]: 1602: parser fallback to jinja rendering on national/aggregations_distinct/national_agg__hash_base_calcs.sql
18:27:14.227070 [debug] [MainThread]: 1699: static parser successfully parsed national/aggregations_distinct/national_agg__month_lookback_distinct.sql
18:27:14.229804 [debug] [MainThread]: 1603: static parser failed on national/aggregations_distinct/national_agg__distinct_calcs.sql
18:27:14.236453 [debug] [MainThread]: 1602: parser fallback to jinja rendering on national/aggregations_distinct/national_agg__distinct_calcs.sql
18:27:14.237810 [debug] [MainThread]: 1699: static parser successfully parsed set_up/monthend_date_calc/calc__dim_monthend_date.sql
18:27:14.240266 [debug] [MainThread]: 1603: static parser failed on set_up/same_store_elig_calc/stg__dim_fcr_loc_sales_elig.sql
18:27:14.244360 [debug] [MainThread]: 1602: parser fallback to jinja rendering on set_up/same_store_elig_calc/stg__dim_fcr_loc_sales_elig.sql
18:27:14.245798 [debug] [MainThread]: 1699: static parser successfully parsed set_up/same_store_elig_calc/stg__dim_same_store.sql
18:27:14.248220 [debug] [MainThread]: 1699: static parser successfully parsed set_up/same_store_elig_calc/stg__fct_same_store.sql
18:27:14.248593 [debug] [MainThread]: 1611: conducting full jinja rendering sample on set_up/same_store_elig_calc/stg__fct_same_store.sql
18:27:14.259769 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'experimental_parser', 'label': '881c6724-3039-44bf-8777-2decef69de63', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9373dafe20>]}
18:27:14.262079 [debug] [MainThread]: 1699: static parser successfully parsed set_up/details_transaction/tender.sql
18:27:14.265645 [debug] [MainThread]: 1699: static parser successfully parsed set_up/details_transaction/item.sql
18:27:14.268151 [debug] [MainThread]: 1699: static parser successfully parsed set_up/details_transaction/trans_item.sql
18:27:14.270759 [debug] [MainThread]: 1699: static parser successfully parsed set_up/details_transaction/trans_detail.sql
18:27:14.273395 [debug] [MainThread]: 1699: static parser successfully parsed set_up/details_transaction/transaction.sql
18:27:14.276489 [debug] [MainThread]: 1699: static parser successfully parsed set_up/stage_transaction/stg__dim_location.sql
18:27:14.279591 [debug] [MainThread]: 1699: static parser successfully parsed set_up/stage_transaction/stg__dim_transaction_status.sql
18:27:14.282155 [debug] [MainThread]: 1699: static parser successfully parsed set_up/stage_transaction/stg__dim_destination.sql
18:27:14.284401 [debug] [MainThread]: 1699: static parser successfully parsed set_up/stage_transaction/stg__dim_daypart.sql
18:27:14.286679 [debug] [MainThread]: 1603: static parser failed on set_up/stage_transaction/stg__fct_item.sql
18:27:14.293644 [debug] [MainThread]: 1602: parser fallback to jinja rendering on set_up/stage_transaction/stg__fct_item.sql
18:27:14.295076 [debug] [MainThread]: 1603: static parser failed on set_up/stage_transaction/stg__fct_transaction.sql
18:27:14.300545 [info ] [MainThread]: 2022-02-01
18:27:14.301014 [info ] [MainThread]: 2022-02-28
18:27:14.301406 [info ] [MainThread]: 
18:27:14.303467 [debug] [MainThread]: 1602: parser fallback to jinja rendering on set_up/stage_transaction/stg__fct_transaction.sql
18:27:14.305286 [debug] [MainThread]: 1699: static parser successfully parsed set_up/stage_transaction/stg__dim_item.sql
18:27:14.311635 [debug] [MainThread]: 1603: static parser failed on set_up/stage_transaction/stg__fct_tender.sql
18:27:14.317716 [debug] [MainThread]: 1602: parser fallback to jinja rendering on set_up/stage_transaction/stg__fct_tender.sql
18:27:14.319165 [debug] [MainThread]: 1699: static parser successfully parsed set_up/price_index_calc/calc__error.sql
18:27:14.321557 [debug] [MainThread]: 1603: static parser failed on set_up/price_index_calc/stg__dim_adj_sales.sql
18:27:14.327113 [debug] [MainThread]: 1602: parser fallback to jinja rendering on set_up/price_index_calc/stg__dim_adj_sales.sql
18:27:14.329375 [debug] [MainThread]: 1699: static parser successfully parsed set_up/price_index_calc/calc__dim_price_index_3.sql
18:27:14.332655 [debug] [MainThread]: 1699: static parser successfully parsed set_up/price_index_calc/calc__dim_price_index_2.sql
18:27:14.335514 [debug] [MainThread]: 1699: static parser successfully parsed set_up/price_index_calc/calc__dim_price_index_1.sql
18:27:14.425876 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 6 unused configuration paths:
- models.source_of_sales_change_lcarr.ast.aggregations_distinct
- models.source_of_sales_change_lcarr.ast.final_output
- models.source_of_sales_change_lcarr.market.final_output
- models.source_of_sales_change_lcarr.market.aggregations_distinct
- models.source_of_sales_change_lcarr.market.aggregations
- models.source_of_sales_change_lcarr.ast.aggregations

18:27:14.432844 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '881c6724-3039-44bf-8777-2decef69de63', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9373e7ef70>]}
18:27:14.451364 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '881c6724-3039-44bf-8777-2decef69de63', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9373d81280>]}
18:27:14.451907 [info ] [MainThread]: Found 40 models, 4 tests, 0 snapshots, 0 analyses, 192 macros, 0 operations, 0 seed files, 11 sources, 0 exposures, 0 metrics
18:27:14.455813 [info ] [MainThread]: 
18:27:14.456563 [debug] [MainThread]: Acquiring new redshift connection "master"
18:27:14.459695 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa_public"
18:27:14.471384 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
18:27:14.471702 [debug] [ThreadPool]: On list_cfa_public: BEGIN
18:27:14.471910 [debug] [ThreadPool]: Opening a new connection, currently in state init
18:27:14.472106 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:27:15.710261 [debug] [ThreadPool]: SQL status: BEGIN in 1.24 seconds
18:27:15.711708 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
18:27:15.712074 [debug] [ThreadPool]: On list_cfa_public: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa_public"} */
select
      'cfa' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'cfa' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
18:27:16.039477 [debug] [ThreadPool]: SQL status: SELECT in 0.33 seconds
18:27:16.112957 [debug] [ThreadPool]: On list_cfa_public: ROLLBACK
18:27:16.372182 [debug] [ThreadPool]: On list_cfa_public: Close
18:27:16.439284 [debug] [MainThread]: Using redshift connection "master"
18:27:16.439620 [debug] [MainThread]: On master: BEGIN
18:27:16.439848 [debug] [MainThread]: Opening a new connection, currently in state init
18:27:16.440086 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:27:17.116077 [debug] [MainThread]: SQL status: BEGIN in 0.68 seconds
18:27:17.116646 [debug] [MainThread]: Using redshift connection "master"
18:27:17.116951 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
18:27:18.586033 [debug] [MainThread]: SQL status: SELECT in 1.47 seconds
18:27:18.605852 [debug] [MainThread]: On master: ROLLBACK
18:27:18.731671 [debug] [MainThread]: On master: Close
18:27:18.732909 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
18:27:18.733390 [info ] [MainThread]: 
18:27:18.740097 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.calc__dim_monthend_date
18:27:18.740668 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.calc__dim_monthend_date"
18:27:18.740940 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.calc__dim_monthend_date
18:27:18.741166 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.calc__dim_monthend_date
18:27:18.744430 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.calc__dim_monthend_date"
18:27:18.745656 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.stg__dim_adj_sales
18:27:18.746945 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.stg__dim_adj_sales"
18:27:18.747353 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.stg__dim_adj_sales
18:27:18.747792 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.stg__dim_adj_sales
18:27:18.755250 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.stg__dim_adj_sales"
18:27:18.756765 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.stg__dim_daypart
18:27:18.757310 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.stg__dim_destination
18:27:18.758080 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.stg__dim_daypart"
18:27:18.758375 [debug] [Thread-1  ]: finished collecting timing info
18:27:18.758655 [debug] [Thread-2  ]: finished collecting timing info
18:27:18.759390 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.stg__dim_destination"
18:27:18.760015 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.stg__dim_daypart
18:27:18.760342 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.calc__dim_monthend_date
18:27:18.760587 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.stg__dim_adj_sales
18:27:18.760798 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.stg__dim_destination
18:27:18.761027 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.stg__dim_daypart
18:27:18.761284 [debug] [Thread-1  ]: finished collecting timing info
18:27:18.761511 [debug] [Thread-2  ]: finished collecting timing info
18:27:18.761726 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.stg__dim_destination
18:27:18.765068 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.stg__dim_daypart"
18:27:18.765701 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.calc__dim_monthend_date
18:27:18.766815 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.stg__dim_adj_sales
18:27:18.770185 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.stg__dim_destination"
18:27:18.770745 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig
18:27:18.771273 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.stg__dim_item
18:27:18.772242 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig"
18:27:18.772903 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.stg__dim_item"
18:27:18.773143 [debug] [Thread-3  ]: finished collecting timing info
18:27:18.773584 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig
18:27:18.773955 [debug] [Thread-4  ]: finished collecting timing info
18:27:18.774180 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.stg__dim_item
18:27:18.774520 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.stg__dim_daypart
18:27:18.774837 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig
18:27:18.775102 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.stg__dim_destination
18:27:18.775376 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.stg__dim_item
18:27:18.775690 [debug] [Thread-3  ]: finished collecting timing info
18:27:18.778916 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig"
18:27:18.779542 [debug] [Thread-4  ]: finished collecting timing info
18:27:18.784477 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.stg__dim_item"
18:27:18.785218 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.stg__dim_daypart
18:27:18.785942 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.stg__dim_destination
18:27:18.786557 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.stg__dim_location
18:27:18.787287 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.stg__dim_transaction_status
18:27:18.787530 [debug] [Thread-2  ]: finished collecting timing info
18:27:18.787698 [debug] [Thread-1  ]: finished collecting timing info
18:27:18.788385 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.stg__dim_location"
18:27:18.788873 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.stg__dim_transaction_status"
18:27:18.789147 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.stg__dim_item
18:27:18.789385 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig
18:27:18.789616 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.stg__dim_location
18:27:18.790655 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.stg__dim_location
18:27:18.789854 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.stg__dim_transaction_status
18:27:18.790345 [debug] [Thread-1  ]: finished collecting timing info
18:27:18.793415 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.stg__dim_location"
18:27:18.790118 [debug] [Thread-2  ]: finished collecting timing info
18:27:18.793783 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.stg__dim_transaction_status
18:27:18.794263 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig
18:27:18.794933 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.stg__dim_item
18:27:18.797845 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.stg__dim_transaction_status"
18:27:18.798312 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.stg__fct_transaction
18:27:18.798668 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.calc__error
18:27:18.799340 [debug] [Thread-3  ]: finished collecting timing info
18:27:18.799941 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.stg__fct_transaction"
18:27:18.800346 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.calc__error"
18:27:18.800645 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.stg__dim_location
18:27:18.800944 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.stg__fct_transaction
18:27:18.801244 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.calc__error
18:27:18.801504 [debug] [Thread-4  ]: finished collecting timing info
18:27:18.801816 [debug] [Thread-3  ]: finished collecting timing info
18:27:18.802065 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.stg__fct_transaction
18:27:18.802295 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.calc__error
18:27:18.802547 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.stg__dim_transaction_status
18:27:18.803020 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.stg__dim_location
18:27:18.809088 [info ] [Thread-1  ]: 2022-02-01
18:27:18.812339 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.calc__error"
18:27:18.812687 [debug] [Thread-4  ]: finished collecting timing info
18:27:18.812949 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.stg__dim_same_store
18:27:18.813552 [info ] [Thread-1  ]: 2022-02-28
18:27:18.814174 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.stg__dim_transaction_status
18:27:18.814806 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.stg__dim_same_store"
18:27:18.815266 [info ] [Thread-1  ]: 
18:27:18.815613 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.calc__dim_price_index_1
18:27:18.816125 [debug] [Thread-2  ]: finished collecting timing info
18:27:18.816319 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.stg__dim_same_store
18:27:18.817514 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.stg__fct_transaction"
18:27:18.818265 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_1"
18:27:18.818671 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.calc__error
18:27:18.819033 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.stg__dim_same_store
18:27:18.819510 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.calc__dim_price_index_1
18:27:18.819934 [debug] [Thread-2  ]: finished collecting timing info
18:27:18.824615 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.stg__dim_same_store"
18:27:18.825105 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.calc__dim_price_index_1
18:27:18.825546 [debug] [Thread-1  ]: finished collecting timing info
18:27:18.826264 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.calc__error
18:27:18.831618 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.calc__dim_price_index_1"
18:27:18.832186 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.stg__fct_transaction
18:27:18.832719 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.stg__fct_item
18:27:18.833450 [debug] [Thread-3  ]: finished collecting timing info
18:27:18.834395 [debug] [Thread-1  ]: finished collecting timing info
18:27:18.835136 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.stg__fct_item"
18:27:18.835765 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.stg__dim_same_store
18:27:18.836891 [debug] [Thread-4  ]: finished collecting timing info
18:27:18.837876 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.stg__fct_transaction
18:27:18.838318 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.stg__fct_item
18:27:18.838703 [debug] [Thread-3  ]: finished collecting timing info
18:27:18.839037 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.calc__dim_price_index_1
18:27:18.839355 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.stg__fct_tender
18:27:18.839712 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.stg__fct_item
18:27:18.840675 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.stg__dim_same_store
18:27:18.841073 [debug] [Thread-4  ]: finished collecting timing info
18:27:18.841664 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.stg__fct_tender"
18:27:18.850394 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.stg__fct_item"
18:27:18.850943 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.transaction
18:27:18.851982 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.calc__dim_price_index_1
18:27:18.852399 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.stg__fct_tender
18:27:18.853183 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.transaction"
18:27:18.853688 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.stg__fct_same_store
18:27:18.854067 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.stg__fct_tender
18:27:18.854548 [debug] [Thread-2  ]: finished collecting timing info
18:27:18.854852 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.transaction
18:27:18.855498 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.stg__fct_same_store"
18:27:18.863777 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.stg__fct_tender"
18:27:18.864255 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.stg__fct_item
18:27:18.864637 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.transaction
18:27:18.864975 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.stg__fct_same_store
18:27:18.865496 [debug] [Thread-2  ]: finished collecting timing info
18:27:18.870301 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.transaction"
18:27:18.870689 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.stg__fct_same_store
18:27:18.871038 [debug] [Thread-1  ]: finished collecting timing info
18:27:18.871761 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.stg__fct_item
18:27:18.876765 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.stg__fct_same_store"
18:27:18.877284 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.stg__fct_tender
18:27:18.878078 [debug] [Thread-3  ]: finished collecting timing info
18:27:18.878545 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.item
18:27:18.878881 [debug] [Thread-1  ]: finished collecting timing info
18:27:18.880998 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.stg__fct_tender
18:27:18.879293 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.transaction
18:27:18.881594 [debug] [Thread-3  ]: finished collecting timing info
18:27:18.880313 [debug] [Thread-4  ]: finished collecting timing info
18:27:18.883003 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.stg__fct_same_store
18:27:18.883336 [debug] [Thread-4  ]: finished collecting timing info
18:27:18.883938 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.stg__fct_same_store
18:27:18.882325 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.transaction
18:27:18.879998 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.item"
18:27:18.885077 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.item
18:27:18.885445 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.item
18:27:18.882650 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.tender
18:27:18.884602 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.calc__dim_price_index_2
18:27:18.893271 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_2"
18:27:18.891988 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.tender"
18:27:18.893912 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.tender
18:27:18.893598 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.calc__dim_price_index_2
18:27:18.894203 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.tender
18:27:18.892630 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.item"
18:27:18.894536 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.calc__dim_price_index_2
18:27:18.899189 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.tender"
18:27:18.902649 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.calc__dim_price_index_2"
18:27:18.903296 [debug] [Thread-2  ]: finished collecting timing info
18:27:18.903749 [debug] [Thread-1  ]: finished collecting timing info
18:27:18.903992 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.item
18:27:18.904202 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.tender
18:27:18.904482 [debug] [Thread-2  ]: finished collecting timing info
18:27:18.904769 [debug] [Thread-1  ]: finished collecting timing info
18:27:18.905058 [debug] [Thread-4  ]: finished collecting timing info
18:27:18.905499 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.item
18:27:18.905885 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.tender
18:27:18.906100 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.calc__dim_price_index_2
18:27:18.907220 [debug] [Thread-3  ]: Began running node test.source_of_sales_change_lcarr.not_null_item_trans_id.f3230ec97f
18:27:18.907459 [debug] [Thread-4  ]: finished collecting timing info
18:27:18.907628 [debug] [Thread-2  ]: Began running node test.source_of_sales_change_lcarr.unique_item_trans_id.31db52b29b
18:27:18.907842 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.trans_detail
18:27:18.909926 [debug] [Thread-3  ]: Acquiring new redshift connection "test.source_of_sales_change_lcarr.not_null_item_trans_id.f3230ec97f"
18:27:18.910375 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.calc__dim_price_index_2
18:27:18.910723 [debug] [Thread-2  ]: Acquiring new redshift connection "test.source_of_sales_change_lcarr.unique_item_trans_id.31db52b29b"
18:27:18.911113 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.trans_detail"
18:27:18.911392 [debug] [Thread-3  ]: Began compiling node test.source_of_sales_change_lcarr.not_null_item_trans_id.f3230ec97f
18:27:18.911804 [debug] [Thread-2  ]: Began compiling node test.source_of_sales_change_lcarr.unique_item_trans_id.31db52b29b
18:27:18.912265 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.trans_detail
18:27:18.912474 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.calc__dim_price_index_3
18:27:18.912685 [debug] [Thread-3  ]: Compiling test.source_of_sales_change_lcarr.not_null_item_trans_id.f3230ec97f
18:27:18.912878 [debug] [Thread-2  ]: Compiling test.source_of_sales_change_lcarr.unique_item_trans_id.31db52b29b
18:27:18.913065 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.trans_detail
18:27:18.913434 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_3"
18:27:18.942205 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.calc__dim_price_index_3
18:27:18.925369 [debug] [Thread-3  ]: Writing injected SQL for node "test.source_of_sales_change_lcarr.not_null_item_trans_id.f3230ec97f"
18:27:18.936392 [debug] [Thread-2  ]: Writing injected SQL for node "test.source_of_sales_change_lcarr.unique_item_trans_id.31db52b29b"
18:27:18.942543 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.calc__dim_price_index_3
18:27:18.941735 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.trans_detail"
18:27:18.948208 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.calc__dim_price_index_3"
18:27:18.949299 [debug] [Thread-2  ]: finished collecting timing info
18:27:18.949773 [debug] [Thread-2  ]: Began executing node test.source_of_sales_change_lcarr.unique_item_trans_id.31db52b29b
18:27:18.950190 [debug] [Thread-2  ]: finished collecting timing info
18:27:18.950562 [debug] [Thread-3  ]: finished collecting timing info
18:27:18.951276 [debug] [Thread-2  ]: Finished running node test.source_of_sales_change_lcarr.unique_item_trans_id.31db52b29b
18:27:18.951731 [debug] [Thread-3  ]: Began executing node test.source_of_sales_change_lcarr.not_null_item_trans_id.f3230ec97f
18:27:18.952021 [debug] [Thread-1  ]: finished collecting timing info
18:27:18.952609 [debug] [Thread-4  ]: finished collecting timing info
18:27:18.953896 [debug] [Thread-3  ]: finished collecting timing info
18:27:18.954283 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.trans_detail
18:27:18.954623 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.calc__dim_price_index_3
18:27:18.955371 [debug] [Thread-3  ]: Finished running node test.source_of_sales_change_lcarr.not_null_item_trans_id.f3230ec97f
18:27:18.955771 [debug] [Thread-1  ]: finished collecting timing info
18:27:18.956311 [debug] [Thread-4  ]: finished collecting timing info
18:27:18.957408 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.trans_detail
18:27:18.958035 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.calc__dim_price_index_3
18:27:18.958970 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.trans_item
18:27:18.959680 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.trans_item"
18:27:18.960026 [debug] [Thread-3  ]: Began running node test.source_of_sales_change_lcarr.not_null_trans_detail_trans_id.39702ad66f
18:27:18.960322 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.trans_item
18:27:18.960604 [debug] [Thread-1  ]: Began running node test.source_of_sales_change_lcarr.unique_trans_detail_trans_id.bf19cf4015
18:27:18.961194 [debug] [Thread-3  ]: Acquiring new redshift connection "test.source_of_sales_change_lcarr.not_null_trans_detail_trans_id.39702ad66f"
18:27:18.961649 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.trans_item
18:27:18.962231 [debug] [Thread-1  ]: Acquiring new redshift connection "test.source_of_sales_change_lcarr.unique_trans_detail_trans_id.bf19cf4015"
18:27:18.962574 [debug] [Thread-3  ]: Began compiling node test.source_of_sales_change_lcarr.not_null_trans_detail_trans_id.39702ad66f
18:27:18.968997 [debug] [Thread-3  ]: Compiling test.source_of_sales_change_lcarr.not_null_trans_detail_trans_id.39702ad66f
18:27:18.967738 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.trans_item"
18:27:18.968496 [debug] [Thread-1  ]: Began compiling node test.source_of_sales_change_lcarr.unique_trans_detail_trans_id.bf19cf4015
18:27:18.977352 [debug] [Thread-3  ]: Writing injected SQL for node "test.source_of_sales_change_lcarr.not_null_trans_detail_trans_id.39702ad66f"
18:27:18.978123 [debug] [Thread-1  ]: Compiling test.source_of_sales_change_lcarr.unique_trans_detail_trans_id.bf19cf4015
18:27:18.978684 [debug] [Thread-2  ]: finished collecting timing info
18:27:18.985096 [debug] [Thread-1  ]: Writing injected SQL for node "test.source_of_sales_change_lcarr.unique_trans_detail_trans_id.bf19cf4015"
18:27:18.985699 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.trans_item
18:27:18.986204 [debug] [Thread-3  ]: finished collecting timing info
18:27:18.986920 [debug] [Thread-2  ]: finished collecting timing info
18:27:18.987628 [debug] [Thread-3  ]: Began executing node test.source_of_sales_change_lcarr.not_null_trans_detail_trans_id.39702ad66f
18:27:18.987921 [debug] [Thread-1  ]: finished collecting timing info
18:27:18.989448 [debug] [Thread-1  ]: Began executing node test.source_of_sales_change_lcarr.unique_trans_detail_trans_id.bf19cf4015
18:27:18.988703 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.trans_item
18:27:18.989072 [debug] [Thread-3  ]: finished collecting timing info
18:27:18.990935 [debug] [Thread-3  ]: Finished running node test.source_of_sales_change_lcarr.not_null_trans_detail_trans_id.39702ad66f
18:27:18.989806 [debug] [Thread-1  ]: finished collecting timing info
18:27:18.991636 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.national_agg__all_groupings
18:27:18.992413 [debug] [Thread-1  ]: Finished running node test.source_of_sales_change_lcarr.unique_trans_detail_trans_id.bf19cf4015
18:27:18.992719 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct
18:27:18.993024 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.region_agg__all_groupings
18:27:18.995429 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.region_agg__all_groupings"
18:27:18.995745 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.region_agg__all_groupings
18:27:18.996075 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.region_agg__all_groupings
18:27:18.993631 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national_agg__all_groupings"
18:27:19.004356 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.national_agg__all_groupings
18:27:18.994843 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
18:27:19.003857 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.region_agg__all_groupings"
18:27:19.004684 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.national_agg__all_groupings
18:27:19.005023 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct
18:27:19.013710 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct
18:27:19.016634 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
18:27:18.994024 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct
18:27:19.012492 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national_agg__all_groupings"
18:27:19.017415 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct"
18:27:19.013481 [debug] [Thread-2  ]: finished collecting timing info
18:27:19.018105 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct
18:27:19.018498 [debug] [Thread-4  ]: finished collecting timing info
18:27:19.018807 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.region_agg__all_groupings
18:27:19.019189 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct
18:27:19.019533 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct
18:27:19.019808 [debug] [Thread-3  ]: finished collecting timing info
18:27:19.020154 [debug] [Thread-2  ]: finished collecting timing info
18:27:19.024548 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct"
18:27:19.025010 [debug] [Thread-4  ]: finished collecting timing info
18:27:19.025267 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.national_agg__all_groupings
18:27:19.025786 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.region_agg__all_groupings
18:27:19.026381 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct
18:27:19.026650 [debug] [Thread-3  ]: finished collecting timing info
18:27:19.027320 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.region_agg__month_lookback
18:27:19.027920 [debug] [Thread-1  ]: finished collecting timing info
18:27:19.028321 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.national_agg__all_groupings
18:27:19.028555 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.national_agg__distinct_calcs
18:27:19.029002 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.region_agg__month_lookback"
18:27:19.029255 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct
18:27:19.029554 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.national_agg__hash_base_calcs
18:27:19.030107 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
18:27:19.030345 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.region_agg__month_lookback
18:27:19.030605 [debug] [Thread-1  ]: finished collecting timing info
18:27:19.030992 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
18:27:19.031200 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.national_agg__distinct_calcs
18:27:19.031486 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.region_agg__month_lookback
18:27:19.031944 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct
18:27:19.032168 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.national_agg__hash_base_calcs
18:27:19.032416 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.national_agg__distinct_calcs
18:27:19.035113 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.region_agg__month_lookback"
18:27:19.035481 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.region_agg__distinct_calcs
18:27:19.035998 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.national_agg__hash_base_calcs
18:27:19.044151 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
18:27:19.044953 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.region_agg__distinct_calcs"
18:27:19.052241 [debug] [Thread-4  ]: finished collecting timing info
18:27:19.056157 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
18:27:19.057396 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.region_agg__distinct_calcs
18:27:19.057793 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.region_agg__month_lookback
18:27:19.059663 [debug] [Thread-4  ]: finished collecting timing info
18:27:19.058724 [debug] [Thread-3  ]: finished collecting timing info
18:27:19.060846 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.national_agg__hash_base_calcs
18:27:19.061191 [debug] [Thread-3  ]: finished collecting timing info
18:27:19.061833 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.national_agg__hash_base_calcs
18:27:19.060414 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.region_agg__month_lookback
18:27:19.062216 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.region_agg__hash_base_calcs
18:27:19.064168 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.region_agg__hash_base_calcs"
18:27:19.062699 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.national_agg__month_lookback
18:27:19.063574 [debug] [Thread-2  ]: finished collecting timing info
18:27:19.064502 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.region_agg__hash_base_calcs
18:27:19.059242 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.region_agg__distinct_calcs
18:27:19.065082 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback"
18:27:19.065538 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.national_agg__distinct_calcs
18:27:19.065914 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.region_agg__hash_base_calcs
18:27:19.072473 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.region_agg__distinct_calcs"
18:27:19.072780 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.national_agg__month_lookback
18:27:19.073426 [debug] [Thread-2  ]: finished collecting timing info
18:27:19.083264 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.national_agg__distinct_calcs
18:27:19.081742 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.region_agg__hash_base_calcs"
18:27:19.082744 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.national_agg__month_lookback
18:27:19.083535 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.region_agg__same_store_all_store
18:27:19.087117 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.region_agg__same_store_all_store"
18:27:19.087325 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.region_agg__same_store_all_store
18:27:19.087508 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.region_agg__same_store_all_store
18:27:19.086598 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national_agg__month_lookback"
18:27:19.091296 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.region_agg__same_store_all_store"
18:27:19.082473 [debug] [Thread-1  ]: finished collecting timing info
18:27:19.092056 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.region_agg__distinct_calcs
18:27:19.092373 [debug] [Thread-1  ]: finished collecting timing info
18:27:19.092789 [debug] [Thread-3  ]: finished collecting timing info
18:27:19.093052 [debug] [Thread-4  ]: finished collecting timing info
18:27:19.093525 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.region_agg__distinct_calcs
18:27:19.093842 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.region_agg__hash_base_calcs
18:27:19.094052 [debug] [Thread-2  ]: finished collecting timing info
18:27:19.094307 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.national_agg__month_lookback
18:27:19.094608 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.national_agg__distinct_join
18:27:19.094996 [debug] [Thread-3  ]: finished collecting timing info
18:27:19.095298 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.region_agg__same_store_all_store
18:27:19.095542 [debug] [Thread-4  ]: finished collecting timing info
18:27:19.095953 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_join"
18:27:19.096395 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.region_agg__hash_base_calcs
18:27:19.096674 [debug] [Thread-2  ]: finished collecting timing info
18:27:19.097075 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.national_agg__month_lookback
18:27:19.097305 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.national_agg__distinct_join
18:27:19.097562 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.region_agg__distinct_join
18:27:19.098107 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.region_agg__same_store_all_store
18:27:19.098680 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.national_agg__same_store_all_store
18:27:19.098881 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.national_agg__distinct_join
18:27:19.099282 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.region_agg__distinct_join"
18:27:19.100167 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"
18:27:19.106219 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.region_agg__distinct_join
18:27:19.106882 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.national_agg__same_store_all_store
18:27:19.107422 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national_agg__distinct_join"
18:27:19.107815 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.region_agg__distinct_join
18:27:19.108144 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.national_agg__same_store_all_store
18:27:19.113663 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.region_agg__distinct_join"
18:27:19.119152 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"
18:27:19.120068 [debug] [Thread-1  ]: finished collecting timing info
18:27:19.120559 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.national_agg__distinct_join
18:27:19.120927 [debug] [Thread-1  ]: finished collecting timing info
18:27:19.121630 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.national_agg__distinct_join
18:27:19.122460 [debug] [Thread-4  ]: finished collecting timing info
18:27:19.123040 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.national_agg__same_store_all_store
18:27:19.123441 [debug] [Thread-4  ]: finished collecting timing info
18:27:19.124496 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.national_agg__same_store_all_store
18:27:19.125057 [debug] [Thread-3  ]: finished collecting timing info
18:27:19.125514 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.region_agg__distinct_join
18:27:19.125861 [debug] [Thread-3  ]: finished collecting timing info
18:27:19.126484 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.region_agg__distinct_join
18:27:19.126866 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.national__big_join
18:27:19.127515 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national__big_join"
18:27:19.127937 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.national__big_join
18:27:19.128247 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.national__big_join
18:27:19.134765 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national__big_join"
18:27:19.135631 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.region__big_join
18:27:19.136533 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.region__big_join"
18:27:19.136911 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.region__big_join
18:27:19.137243 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.region__big_join
18:27:19.144290 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.region__big_join"
18:27:19.145272 [debug] [Thread-3  ]: finished collecting timing info
18:27:19.145681 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.national__big_join
18:27:19.146051 [debug] [Thread-3  ]: finished collecting timing info
18:27:19.146870 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.national__big_join
18:27:19.147565 [debug] [Thread-2  ]: finished collecting timing info
18:27:19.148086 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.region__big_join
18:27:19.148601 [debug] [Thread-2  ]: finished collecting timing info
18:27:19.149331 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.region__big_join
18:27:19.149793 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.national__final_output
18:27:19.150910 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national__final_output"
18:27:19.151543 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.national__final_output
18:27:19.151957 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.region__final_output
18:27:19.152247 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.national__final_output
18:27:19.152904 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.region__final_output"
18:27:19.158853 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.region__final_output
18:27:19.158396 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national__final_output"
18:27:19.159186 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.region__final_output
18:27:19.164457 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.region__final_output"
18:27:19.165355 [debug] [Thread-1  ]: finished collecting timing info
18:27:19.165715 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.region__final_output
18:27:19.166043 [debug] [Thread-1  ]: finished collecting timing info
18:27:19.166691 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.region__final_output
18:27:19.167432 [debug] [Thread-2  ]: finished collecting timing info
18:27:19.167753 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.national__final_output
18:27:19.168066 [debug] [Thread-2  ]: finished collecting timing info
18:27:19.168649 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.national__final_output
18:27:19.170489 [debug] [MainThread]: Connection 'master' was properly closed.
18:27:19.170856 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.region__final_output' was properly closed.
18:27:19.171153 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.national__final_output' was properly closed.
18:27:19.171433 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.national__big_join' was properly closed.
18:27:19.171711 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.national_agg__same_store_all_store' was properly closed.
18:27:19.192602 [info ] [MainThread]: Done.
18:27:19.193469 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f937443eeb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f937443e400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f937443e520>]}


============================== 2022-06-24 18:30:41.272479 | f5fd79aa-349f-4237-a170-6ae99ae34af8 ==============================
18:30:41.272479 [info ] [MainThread]: Running with dbt=1.0.4
18:30:41.273835 [debug] [MainThread]: running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=None, defer=None, event_buffer_size=None, exclude=None, fail_fast=True, full_refresh=False, log_cache_events=False, log_format=None, partial_parse=None, printer_width=None, profile=None, profiles_dir='/Users/lindsay.carr/DBT/environments/redshift_discovery_crn_svc/', project_dir=None, record_timing_info=None, rpc_method='run', select=['region.aggregations_distinct'], selector_name=None, send_anonymous_usage_stats=None, single_threaded=False, state=None, static_parser=None, target=None, threads=None, use_colors=None, use_experimental_parser=None, vars='{}', version_check=None, warn_error=None, which='run', write_json=None)
18:30:41.274333 [debug] [MainThread]: Tracking: tracking
18:30:41.308904 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa345d63700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa345d63af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa345d49340>]}
18:30:41.523349 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
18:30:41.523703 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
18:30:41.525620 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 6 unused configuration paths:
- models.source_of_sales_change_lcarr.market.aggregations
- models.source_of_sales_change_lcarr.ast.aggregations_distinct
- models.source_of_sales_change_lcarr.ast.aggregations
- models.source_of_sales_change_lcarr.market.aggregations_distinct
- models.source_of_sales_change_lcarr.ast.final_output
- models.source_of_sales_change_lcarr.market.final_output

18:30:41.533179 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f5fd79aa-349f-4237-a170-6ae99ae34af8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa345d8aa60>]}
18:30:41.550429 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f5fd79aa-349f-4237-a170-6ae99ae34af8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa345308100>]}
18:30:41.551107 [info ] [MainThread]: Found 40 models, 4 tests, 0 snapshots, 0 analyses, 192 macros, 0 operations, 0 seed files, 11 sources, 0 exposures, 0 metrics
18:30:41.556252 [info ] [MainThread]: 
18:30:41.557089 [debug] [MainThread]: Acquiring new redshift connection "master"
18:30:41.558993 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa"
18:30:41.572712 [debug] [ThreadPool]: Using redshift connection "list_cfa"
18:30:41.573182 [debug] [ThreadPool]: On list_cfa: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa"} */

    select distinct nspname from pg_namespace
  
18:30:41.573496 [debug] [ThreadPool]: Opening a new connection, currently in state init
18:30:41.573730 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:30:51.919406 [debug] [ThreadPool]: Postgres adapter: Got an error when attempting to open a postgres connection: 'connection to server at "prod-useast1-discovery.c5ivm6rlzpod.us-east-1.redshift.amazonaws.com" (10.80.32.28), port 35439 failed: timeout expired
'
18:30:51.920674 [debug] [ThreadPool]: Postgres adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa"} */

    select distinct nspname from pg_namespace
  
18:30:51.921355 [debug] [ThreadPool]: Postgres adapter: Rolling back transaction.
18:30:51.921963 [debug] [ThreadPool]: Postgres adapter: Error running SQL: macro list_schemas
18:30:51.922305 [debug] [ThreadPool]: Postgres adapter: Rolling back transaction.
18:30:51.922738 [debug] [ThreadPool]: On list_cfa: No close available on handle
18:30:51.923868 [debug] [MainThread]: Connection 'master' was properly closed.
18:30:51.924162 [debug] [MainThread]: Connection 'list_cfa' was properly closed.
18:30:51.925982 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa345dea040>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa345d4d430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa345d4d5b0>]}


============================== 2022-06-24 18:31:29.027574 | dab3b6d2-cc3b-456d-8a78-431f74322f05 ==============================
18:31:29.027574 [info ] [MainThread]: Running with dbt=1.0.4
18:31:29.028122 [debug] [MainThread]: running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=None, defer=None, event_buffer_size=None, exclude=None, fail_fast=True, full_refresh=False, log_cache_events=False, log_format=None, partial_parse=None, printer_width=None, profile=None, profiles_dir='/Users/lindsay.carr/DBT/environments/redshift_discovery_crn_svc/', project_dir=None, record_timing_info=None, rpc_method='run', select=['region.aggregations_distinct'], selector_name=None, send_anonymous_usage_stats=None, single_threaded=False, state=None, static_parser=None, target=None, threads=None, use_colors=None, use_experimental_parser=None, vars='{}', version_check=None, warn_error=None, which='run', write_json=None)
18:31:29.028417 [debug] [MainThread]: Tracking: tracking
18:31:29.056225 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9aaa4636d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9aaa463ac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9aaa4491c0>]}
18:31:29.172860 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
18:31:29.173150 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
18:31:29.175185 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 6 unused configuration paths:
- models.source_of_sales_change_lcarr.market.aggregations
- models.source_of_sales_change_lcarr.ast.final_output
- models.source_of_sales_change_lcarr.market.final_output
- models.source_of_sales_change_lcarr.ast.aggregations_distinct
- models.source_of_sales_change_lcarr.ast.aggregations
- models.source_of_sales_change_lcarr.market.aggregations_distinct

18:31:29.187543 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'dab3b6d2-cc3b-456d-8a78-431f74322f05', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9aaa48aa30>]}
18:31:29.212514 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'dab3b6d2-cc3b-456d-8a78-431f74322f05', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9aa9b38130>]}
18:31:29.213031 [info ] [MainThread]: Found 40 models, 4 tests, 0 snapshots, 0 analyses, 192 macros, 0 operations, 0 seed files, 11 sources, 0 exposures, 0 metrics
18:31:29.215992 [info ] [MainThread]: 
18:31:29.216738 [debug] [MainThread]: Acquiring new redshift connection "master"
18:31:29.218080 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa"
18:31:29.230586 [debug] [ThreadPool]: Using redshift connection "list_cfa"
18:31:29.230973 [debug] [ThreadPool]: On list_cfa: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa"} */

    select distinct nspname from pg_namespace
  
18:31:29.231382 [debug] [ThreadPool]: Opening a new connection, currently in state init
18:31:29.231675 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:31:30.216194 [debug] [ThreadPool]: SQL status: SELECT in 0.98 seconds
18:31:30.224250 [debug] [ThreadPool]: On list_cfa: Close
18:31:30.228382 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa_public"
18:31:30.237423 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
18:31:30.237704 [debug] [ThreadPool]: On list_cfa_public: BEGIN
18:31:30.237882 [debug] [ThreadPool]: Opening a new connection, currently in state closed
18:31:30.238058 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:31:30.959407 [debug] [ThreadPool]: SQL status: BEGIN in 0.72 seconds
18:31:30.959757 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
18:31:30.959982 [debug] [ThreadPool]: On list_cfa_public: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa_public"} */
select
      'cfa' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'cfa' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
18:31:31.438162 [debug] [ThreadPool]: SQL status: SELECT in 0.48 seconds
18:31:31.502562 [debug] [ThreadPool]: On list_cfa_public: ROLLBACK
18:31:31.600383 [debug] [ThreadPool]: On list_cfa_public: Close
18:31:31.631472 [debug] [MainThread]: Using redshift connection "master"
18:31:31.631788 [debug] [MainThread]: On master: BEGIN
18:31:31.631999 [debug] [MainThread]: Opening a new connection, currently in state init
18:31:31.632176 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:31:32.319243 [debug] [MainThread]: SQL status: BEGIN in 0.69 seconds
18:31:32.319846 [debug] [MainThread]: Using redshift connection "master"
18:31:32.320115 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
18:31:32.997719 [debug] [MainThread]: SQL status: SELECT in 0.68 seconds
18:31:33.015499 [debug] [MainThread]: On master: ROLLBACK
18:31:33.123828 [debug] [MainThread]: Using redshift connection "master"
18:31:33.124453 [debug] [MainThread]: On master: BEGIN
18:31:33.243265 [debug] [MainThread]: SQL status: BEGIN in 0.12 seconds
18:31:33.243899 [debug] [MainThread]: On master: COMMIT
18:31:33.244192 [debug] [MainThread]: Using redshift connection "master"
18:31:33.244449 [debug] [MainThread]: On master: COMMIT
18:31:33.431202 [debug] [MainThread]: SQL status: COMMIT in 0.19 seconds
18:31:33.431736 [debug] [MainThread]: On master: Close
18:31:33.432877 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
18:31:33.433406 [info ] [MainThread]: 
18:31:33.644148 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.region_agg__distinct_calcs
18:31:33.644462 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.region_agg__distinct_join
18:31:33.644721 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.region_agg__hash_base_calcs
18:31:33.645032 [info ] [Thread-1  ]: 1 of 4 START table model public.lcarr_sosx_region_agg__distinct_calcs........... [RUN]
18:31:33.645275 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct
18:31:33.645609 [info ] [Thread-2  ]: 2 of 4 START table model public.lcarr_sosx_region_agg__distinct_join............ [RUN]
18:31:33.645923 [info ] [Thread-3  ]: 3 of 4 START table model public.lcarr_sosx_region_agg__hash_base_calcs.......... [RUN]
18:31:33.646591 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.region_agg__distinct_calcs"
18:31:33.646913 [info ] [Thread-4  ]: 4 of 4 START table model public.lcarr_sosx_region_agg__month_lookback_distinct.. [RUN]
18:31:33.647644 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.region_agg__distinct_join"
18:31:33.648290 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.region_agg__hash_base_calcs"
18:31:33.648561 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.region_agg__distinct_calcs
18:31:33.649138 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct"
18:31:33.649374 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.region_agg__distinct_join
18:31:33.649571 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.region_agg__hash_base_calcs
18:31:33.649864 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.region_agg__distinct_calcs
18:31:33.650078 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct
18:31:33.650289 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.region_agg__distinct_join
18:31:33.650479 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.region_agg__hash_base_calcs
18:31:33.657366 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.region_agg__distinct_calcs"
18:31:33.657652 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct
18:31:33.661749 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.region_agg__distinct_join"
18:31:33.668854 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.region_agg__hash_base_calcs"
18:31:33.672499 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct"
18:31:33.673987 [debug] [Thread-2  ]: finished collecting timing info
18:31:33.674308 [debug] [Thread-1  ]: finished collecting timing info
18:31:33.674555 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.region_agg__distinct_join
18:31:33.674732 [debug] [Thread-3  ]: finished collecting timing info
18:31:33.675003 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.region_agg__distinct_calcs
18:31:33.675229 [debug] [Thread-4  ]: finished collecting timing info
18:31:33.693687 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.region_agg__hash_base_calcs
18:31:33.725752 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct
18:31:34.051567 [debug] [Thread-2  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.region_agg__distinct_join"
18:31:34.057389 [debug] [Thread-1  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.region_agg__distinct_calcs"
18:31:34.087832 [debug] [Thread-3  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.region_agg__hash_base_calcs"
18:31:34.101270 [debug] [Thread-4  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct"
18:31:34.102103 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__distinct_calcs"
18:31:34.102377 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__distinct_calcs: BEGIN
18:31:34.102565 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:31:34.102768 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:31:34.103220 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__hash_base_calcs"
18:31:34.103492 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__distinct_join"
18:31:34.103767 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct"
18:31:34.104156 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region_agg__hash_base_calcs: BEGIN
18:31:34.104607 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.region_agg__distinct_join: BEGIN
18:31:34.105025 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct: BEGIN
18:31:34.105348 [debug] [Thread-3  ]: Opening a new connection, currently in state init
18:31:34.105699 [debug] [Thread-2  ]: Opening a new connection, currently in state init
18:31:34.106029 [debug] [Thread-4  ]: Opening a new connection, currently in state init
18:31:34.106385 [debug] [Thread-3  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:31:34.106752 [debug] [Thread-2  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:31:34.107189 [debug] [Thread-4  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:31:34.940400 [debug] [Thread-3  ]: SQL status: BEGIN in 0.84 seconds
18:31:34.940934 [debug] [Thread-1  ]: SQL status: BEGIN in 0.84 seconds
18:31:34.941199 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__hash_base_calcs"
18:31:34.941482 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__distinct_calcs"
18:31:34.941764 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region_agg__hash_base_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region_agg__hash_base_calcs"} */


  create  table
    "cfa"."public"."region_agg__hash_base_calcs__dbt_tmp"
    
    
    
  as (
    with hash_base_calcs_all_store as (
    select monthend_date,look_back_period,'All Stores' as same_store,region_name,
    location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,region_name,
    location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,region_name,
    location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,region_name,
    location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,region_name,
    'All' as location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,region_name,
    'All' as location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,region_name,
    'All' as location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,region_name,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6,7
), hash_base_calcs_same_store as (
    select monthend_date,look_back_period,'Same Stores' as same_store,region_name,
    location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,region_name,
    location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,region_name,
    location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,region_name,
    location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,region_name,
    'All' as location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,region_name,
    'All' as location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,region_name,
    'All' as location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,region_name,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6,7
)

select * from hash_base_calcs_all_store 
union 
select * from hash_base_calcs_same_store
  );
18:31:34.942039 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__distinct_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region_agg__distinct_calcs"} */


  create  table
    "cfa"."public"."region_agg__distinct_calcs__dbt_tmp"
    
    
    
  as (
    with distinct_calcs_all_store as (
    select monthend_date,look_back_period,'All Stores' as same_store,region_name,
    location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,region_name,
    location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,region_name,
    location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,region_name,
    location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,region_name,
    'All' as location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,region_name,
    'All' as location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,region_name,
    'All' as location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,region_name,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6,7
), distinct_calcs_same_store as (
    select monthend_date,look_back_period,'Same Stores' as same_store,region_name,
    location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,region_name,
    location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,region_name,
    location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,region_name,
    location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,region_name,
    'All' as location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,region_name,
    'All' as location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,region_name,
    'All' as location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,region_name,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6,7
)

select * from distinct_calcs_all_store 
union 
select * from distinct_calcs_same_store
  );
18:31:34.951658 [debug] [Thread-2  ]: SQL status: BEGIN in 0.85 seconds
18:31:34.952022 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__distinct_join"
18:31:34.952296 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.region_agg__distinct_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region_agg__distinct_join"} */


  create  table
    "cfa"."public"."region_agg__distinct_join__dbt_tmp"
    
    
    
  as (
    with distinct_calcs_join as (
    select a.monthend_date,a.look_back_period,a.same_store,a.region_name,
    a.location_type_code,a.daypart,a.destination_desc,
    a.unique_cfa_one_ids,a.unique_hashes,a.hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_national_agg__distinct_calcs" a
    inner join "cfa"."public"."lcarr_sosx_national_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period
    and a.same_store = b.same_store
    and a.region_name = b.region_name 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
) 
select * from distinct_calcs_join
  );
18:31:35.003385 [debug] [Thread-4  ]: SQL status: BEGIN in 0.9 seconds
18:31:35.003945 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct"
18:31:35.004198 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct"} */


  create  table
    "cfa"."public"."region_agg__month_lookback_distinct__dbt_tmp"
    
    
    
  as (
    with one_month_set_up as (
  select a.region_name,a.service_team_name,a.dma_name,
  a.location_num,a.monthend_date,'1 month' as look_back_period,
  a.trans_id,a.cfa_one_id,a.customer_hash,
  a.location_type_code,a.daypart,a.destination_desc,
  b.same_store_eligible
  from "cfa"."public"."lcarr_sosx_trans_item" a
  inner join "cfa"."public"."lcarr_sosx_stg__fct_same_store" b
  on a.location_num = b.location_num
  and a.monthend_date = b.monthend_date 
  and b.look_back_period = '1 month'
)
select * from one_month_set_up
  );
18:31:35.061043 [debug] [Thread-2  ]: Postgres adapter: Postgres error: column a.region_name does not exist

18:31:35.061657 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.region_agg__distinct_join: ROLLBACK
18:31:35.120772 [debug] [Thread-2  ]: finished collecting timing info
18:31:35.121178 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.region_agg__distinct_join: Close
18:31:35.122063 [debug] [Thread-2  ]: Database Error in model region_agg__distinct_join (models/region/aggregations_distinct/region_agg__distinct_join.sql)
  column a.region_name does not exist
  compiled SQL at target/run/source_of_sales_change_lcarr/models/region/aggregations_distinct/region_agg__distinct_join.sql
18:31:35.122497 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dab3b6d2-cc3b-456d-8a78-431f74322f05', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9aaaa529a0>]}
18:31:35.122954 [error] [Thread-2  ]: 2 of 4 ERROR creating table model public.lcarr_sosx_region_agg__distinct_join... [[31mERROR[0m in 1.48s]
18:31:35.123936 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.region_agg__distinct_join
18:31:35.137077 [debug] [MainThread]: Acquiring new redshift connection "master"
18:31:35.137900 [debug] [MainThread]: Postgres adapter: Cancelling query 'model.source_of_sales_change_lcarr.region_agg__distinct_calcs' (1094332949)
18:31:35.138374 [debug] [MainThread]: Using redshift connection "master"
18:31:35.138758 [debug] [MainThread]: On master: BEGIN
18:31:35.139170 [debug] [MainThread]: Opening a new connection, currently in state closed
18:31:35.139604 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:31:35.846625 [debug] [MainThread]: SQL status: BEGIN in 0.71 seconds
18:31:35.848189 [debug] [MainThread]: Using redshift connection "master"
18:31:35.849245 [debug] [MainThread]: On master: select pg_terminate_backend(1094332949)
18:31:35.910003 [debug] [MainThread]: SQL status: SELECT in 0.06 seconds
18:31:35.910537 [debug] [MainThread]: Postgres adapter: Cancel query 'model.source_of_sales_change_lcarr.region_agg__distinct_calcs': (1,)
18:31:35.910868 [debug] [MainThread]: Postgres adapter: Cancelling query 'model.source_of_sales_change_lcarr.region_agg__hash_base_calcs' (1094210290)
18:31:35.911172 [debug] [MainThread]: Using redshift connection "master"
18:31:35.911483 [debug] [MainThread]: On master: select pg_terminate_backend(1094210290)
18:31:36.060990 [debug] [MainThread]: SQL status: SELECT in 0.15 seconds
18:31:36.061505 [debug] [Thread-1  ]: Postgres adapter: Postgres error: Query (201520365) cancelled on user's request

18:31:36.061839 [debug] [MainThread]: Postgres adapter: Cancel query 'model.source_of_sales_change_lcarr.region_agg__hash_base_calcs': (1,)
18:31:36.062195 [debug] [MainThread]: Postgres adapter: Cancelling query 'model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct' (1094218512)
18:31:36.062410 [debug] [MainThread]: Using redshift connection "master"
18:31:36.062614 [debug] [MainThread]: On master: select pg_terminate_backend(1094218512)
18:31:36.100052 [debug] [Thread-3  ]: Postgres adapter: Postgres error: Query (201520366) cancelled on user's request

18:31:36.128511 [debug] [MainThread]: SQL status: SELECT in 0.07 seconds
18:31:36.129169 [debug] [MainThread]: Postgres adapter: Cancel query 'model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct': (1,)
18:31:36.129501 [error] [MainThread]: CANCEL query model.source_of_sales_change_lcarr.region_agg__distinct_calcs...... [[31mCANCEL[0m]
18:31:36.129812 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__distinct_calcs: ROLLBACK
18:31:36.130295 [error] [MainThread]: CANCEL query model.source_of_sales_change_lcarr.region_agg__distinct_join....... [[31mCANCEL[0m]
18:31:36.130594 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region_agg__hash_base_calcs: ROLLBACK
18:31:36.131682 [debug] [Thread-1  ]: Failed to rollback 'model.source_of_sales_change_lcarr.region_agg__distinct_calcs'
18:31:36.132117 [error] [MainThread]: CANCEL query model.source_of_sales_change_lcarr.region_agg__hash_base_calcs..... [[31mCANCEL[0m]
18:31:36.132782 [debug] [Thread-1  ]: finished collecting timing info
18:31:36.133352 [error] [MainThread]: CANCEL query model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct [[31mCANCEL[0m]
18:31:36.133612 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__distinct_calcs: Close
18:31:36.134147 [debug] [MainThread]: On master: ROLLBACK
18:31:36.134659 [debug] [Thread-1  ]: Database Error in model region_agg__distinct_calcs (models/region/aggregations_distinct/region_agg__distinct_calcs.sql)
  Query (201520365) cancelled on user's request
  compiled SQL at target/run/source_of_sales_change_lcarr/models/region/aggregations_distinct/region_agg__distinct_calcs.sql
18:31:36.135378 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dab3b6d2-cc3b-456d-8a78-431f74322f05', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9aaaa58ca0>]}
18:31:36.135956 [error] [Thread-1  ]: 1 of 4 ERROR creating table model public.lcarr_sosx_region_agg__distinct_calcs.. [[31mERROR[0m in 2.49s]
18:31:36.136460 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.region_agg__distinct_calcs
18:31:36.141868 [debug] [Thread-3  ]: Failed to rollback 'model.source_of_sales_change_lcarr.region_agg__hash_base_calcs'
18:31:36.142488 [debug] [Thread-3  ]: finished collecting timing info
18:31:36.142937 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region_agg__hash_base_calcs: Close
18:31:36.143421 [debug] [Thread-3  ]: Database Error in model region_agg__hash_base_calcs (models/region/aggregations_distinct/region_agg__hash_base_calcs.sql)
  Query (201520366) cancelled on user's request
  compiled SQL at target/run/source_of_sales_change_lcarr/models/region/aggregations_distinct/region_agg__hash_base_calcs.sql
18:31:36.143780 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dab3b6d2-cc3b-456d-8a78-431f74322f05', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9aaaa600d0>]}
18:31:36.144214 [error] [Thread-3  ]: 3 of 4 ERROR creating table model public.lcarr_sosx_region_agg__hash_base_calcs. [[31mERROR[0m in 2.50s]
18:31:36.144624 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.region_agg__hash_base_calcs
18:31:36.235538 [debug] [MainThread]: On master: Close
18:31:36.343040 [debug] [Thread-4  ]: Postgres adapter: Postgres error: terminating connection due to administrator command
SSL connection has been closed unexpectedly

18:31:36.343692 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct: ROLLBACK
18:31:36.343976 [debug] [Thread-4  ]: Failed to rollback 'model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct'
18:31:36.344422 [debug] [Thread-4  ]: finished collecting timing info
18:31:36.344703 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct: Close
18:31:36.345640 [debug] [Thread-4  ]: Database Error in model region_agg__month_lookback_distinct (models/region/aggregations_distinct/region_agg__month_lookback_distinct.sql)
  terminating connection due to administrator command
  SSL connection has been closed unexpectedly
  compiled SQL at target/run/source_of_sales_change_lcarr/models/region/aggregations_distinct/region_agg__month_lookback_distinct.sql
18:31:36.346005 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dab3b6d2-cc3b-456d-8a78-431f74322f05', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9aaaa58f40>]}
18:31:36.346453 [error] [Thread-4  ]: 4 of 4 ERROR creating table model public.lcarr_sosx_region_agg__month_lookback_distinct [[31mERROR[0m in 2.70s]
18:31:36.346887 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct
18:31:36.347387 [info ] [MainThread]: 
18:31:36.347801 [error] [MainThread]: [33mDatabase Error in model region_agg__distinct_join (models/region/aggregations_distinct/region_agg__distinct_join.sql)[0m
18:31:36.348253 [error] [MainThread]:   column a.region_name does not exist
18:31:36.348705 [error] [MainThread]:   compiled SQL at target/run/source_of_sales_change_lcarr/models/region/aggregations_distinct/region_agg__distinct_join.sql
18:31:36.349209 [debug] [MainThread]: Connection 'master' was properly closed.
18:31:36.349460 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.region_agg__distinct_calcs' was properly closed.
18:31:36.349656 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.region_agg__distinct_join' was properly closed.
18:31:36.349843 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.region_agg__hash_base_calcs' was properly closed.
18:31:36.350037 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct' was properly closed.
18:31:36.350314 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9aaa401100>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9aaaaf9250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9aaaaf9070>]}


============================== 2022-06-24 18:32:48.897148 | b3ef6def-c74b-4f0d-934a-b4a045cd99aa ==============================
18:32:48.897148 [info ] [MainThread]: Running with dbt=1.0.4
18:32:48.898646 [debug] [MainThread]: running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=None, defer=None, event_buffer_size=None, exclude=None, fail_fast=True, full_refresh=False, log_cache_events=False, log_format=None, partial_parse=None, printer_width=None, profile=None, profiles_dir='/Users/lindsay.carr/DBT/environments/redshift_discovery_crn_svc/', project_dir=None, record_timing_info=None, rpc_method='run', select=['region.aggregations_distinct'], selector_name=None, send_anonymous_usage_stats=None, single_threaded=False, state=None, static_parser=None, target=None, threads=None, use_colors=None, use_experimental_parser=None, vars='{}', version_check=None, warn_error=None, which='run', write_json=None)
18:32:48.899281 [debug] [MainThread]: Tracking: tracking
18:32:48.929676 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd8d4ca36a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd8d4ca3a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd8d4c89280>]}
18:32:49.078784 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 3 files changed.
18:32:49.079595 [debug] [MainThread]: Partial parsing: updated file: source_of_sales_change_lcarr://models/region/aggregations_distinct/region_agg__distinct_calcs.sql
18:32:49.079946 [debug] [MainThread]: Partial parsing: updated file: source_of_sales_change_lcarr://models/region/aggregations_distinct/region_agg__hash_base_calcs.sql
18:32:49.080361 [debug] [MainThread]: Partial parsing: updated file: source_of_sales_change_lcarr://models/region/aggregations_distinct/region_agg__distinct_join.sql
18:32:49.094983 [debug] [MainThread]: 1603: static parser failed on region/aggregations_distinct/region_agg__distinct_calcs.sql
18:32:49.112375 [debug] [MainThread]: 1602: parser fallback to jinja rendering on region/aggregations_distinct/region_agg__distinct_calcs.sql
18:32:49.114689 [debug] [MainThread]: 1603: static parser failed on region/aggregations_distinct/region_agg__hash_base_calcs.sql
18:32:49.122105 [debug] [MainThread]: 1602: parser fallback to jinja rendering on region/aggregations_distinct/region_agg__hash_base_calcs.sql
18:32:49.123815 [debug] [MainThread]: 1699: static parser successfully parsed region/aggregations_distinct/region_agg__distinct_join.sql
18:32:49.133413 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 6 unused configuration paths:
- models.source_of_sales_change_lcarr.market.final_output
- models.source_of_sales_change_lcarr.ast.final_output
- models.source_of_sales_change_lcarr.ast.aggregations
- models.source_of_sales_change_lcarr.market.aggregations_distinct
- models.source_of_sales_change_lcarr.market.aggregations
- models.source_of_sales_change_lcarr.ast.aggregations_distinct

18:32:49.140880 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b3ef6def-c74b-4f0d-934a-b4a045cd99aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd8d4df5d30>]}
18:32:49.161624 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b3ef6def-c74b-4f0d-934a-b4a045cd99aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd8d4dd88e0>]}
18:32:49.162043 [info ] [MainThread]: Found 40 models, 4 tests, 0 snapshots, 0 analyses, 192 macros, 0 operations, 0 seed files, 11 sources, 0 exposures, 0 metrics
18:32:49.164629 [info ] [MainThread]: 
18:32:49.165512 [debug] [MainThread]: Acquiring new redshift connection "master"
18:32:49.167628 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa"
18:32:49.182083 [debug] [ThreadPool]: Using redshift connection "list_cfa"
18:32:49.182460 [debug] [ThreadPool]: On list_cfa: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa"} */

    select distinct nspname from pg_namespace
  
18:32:49.183175 [debug] [ThreadPool]: Opening a new connection, currently in state init
18:32:49.183516 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:32:50.078097 [debug] [ThreadPool]: SQL status: SELECT in 0.89 seconds
18:32:50.086568 [debug] [ThreadPool]: On list_cfa: Close
18:32:50.090908 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa_public"
18:32:50.099030 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
18:32:50.099314 [debug] [ThreadPool]: On list_cfa_public: BEGIN
18:32:50.099491 [debug] [ThreadPool]: Opening a new connection, currently in state closed
18:32:50.099686 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:32:51.248335 [debug] [ThreadPool]: SQL status: BEGIN in 1.15 seconds
18:32:51.249118 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
18:32:51.249473 [debug] [ThreadPool]: On list_cfa_public: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa_public"} */
select
      'cfa' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'cfa' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
18:32:51.550590 [debug] [ThreadPool]: SQL status: SELECT in 0.3 seconds
18:32:51.603911 [debug] [ThreadPool]: On list_cfa_public: ROLLBACK
18:32:51.710551 [debug] [ThreadPool]: On list_cfa_public: Close
18:32:51.745091 [debug] [MainThread]: Using redshift connection "master"
18:32:51.745446 [debug] [MainThread]: On master: BEGIN
18:32:51.745621 [debug] [MainThread]: Opening a new connection, currently in state init
18:32:51.745802 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:32:52.466041 [debug] [MainThread]: SQL status: BEGIN in 0.72 seconds
18:32:52.466670 [debug] [MainThread]: Using redshift connection "master"
18:32:52.467081 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
18:32:53.294608 [debug] [MainThread]: SQL status: SELECT in 0.83 seconds
18:32:53.313815 [debug] [MainThread]: On master: ROLLBACK
18:32:53.477362 [debug] [MainThread]: Using redshift connection "master"
18:32:53.477944 [debug] [MainThread]: On master: BEGIN
18:32:53.594522 [debug] [MainThread]: SQL status: BEGIN in 0.12 seconds
18:32:53.595200 [debug] [MainThread]: On master: COMMIT
18:32:53.595503 [debug] [MainThread]: Using redshift connection "master"
18:32:53.595764 [debug] [MainThread]: On master: COMMIT
18:32:53.845177 [debug] [MainThread]: SQL status: COMMIT in 0.25 seconds
18:32:53.845736 [debug] [MainThread]: On master: Close
18:32:53.846537 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
18:32:53.846968 [info ] [MainThread]: 
18:32:53.857263 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct
18:32:53.858149 [info ] [Thread-1  ]: 1 of 4 START table model public.lcarr_sosx_region_agg__month_lookback_distinct.. [RUN]
18:32:53.859370 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct"
18:32:53.859801 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct
18:32:53.860154 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct
18:32:53.864381 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct"
18:32:53.865244 [debug] [Thread-1  ]: finished collecting timing info
18:32:53.865594 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct
18:32:53.975016 [debug] [Thread-1  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct"
18:32:53.975761 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct"
18:32:53.976047 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct: BEGIN
18:32:53.976359 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:32:53.976688 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:32:54.719337 [debug] [Thread-1  ]: SQL status: BEGIN in 0.74 seconds
18:32:54.720051 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct"
18:32:54.720506 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct"} */


  create  table
    "cfa"."public"."region_agg__month_lookback_distinct__dbt_tmp"
    
    
    
  as (
    with one_month_set_up as (
  select a.region_name,a.service_team_name,a.dma_name,
  a.location_num,a.monthend_date,'1 month' as look_back_period,
  a.trans_id,a.cfa_one_id,a.customer_hash,
  a.location_type_code,a.daypart,a.destination_desc,
  b.same_store_eligible
  from "cfa"."public"."lcarr_sosx_trans_item" a
  inner join "cfa"."public"."lcarr_sosx_stg__fct_same_store" b
  on a.location_num = b.location_num
  and a.monthend_date = b.monthend_date 
  and b.look_back_period = '1 month'
)
select * from one_month_set_up
  );
18:34:19.186490 [debug] [Thread-1  ]: SQL status: SELECT in 84.47 seconds
18:34:19.196596 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct"
18:34:19.196916 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct"} */
alter table "cfa"."public"."region_agg__month_lookback_distinct__dbt_tmp" rename to "lcarr_sosx_region_agg__month_lookback_distinct"
18:34:19.259146 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.06 seconds
18:34:19.274165 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct: COMMIT
18:34:19.274462 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct"
18:34:19.274646 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct: COMMIT
18:34:21.642918 [debug] [Thread-1  ]: SQL status: COMMIT in 2.37 seconds
18:34:21.643661 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct"
18:34:21.643968 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct: BEGIN
18:34:21.704127 [debug] [Thread-1  ]: SQL status: BEGIN in 0.06 seconds
18:34:21.711115 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct"
18:34:21.711416 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct"} */
drop table if exists "cfa"."public"."region_agg__month_lookback_distinct__dbt_backup" cascade
18:34:21.768634 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.06 seconds
18:34:21.770384 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct: COMMIT
18:34:21.770692 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct"
18:34:21.770917 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct: COMMIT
18:34:22.042706 [debug] [Thread-1  ]: SQL status: COMMIT in 0.27 seconds
18:34:22.043449 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct"
18:34:22.043739 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct: BEGIN
18:34:22.106748 [debug] [Thread-1  ]: SQL status: BEGIN in 0.06 seconds
18:34:22.107731 [debug] [Thread-1  ]: finished collecting timing info
18:34:22.108017 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct: ROLLBACK
18:34:22.209539 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct: Close
18:34:22.210802 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b3ef6def-c74b-4f0d-934a-b4a045cd99aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd8d5454a60>]}
18:34:22.211437 [info ] [Thread-1  ]: 1 of 4 OK created table model public.lcarr_sosx_region_agg__month_lookback_distinct [[32mSELECT[0m in 88.35s]
18:34:22.211924 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct
18:34:22.212735 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.region_agg__distinct_calcs
18:34:22.213142 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.region_agg__hash_base_calcs
18:34:22.213505 [info ] [Thread-3  ]: 2 of 4 START table model public.lcarr_sosx_region_agg__distinct_calcs........... [RUN]
18:34:22.214012 [info ] [Thread-4  ]: 3 of 4 START table model public.lcarr_sosx_region_agg__hash_base_calcs.......... [RUN]
18:34:22.214821 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.region_agg__distinct_calcs"
18:34:22.215468 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.region_agg__hash_base_calcs"
18:34:22.215745 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.region_agg__distinct_calcs
18:34:22.215997 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.region_agg__hash_base_calcs
18:34:22.216255 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.region_agg__distinct_calcs
18:34:22.216503 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.region_agg__hash_base_calcs
18:34:22.225437 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.region_agg__distinct_calcs"
18:34:22.233138 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.region_agg__hash_base_calcs"
18:34:22.234106 [debug] [Thread-4  ]: finished collecting timing info
18:34:22.234374 [debug] [Thread-3  ]: finished collecting timing info
18:34:22.234606 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.region_agg__hash_base_calcs
18:34:22.234886 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.region_agg__distinct_calcs
18:34:22.347082 [debug] [Thread-4  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.region_agg__hash_base_calcs"
18:34:22.359633 [debug] [Thread-3  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.region_agg__distinct_calcs"
18:34:22.360491 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__hash_base_calcs"
18:34:22.360810 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__distinct_calcs"
18:34:22.361013 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.region_agg__hash_base_calcs: BEGIN
18:34:22.361279 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region_agg__distinct_calcs: BEGIN
18:34:22.361539 [debug] [Thread-4  ]: Opening a new connection, currently in state init
18:34:22.361814 [debug] [Thread-3  ]: Opening a new connection, currently in state init
18:34:22.362075 [debug] [Thread-4  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:34:22.362348 [debug] [Thread-3  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:34:23.097196 [debug] [Thread-3  ]: SQL status: BEGIN in 0.74 seconds
18:34:23.097801 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__distinct_calcs"
18:34:23.098085 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region_agg__distinct_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region_agg__distinct_calcs"} */


  create  table
    "cfa"."public"."region_agg__distinct_calcs__dbt_tmp"
    
    
    
  as (
    with distinct_calcs_all_store as (
    select monthend_date,look_back_period,'All Stores' as same_store,region_name,
    location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_region_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,region_name,
    location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_region_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,region_name,
    location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_region_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,region_name,
    location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_region_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,region_name,
    'All' as location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_region_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,region_name,
    'All' as location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_region_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,region_name,
    'All' as location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_region_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,region_name,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_region_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6,7
), distinct_calcs_same_store as (
    select monthend_date,look_back_period,'Same Stores' as same_store,region_name,
    location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_region_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,region_name,
    location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_region_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,region_name,
    location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_region_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,region_name,
    location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_region_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,region_name,
    'All' as location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_region_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,region_name,
    'All' as location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_region_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,region_name,
    'All' as location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_region_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,region_name,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_region_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6,7
)

select * from distinct_calcs_all_store 
union 
select * from distinct_calcs_same_store
  );
18:34:23.153466 [debug] [Thread-4  ]: SQL status: BEGIN in 0.79 seconds
18:34:23.153985 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__hash_base_calcs"
18:34:23.154446 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.region_agg__hash_base_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region_agg__hash_base_calcs"} */


  create  table
    "cfa"."public"."region_agg__hash_base_calcs__dbt_tmp"
    
    
    
  as (
    with hash_base_calcs_all_store as (
    select monthend_date,look_back_period,'All Stores' as same_store,region_name,
    location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_region_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,region_name,
    location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_region_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,region_name,
    location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_region_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,region_name,
    location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_region_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,region_name,
    'All' as location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_region_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,region_name,
    'All' as location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_region_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,region_name,
    'All' as location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_region_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,region_name,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_region_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6,7
), hash_base_calcs_same_store as (
    select monthend_date,look_back_period,'Same Stores' as same_store,region_name,
    location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_region_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,region_name,
    location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_region_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,region_name,
    location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_region_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,region_name,
    location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_region_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,region_name,
    'All' as location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_region_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,region_name,
    'All' as location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_region_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,region_name,
    'All' as location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_region_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,region_name,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_region_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6,7
)

select * from hash_base_calcs_all_store 
union 
select * from hash_base_calcs_same_store
  );
18:44:55.569430 [debug] [Thread-4  ]: SQL status: SELECT in 632.41 seconds
18:44:55.577399 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__hash_base_calcs"
18:44:55.577767 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.region_agg__hash_base_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region_agg__hash_base_calcs"} */
alter table "cfa"."public"."region_agg__hash_base_calcs__dbt_tmp" rename to "lcarr_sosx_region_agg__hash_base_calcs"
18:44:55.638125 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.06 seconds
18:44:55.643928 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.region_agg__hash_base_calcs: COMMIT
18:44:55.644268 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__hash_base_calcs"
18:44:55.644494 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.region_agg__hash_base_calcs: COMMIT
18:44:57.248534 [debug] [Thread-4  ]: SQL status: COMMIT in 1.6 seconds
18:44:57.249359 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__hash_base_calcs"
18:44:57.249745 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.region_agg__hash_base_calcs: BEGIN
18:44:57.323509 [debug] [Thread-4  ]: SQL status: BEGIN in 0.07 seconds
18:44:57.326019 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__hash_base_calcs"
18:44:57.326315 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.region_agg__hash_base_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region_agg__hash_base_calcs"} */
drop table if exists "cfa"."public"."region_agg__hash_base_calcs__dbt_backup" cascade
18:44:57.398465 [debug] [Thread-4  ]: SQL status: DROP TABLE in 0.07 seconds
18:44:57.402627 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.region_agg__hash_base_calcs: COMMIT
18:44:57.403018 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__hash_base_calcs"
18:44:57.403291 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.region_agg__hash_base_calcs: COMMIT
18:44:57.520828 [debug] [Thread-4  ]: SQL status: COMMIT in 0.12 seconds
18:44:57.521414 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__hash_base_calcs"
18:44:57.522344 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.region_agg__hash_base_calcs: BEGIN
18:44:57.582101 [debug] [Thread-4  ]: SQL status: BEGIN in 0.06 seconds
18:44:57.583226 [debug] [Thread-4  ]: finished collecting timing info
18:44:57.584003 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.region_agg__hash_base_calcs: ROLLBACK
18:44:57.791057 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.region_agg__hash_base_calcs: Close
18:44:57.798418 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b3ef6def-c74b-4f0d-934a-b4a045cd99aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd8d5395f40>]}
18:44:57.798987 [info ] [Thread-4  ]: 3 of 4 OK created table model public.lcarr_sosx_region_agg__hash_base_calcs..... [[32mSELECT[0m in 635.58s]
18:44:57.799444 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.region_agg__hash_base_calcs
18:55:31.998230 [debug] [Thread-3  ]: SQL status: SELECT in 1268.9 seconds
18:55:32.003633 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__distinct_calcs"
18:55:32.003980 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region_agg__distinct_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region_agg__distinct_calcs"} */
alter table "cfa"."public"."region_agg__distinct_calcs__dbt_tmp" rename to "lcarr_sosx_region_agg__distinct_calcs"
18:55:32.095581 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.09 seconds
18:55:32.101147 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region_agg__distinct_calcs: COMMIT
18:55:32.101567 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__distinct_calcs"
18:55:32.101880 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region_agg__distinct_calcs: COMMIT
18:55:33.839640 [debug] [Thread-3  ]: SQL status: COMMIT in 1.74 seconds
18:55:33.840469 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__distinct_calcs"
18:55:33.840776 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region_agg__distinct_calcs: BEGIN
18:55:33.898281 [debug] [Thread-3  ]: SQL status: BEGIN in 0.06 seconds
18:55:33.900866 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__distinct_calcs"
18:55:33.901202 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region_agg__distinct_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region_agg__distinct_calcs"} */
drop table if exists "cfa"."public"."region_agg__distinct_calcs__dbt_backup" cascade
18:55:33.956736 [debug] [Thread-3  ]: SQL status: DROP TABLE in 0.06 seconds
18:55:33.959964 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region_agg__distinct_calcs: COMMIT
18:55:33.960314 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__distinct_calcs"
18:55:33.960542 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region_agg__distinct_calcs: COMMIT
18:55:35.068341 [debug] [Thread-3  ]: SQL status: COMMIT in 1.11 seconds
18:55:35.069013 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__distinct_calcs"
18:55:35.069301 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region_agg__distinct_calcs: BEGIN
18:55:35.135992 [debug] [Thread-3  ]: SQL status: BEGIN in 0.07 seconds
18:55:35.137187 [debug] [Thread-3  ]: finished collecting timing info
18:55:35.137522 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region_agg__distinct_calcs: ROLLBACK
18:55:35.240147 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region_agg__distinct_calcs: Close
18:55:35.241990 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b3ef6def-c74b-4f0d-934a-b4a045cd99aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd8d5395340>]}
18:55:35.242543 [info ] [Thread-3  ]: 2 of 4 OK created table model public.lcarr_sosx_region_agg__distinct_calcs...... [[32mSELECT[0m in 1273.03s]
18:55:35.243011 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.region_agg__distinct_calcs
18:55:35.243749 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.region_agg__distinct_join
18:55:35.244255 [info ] [Thread-1  ]: 4 of 4 START table model public.lcarr_sosx_region_agg__distinct_join............ [RUN]
18:55:35.245079 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.region_agg__distinct_join"
18:55:35.245340 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.region_agg__distinct_join
18:55:35.245572 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.region_agg__distinct_join
18:55:35.249441 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.region_agg__distinct_join"
18:55:35.252134 [debug] [Thread-1  ]: finished collecting timing info
18:55:35.252570 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.region_agg__distinct_join
18:55:35.318715 [debug] [Thread-1  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.region_agg__distinct_join"
18:55:35.320723 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__distinct_join"
18:55:35.321039 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__distinct_join: BEGIN
18:55:35.321226 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:55:35.321465 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:55:36.208652 [debug] [Thread-1  ]: SQL status: BEGIN in 0.89 seconds
18:55:36.209295 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__distinct_join"
18:55:36.209535 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__distinct_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region_agg__distinct_join"} */


  create  table
    "cfa"."public"."region_agg__distinct_join__dbt_tmp"
    
    
    
  as (
    with distinct_calcs_join as (
    select a.monthend_date,a.look_back_period,a.same_store,a.region_name,
    a.location_type_code,a.daypart,a.destination_desc,
    a.unique_cfa_one_ids,a.unique_hashes,a.hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_region_agg__distinct_calcs" a
    inner join "cfa"."public"."lcarr_sosx_region_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period
    and a.same_store = b.same_store
    and a.region_name = b.region_name 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
) 
select * from distinct_calcs_join
  );
18:55:45.368638 [debug] [Thread-1  ]: SQL status: SELECT in 9.16 seconds
18:55:45.372064 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__distinct_join"
18:55:45.374009 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__distinct_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region_agg__distinct_join"} */
alter table "cfa"."public"."region_agg__distinct_join__dbt_tmp" rename to "lcarr_sosx_region_agg__distinct_join"
18:55:45.430049 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.06 seconds
18:55:45.432079 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__distinct_join: COMMIT
18:55:45.432336 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__distinct_join"
18:55:45.432545 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__distinct_join: COMMIT
18:55:48.589221 [debug] [Thread-1  ]: SQL status: COMMIT in 3.16 seconds
18:55:48.589998 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__distinct_join"
18:55:48.590282 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__distinct_join: BEGIN
18:55:48.651260 [debug] [Thread-1  ]: SQL status: BEGIN in 0.06 seconds
18:55:48.654085 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__distinct_join"
18:55:48.654406 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__distinct_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region_agg__distinct_join"} */
drop table if exists "cfa"."public"."region_agg__distinct_join__dbt_backup" cascade
18:55:48.711949 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.06 seconds
18:55:48.713861 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__distinct_join: COMMIT
18:55:48.714167 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__distinct_join"
18:55:48.714387 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__distinct_join: COMMIT
18:55:48.894982 [debug] [Thread-1  ]: SQL status: COMMIT in 0.18 seconds
18:55:48.895596 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__distinct_join"
18:55:48.895896 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__distinct_join: BEGIN
18:55:48.954107 [debug] [Thread-1  ]: SQL status: BEGIN in 0.06 seconds
18:55:48.954894 [debug] [Thread-1  ]: finished collecting timing info
18:55:48.955178 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__distinct_join: ROLLBACK
18:55:49.053551 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__distinct_join: Close
18:55:49.054588 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b3ef6def-c74b-4f0d-934a-b4a045cd99aa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd8d53a2730>]}
18:55:49.055222 [info ] [Thread-1  ]: 4 of 4 OK created table model public.lcarr_sosx_region_agg__distinct_join....... [[32mSELECT[0m in 13.81s]
18:55:49.055953 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.region_agg__distinct_join
18:55:49.060906 [debug] [MainThread]: Acquiring new redshift connection "master"
18:55:49.061810 [debug] [MainThread]: Using redshift connection "master"
18:55:49.062121 [debug] [MainThread]: On master: BEGIN
18:55:49.062384 [debug] [MainThread]: Opening a new connection, currently in state closed
18:55:49.062674 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:55:49.790332 [debug] [MainThread]: SQL status: BEGIN in 0.73 seconds
18:55:49.790966 [debug] [MainThread]: On master: COMMIT
18:55:49.791252 [debug] [MainThread]: Using redshift connection "master"
18:55:49.791758 [debug] [MainThread]: On master: COMMIT
18:55:50.045520 [debug] [MainThread]: SQL status: COMMIT in 0.25 seconds
18:55:50.045993 [debug] [MainThread]: On master: Close
18:55:50.046899 [info ] [MainThread]: 
18:55:50.047390 [info ] [MainThread]: Finished running 4 table models in 1380.88s.
18:55:50.047808 [debug] [MainThread]: Connection 'master' was properly closed.
18:55:50.048023 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.region_agg__distinct_join' was properly closed.
18:55:50.048210 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.region_agg__distinct_calcs' was properly closed.
18:55:50.048401 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.region_agg__hash_base_calcs' was properly closed.
18:55:50.068383 [info ] [MainThread]: 
18:55:50.069100 [info ] [MainThread]: [32mCompleted successfully[0m
18:55:50.069622 [info ] [MainThread]: 
18:55:50.070022 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
18:55:50.071410 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd8d546bc70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd8d546bb80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd8d546bdc0>]}


============================== 2022-06-24 18:58:28.523659 | 021eda0f-36e5-4478-ab05-c6fb93508482 ==============================
18:58:28.523659 [info ] [MainThread]: Running with dbt=1.0.4
18:58:28.524794 [debug] [MainThread]: running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=None, defer=None, event_buffer_size=None, exclude=None, fail_fast=True, full_refresh=False, log_cache_events=False, log_format=None, partial_parse=None, printer_width=None, profile=None, profiles_dir='/Users/lindsay.carr/DBT/environments/redshift_discovery_crn_svc/', project_dir=None, record_timing_info=None, rpc_method='run', select=['region.aggregations'], selector_name=None, send_anonymous_usage_stats=None, single_threaded=False, state=None, static_parser=None, target=None, threads=None, use_colors=None, use_experimental_parser=None, vars='{}', version_check=None, warn_error=None, which='run', write_json=None)
18:58:28.525367 [debug] [MainThread]: Tracking: tracking
18:58:28.609193 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf2cc63610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf2cc63a00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf2cc6ac10>]}
18:58:28.803412 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
18:58:28.803931 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
18:58:28.807156 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 6 unused configuration paths:
- models.source_of_sales_change_lcarr.market.aggregations
- models.source_of_sales_change_lcarr.ast.final_output
- models.source_of_sales_change_lcarr.ast.aggregations_distinct
- models.source_of_sales_change_lcarr.market.final_output
- models.source_of_sales_change_lcarr.market.aggregations_distinct
- models.source_of_sales_change_lcarr.ast.aggregations

18:58:28.834153 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '021eda0f-36e5-4478-ab05-c6fb93508482', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf2cc8b970>]}
18:58:28.875028 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '021eda0f-36e5-4478-ab05-c6fb93508482', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf2c19d370>]}
18:58:28.875769 [info ] [MainThread]: Found 40 models, 4 tests, 0 snapshots, 0 analyses, 192 macros, 0 operations, 0 seed files, 11 sources, 0 exposures, 0 metrics
18:58:28.884762 [info ] [MainThread]: 
18:58:28.885897 [debug] [MainThread]: Acquiring new redshift connection "master"
18:58:28.887746 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa"
18:58:28.912845 [debug] [ThreadPool]: Using redshift connection "list_cfa"
18:58:28.913589 [debug] [ThreadPool]: On list_cfa: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa"} */

    select distinct nspname from pg_namespace
  
18:58:28.913923 [debug] [ThreadPool]: Opening a new connection, currently in state init
18:58:28.914259 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:58:29.829524 [debug] [ThreadPool]: SQL status: SELECT in 0.92 seconds
18:58:29.842735 [debug] [ThreadPool]: On list_cfa: Close
18:58:29.850637 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa_public"
18:58:29.863224 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
18:58:29.863624 [debug] [ThreadPool]: On list_cfa_public: BEGIN
18:58:29.863928 [debug] [ThreadPool]: Opening a new connection, currently in state closed
18:58:29.864240 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:58:30.539375 [debug] [ThreadPool]: SQL status: BEGIN in 0.68 seconds
18:58:30.539833 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
18:58:30.540144 [debug] [ThreadPool]: On list_cfa_public: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa_public"} */
select
      'cfa' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'cfa' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
18:58:30.819038 [debug] [ThreadPool]: SQL status: SELECT in 0.28 seconds
18:58:30.917563 [debug] [ThreadPool]: On list_cfa_public: ROLLBACK
18:58:31.017186 [debug] [ThreadPool]: On list_cfa_public: Close
18:58:31.073388 [debug] [MainThread]: Using redshift connection "master"
18:58:31.073806 [debug] [MainThread]: On master: BEGIN
18:58:31.074120 [debug] [MainThread]: Opening a new connection, currently in state init
18:58:31.074446 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:58:31.959700 [debug] [MainThread]: SQL status: BEGIN in 0.89 seconds
18:58:31.963034 [debug] [MainThread]: Using redshift connection "master"
18:58:31.963468 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
18:58:32.745750 [debug] [MainThread]: SQL status: SELECT in 0.78 seconds
18:58:32.762538 [debug] [MainThread]: On master: ROLLBACK
18:58:32.867034 [debug] [MainThread]: Using redshift connection "master"
18:58:32.867531 [debug] [MainThread]: On master: BEGIN
18:58:33.031080 [debug] [MainThread]: SQL status: BEGIN in 0.16 seconds
18:58:33.031539 [debug] [MainThread]: On master: COMMIT
18:58:33.031840 [debug] [MainThread]: Using redshift connection "master"
18:58:33.032103 [debug] [MainThread]: On master: COMMIT
18:58:33.128600 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
18:58:33.129270 [debug] [MainThread]: On master: Close
18:58:33.130218 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
18:58:33.130801 [info ] [MainThread]: 
18:58:33.138655 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.region_agg__all_groupings
18:58:33.139275 [info ] [Thread-1  ]: 1 of 3 START table model public.lcarr_sosx_region_agg__all_groupings............ [RUN]
18:58:33.140142 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.region_agg__all_groupings"
18:58:33.140436 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.region_agg__all_groupings
18:58:33.140693 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.region_agg__all_groupings
18:58:33.149560 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.region_agg__all_groupings"
18:58:33.152114 [debug] [Thread-1  ]: finished collecting timing info
18:58:33.152545 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.region_agg__all_groupings
18:58:33.254318 [debug] [Thread-1  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.region_agg__all_groupings"
18:58:33.255229 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__all_groupings"
18:58:33.255443 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__all_groupings: BEGIN
18:58:33.255638 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
18:58:33.255824 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:58:34.474425 [debug] [Thread-1  ]: SQL status: BEGIN in 1.22 seconds
18:58:34.474955 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__all_groupings"
18:58:34.475262 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__all_groupings: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region_agg__all_groupings"} */


  create  table
    "cfa"."public"."region_agg__all_groupings__dbt_tmp"
    
    
    
  as (
    with aggregations_all_groupings as (
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    location_type_code,daypart,destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    location_type_code,'All' as daypart,destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    location_type_code,'All' as daypart,'All' as destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    location_type_code,daypart,'All' as destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    'All' as location_type_code,daypart,'All' as destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    'All' as location_type_code,daypart,destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    'All' as location_type_code,'All' as daypart,destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
) 
select * from aggregations_all_groupings
  );
19:00:55.825113 [debug] [Thread-1  ]: SQL status: SELECT in 141.35 seconds
19:00:55.835324 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__all_groupings"
19:00:55.835684 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__all_groupings: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region_agg__all_groupings"} */
alter table "cfa"."public"."region_agg__all_groupings__dbt_tmp" rename to "lcarr_sosx_region_agg__all_groupings"
19:00:55.891750 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.06 seconds
19:00:55.907655 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__all_groupings: COMMIT
19:00:55.907984 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__all_groupings"
19:00:55.908174 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__all_groupings: COMMIT
19:00:57.699382 [debug] [Thread-1  ]: SQL status: COMMIT in 1.79 seconds
19:00:57.700063 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__all_groupings"
19:00:57.700361 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__all_groupings: BEGIN
19:00:57.768343 [debug] [Thread-1  ]: SQL status: BEGIN in 0.07 seconds
19:00:57.774946 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__all_groupings"
19:00:57.775256 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__all_groupings: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region_agg__all_groupings"} */
drop table if exists "cfa"."public"."region_agg__all_groupings__dbt_backup" cascade
19:00:57.831804 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.06 seconds
19:00:57.833614 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__all_groupings: COMMIT
19:00:57.833999 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__all_groupings"
19:00:57.834228 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__all_groupings: COMMIT
19:00:59.477659 [debug] [Thread-1  ]: SQL status: COMMIT in 1.64 seconds
19:00:59.478251 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__all_groupings"
19:00:59.478544 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__all_groupings: BEGIN
19:00:59.537002 [debug] [Thread-1  ]: SQL status: BEGIN in 0.06 seconds
19:00:59.538261 [debug] [Thread-1  ]: finished collecting timing info
19:00:59.538604 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__all_groupings: ROLLBACK
19:00:59.639248 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__all_groupings: Close
19:00:59.640760 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '021eda0f-36e5-4478-ab05-c6fb93508482', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf2d331c40>]}
19:00:59.641333 [info ] [Thread-1  ]: 1 of 3 OK created table model public.lcarr_sosx_region_agg__all_groupings....... [[32mSELECT[0m in 146.50s]
19:00:59.641821 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.region_agg__all_groupings
19:00:59.642588 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.region_agg__month_lookback
19:00:59.643220 [info ] [Thread-3  ]: 2 of 3 START table model public.lcarr_sosx_region_agg__month_lookback........... [RUN]
19:00:59.643960 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.region_agg__month_lookback"
19:00:59.644239 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.region_agg__month_lookback
19:00:59.644467 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.region_agg__month_lookback
19:00:59.647654 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.region_agg__month_lookback"
19:00:59.650362 [debug] [Thread-3  ]: finished collecting timing info
19:00:59.650710 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.region_agg__month_lookback
19:00:59.715265 [debug] [Thread-3  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.region_agg__month_lookback"
19:00:59.716036 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__month_lookback"
19:00:59.716240 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region_agg__month_lookback: BEGIN
19:00:59.716461 [debug] [Thread-3  ]: Opening a new connection, currently in state init
19:00:59.716644 [debug] [Thread-3  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:01:00.527281 [debug] [Thread-3  ]: SQL status: BEGIN in 0.81 seconds
19:01:00.527952 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__month_lookback"
19:01:00.528250 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region_agg__month_lookback: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region_agg__month_lookback"} */


  create  table
    "cfa"."public"."region_agg__month_lookback__dbt_tmp"
    
    
    
  as (
    with add_month_lookback as (
  select quarter,region_name,service_team_name,dma_name,location_num,
  monthend_date,'1 month' as look_back_period,
  location_type_code,daypart,destination_desc,sales_sub_total,
  transactions,purchaser_visits,credit_txn,
  total_items_promo_count,total_items_sold_count
  from "cfa"."public"."lcarr_sosx_region_agg__all_groupings"
)
select * from add_month_lookback
  );
19:01:02.856635 [debug] [Thread-3  ]: SQL status: SELECT in 2.33 seconds
19:01:02.859896 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__month_lookback"
19:01:02.860202 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region_agg__month_lookback: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region_agg__month_lookback"} */
alter table "cfa"."public"."region_agg__month_lookback__dbt_tmp" rename to "lcarr_sosx_region_agg__month_lookback"
19:01:02.918164 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.06 seconds
19:01:02.920102 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region_agg__month_lookback: COMMIT
19:01:02.920367 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__month_lookback"
19:01:02.920572 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region_agg__month_lookback: COMMIT
19:01:04.598008 [debug] [Thread-3  ]: SQL status: COMMIT in 1.68 seconds
19:01:04.598791 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__month_lookback"
19:01:04.599085 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region_agg__month_lookback: BEGIN
19:01:04.681734 [debug] [Thread-3  ]: SQL status: BEGIN in 0.08 seconds
19:01:04.684382 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__month_lookback"
19:01:04.684698 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region_agg__month_lookback: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region_agg__month_lookback"} */
drop table if exists "cfa"."public"."region_agg__month_lookback__dbt_backup" cascade
19:01:04.742513 [debug] [Thread-3  ]: SQL status: DROP TABLE in 0.06 seconds
19:01:04.744130 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region_agg__month_lookback: COMMIT
19:01:04.744438 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__month_lookback"
19:01:04.744705 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region_agg__month_lookback: COMMIT
19:01:04.859078 [debug] [Thread-3  ]: SQL status: COMMIT in 0.11 seconds
19:01:04.859676 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__month_lookback"
19:01:04.859934 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region_agg__month_lookback: BEGIN
19:01:04.921003 [debug] [Thread-3  ]: SQL status: BEGIN in 0.06 seconds
19:01:04.922111 [debug] [Thread-3  ]: finished collecting timing info
19:01:04.922447 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region_agg__month_lookback: ROLLBACK
19:01:05.108865 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region_agg__month_lookback: Close
19:01:05.110393 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '021eda0f-36e5-4478-ab05-c6fb93508482', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf2d31acd0>]}
19:01:05.110919 [info ] [Thread-3  ]: 2 of 3 OK created table model public.lcarr_sosx_region_agg__month_lookback...... [[32mSELECT[0m in 5.47s]
19:01:05.111380 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.region_agg__month_lookback
19:01:05.112072 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.region_agg__same_store_all_store
19:01:05.112601 [info ] [Thread-2  ]: 3 of 3 START table model public.lcarr_sosx_region_agg__same_store_all_store..... [RUN]
19:01:05.114479 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.region_agg__same_store_all_store"
19:01:05.114780 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.region_agg__same_store_all_store
19:01:05.115014 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.region_agg__same_store_all_store
19:01:05.118752 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.region_agg__same_store_all_store"
19:01:05.121200 [debug] [Thread-2  ]: finished collecting timing info
19:01:05.121533 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.region_agg__same_store_all_store
19:01:05.187376 [debug] [Thread-2  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.region_agg__same_store_all_store"
19:01:05.189420 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__same_store_all_store"
19:01:05.189887 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.region_agg__same_store_all_store: BEGIN
19:01:05.190099 [debug] [Thread-2  ]: Opening a new connection, currently in state init
19:01:05.190463 [debug] [Thread-2  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:01:06.109791 [debug] [Thread-2  ]: SQL status: BEGIN in 0.92 seconds
19:01:06.110162 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__same_store_all_store"
19:01:06.110376 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.region_agg__same_store_all_store: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region_agg__same_store_all_store"} */


  create  table
    "cfa"."public"."region_agg__same_store_all_store__dbt_tmp"
    
    
    
  as (
    with transaction_same_store as (
  select a.*,b.same_store_eligible,b.actual_days,b.avail_days
  from "cfa"."public"."lcarr_sosx_region_agg__month_lookback" a
  left join "cfa"."public"."lcarr_sosx_stg__fct_same_store" b
  on a.location_num = b.location_num
  and a.look_back_period = b.look_back_period
  and a.monthend_date = b.monthend_date
  order by dma_name,location_num,look_back_period,location_type_code,daypart,destination_desc,monthend_date
), transaction_agg_all_stores as ( 
  select quarter,
  monthend_date,look_back_period,'All Stores' as same_store,region_name,
  location_type_code,daypart,destination_desc,
  sum(sales_sub_total) as sales_sub_total,
  sum(transactions) as transactions,sum(purchaser_visits) as purchaser_visits,
  sum(credit_txn) as credit_txn,sum(total_items_promo_count) as total_items_promo_count,
  sum(total_items_sold_count) as total_items_sold_count,
  sum(actual_days) as actual_days, 
  sum(avail_days) as avail_days
  from transaction_same_store
  group by 1,2,3,4,5,6,7,8
), transaction_agg_same_stores as ( 
  select quarter,
  monthend_date,look_back_period,'Same Stores' as same_store,region_name,
  location_type_code,daypart,destination_desc,
  sum(sales_sub_total) as sales_sub_total,
  sum(transactions) as transactions,sum(purchaser_visits) as purchaser_visits,
  sum(credit_txn) as credit_txn,sum(total_items_promo_count) as total_items_promo_count,
  sum(total_items_sold_count) as total_items_sold_count,
  sum(actual_days) as actual_days,
  sum(avail_days) as avail_days
  from transaction_same_store
  where same_store_eligible = 1 
  group by 1,2,3,4,5,6,7,8
), union_all_same_market_transactions as ( 
  select * from region_transaction_agg_all_stores
  union
  select * from region_transaction_agg_same_stores
)
select * from union_all_same_market_transactions
  );
19:01:06.232462 [debug] [Thread-2  ]: Postgres adapter: Postgres error: relation "region_transaction_agg_all_stores" does not exist

19:01:06.232974 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.region_agg__same_store_all_store: ROLLBACK
19:01:06.302700 [debug] [Thread-2  ]: finished collecting timing info
19:01:06.303122 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.region_agg__same_store_all_store: Close
19:01:06.303998 [debug] [Thread-2  ]: Database Error in model region_agg__same_store_all_store (models/region/aggregations/region_agg__same_store_all_store.sql)
  relation "region_transaction_agg_all_stores" does not exist
  compiled SQL at target/run/source_of_sales_change_lcarr/models/region/aggregations/region_agg__same_store_all_store.sql
19:01:06.304501 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '021eda0f-36e5-4478-ab05-c6fb93508482', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf2d42f5e0>]}
19:01:06.305057 [error] [Thread-2  ]: 3 of 3 ERROR creating table model public.lcarr_sosx_region_agg__same_store_all_store [[31mERROR[0m in 1.19s]
19:01:06.305641 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.region_agg__same_store_all_store
19:01:06.307555 [debug] [MainThread]: Acquiring new redshift connection "master"
19:01:06.307934 [error] [MainThread]: CANCEL query model.source_of_sales_change_lcarr.region_agg__all_groupings....... [[31mCANCEL[0m]
19:01:06.308377 [error] [MainThread]: CANCEL query model.source_of_sales_change_lcarr.region_agg__month_lookback...... [[31mCANCEL[0m]
19:01:06.308847 [error] [MainThread]: CANCEL query model.source_of_sales_change_lcarr.region_agg__same_store_all_store [[31mCANCEL[0m]
19:01:06.309529 [info ] [MainThread]: 
19:01:06.309955 [error] [MainThread]: [33mDatabase Error in model region_agg__same_store_all_store (models/region/aggregations/region_agg__same_store_all_store.sql)[0m
19:01:06.310330 [error] [MainThread]:   relation "region_transaction_agg_all_stores" does not exist
19:01:06.310669 [error] [MainThread]:   compiled SQL at target/run/source_of_sales_change_lcarr/models/region/aggregations/region_agg__same_store_all_store.sql
19:01:06.311032 [debug] [MainThread]: Connection 'master' was properly closed.
19:01:06.311230 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.region_agg__all_groupings' was properly closed.
19:01:06.311431 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.region_agg__month_lookback' was properly closed.
19:01:06.311899 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.region_agg__same_store_all_store' was properly closed.
19:01:06.312379 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf2d31aac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf2cc13cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf2d377310>]}


============================== 2022-06-24 19:01:46.523443 | 09db5452-3cb3-4199-903b-b6b2a00f28ba ==============================
19:01:46.523443 [info ] [MainThread]: Running with dbt=1.0.4
19:01:46.524839 [debug] [MainThread]: running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=None, defer=None, event_buffer_size=None, exclude=None, fail_fast=True, full_refresh=False, log_cache_events=False, log_format=None, partial_parse=None, printer_width=None, profile=None, profiles_dir='/Users/lindsay.carr/DBT/environments/redshift_discovery_crn_svc/', project_dir=None, record_timing_info=None, rpc_method='run', select=['region.aggregations'], selector_name=None, send_anonymous_usage_stats=None, single_threaded=False, state=None, static_parser=None, target=None, threads=None, use_colors=None, use_experimental_parser=None, vars='{}', version_check=None, warn_error=None, which='run', write_json=None)
19:01:46.525428 [debug] [MainThread]: Tracking: tracking
19:01:46.556086 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe2c0da4580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe2c0da4970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe2c0daafa0>]}
19:01:46.719051 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
19:01:46.720104 [debug] [MainThread]: Partial parsing: updated file: source_of_sales_change_lcarr://models/region/aggregations/region_agg__same_store_all_store.sql
19:01:46.720727 [debug] [MainThread]: Partial parsing: updated file: source_of_sales_change_lcarr://models/national/aggregations/national_agg__same_store_all_store.sql
19:01:46.740516 [debug] [MainThread]: 1699: static parser successfully parsed region/aggregations/region_agg__same_store_all_store.sql
19:01:46.759894 [debug] [MainThread]: 1699: static parser successfully parsed national/aggregations/national_agg__same_store_all_store.sql
19:01:46.770633 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 6 unused configuration paths:
- models.source_of_sales_change_lcarr.ast.final_output
- models.source_of_sales_change_lcarr.ast.aggregations
- models.source_of_sales_change_lcarr.market.aggregations
- models.source_of_sales_change_lcarr.ast.aggregations_distinct
- models.source_of_sales_change_lcarr.market.aggregations_distinct
- models.source_of_sales_change_lcarr.market.final_output

19:01:46.779910 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '09db5452-3cb3-4199-903b-b6b2a00f28ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe2c0f27f70>]}
19:01:46.796791 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '09db5452-3cb3-4199-903b-b6b2a00f28ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe2c0ebfac0>]}
19:01:46.797432 [info ] [MainThread]: Found 40 models, 4 tests, 0 snapshots, 0 analyses, 192 macros, 0 operations, 0 seed files, 11 sources, 0 exposures, 0 metrics
19:01:46.800003 [info ] [MainThread]: 
19:01:46.800800 [debug] [MainThread]: Acquiring new redshift connection "master"
19:01:46.802071 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa"
19:01:46.813474 [debug] [ThreadPool]: Using redshift connection "list_cfa"
19:01:46.813793 [debug] [ThreadPool]: On list_cfa: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa"} */

    select distinct nspname from pg_namespace
  
19:01:46.813993 [debug] [ThreadPool]: Opening a new connection, currently in state init
19:01:46.814189 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:01:47.866202 [debug] [ThreadPool]: SQL status: SELECT in 1.05 seconds
19:01:47.879093 [debug] [ThreadPool]: On list_cfa: Close
19:01:47.886090 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa_public"
19:01:47.899668 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
19:01:47.900106 [debug] [ThreadPool]: On list_cfa_public: BEGIN
19:01:47.900426 [debug] [ThreadPool]: Opening a new connection, currently in state closed
19:01:47.900819 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:01:48.672169 [debug] [ThreadPool]: SQL status: BEGIN in 0.77 seconds
19:01:48.672855 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
19:01:48.673152 [debug] [ThreadPool]: On list_cfa_public: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa_public"} */
select
      'cfa' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'cfa' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
19:01:49.076439 [debug] [ThreadPool]: SQL status: SELECT in 0.4 seconds
19:01:49.124933 [debug] [ThreadPool]: On list_cfa_public: ROLLBACK
19:01:49.248999 [debug] [ThreadPool]: On list_cfa_public: Close
19:01:49.281620 [debug] [MainThread]: Using redshift connection "master"
19:01:49.281931 [debug] [MainThread]: On master: BEGIN
19:01:49.282144 [debug] [MainThread]: Opening a new connection, currently in state init
19:01:49.282346 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:01:50.374765 [debug] [MainThread]: SQL status: BEGIN in 1.09 seconds
19:01:50.375244 [debug] [MainThread]: Using redshift connection "master"
19:01:50.375520 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
19:01:51.220999 [debug] [MainThread]: SQL status: SELECT in 0.85 seconds
19:01:51.237969 [debug] [MainThread]: On master: ROLLBACK
19:01:51.339408 [debug] [MainThread]: Using redshift connection "master"
19:01:51.339903 [debug] [MainThread]: On master: BEGIN
19:01:51.461826 [debug] [MainThread]: SQL status: BEGIN in 0.12 seconds
19:01:51.462466 [debug] [MainThread]: On master: COMMIT
19:01:51.462760 [debug] [MainThread]: Using redshift connection "master"
19:01:51.463016 [debug] [MainThread]: On master: COMMIT
19:01:51.676093 [debug] [MainThread]: SQL status: COMMIT in 0.21 seconds
19:01:51.676645 [debug] [MainThread]: On master: Close
19:01:51.677438 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
19:01:51.677874 [info ] [MainThread]: 
19:01:51.685788 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.region_agg__all_groupings
19:01:51.686267 [info ] [Thread-1  ]: 1 of 3 START table model public.lcarr_sosx_region_agg__all_groupings............ [RUN]
19:01:51.686983 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.region_agg__all_groupings"
19:01:51.687227 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.region_agg__all_groupings
19:01:51.687466 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.region_agg__all_groupings
19:01:51.692690 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.region_agg__all_groupings"
19:01:51.693827 [debug] [Thread-1  ]: finished collecting timing info
19:01:51.694207 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.region_agg__all_groupings
19:01:51.794070 [debug] [Thread-1  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.region_agg__all_groupings"
19:01:51.794895 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__all_groupings"
19:01:51.795096 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__all_groupings: BEGIN
19:01:51.795317 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
19:01:51.795497 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:01:52.793389 [debug] [Thread-1  ]: SQL status: BEGIN in 1.0 seconds
19:01:52.794052 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__all_groupings"
19:01:52.794336 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__all_groupings: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region_agg__all_groupings"} */


  create  table
    "cfa"."public"."region_agg__all_groupings__dbt_tmp"
    
    
    
  as (
    with aggregations_all_groupings as (
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    location_type_code,daypart,destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    location_type_code,'All' as daypart,destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    location_type_code,'All' as daypart,'All' as destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    location_type_code,daypart,'All' as destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    'All' as location_type_code,daypart,'All' as destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    'All' as location_type_code,daypart,destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    'All' as location_type_code,'All' as daypart,destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
) 
select * from aggregations_all_groupings
  );
19:03:33.780764 [debug] [Thread-1  ]: SQL status: SELECT in 100.99 seconds
19:03:33.789916 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__all_groupings"
19:03:33.790216 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__all_groupings: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region_agg__all_groupings"} */
alter table "cfa"."public"."lcarr_sosx_region_agg__all_groupings" rename to "region_agg__all_groupings__dbt_backup"
19:03:33.859189 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.07 seconds
19:03:33.861774 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__all_groupings"
19:03:33.862101 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__all_groupings: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region_agg__all_groupings"} */
alter table "cfa"."public"."region_agg__all_groupings__dbt_tmp" rename to "lcarr_sosx_region_agg__all_groupings"
19:03:33.929390 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.07 seconds
19:03:33.944548 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__all_groupings: COMMIT
19:03:33.944880 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__all_groupings"
19:03:33.945081 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__all_groupings: COMMIT
19:03:35.847936 [debug] [Thread-1  ]: SQL status: COMMIT in 1.9 seconds
19:03:35.848670 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__all_groupings"
19:03:35.848906 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__all_groupings: BEGIN
19:03:35.920389 [debug] [Thread-1  ]: SQL status: BEGIN in 0.07 seconds
19:03:35.928263 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__all_groupings"
19:03:35.928569 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__all_groupings: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region_agg__all_groupings"} */
drop table if exists "cfa"."public"."region_agg__all_groupings__dbt_backup" cascade
19:03:36.004255 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.08 seconds
19:03:36.005837 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__all_groupings: COMMIT
19:03:36.006156 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__all_groupings"
19:03:36.006419 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__all_groupings: COMMIT
19:03:37.688775 [debug] [Thread-1  ]: SQL status: COMMIT in 1.68 seconds
19:03:37.689342 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__all_groupings"
19:03:37.689582 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__all_groupings: BEGIN
19:03:37.844455 [debug] [Thread-1  ]: SQL status: BEGIN in 0.15 seconds
19:03:37.845380 [debug] [Thread-1  ]: finished collecting timing info
19:03:37.845672 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__all_groupings: ROLLBACK
19:03:38.307511 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region_agg__all_groupings: Close
19:03:38.308475 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '09db5452-3cb3-4199-903b-b6b2a00f28ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe2c14d1430>]}
19:03:38.309043 [info ] [Thread-1  ]: 1 of 3 OK created table model public.lcarr_sosx_region_agg__all_groupings....... [[32mSELECT[0m in 106.62s]
19:03:38.309504 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.region_agg__all_groupings
19:03:38.310239 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.region_agg__month_lookback
19:03:38.310760 [info ] [Thread-3  ]: 2 of 3 START table model public.lcarr_sosx_region_agg__month_lookback........... [RUN]
19:03:38.311609 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.region_agg__month_lookback"
19:03:38.311891 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.region_agg__month_lookback
19:03:38.312116 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.region_agg__month_lookback
19:03:38.316532 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.region_agg__month_lookback"
19:03:38.319269 [debug] [Thread-3  ]: finished collecting timing info
19:03:38.319632 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.region_agg__month_lookback
19:03:38.385020 [debug] [Thread-3  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.region_agg__month_lookback"
19:03:38.385750 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__month_lookback"
19:03:38.385952 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region_agg__month_lookback: BEGIN
19:03:38.386179 [debug] [Thread-3  ]: Opening a new connection, currently in state init
19:03:38.386357 [debug] [Thread-3  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:03:39.185587 [debug] [Thread-3  ]: SQL status: BEGIN in 0.8 seconds
19:03:39.186083 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__month_lookback"
19:03:39.186402 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region_agg__month_lookback: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region_agg__month_lookback"} */


  create  table
    "cfa"."public"."region_agg__month_lookback__dbt_tmp"
    
    
    
  as (
    with add_month_lookback as (
  select quarter,region_name,service_team_name,dma_name,location_num,
  monthend_date,'1 month' as look_back_period,
  location_type_code,daypart,destination_desc,sales_sub_total,
  transactions,purchaser_visits,credit_txn,
  total_items_promo_count,total_items_sold_count
  from "cfa"."public"."lcarr_sosx_region_agg__all_groupings"
)
select * from add_month_lookback
  );
19:03:41.171166 [debug] [Thread-3  ]: SQL status: SELECT in 1.98 seconds
19:03:41.175704 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__month_lookback"
19:03:41.176017 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region_agg__month_lookback: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region_agg__month_lookback"} */
alter table "cfa"."public"."lcarr_sosx_region_agg__month_lookback" rename to "region_agg__month_lookback__dbt_backup"
19:03:41.266529 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.09 seconds
19:03:41.269577 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__month_lookback"
19:03:41.269869 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region_agg__month_lookback: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region_agg__month_lookback"} */
alter table "cfa"."public"."region_agg__month_lookback__dbt_tmp" rename to "lcarr_sosx_region_agg__month_lookback"
19:03:41.354111 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.08 seconds
19:03:41.356585 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region_agg__month_lookback: COMMIT
19:03:41.357095 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__month_lookback"
19:03:41.357325 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region_agg__month_lookback: COMMIT
19:03:42.826855 [debug] [Thread-3  ]: SQL status: COMMIT in 1.47 seconds
19:03:42.827835 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__month_lookback"
19:03:42.828141 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region_agg__month_lookback: BEGIN
19:03:42.900743 [debug] [Thread-3  ]: SQL status: BEGIN in 0.07 seconds
19:03:42.904730 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__month_lookback"
19:03:42.905011 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region_agg__month_lookback: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region_agg__month_lookback"} */
drop table if exists "cfa"."public"."region_agg__month_lookback__dbt_backup" cascade
19:03:43.028068 [debug] [Thread-3  ]: SQL status: DROP TABLE in 0.12 seconds
19:03:43.029815 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region_agg__month_lookback: COMMIT
19:03:43.030130 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__month_lookback"
19:03:43.030393 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region_agg__month_lookback: COMMIT
19:03:43.875476 [debug] [Thread-3  ]: SQL status: COMMIT in 0.84 seconds
19:03:43.875880 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__month_lookback"
19:03:43.876105 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region_agg__month_lookback: BEGIN
19:03:43.985875 [debug] [Thread-3  ]: SQL status: BEGIN in 0.11 seconds
19:03:43.986628 [debug] [Thread-3  ]: finished collecting timing info
19:03:43.986895 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region_agg__month_lookback: ROLLBACK
19:03:46.700896 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region_agg__month_lookback: Close
19:03:46.702147 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '09db5452-3cb3-4199-903b-b6b2a00f28ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe2c15a34c0>]}
19:03:46.702677 [info ] [Thread-3  ]: 2 of 3 OK created table model public.lcarr_sosx_region_agg__month_lookback...... [[32mSELECT[0m in 8.39s]
19:03:46.703146 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.region_agg__month_lookback
19:03:46.703822 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.region_agg__same_store_all_store
19:03:46.704414 [info ] [Thread-2  ]: 3 of 3 START table model public.lcarr_sosx_region_agg__same_store_all_store..... [RUN]
19:03:46.705170 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.region_agg__same_store_all_store"
19:03:46.705429 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.region_agg__same_store_all_store
19:03:46.705660 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.region_agg__same_store_all_store
19:03:46.709227 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.region_agg__same_store_all_store"
19:03:46.709986 [debug] [Thread-2  ]: finished collecting timing info
19:03:46.710283 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.region_agg__same_store_all_store
19:03:46.775214 [debug] [Thread-2  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.region_agg__same_store_all_store"
19:03:46.775896 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__same_store_all_store"
19:03:46.776093 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.region_agg__same_store_all_store: BEGIN
19:03:46.776365 [debug] [Thread-2  ]: Opening a new connection, currently in state init
19:03:46.776589 [debug] [Thread-2  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:03:47.665501 [debug] [Thread-2  ]: SQL status: BEGIN in 0.89 seconds
19:03:47.666020 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__same_store_all_store"
19:03:47.666310 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.region_agg__same_store_all_store: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region_agg__same_store_all_store"} */


  create  table
    "cfa"."public"."region_agg__same_store_all_store__dbt_tmp"
    
    
    
  as (
    with transaction_same_store as (
  select a.*,b.same_store_eligible,b.actual_days,b.avail_days
  from "cfa"."public"."lcarr_sosx_region_agg__month_lookback" a
  left join "cfa"."public"."lcarr_sosx_stg__fct_same_store" b
  on a.location_num = b.location_num
  and a.look_back_period = b.look_back_period
  and a.monthend_date = b.monthend_date
  order by dma_name,location_num,look_back_period,location_type_code,daypart,destination_desc,monthend_date
), transaction_agg_all_stores as ( 
  select quarter,
  monthend_date,look_back_period,'All Stores' as same_store,region_name,
  location_type_code,daypart,destination_desc,
  sum(sales_sub_total) as sales_sub_total,
  sum(transactions) as transactions,sum(purchaser_visits) as purchaser_visits,
  sum(credit_txn) as credit_txn,sum(total_items_promo_count) as total_items_promo_count,
  sum(total_items_sold_count) as total_items_sold_count,
  sum(actual_days) as actual_days, 
  sum(avail_days) as avail_days
  from transaction_same_store
  group by 1,2,3,4,5,6,7,8
), transaction_agg_same_stores as ( 
  select quarter,
  monthend_date,look_back_period,'Same Stores' as same_store,region_name,
  location_type_code,daypart,destination_desc,
  sum(sales_sub_total) as sales_sub_total,
  sum(transactions) as transactions,sum(purchaser_visits) as purchaser_visits,
  sum(credit_txn) as credit_txn,sum(total_items_promo_count) as total_items_promo_count,
  sum(total_items_sold_count) as total_items_sold_count,
  sum(actual_days) as actual_days,
  sum(avail_days) as avail_days
  from transaction_same_store
  where same_store_eligible = 1 
  group by 1,2,3,4,5,6,7,8
), union_all_same_market_transactions as ( 
  select * from transaction_agg_all_stores
  union
  select * from transaction_agg_same_stores
)
select * from union_all_same_market_transactions
  );
19:04:01.036868 [debug] [Thread-2  ]: SQL status: SELECT in 13.37 seconds
19:04:01.042745 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__same_store_all_store"
19:04:01.043113 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.region_agg__same_store_all_store: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region_agg__same_store_all_store"} */
alter table "cfa"."public"."region_agg__same_store_all_store__dbt_tmp" rename to "lcarr_sosx_region_agg__same_store_all_store"
19:04:01.106034 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.06 seconds
19:04:01.108330 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.region_agg__same_store_all_store: COMMIT
19:04:01.108634 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__same_store_all_store"
19:04:01.108895 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.region_agg__same_store_all_store: COMMIT
19:04:02.530228 [debug] [Thread-2  ]: SQL status: COMMIT in 1.42 seconds
19:04:02.530791 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__same_store_all_store"
19:04:02.531126 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.region_agg__same_store_all_store: BEGIN
19:04:02.597161 [debug] [Thread-2  ]: SQL status: BEGIN in 0.07 seconds
19:04:02.600619 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__same_store_all_store"
19:04:02.600945 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.region_agg__same_store_all_store: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region_agg__same_store_all_store"} */
drop table if exists "cfa"."public"."region_agg__same_store_all_store__dbt_backup" cascade
19:04:02.667212 [debug] [Thread-2  ]: SQL status: DROP TABLE in 0.07 seconds
19:04:02.668841 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.region_agg__same_store_all_store: COMMIT
19:04:02.669140 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__same_store_all_store"
19:04:02.669352 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.region_agg__same_store_all_store: COMMIT
19:04:02.788664 [debug] [Thread-2  ]: SQL status: COMMIT in 0.12 seconds
19:04:02.789297 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.region_agg__same_store_all_store"
19:04:02.789594 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.region_agg__same_store_all_store: BEGIN
19:04:02.848932 [debug] [Thread-2  ]: SQL status: BEGIN in 0.06 seconds
19:04:02.849732 [debug] [Thread-2  ]: finished collecting timing info
19:04:02.850025 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.region_agg__same_store_all_store: ROLLBACK
19:04:03.119245 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.region_agg__same_store_all_store: Close
19:04:03.120816 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '09db5452-3cb3-4199-903b-b6b2a00f28ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe2c14f0520>]}
19:04:03.121354 [info ] [Thread-2  ]: 3 of 3 OK created table model public.lcarr_sosx_region_agg__same_store_all_store [[32mSELECT[0m in 16.42s]
19:04:03.121884 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.region_agg__same_store_all_store
19:04:03.123610 [debug] [MainThread]: Acquiring new redshift connection "master"
19:04:03.123975 [debug] [MainThread]: Using redshift connection "master"
19:04:03.124216 [debug] [MainThread]: On master: BEGIN
19:04:03.124451 [debug] [MainThread]: Opening a new connection, currently in state closed
19:04:03.124680 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:04:04.076842 [debug] [MainThread]: SQL status: BEGIN in 0.95 seconds
19:04:04.077371 [debug] [MainThread]: On master: COMMIT
19:04:04.077656 [debug] [MainThread]: Using redshift connection "master"
19:04:04.077912 [debug] [MainThread]: On master: COMMIT
19:04:04.191903 [debug] [MainThread]: SQL status: COMMIT in 0.11 seconds
19:04:04.192566 [debug] [MainThread]: On master: Close
19:04:04.193531 [info ] [MainThread]: 
19:04:04.194005 [info ] [MainThread]: Finished running 3 table models in 137.39s.
19:04:04.194456 [debug] [MainThread]: Connection 'master' was properly closed.
19:04:04.194686 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.region_agg__all_groupings' was properly closed.
19:04:04.194886 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.region_agg__month_lookback' was properly closed.
19:04:04.195079 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.region_agg__same_store_all_store' was properly closed.
19:04:04.209141 [info ] [MainThread]: 
19:04:04.209630 [info ] [MainThread]: [32mCompleted successfully[0m
19:04:04.210114 [info ] [MainThread]: 
19:04:04.210710 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
19:04:04.211255 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe2c0e295e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe2c0e292e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe2c148a3d0>]}


============================== 2022-06-24 19:04:21.052322 | c2128bd3-198f-472e-804b-ec4f3636d5d9 ==============================
19:04:21.052322 [info ] [MainThread]: Running with dbt=1.0.4
19:04:21.052885 [debug] [MainThread]: running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=None, defer=None, event_buffer_size=None, exclude=None, fail_fast=True, full_refresh=False, log_cache_events=False, log_format=None, partial_parse=None, printer_width=None, profile=None, profiles_dir='/Users/lindsay.carr/DBT/environments/redshift_discovery_crn_svc/', project_dir=None, record_timing_info=None, rpc_method='run', select=['region.final_output'], selector_name=None, send_anonymous_usage_stats=None, single_threaded=False, state=None, static_parser=None, target=None, threads=None, use_colors=None, use_experimental_parser=None, vars='{}', version_check=None, warn_error=None, which='run', write_json=None)
19:04:21.053220 [debug] [MainThread]: Tracking: tracking
19:04:21.084155 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff4354646d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff435464ac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff435449070>]}
19:04:21.275432 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
19:04:21.276213 [debug] [MainThread]: Partial parsing: updated file: source_of_sales_change_lcarr://models/national/aggregations/national_agg__same_store_all_store.sql
19:04:21.290337 [debug] [MainThread]: 1699: static parser successfully parsed national/aggregations/national_agg__same_store_all_store.sql
19:04:21.311523 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 6 unused configuration paths:
- models.source_of_sales_change_lcarr.market.aggregations
- models.source_of_sales_change_lcarr.ast.aggregations
- models.source_of_sales_change_lcarr.market.aggregations_distinct
- models.source_of_sales_change_lcarr.market.final_output
- models.source_of_sales_change_lcarr.ast.final_output
- models.source_of_sales_change_lcarr.ast.aggregations_distinct

19:04:21.318930 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c2128bd3-198f-472e-804b-ec4f3636d5d9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff4355e4940>]}
19:04:21.334700 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c2128bd3-198f-472e-804b-ec4f3636d5d9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff434a12130>]}
19:04:21.335315 [info ] [MainThread]: Found 40 models, 4 tests, 0 snapshots, 0 analyses, 192 macros, 0 operations, 0 seed files, 11 sources, 0 exposures, 0 metrics
19:04:21.338457 [info ] [MainThread]: 
19:04:21.339386 [debug] [MainThread]: Acquiring new redshift connection "master"
19:04:21.341012 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa"
19:04:21.356495 [debug] [ThreadPool]: Using redshift connection "list_cfa"
19:04:21.356804 [debug] [ThreadPool]: On list_cfa: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa"} */

    select distinct nspname from pg_namespace
  
19:04:21.357005 [debug] [ThreadPool]: Opening a new connection, currently in state init
19:04:21.357224 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:04:22.518332 [debug] [ThreadPool]: SQL status: SELECT in 1.16 seconds
19:04:22.526324 [debug] [ThreadPool]: On list_cfa: Close
19:04:22.530271 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa_public"
19:04:22.537954 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
19:04:22.538227 [debug] [ThreadPool]: On list_cfa_public: BEGIN
19:04:22.538403 [debug] [ThreadPool]: Opening a new connection, currently in state closed
19:04:22.538586 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:04:23.691047 [debug] [ThreadPool]: SQL status: BEGIN in 1.15 seconds
19:04:23.691612 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
19:04:23.691882 [debug] [ThreadPool]: On list_cfa_public: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa_public"} */
select
      'cfa' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'cfa' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
19:04:24.009026 [debug] [ThreadPool]: SQL status: SELECT in 0.32 seconds
19:04:24.057572 [debug] [ThreadPool]: On list_cfa_public: ROLLBACK
19:04:24.174361 [debug] [ThreadPool]: On list_cfa_public: Close
19:04:24.217578 [debug] [MainThread]: Using redshift connection "master"
19:04:24.217985 [debug] [MainThread]: On master: BEGIN
19:04:24.218291 [debug] [MainThread]: Opening a new connection, currently in state init
19:04:24.218507 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:04:25.232779 [debug] [MainThread]: SQL status: BEGIN in 1.01 seconds
19:04:25.233245 [debug] [MainThread]: Using redshift connection "master"
19:04:25.233559 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
19:04:26.363783 [debug] [MainThread]: SQL status: SELECT in 1.13 seconds
19:04:26.382102 [debug] [MainThread]: On master: ROLLBACK
19:04:26.550598 [debug] [MainThread]: Using redshift connection "master"
19:04:26.551063 [debug] [MainThread]: On master: BEGIN
19:04:26.691316 [debug] [MainThread]: SQL status: BEGIN in 0.14 seconds
19:04:26.692007 [debug] [MainThread]: On master: COMMIT
19:04:26.692310 [debug] [MainThread]: Using redshift connection "master"
19:04:26.692567 [debug] [MainThread]: On master: COMMIT
19:04:26.858072 [debug] [MainThread]: SQL status: COMMIT in 0.17 seconds
19:04:26.858746 [debug] [MainThread]: On master: Close
19:04:26.860028 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
19:04:26.860554 [info ] [MainThread]: 
19:04:26.868812 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.region__big_join
19:04:26.869296 [info ] [Thread-1  ]: 1 of 2 START table model public.lcarr_sosx_region__big_join..................... [RUN]
19:04:26.870130 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.region__big_join"
19:04:26.870578 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.region__big_join
19:04:26.871019 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.region__big_join
19:04:26.878170 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.region__big_join"
19:04:26.880078 [debug] [Thread-1  ]: finished collecting timing info
19:04:26.880388 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.region__big_join
19:04:26.983960 [debug] [Thread-1  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.region__big_join"
19:04:26.985958 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region__big_join"
19:04:26.986311 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region__big_join: BEGIN
19:04:26.986513 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
19:04:26.986705 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:04:27.966078 [debug] [Thread-1  ]: SQL status: BEGIN in 0.98 seconds
19:04:27.966922 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region__big_join"
19:04:27.967241 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region__big_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region__big_join"} */


  create  table
    "cfa"."public"."region__big_join__dbt_tmp"
    
    
    
  as (
    with big_join as ( 
  select a.*, e.unique_cfa_one_ids, e.unique_hashes, e.hash_transactions, e.hash_per_customer,
  b.price_index, 
  d.previous_year_monthend_date
  from "cfa"."public"."lcarr_sosx_region_agg__same_store_all_store" a
  inner join "cfa"."public"."lcarr_sosx_calc__dim_price_index_3" b
  on a.look_back_period = b.look_back_period
  and a.monthend_date = b.monthend_date
  and a.same_store = b.same_store
  inner join "cfa"."public"."lcarr_sosx_calc__dim_monthend_date" d
  on a.monthend_date = d.monthend_date
  inner join "cfa"."public"."lcarr_sosx_region_agg__distinct_join" e
  on a.monthend_date = e.monthend_date
  and a.look_back_period = e.look_back_period
  and a.same_store = e.same_store
  and a.location_type_code = e.location_type_code
  and a.daypart = e.daypart
  and a.destination_desc = e.destination_desc
)
select * from big_join
  );
19:05:16.939629 [debug] [Thread-1  ]: SQL status: SELECT in 48.97 seconds
19:05:16.948892 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region__big_join"
19:05:16.949230 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region__big_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region__big_join"} */
alter table "cfa"."public"."region__big_join__dbt_tmp" rename to "lcarr_sosx_region__big_join"
19:05:17.007338 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.06 seconds
19:05:17.022371 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region__big_join: COMMIT
19:05:17.022671 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region__big_join"
19:05:17.022862 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region__big_join: COMMIT
19:05:18.885331 [debug] [Thread-1  ]: SQL status: COMMIT in 1.86 seconds
19:05:18.886185 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region__big_join"
19:05:18.886515 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region__big_join: BEGIN
19:05:18.952633 [debug] [Thread-1  ]: SQL status: BEGIN in 0.07 seconds
19:05:18.960580 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region__big_join"
19:05:18.960905 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region__big_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region__big_join"} */
drop table if exists "cfa"."public"."region__big_join__dbt_backup" cascade
19:05:19.019019 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.06 seconds
19:05:19.020546 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region__big_join: COMMIT
19:05:19.020914 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region__big_join"
19:05:19.021205 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region__big_join: COMMIT
19:05:19.142151 [debug] [Thread-1  ]: SQL status: COMMIT in 0.12 seconds
19:05:19.142878 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region__big_join"
19:05:19.143118 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region__big_join: BEGIN
19:05:19.203856 [debug] [Thread-1  ]: SQL status: BEGIN in 0.06 seconds
19:05:19.204675 [debug] [Thread-1  ]: finished collecting timing info
19:05:19.204938 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region__big_join: ROLLBACK
19:05:19.310826 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region__big_join: Close
19:05:19.312118 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c2128bd3-198f-472e-804b-ec4f3636d5d9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff435b73490>]}
19:05:19.312656 [info ] [Thread-1  ]: 1 of 2 OK created table model public.lcarr_sosx_region__big_join................ [[32mSELECT[0m in 52.44s]
19:05:19.313150 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.region__big_join
19:05:19.313988 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.region__final_output
19:05:19.314596 [info ] [Thread-3  ]: 2 of 2 START table model public.lcarr_sosx_region__final_output................. [RUN]
19:05:19.315447 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.region__final_output"
19:05:19.315715 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.region__final_output
19:05:19.315952 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.region__final_output
19:05:19.319896 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.region__final_output"
19:05:19.320667 [debug] [Thread-3  ]: finished collecting timing info
19:05:19.320943 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.region__final_output
19:05:19.385890 [debug] [Thread-3  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.region__final_output"
19:05:19.386867 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region__final_output"
19:05:19.387241 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region__final_output: BEGIN
19:05:19.387489 [debug] [Thread-3  ]: Opening a new connection, currently in state init
19:05:19.387691 [debug] [Thread-3  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:05:20.250433 [debug] [Thread-3  ]: SQL status: BEGIN in 0.86 seconds
19:05:20.250936 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region__final_output"
19:05:20.251203 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region__final_output: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region__final_output"} */


  create  table
    "cfa"."public"."region__final_output__dbt_tmp"
    
    
    
  as (
    with twentytwo as (
select *
from "cfa"."public"."lcarr_sosx_region__big_join" 
where monthend_date = cast('02-28-2022' as date) 
), twentyone as ( 
select * 
from "cfa"."public"."lcarr_sosx_region__big_join"
where monthend_date = cast('02-28-2021' as date)
) 

select a.quarter,
a.look_back_period,a.same_store,
'Region' as geolevel, 
a.region_name as geolevel_detail,
a.location_type_code,a.daypart,a.destination_desc,
a.monthend_date as current_monthend_date,
a.sales_sub_total as current_sales_sub_total,
a.transactions as current_transactions,
a.purchaser_visits as current_purchaser_visits,
a.credit_txn as current_credit_txn,
a.total_items_promo_count as current_total_items_promo_count,
a.total_items_sold_count as current_total_items_sold_count,
a.actual_days as current_actual_days,
a.avail_days as current_avail_days,
a.price_index as current_price_index,
a.unique_cfa_one_ids as current_unique_cfa_one_ids,
a.unique_hashes as current_unique_hashes,
a.hash_transactions as current_hash_transactions,
a.hash_per_customer as current_hash_per_customer,
a.previous_year_monthend_date as check_date,
b.monthend_date as previous_monthend_date,
b.sales_sub_total as previous_sales_sub_total,
b.transactions as previous_transactions,
b.purchaser_visits as previous_purchaser_visits,
b.credit_txn as previous_credit_txn,
b.total_items_promo_count as previous_total_items_promo_count,
b.total_items_sold_count as previous_total_items_sold_count,
b.actual_days as previous_actual_days,
b.avail_days as previous_avail_days,
b.price_index as previous_price_index,
b.unique_cfa_one_ids as previous_unique_cfa_one_ids,
b.unique_hashes as previous_unique_hashes,
b.hash_transactions as previous_hash_transactions,
b.hash_per_customer as previous_hash_per_customer
from twentytwo a 
inner join twentyone b
on a.look_back_period = b.look_back_period 
and a.same_store = b.same_store 
and a.location_type_code = b.location_type_code 
and a.daypart = b.daypart
and a.destination_desc = b.destination_desc
and a.previous_year_monthend_date = b.monthend_date
order by same_store,location_type_code,daypart,destination_desc
  );
19:05:38.750863 [debug] [Thread-3  ]: SQL status: SELECT in 18.5 seconds
19:05:38.755151 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region__final_output"
19:05:38.755485 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region__final_output: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region__final_output"} */
alter table "cfa"."public"."region__final_output__dbt_tmp" rename to "lcarr_sosx_region__final_output"
19:05:38.821839 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.07 seconds
19:05:38.824007 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region__final_output: COMMIT
19:05:38.824331 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region__final_output"
19:05:38.824604 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region__final_output: COMMIT
19:05:40.592831 [debug] [Thread-3  ]: SQL status: COMMIT in 1.77 seconds
19:05:40.593840 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region__final_output"
19:05:40.594158 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region__final_output: BEGIN
19:05:40.655773 [debug] [Thread-3  ]: SQL status: BEGIN in 0.06 seconds
19:05:40.658100 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region__final_output"
19:05:40.658373 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region__final_output: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region__final_output"} */
drop table if exists "cfa"."public"."region__final_output__dbt_backup" cascade
19:05:40.717224 [debug] [Thread-3  ]: SQL status: DROP TABLE in 0.06 seconds
19:05:40.718837 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region__final_output: COMMIT
19:05:40.719139 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region__final_output"
19:05:40.719406 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region__final_output: COMMIT
19:05:40.901875 [debug] [Thread-3  ]: SQL status: COMMIT in 0.18 seconds
19:05:40.902583 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region__final_output"
19:05:40.902842 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region__final_output: BEGIN
19:05:40.963328 [debug] [Thread-3  ]: SQL status: BEGIN in 0.06 seconds
19:05:40.964200 [debug] [Thread-3  ]: finished collecting timing info
19:05:40.964480 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region__final_output: ROLLBACK
19:05:41.070303 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region__final_output: Close
19:05:41.071815 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c2128bd3-198f-472e-804b-ec4f3636d5d9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff435c642b0>]}
19:05:41.072687 [info ] [Thread-3  ]: 2 of 2 OK created table model public.lcarr_sosx_region__final_output............ [[32mSELECT[0m in 21.76s]
19:05:41.073316 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.region__final_output
19:05:41.074965 [debug] [MainThread]: Acquiring new redshift connection "master"
19:05:41.075335 [debug] [MainThread]: Using redshift connection "master"
19:05:41.075583 [debug] [MainThread]: On master: BEGIN
19:05:41.075788 [debug] [MainThread]: Opening a new connection, currently in state closed
19:05:41.076018 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:05:42.129274 [debug] [MainThread]: SQL status: BEGIN in 1.05 seconds
19:05:42.129696 [debug] [MainThread]: On master: COMMIT
19:05:42.129931 [debug] [MainThread]: Using redshift connection "master"
19:05:42.130138 [debug] [MainThread]: On master: COMMIT
19:05:42.242665 [debug] [MainThread]: SQL status: COMMIT in 0.11 seconds
19:05:42.243321 [debug] [MainThread]: On master: Close
19:05:42.244266 [info ] [MainThread]: 
19:05:42.244794 [info ] [MainThread]: Finished running 2 table models in 80.91s.
19:05:42.245339 [debug] [MainThread]: Connection 'master' was properly closed.
19:05:42.245628 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.region__big_join' was properly closed.
19:05:42.245873 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.region__final_output' was properly closed.
19:05:42.261246 [info ] [MainThread]: 
19:05:42.261787 [info ] [MainThread]: [32mCompleted successfully[0m
19:05:42.262258 [info ] [MainThread]: 
19:05:42.262697 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
19:05:42.263185 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff435587d30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff435587b80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff435587c70>]}


============================== 2022-06-24 19:11:55.324018 | 2505bce0-9993-4a34-8b6e-572966c51981 ==============================
19:11:55.324018 [info ] [MainThread]: Running with dbt=1.0.4
19:11:55.325742 [debug] [MainThread]: running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=None, defer=None, event_buffer_size=None, exclude=None, fail_fast=True, full_refresh=False, log_cache_events=False, log_format=None, partial_parse=None, printer_width=None, profile=None, profiles_dir='/Users/lindsay.carr/DBT/environments/redshift_discovery_crn_svc/', project_dir=None, record_timing_info=None, rpc_method='run', select=['region.final_output'], selector_name=None, send_anonymous_usage_stats=None, single_threaded=False, state=None, static_parser=None, target=None, threads=None, use_colors=None, use_experimental_parser=None, vars='{}', version_check=None, warn_error=None, which='run', write_json=None)
19:11:55.326230 [debug] [MainThread]: Tracking: tracking
19:11:55.379198 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf51c645b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf51c649a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf51c6a3a0>]}
19:11:55.598290 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
19:11:55.599360 [debug] [MainThread]: Partial parsing: updated file: source_of_sales_change_lcarr://models/region/final_output/region__big_join.sql
19:11:55.623011 [debug] [MainThread]: 1699: static parser successfully parsed region/final_output/region__big_join.sql
19:11:55.655272 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 6 unused configuration paths:
- models.source_of_sales_change_lcarr.market.aggregations_distinct
- models.source_of_sales_change_lcarr.market.final_output
- models.source_of_sales_change_lcarr.ast.aggregations
- models.source_of_sales_change_lcarr.market.aggregations
- models.source_of_sales_change_lcarr.ast.aggregations_distinct
- models.source_of_sales_change_lcarr.ast.final_output

19:11:55.666925 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2505bce0-9993-4a34-8b6e-572966c51981', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf51de57f0>]}
19:11:55.692479 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2505bce0-9993-4a34-8b6e-572966c51981', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf51c1a190>]}
19:11:55.693146 [info ] [MainThread]: Found 40 models, 4 tests, 0 snapshots, 0 analyses, 192 macros, 0 operations, 0 seed files, 11 sources, 0 exposures, 0 metrics
19:11:55.696818 [info ] [MainThread]: 
19:11:55.697826 [debug] [MainThread]: Acquiring new redshift connection "master"
19:11:55.699892 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa"
19:11:55.716695 [debug] [ThreadPool]: Using redshift connection "list_cfa"
19:11:55.717113 [debug] [ThreadPool]: On list_cfa: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa"} */

    select distinct nspname from pg_namespace
  
19:11:55.717436 [debug] [ThreadPool]: Opening a new connection, currently in state init
19:11:55.717781 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:11:56.680430 [debug] [ThreadPool]: SQL status: SELECT in 0.96 seconds
19:11:56.692972 [debug] [ThreadPool]: On list_cfa: Close
19:11:56.699176 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa_public"
19:11:56.711953 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
19:11:56.712353 [debug] [ThreadPool]: On list_cfa_public: BEGIN
19:11:56.712658 [debug] [ThreadPool]: Opening a new connection, currently in state closed
19:11:56.712967 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:11:57.513210 [debug] [ThreadPool]: SQL status: BEGIN in 0.8 seconds
19:11:57.513631 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
19:11:57.513917 [debug] [ThreadPool]: On list_cfa_public: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa_public"} */
select
      'cfa' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'cfa' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
19:11:57.939630 [debug] [ThreadPool]: SQL status: SELECT in 0.43 seconds
19:11:57.989995 [debug] [ThreadPool]: On list_cfa_public: ROLLBACK
19:11:58.091299 [debug] [ThreadPool]: On list_cfa_public: Close
19:11:58.140840 [debug] [MainThread]: Using redshift connection "master"
19:11:58.141115 [debug] [MainThread]: On master: BEGIN
19:11:58.141290 [debug] [MainThread]: Opening a new connection, currently in state init
19:11:58.141467 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:11:58.990230 [debug] [MainThread]: SQL status: BEGIN in 0.85 seconds
19:11:58.990655 [debug] [MainThread]: Using redshift connection "master"
19:11:58.991234 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
19:11:59.794416 [debug] [MainThread]: SQL status: SELECT in 0.8 seconds
19:11:59.811809 [debug] [MainThread]: On master: ROLLBACK
19:11:59.911070 [debug] [MainThread]: Using redshift connection "master"
19:11:59.911663 [debug] [MainThread]: On master: BEGIN
19:12:00.031166 [debug] [MainThread]: SQL status: BEGIN in 0.12 seconds
19:12:00.031716 [debug] [MainThread]: On master: COMMIT
19:12:00.032011 [debug] [MainThread]: Using redshift connection "master"
19:12:00.032223 [debug] [MainThread]: On master: COMMIT
19:12:00.266547 [debug] [MainThread]: SQL status: COMMIT in 0.23 seconds
19:12:00.267106 [debug] [MainThread]: On master: Close
19:12:00.267919 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
19:12:00.268356 [info ] [MainThread]: 
19:12:00.278417 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.region__big_join
19:12:00.278926 [info ] [Thread-1  ]: 1 of 2 START table model public.lcarr_sosx_region__big_join..................... [RUN]
19:12:00.279772 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.region__big_join"
19:12:00.280017 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.region__big_join
19:12:00.280235 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.region__big_join
19:12:00.285048 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.region__big_join"
19:12:00.292959 [debug] [Thread-1  ]: finished collecting timing info
19:12:00.293416 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.region__big_join
19:12:00.403788 [debug] [Thread-1  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.region__big_join"
19:12:00.405033 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region__big_join"
19:12:00.405337 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region__big_join: BEGIN
19:12:00.405545 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
19:12:00.405745 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:12:01.164199 [debug] [Thread-1  ]: SQL status: BEGIN in 0.76 seconds
19:12:01.164722 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region__big_join"
19:12:01.165003 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region__big_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region__big_join"} */


  create  table
    "cfa"."public"."region__big_join__dbt_tmp"
    
    
    
  as (
    with big_join as ( 
  select a.*, e.unique_cfa_one_ids, e.unique_hashes, e.hash_transactions, e.hash_per_customer,
  b.price_index, 
  d.previous_year_monthend_date
  from "cfa"."public"."lcarr_sosx_region_agg__same_store_all_store" a
  inner join "cfa"."public"."lcarr_sosx_calc__dim_price_index_3" b
  on a.look_back_period = b.look_back_period
  and a.monthend_date = b.monthend_date
  and a.same_store = b.same_store
  inner join "cfa"."public"."lcarr_sosx_calc__dim_monthend_date" d
  on a.monthend_date = d.monthend_date
  inner join "cfa"."public"."lcarr_sosx_region_agg__distinct_join" e
  on a.monthend_date = e.monthend_date
  and a.look_back_period = e.look_back_period
  and a.same_store = e.same_store
  and a.region_name = e.region_name
  and a.location_type_code = e.location_type_code
  and a.daypart = e.daypart
  and a.destination_desc = e.destination_desc
)
select * from big_join
  );
19:12:41.162827 [debug] [Thread-1  ]: SQL status: SELECT in 40.0 seconds
19:12:41.171389 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region__big_join"
19:12:41.171717 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region__big_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region__big_join"} */
alter table "cfa"."public"."lcarr_sosx_region__big_join" rename to "region__big_join__dbt_backup"
19:12:41.237228 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.07 seconds
19:12:41.240262 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region__big_join"
19:12:41.240534 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region__big_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region__big_join"} */
alter table "cfa"."public"."region__big_join__dbt_tmp" rename to "lcarr_sosx_region__big_join"
19:12:41.332927 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.09 seconds
19:12:41.348590 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region__big_join: COMMIT
19:12:41.348898 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region__big_join"
19:12:41.349097 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region__big_join: COMMIT
19:12:42.695911 [debug] [Thread-1  ]: SQL status: COMMIT in 1.35 seconds
19:12:42.698462 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region__big_join"
19:12:42.698879 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region__big_join: BEGIN
19:12:42.757312 [debug] [Thread-1  ]: SQL status: BEGIN in 0.06 seconds
19:12:42.765786 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region__big_join"
19:12:42.766113 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region__big_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region__big_join"} */
drop table if exists "cfa"."public"."region__big_join__dbt_backup" cascade
19:12:42.827733 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.06 seconds
19:12:42.829371 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region__big_join: COMMIT
19:12:42.829712 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region__big_join"
19:12:42.830115 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region__big_join: COMMIT
19:12:44.249675 [debug] [Thread-1  ]: SQL status: COMMIT in 1.42 seconds
19:12:44.250249 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region__big_join"
19:12:44.250544 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region__big_join: BEGIN
19:12:44.312000 [debug] [Thread-1  ]: SQL status: BEGIN in 0.06 seconds
19:12:44.312843 [debug] [Thread-1  ]: finished collecting timing info
19:12:44.313135 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region__big_join: ROLLBACK
19:12:44.418484 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region__big_join: Close
19:12:44.419961 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2505bce0-9993-4a34-8b6e-572966c51981', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf5235e5e0>]}
19:12:44.420596 [info ] [Thread-1  ]: 1 of 2 OK created table model public.lcarr_sosx_region__big_join................ [[32mSELECT[0m in 44.14s]
19:12:44.421620 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.region__big_join
19:12:44.422418 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.region__final_output
19:12:44.423029 [info ] [Thread-3  ]: 2 of 2 START table model public.lcarr_sosx_region__final_output................. [RUN]
19:12:44.423981 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.region__final_output"
19:12:44.424621 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.region__final_output
19:12:44.425149 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.region__final_output
19:12:44.432056 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.region__final_output"
19:12:44.433222 [debug] [Thread-3  ]: finished collecting timing info
19:12:44.433583 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.region__final_output
19:12:44.497978 [debug] [Thread-3  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.region__final_output"
19:12:44.500355 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region__final_output"
19:12:44.500719 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region__final_output: BEGIN
19:12:44.500962 [debug] [Thread-3  ]: Opening a new connection, currently in state init
19:12:44.501162 [debug] [Thread-3  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:12:45.385680 [debug] [Thread-3  ]: SQL status: BEGIN in 0.88 seconds
19:12:45.386157 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region__final_output"
19:12:45.386448 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region__final_output: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region__final_output"} */


  create  table
    "cfa"."public"."region__final_output__dbt_tmp"
    
    
    
  as (
    with twentytwo as (
select *
from "cfa"."public"."lcarr_sosx_region__big_join" 
where monthend_date = cast('02-28-2022' as date) 
), twentyone as ( 
select * 
from "cfa"."public"."lcarr_sosx_region__big_join"
where monthend_date = cast('02-28-2021' as date)
) 

select a.quarter,
a.look_back_period,a.same_store,
'Region' as geolevel, 
a.region_name as geolevel_detail,
a.location_type_code,a.daypart,a.destination_desc,
a.monthend_date as current_monthend_date,
a.sales_sub_total as current_sales_sub_total,
a.transactions as current_transactions,
a.purchaser_visits as current_purchaser_visits,
a.credit_txn as current_credit_txn,
a.total_items_promo_count as current_total_items_promo_count,
a.total_items_sold_count as current_total_items_sold_count,
a.actual_days as current_actual_days,
a.avail_days as current_avail_days,
a.price_index as current_price_index,
a.unique_cfa_one_ids as current_unique_cfa_one_ids,
a.unique_hashes as current_unique_hashes,
a.hash_transactions as current_hash_transactions,
a.hash_per_customer as current_hash_per_customer,
a.previous_year_monthend_date as check_date,
b.monthend_date as previous_monthend_date,
b.sales_sub_total as previous_sales_sub_total,
b.transactions as previous_transactions,
b.purchaser_visits as previous_purchaser_visits,
b.credit_txn as previous_credit_txn,
b.total_items_promo_count as previous_total_items_promo_count,
b.total_items_sold_count as previous_total_items_sold_count,
b.actual_days as previous_actual_days,
b.avail_days as previous_avail_days,
b.price_index as previous_price_index,
b.unique_cfa_one_ids as previous_unique_cfa_one_ids,
b.unique_hashes as previous_unique_hashes,
b.hash_transactions as previous_hash_transactions,
b.hash_per_customer as previous_hash_per_customer
from twentytwo a 
inner join twentyone b
on a.look_back_period = b.look_back_period 
and a.same_store = b.same_store 
and a.location_type_code = b.location_type_code 
and a.daypart = b.daypart
and a.destination_desc = b.destination_desc
and a.previous_year_monthend_date = b.monthend_date
order by same_store,location_type_code,daypart,destination_desc
  );
19:12:51.913104 [debug] [Thread-3  ]: SQL status: SELECT in 6.53 seconds
19:12:51.919220 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region__final_output"
19:12:51.919542 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region__final_output: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region__final_output"} */
alter table "cfa"."public"."lcarr_sosx_region__final_output" rename to "region__final_output__dbt_backup"
19:12:51.976813 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.06 seconds
19:12:51.979901 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region__final_output"
19:12:51.980203 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region__final_output: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region__final_output"} */
alter table "cfa"."public"."region__final_output__dbt_tmp" rename to "lcarr_sosx_region__final_output"
19:12:52.037079 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.06 seconds
19:12:52.039665 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region__final_output: COMMIT
19:12:52.039992 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region__final_output"
19:12:52.040251 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region__final_output: COMMIT
19:12:54.373212 [debug] [Thread-3  ]: SQL status: COMMIT in 2.33 seconds
19:12:54.374103 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region__final_output"
19:12:54.374388 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region__final_output: BEGIN
19:12:54.433905 [debug] [Thread-3  ]: SQL status: BEGIN in 0.06 seconds
19:12:54.437629 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region__final_output"
19:12:54.437902 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region__final_output: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region__final_output"} */
drop table if exists "cfa"."public"."region__final_output__dbt_backup" cascade
19:12:54.499265 [debug] [Thread-3  ]: SQL status: DROP TABLE in 0.06 seconds
19:12:54.501004 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region__final_output: COMMIT
19:12:54.501308 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region__final_output"
19:12:54.501567 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region__final_output: COMMIT
19:12:55.599499 [debug] [Thread-3  ]: SQL status: COMMIT in 1.1 seconds
19:12:55.600053 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region__final_output"
19:12:55.600311 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region__final_output: BEGIN
19:12:55.661139 [debug] [Thread-3  ]: SQL status: BEGIN in 0.06 seconds
19:12:55.662261 [debug] [Thread-3  ]: finished collecting timing info
19:12:55.662580 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region__final_output: ROLLBACK
19:12:55.767239 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region__final_output: Close
19:12:55.768557 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2505bce0-9993-4a34-8b6e-572966c51981', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf523b9eb0>]}
19:12:55.769285 [info ] [Thread-3  ]: 2 of 2 OK created table model public.lcarr_sosx_region__final_output............ [[32mSELECT[0m in 11.34s]
19:12:55.769863 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.region__final_output
19:12:55.779519 [debug] [MainThread]: Acquiring new redshift connection "master"
19:12:55.780005 [debug] [MainThread]: Using redshift connection "master"
19:12:55.780334 [debug] [MainThread]: On master: BEGIN
19:12:55.780645 [debug] [MainThread]: Opening a new connection, currently in state closed
19:12:55.780969 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:12:56.692236 [debug] [MainThread]: SQL status: BEGIN in 0.91 seconds
19:12:56.692867 [debug] [MainThread]: On master: COMMIT
19:12:56.693149 [debug] [MainThread]: Using redshift connection "master"
19:12:56.693409 [debug] [MainThread]: On master: COMMIT
19:12:56.827411 [debug] [MainThread]: SQL status: COMMIT in 0.13 seconds
19:12:56.827948 [debug] [MainThread]: On master: Close
19:12:56.828828 [info ] [MainThread]: 
19:12:56.829381 [info ] [MainThread]: Finished running 2 table models in 61.13s.
19:12:56.829954 [debug] [MainThread]: Connection 'master' was properly closed.
19:12:56.830184 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.region__big_join' was properly closed.
19:12:56.830385 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.region__final_output' was properly closed.
19:12:56.864358 [info ] [MainThread]: 
19:12:56.864909 [info ] [MainThread]: [32mCompleted successfully[0m
19:12:56.865556 [info ] [MainThread]: 
19:12:56.866391 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
19:12:56.867071 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf5118e760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf5118e700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf5118e310>]}


============================== 2022-06-24 19:14:16.222953 | fcb3b64d-2977-4519-8014-59dd16dc5a0b ==============================
19:14:16.222953 [info ] [MainThread]: Running with dbt=1.0.4
19:14:16.224236 [debug] [MainThread]: running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=None, defer=None, event_buffer_size=None, exclude=None, fail_fast=True, full_refresh=False, log_cache_events=False, log_format=None, partial_parse=None, printer_width=None, profile=None, profiles_dir='/Users/lindsay.carr/DBT/environments/redshift_discovery_crn_svc/', project_dir=None, record_timing_info=None, rpc_method='run', select=['region.final_output'], selector_name=None, send_anonymous_usage_stats=None, single_threaded=False, state=None, static_parser=None, target=None, threads=None, use_colors=None, use_experimental_parser=None, vars='{}', version_check=None, warn_error=None, which='run', write_json=None)
19:14:16.224692 [debug] [MainThread]: Tracking: tracking
19:14:16.259348 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbb05463700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbb05463af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbb05449340>]}
19:14:16.431334 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
19:14:16.432053 [debug] [MainThread]: Partial parsing: updated file: source_of_sales_change_lcarr://models/region/final_output/region__final_output.sql
19:14:16.448771 [debug] [MainThread]: 1699: static parser successfully parsed region/final_output/region__final_output.sql
19:14:16.476997 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 6 unused configuration paths:
- models.source_of_sales_change_lcarr.market.aggregations_distinct
- models.source_of_sales_change_lcarr.market.final_output
- models.source_of_sales_change_lcarr.ast.aggregations_distinct
- models.source_of_sales_change_lcarr.market.aggregations
- models.source_of_sales_change_lcarr.ast.final_output
- models.source_of_sales_change_lcarr.ast.aggregations

19:14:16.485593 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fcb3b64d-2977-4519-8014-59dd16dc5a0b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbb055e5970>]}
19:14:16.501610 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fcb3b64d-2977-4519-8014-59dd16dc5a0b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbb04a00250>]}
19:14:16.502120 [info ] [MainThread]: Found 40 models, 4 tests, 0 snapshots, 0 analyses, 192 macros, 0 operations, 0 seed files, 11 sources, 0 exposures, 0 metrics
19:14:16.504946 [info ] [MainThread]: 
19:14:16.505613 [debug] [MainThread]: Acquiring new redshift connection "master"
19:14:16.507113 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa"
19:14:16.521931 [debug] [ThreadPool]: Using redshift connection "list_cfa"
19:14:16.522237 [debug] [ThreadPool]: On list_cfa: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa"} */

    select distinct nspname from pg_namespace
  
19:14:16.522435 [debug] [ThreadPool]: Opening a new connection, currently in state init
19:14:16.522641 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:14:17.380785 [debug] [ThreadPool]: SQL status: SELECT in 0.86 seconds
19:14:17.389569 [debug] [ThreadPool]: On list_cfa: Close
19:14:17.394122 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa_public"
19:14:17.403669 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
19:14:17.403973 [debug] [ThreadPool]: On list_cfa_public: BEGIN
19:14:17.404163 [debug] [ThreadPool]: Opening a new connection, currently in state closed
19:14:17.404352 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:14:18.342530 [debug] [ThreadPool]: SQL status: BEGIN in 0.94 seconds
19:14:18.343025 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
19:14:18.343242 [debug] [ThreadPool]: On list_cfa_public: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa_public"} */
select
      'cfa' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'cfa' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
19:14:18.611865 [debug] [ThreadPool]: SQL status: SELECT in 0.27 seconds
19:14:18.688783 [debug] [ThreadPool]: On list_cfa_public: ROLLBACK
19:14:18.857454 [debug] [ThreadPool]: On list_cfa_public: Close
19:14:18.901437 [debug] [MainThread]: Using redshift connection "master"
19:14:18.901800 [debug] [MainThread]: On master: BEGIN
19:14:18.901999 [debug] [MainThread]: Opening a new connection, currently in state init
19:14:18.902196 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:14:19.727859 [debug] [MainThread]: SQL status: BEGIN in 0.83 seconds
19:14:19.728192 [debug] [MainThread]: Using redshift connection "master"
19:14:19.728413 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
19:14:20.499095 [debug] [MainThread]: SQL status: SELECT in 0.77 seconds
19:14:20.517073 [debug] [MainThread]: On master: ROLLBACK
19:14:20.615972 [debug] [MainThread]: Using redshift connection "master"
19:14:20.616534 [debug] [MainThread]: On master: BEGIN
19:14:20.735692 [debug] [MainThread]: SQL status: BEGIN in 0.12 seconds
19:14:20.736323 [debug] [MainThread]: On master: COMMIT
19:14:20.736619 [debug] [MainThread]: Using redshift connection "master"
19:14:20.736890 [debug] [MainThread]: On master: COMMIT
19:14:20.852243 [debug] [MainThread]: SQL status: COMMIT in 0.12 seconds
19:14:20.852967 [debug] [MainThread]: On master: Close
19:14:20.853867 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
19:14:20.854361 [info ] [MainThread]: 
19:14:20.861979 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.region__big_join
19:14:20.862727 [info ] [Thread-1  ]: 1 of 2 START table model public.lcarr_sosx_region__big_join..................... [RUN]
19:14:20.863556 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.region__big_join"
19:14:20.863861 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.region__big_join
19:14:20.864133 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.region__big_join
19:14:20.868635 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.region__big_join"
19:14:20.872698 [debug] [Thread-1  ]: finished collecting timing info
19:14:20.873009 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.region__big_join
19:14:20.979443 [debug] [Thread-1  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.region__big_join"
19:14:20.983657 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region__big_join"
19:14:20.984009 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region__big_join: BEGIN
19:14:20.984274 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
19:14:20.984522 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:14:21.662997 [debug] [Thread-1  ]: SQL status: BEGIN in 0.68 seconds
19:14:21.663427 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region__big_join"
19:14:21.663710 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region__big_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region__big_join"} */


  create  table
    "cfa"."public"."region__big_join__dbt_tmp"
    
    
    
  as (
    with big_join as ( 
  select a.*, e.unique_cfa_one_ids, e.unique_hashes, e.hash_transactions, e.hash_per_customer,
  b.price_index, 
  d.previous_year_monthend_date
  from "cfa"."public"."lcarr_sosx_region_agg__same_store_all_store" a
  inner join "cfa"."public"."lcarr_sosx_calc__dim_price_index_3" b
  on a.look_back_period = b.look_back_period
  and a.monthend_date = b.monthend_date
  and a.same_store = b.same_store
  inner join "cfa"."public"."lcarr_sosx_calc__dim_monthend_date" d
  on a.monthend_date = d.monthend_date
  inner join "cfa"."public"."lcarr_sosx_region_agg__distinct_join" e
  on a.monthend_date = e.monthend_date
  and a.look_back_period = e.look_back_period
  and a.same_store = e.same_store
  and a.region_name = e.region_name
  and a.location_type_code = e.location_type_code
  and a.daypart = e.daypart
  and a.destination_desc = e.destination_desc
)
select * from big_join
  );
19:14:49.880959 [debug] [Thread-1  ]: SQL status: SELECT in 28.22 seconds
19:14:49.889428 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region__big_join"
19:14:49.889761 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region__big_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region__big_join"} */
alter table "cfa"."public"."lcarr_sosx_region__big_join" rename to "region__big_join__dbt_backup"
19:14:49.946316 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.06 seconds
19:14:49.950205 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region__big_join"
19:14:49.950546 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region__big_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region__big_join"} */
alter table "cfa"."public"."region__big_join__dbt_tmp" rename to "lcarr_sosx_region__big_join"
19:14:50.009204 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.06 seconds
19:14:50.025280 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region__big_join: COMMIT
19:14:50.025579 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region__big_join"
19:14:50.025761 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region__big_join: COMMIT
19:14:51.039616 [debug] [Thread-1  ]: SQL status: COMMIT in 1.01 seconds
19:14:51.040563 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region__big_join"
19:14:51.040857 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region__big_join: BEGIN
19:14:51.111211 [debug] [Thread-1  ]: SQL status: BEGIN in 0.07 seconds
19:14:51.119222 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region__big_join"
19:14:51.119548 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region__big_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region__big_join"} */
drop table if exists "cfa"."public"."region__big_join__dbt_backup" cascade
19:14:51.178138 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.06 seconds
19:14:51.179724 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region__big_join: COMMIT
19:14:51.180111 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region__big_join"
19:14:51.180385 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region__big_join: COMMIT
19:14:52.956413 [debug] [Thread-1  ]: SQL status: COMMIT in 1.78 seconds
19:14:52.957007 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.region__big_join"
19:14:52.957286 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region__big_join: BEGIN
19:14:53.017735 [debug] [Thread-1  ]: SQL status: BEGIN in 0.06 seconds
19:14:53.019351 [debug] [Thread-1  ]: finished collecting timing info
19:14:53.019719 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region__big_join: ROLLBACK
19:14:53.120315 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.region__big_join: Close
19:14:53.121734 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fcb3b64d-2977-4519-8014-59dd16dc5a0b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbb05c77e20>]}
19:14:53.122382 [info ] [Thread-1  ]: 1 of 2 OK created table model public.lcarr_sosx_region__big_join................ [[32mSELECT[0m in 32.26s]
19:14:53.123141 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.region__big_join
19:14:53.123982 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.region__final_output
19:14:53.124596 [info ] [Thread-3  ]: 2 of 2 START table model public.lcarr_sosx_region__final_output................. [RUN]
19:14:53.125397 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.region__final_output"
19:14:53.125668 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.region__final_output
19:14:53.125918 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.region__final_output
19:14:53.131807 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.region__final_output"
19:14:53.132639 [debug] [Thread-3  ]: finished collecting timing info
19:14:53.132993 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.region__final_output
19:14:53.200602 [debug] [Thread-3  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.region__final_output"
19:14:53.201298 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region__final_output"
19:14:53.201504 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region__final_output: BEGIN
19:14:53.201799 [debug] [Thread-3  ]: Opening a new connection, currently in state init
19:14:53.202033 [debug] [Thread-3  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:14:54.371801 [debug] [Thread-3  ]: SQL status: BEGIN in 1.17 seconds
19:14:54.372250 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region__final_output"
19:14:54.372471 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region__final_output: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region__final_output"} */


  create  table
    "cfa"."public"."region__final_output__dbt_tmp"
    
    
    
  as (
    with twentytwo as (
select *
from "cfa"."public"."lcarr_sosx_region__big_join" 
where monthend_date = cast('02-28-2022' as date) 
), twentyone as ( 
select * 
from "cfa"."public"."lcarr_sosx_region__big_join"
where monthend_date = cast('02-28-2021' as date)
) 

select a.quarter,
a.look_back_period,a.same_store,
'Region' as geolevel, 
a.region_name as geolevel_detail,
a.location_type_code,a.daypart,a.destination_desc,
a.monthend_date as current_monthend_date,
a.sales_sub_total as current_sales_sub_total,
a.transactions as current_transactions,
a.purchaser_visits as current_purchaser_visits,
a.credit_txn as current_credit_txn,
a.total_items_promo_count as current_total_items_promo_count,
a.total_items_sold_count as current_total_items_sold_count,
a.actual_days as current_actual_days,
a.avail_days as current_avail_days,
a.price_index as current_price_index,
a.unique_cfa_one_ids as current_unique_cfa_one_ids,
a.unique_hashes as current_unique_hashes,
a.hash_transactions as current_hash_transactions,
a.hash_per_customer as current_hash_per_customer,
a.previous_year_monthend_date as check_date,
b.monthend_date as previous_monthend_date,
b.sales_sub_total as previous_sales_sub_total,
b.transactions as previous_transactions,
b.purchaser_visits as previous_purchaser_visits,
b.credit_txn as previous_credit_txn,
b.total_items_promo_count as previous_total_items_promo_count,
b.total_items_sold_count as previous_total_items_sold_count,
b.actual_days as previous_actual_days,
b.avail_days as previous_avail_days,
b.price_index as previous_price_index,
b.unique_cfa_one_ids as previous_unique_cfa_one_ids,
b.unique_hashes as previous_unique_hashes,
b.hash_transactions as previous_hash_transactions,
b.hash_per_customer as previous_hash_per_customer
from twentytwo a 
inner join twentyone b
on a.look_back_period = b.look_back_period 
and a.same_store = b.same_store 
and a.region_name = b.region_name
and a.location_type_code = b.location_type_code 
and a.daypart = b.daypart
and a.destination_desc = b.destination_desc
and a.previous_year_monthend_date = b.monthend_date
order by same_store,location_type_code,daypart,destination_desc
  );
19:15:01.014547 [debug] [Thread-3  ]: SQL status: SELECT in 6.64 seconds
19:15:01.018623 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region__final_output"
19:15:01.018926 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region__final_output: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region__final_output"} */
alter table "cfa"."public"."lcarr_sosx_region__final_output" rename to "region__final_output__dbt_backup"
19:15:01.076731 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.06 seconds
19:15:01.079987 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region__final_output"
19:15:01.080336 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region__final_output: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region__final_output"} */
alter table "cfa"."public"."region__final_output__dbt_tmp" rename to "lcarr_sosx_region__final_output"
19:15:01.138420 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.06 seconds
19:15:01.140898 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region__final_output: COMMIT
19:15:01.141242 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region__final_output"
19:15:01.141506 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region__final_output: COMMIT
19:15:03.090317 [debug] [Thread-3  ]: SQL status: COMMIT in 1.95 seconds
19:15:03.090890 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region__final_output"
19:15:03.091137 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region__final_output: BEGIN
19:15:03.171085 [debug] [Thread-3  ]: SQL status: BEGIN in 0.08 seconds
19:15:03.175148 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region__final_output"
19:15:03.175408 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region__final_output: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.region__final_output"} */
drop table if exists "cfa"."public"."region__final_output__dbt_backup" cascade
19:15:03.272147 [debug] [Thread-3  ]: SQL status: DROP TABLE in 0.1 seconds
19:15:03.274183 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region__final_output: COMMIT
19:15:03.274518 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region__final_output"
19:15:03.274874 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region__final_output: COMMIT
19:15:06.264817 [debug] [Thread-3  ]: SQL status: COMMIT in 2.99 seconds
19:15:06.265310 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.region__final_output"
19:15:06.265544 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region__final_output: BEGIN
19:15:06.323738 [debug] [Thread-3  ]: SQL status: BEGIN in 0.06 seconds
19:15:06.324796 [debug] [Thread-3  ]: finished collecting timing info
19:15:06.325147 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region__final_output: ROLLBACK
19:15:06.438716 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.region__final_output: Close
19:15:06.440274 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fcb3b64d-2977-4519-8014-59dd16dc5a0b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbb05d53160>]}
19:15:06.440792 [info ] [Thread-3  ]: 2 of 2 OK created table model public.lcarr_sosx_region__final_output............ [[32mSELECT[0m in 13.32s]
19:15:06.441251 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.region__final_output
19:15:06.442878 [debug] [MainThread]: Acquiring new redshift connection "master"
19:15:06.443259 [debug] [MainThread]: Using redshift connection "master"
19:15:06.443512 [debug] [MainThread]: On master: BEGIN
19:15:06.443741 [debug] [MainThread]: Opening a new connection, currently in state closed
19:15:06.443967 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:15:07.204528 [debug] [MainThread]: SQL status: BEGIN in 0.76 seconds
19:15:07.205117 [debug] [MainThread]: On master: COMMIT
19:15:07.205387 [debug] [MainThread]: Using redshift connection "master"
19:15:07.205602 [debug] [MainThread]: On master: COMMIT
19:15:07.394164 [debug] [MainThread]: SQL status: COMMIT in 0.19 seconds
19:15:07.394701 [debug] [MainThread]: On master: Close
19:15:07.396763 [info ] [MainThread]: 
19:15:07.397588 [info ] [MainThread]: Finished running 2 table models in 50.89s.
19:15:07.398501 [debug] [MainThread]: Connection 'master' was properly closed.
19:15:07.398890 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.region__big_join' was properly closed.
19:15:07.399231 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.region__final_output' was properly closed.
19:15:07.412789 [info ] [MainThread]: 
19:15:07.413265 [info ] [MainThread]: [32mCompleted successfully[0m
19:15:07.414013 [info ] [MainThread]: 
19:15:07.414452 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
19:15:07.414927 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbb05c411f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbb05c41160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbb05c41430>]}


============================== 2022-06-24 19:22:12.991688 | 63ee258f-d6ca-4c92-9774-31337beb4a19 ==============================
19:22:12.991688 [info ] [MainThread]: Running with dbt=1.0.4
19:22:12.993395 [debug] [MainThread]: running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=None, defer=None, event_buffer_size=None, exclude=None, fail_fast=True, full_refresh=False, log_cache_events=False, log_format=None, partial_parse=None, printer_width=None, profile=None, profiles_dir='/Users/lindsay.carr/DBT/environments/redshift_discovery_crn_svc/', project_dir=None, record_timing_info=None, rpc_method='run', select=['ast.aggregations'], selector_name=None, send_anonymous_usage_stats=None, single_threaded=False, state=None, static_parser=None, target=None, threads=None, use_colors=None, use_experimental_parser=None, vars='{}', version_check=None, warn_error=None, which='run', write_json=None)
19:22:12.994021 [debug] [MainThread]: Tracking: tracking
19:22:13.039728 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe905c635e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe905c639d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe905c5c760>]}
19:22:13.289942 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 9 files added, 0 files changed.
19:22:13.290609 [debug] [MainThread]: Partial parsing: added file: source_of_sales_change_lcarr://models/ast/final_output/ast__big_join.sql
19:22:13.290925 [debug] [MainThread]: Partial parsing: added file: source_of_sales_change_lcarr://models/ast/aggregations/ast_agg__all_groupings.sql
19:22:13.291216 [debug] [MainThread]: Partial parsing: added file: source_of_sales_change_lcarr://models/ast/aggregations/ast_agg__same_store_all_store.sql
19:22:13.291494 [debug] [MainThread]: Partial parsing: added file: source_of_sales_change_lcarr://models/ast/final_output/ast__final_output.sql
19:22:13.291768 [debug] [MainThread]: Partial parsing: added file: source_of_sales_change_lcarr://models/ast/aggregations/ast_agg__month_lookback.sql
19:22:13.292047 [debug] [MainThread]: Partial parsing: added file: source_of_sales_change_lcarr://models/ast/aggregations_distinct/ast_agg__month_lookback_distinct.sql
19:22:13.292309 [debug] [MainThread]: Partial parsing: added file: source_of_sales_change_lcarr://models/ast/aggregations_distinct/ast_agg__distinct_calcs.sql
19:22:13.292568 [debug] [MainThread]: Partial parsing: added file: source_of_sales_change_lcarr://models/ast/aggregations_distinct/ast_agg__hash_base_calcs.sql
19:22:13.292835 [debug] [MainThread]: Partial parsing: added file: source_of_sales_change_lcarr://models/ast/aggregations_distinct/ast_agg__distinct_join.sql
19:22:13.306903 [debug] [MainThread]: 1699: static parser successfully parsed ast/final_output/ast__big_join.sql
19:22:13.321962 [debug] [MainThread]: 1603: static parser failed on ast/aggregations/ast_agg__all_groupings.sql
19:22:13.328361 [debug] [MainThread]: 1602: parser fallback to jinja rendering on ast/aggregations/ast_agg__all_groupings.sql
19:22:13.329898 [debug] [MainThread]: 1699: static parser successfully parsed ast/aggregations/ast_agg__same_store_all_store.sql
19:22:13.332478 [debug] [MainThread]: 1699: static parser successfully parsed ast/final_output/ast__final_output.sql
19:22:13.335204 [debug] [MainThread]: 1699: static parser successfully parsed ast/aggregations/ast_agg__month_lookback.sql
19:22:13.337880 [debug] [MainThread]: 1699: static parser successfully parsed ast/aggregations_distinct/ast_agg__month_lookback_distinct.sql
19:22:13.340953 [debug] [MainThread]: 1603: static parser failed on ast/aggregations_distinct/ast_agg__distinct_calcs.sql
19:22:13.348427 [debug] [MainThread]: 1602: parser fallback to jinja rendering on ast/aggregations_distinct/ast_agg__distinct_calcs.sql
19:22:13.350916 [debug] [MainThread]: 1603: static parser failed on ast/aggregations_distinct/ast_agg__hash_base_calcs.sql
19:22:13.363191 [debug] [MainThread]: 1602: parser fallback to jinja rendering on ast/aggregations_distinct/ast_agg__hash_base_calcs.sql
19:22:13.364744 [debug] [MainThread]: 1699: static parser successfully parsed ast/aggregations_distinct/ast_agg__distinct_join.sql
19:22:13.377815 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.source_of_sales_change_lcarr.market.aggregations
- models.source_of_sales_change_lcarr.market.aggregations_distinct
- models.source_of_sales_change_lcarr.market.final_output

19:22:13.386843 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '63ee258f-d6ca-4c92-9774-31337beb4a19', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe905dac580>]}
19:22:13.405541 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '63ee258f-d6ca-4c92-9774-31337beb4a19', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe905cd7760>]}
19:22:13.406176 [info ] [MainThread]: Found 49 models, 4 tests, 0 snapshots, 0 analyses, 192 macros, 0 operations, 0 seed files, 11 sources, 0 exposures, 0 metrics
19:22:13.409387 [info ] [MainThread]: 
19:22:13.410097 [debug] [MainThread]: Acquiring new redshift connection "master"
19:22:13.411143 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa"
19:22:13.425939 [debug] [ThreadPool]: Using redshift connection "list_cfa"
19:22:13.426228 [debug] [ThreadPool]: On list_cfa: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa"} */

    select distinct nspname from pg_namespace
  
19:22:13.426418 [debug] [ThreadPool]: Opening a new connection, currently in state init
19:22:13.426609 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:22:14.592992 [debug] [ThreadPool]: SQL status: SELECT in 1.17 seconds
19:22:14.602337 [debug] [ThreadPool]: On list_cfa: Close
19:22:14.607396 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa_public"
19:22:14.615022 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
19:22:14.615292 [debug] [ThreadPool]: On list_cfa_public: BEGIN
19:22:14.615470 [debug] [ThreadPool]: Opening a new connection, currently in state closed
19:22:14.615650 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:22:15.622142 [debug] [ThreadPool]: SQL status: BEGIN in 1.01 seconds
19:22:15.622624 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
19:22:15.622907 [debug] [ThreadPool]: On list_cfa_public: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa_public"} */
select
      'cfa' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'cfa' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
19:22:15.948478 [debug] [ThreadPool]: SQL status: SELECT in 0.33 seconds
19:22:15.999399 [debug] [ThreadPool]: On list_cfa_public: ROLLBACK
19:22:16.098767 [debug] [ThreadPool]: On list_cfa_public: Close
19:22:16.130528 [debug] [MainThread]: Using redshift connection "master"
19:22:16.130831 [debug] [MainThread]: On master: BEGIN
19:22:16.131015 [debug] [MainThread]: Opening a new connection, currently in state init
19:22:16.131194 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:22:17.039775 [debug] [MainThread]: SQL status: BEGIN in 0.91 seconds
19:22:17.040233 [debug] [MainThread]: Using redshift connection "master"
19:22:17.040539 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
19:22:17.763275 [debug] [MainThread]: SQL status: SELECT in 0.72 seconds
19:22:17.782061 [debug] [MainThread]: On master: ROLLBACK
19:22:17.881926 [debug] [MainThread]: Using redshift connection "master"
19:22:17.882561 [debug] [MainThread]: On master: BEGIN
19:22:18.078261 [debug] [MainThread]: SQL status: BEGIN in 0.2 seconds
19:22:18.078719 [debug] [MainThread]: On master: COMMIT
19:22:18.079025 [debug] [MainThread]: Using redshift connection "master"
19:22:18.079287 [debug] [MainThread]: On master: COMMIT
19:22:18.269133 [debug] [MainThread]: SQL status: COMMIT in 0.19 seconds
19:22:18.269660 [debug] [MainThread]: On master: Close
19:22:18.270615 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
19:22:18.271423 [info ] [MainThread]: 
19:22:18.280027 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.ast_agg__all_groupings
19:22:18.280678 [info ] [Thread-1  ]: 1 of 3 START table model public.lcarr_sosx_ast_agg__all_groupings............... [RUN]
19:22:18.281717 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.ast_agg__all_groupings"
19:22:18.282024 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.ast_agg__all_groupings
19:22:18.282250 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.ast_agg__all_groupings
19:22:18.291108 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.ast_agg__all_groupings"
19:22:18.295107 [debug] [Thread-1  ]: finished collecting timing info
19:22:18.295604 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.ast_agg__all_groupings
19:22:18.395305 [debug] [Thread-1  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.ast_agg__all_groupings"
19:22:18.399353 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__all_groupings"
19:22:18.399683 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__all_groupings: BEGIN
19:22:18.400009 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
19:22:18.400345 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:22:19.336453 [debug] [Thread-1  ]: SQL status: BEGIN in 0.94 seconds
19:22:19.336995 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__all_groupings"
19:22:19.337275 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__all_groupings: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.ast_agg__all_groupings"} */


  create  table
    "cfa"."public"."ast_agg__all_groupings__dbt_tmp"
    
    
    
  as (
    with aggregations_all_groupings as (
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    location_type_code,daypart,destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    location_type_code,'All' as daypart,destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    location_type_code,'All' as daypart,'All' as destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    location_type_code,daypart,'All' as destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    'All' as location_type_code,daypart,'All' as destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    'All' as location_type_code,daypart,destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    'All' as location_type_code,'All' as daypart,destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
) 
select * from aggregations_all_groupings
  );
19:24:11.612182 [debug] [Thread-1  ]: SQL status: SELECT in 112.27 seconds
19:24:11.620589 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__all_groupings"
19:24:11.620890 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__all_groupings: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.ast_agg__all_groupings"} */
alter table "cfa"."public"."lcarr_sosx_ast_agg__all_groupings" rename to "ast_agg__all_groupings__dbt_backup"
19:24:11.681132 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.06 seconds
19:24:11.684825 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__all_groupings"
19:24:11.685112 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__all_groupings: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.ast_agg__all_groupings"} */
alter table "cfa"."public"."ast_agg__all_groupings__dbt_tmp" rename to "lcarr_sosx_ast_agg__all_groupings"
19:24:11.745475 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.06 seconds
19:24:11.760507 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__all_groupings: COMMIT
19:24:11.760798 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__all_groupings"
19:24:11.760997 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__all_groupings: COMMIT
19:24:13.760781 [debug] [Thread-1  ]: SQL status: COMMIT in 2.0 seconds
19:24:13.761550 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__all_groupings"
19:24:13.761911 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__all_groupings: BEGIN
19:24:13.828239 [debug] [Thread-1  ]: SQL status: BEGIN in 0.07 seconds
19:24:13.836460 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__all_groupings"
19:24:13.836760 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__all_groupings: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.ast_agg__all_groupings"} */
drop table if exists "cfa"."public"."ast_agg__all_groupings__dbt_backup" cascade
19:24:13.899768 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.06 seconds
19:24:13.901314 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__all_groupings: COMMIT
19:24:13.901633 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__all_groupings"
19:24:13.901896 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__all_groupings: COMMIT
19:24:14.989158 [debug] [Thread-1  ]: SQL status: COMMIT in 1.09 seconds
19:24:14.989654 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__all_groupings"
19:24:14.989908 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__all_groupings: BEGIN
19:24:15.048686 [debug] [Thread-1  ]: SQL status: BEGIN in 0.06 seconds
19:24:15.049775 [debug] [Thread-1  ]: finished collecting timing info
19:24:15.050497 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__all_groupings: ROLLBACK
19:24:15.151109 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__all_groupings: Close
19:24:15.152578 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '63ee258f-d6ca-4c92-9774-31337beb4a19', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe906449250>]}
19:24:15.153107 [info ] [Thread-1  ]: 1 of 3 OK created table model public.lcarr_sosx_ast_agg__all_groupings.......... [[32mSELECT[0m in 116.87s]
19:24:15.153610 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.ast_agg__all_groupings
19:24:15.154464 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.ast_agg__month_lookback
19:24:15.155082 [info ] [Thread-3  ]: 2 of 3 START table model public.lcarr_sosx_ast_agg__month_lookback.............. [RUN]
19:24:15.155905 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.ast_agg__month_lookback"
19:24:15.156187 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.ast_agg__month_lookback
19:24:15.156434 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.ast_agg__month_lookback
19:24:15.160143 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.ast_agg__month_lookback"
19:24:15.163352 [debug] [Thread-3  ]: finished collecting timing info
19:24:15.163724 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.ast_agg__month_lookback
19:24:15.228675 [debug] [Thread-3  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.ast_agg__month_lookback"
19:24:15.232361 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__month_lookback"
19:24:15.232720 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.ast_agg__month_lookback: BEGIN
19:24:15.232972 [debug] [Thread-3  ]: Opening a new connection, currently in state init
19:24:15.233177 [debug] [Thread-3  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:24:16.134894 [debug] [Thread-3  ]: SQL status: BEGIN in 0.9 seconds
19:24:16.135459 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__month_lookback"
19:24:16.135773 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.ast_agg__month_lookback: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.ast_agg__month_lookback"} */


  create  table
    "cfa"."public"."ast_agg__month_lookback__dbt_tmp"
    
    
    
  as (
    with add_month_lookback as (
  select quarter,region_name,service_team_name,dma_name,location_num,
  monthend_date,'1 month' as look_back_period,
  location_type_code,daypart,destination_desc,sales_sub_total,
  transactions,purchaser_visits,credit_txn,
  total_items_promo_count,total_items_sold_count
  from "cfa"."public"."lcarr_sosx_ast_agg__all_groupings"
)
select * from add_month_lookback
  );
19:24:18.061600 [debug] [Thread-3  ]: SQL status: SELECT in 1.93 seconds
19:24:18.065853 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__month_lookback"
19:24:18.066115 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.ast_agg__month_lookback: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.ast_agg__month_lookback"} */
alter table "cfa"."public"."lcarr_sosx_ast_agg__month_lookback" rename to "ast_agg__month_lookback__dbt_backup"
19:24:18.123372 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.06 seconds
19:24:18.126375 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__month_lookback"
19:24:18.126662 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.ast_agg__month_lookback: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.ast_agg__month_lookback"} */
alter table "cfa"."public"."ast_agg__month_lookback__dbt_tmp" rename to "lcarr_sosx_ast_agg__month_lookback"
19:24:18.183645 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.06 seconds
19:24:18.186033 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.ast_agg__month_lookback: COMMIT
19:24:18.186344 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__month_lookback"
19:24:18.186602 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.ast_agg__month_lookback: COMMIT
19:24:19.290583 [debug] [Thread-3  ]: SQL status: COMMIT in 1.1 seconds
19:24:19.291488 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__month_lookback"
19:24:19.291780 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.ast_agg__month_lookback: BEGIN
19:24:19.355476 [debug] [Thread-3  ]: SQL status: BEGIN in 0.06 seconds
19:24:19.359675 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__month_lookback"
19:24:19.359934 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.ast_agg__month_lookback: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.ast_agg__month_lookback"} */
drop table if exists "cfa"."public"."ast_agg__month_lookback__dbt_backup" cascade
19:24:19.422395 [debug] [Thread-3  ]: SQL status: DROP TABLE in 0.06 seconds
19:24:19.424117 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.ast_agg__month_lookback: COMMIT
19:24:19.424418 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__month_lookback"
19:24:19.424678 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.ast_agg__month_lookback: COMMIT
19:24:20.826761 [debug] [Thread-3  ]: SQL status: COMMIT in 1.4 seconds
19:24:20.827385 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__month_lookback"
19:24:20.827674 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.ast_agg__month_lookback: BEGIN
19:24:20.886086 [debug] [Thread-3  ]: SQL status: BEGIN in 0.06 seconds
19:24:20.887248 [debug] [Thread-3  ]: finished collecting timing info
19:24:20.887583 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.ast_agg__month_lookback: ROLLBACK
19:24:21.018243 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.ast_agg__month_lookback: Close
19:24:21.019850 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '63ee258f-d6ca-4c92-9774-31337beb4a19', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe9064fe3a0>]}
19:24:21.020365 [info ] [Thread-3  ]: 2 of 3 OK created table model public.lcarr_sosx_ast_agg__month_lookback......... [[32mSELECT[0m in 5.86s]
19:24:21.020827 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.ast_agg__month_lookback
19:24:21.021584 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.ast_agg__same_store_all_store
19:24:21.022115 [info ] [Thread-2  ]: 3 of 3 START table model public.lcarr_sosx_ast_agg__same_store_all_store........ [RUN]
19:24:21.023021 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.ast_agg__same_store_all_store"
19:24:21.023350 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.ast_agg__same_store_all_store
19:24:21.023603 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.ast_agg__same_store_all_store
19:24:21.027297 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.ast_agg__same_store_all_store"
19:24:21.028960 [debug] [Thread-2  ]: finished collecting timing info
19:24:21.029340 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.ast_agg__same_store_all_store
19:24:21.094709 [debug] [Thread-2  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.ast_agg__same_store_all_store"
19:24:21.098347 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__same_store_all_store"
19:24:21.098781 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.ast_agg__same_store_all_store: BEGIN
19:24:21.099063 [debug] [Thread-2  ]: Opening a new connection, currently in state init
19:24:21.099345 [debug] [Thread-2  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:24:21.744722 [debug] [Thread-2  ]: SQL status: BEGIN in 0.65 seconds
19:24:21.745306 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__same_store_all_store"
19:24:21.745580 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.ast_agg__same_store_all_store: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.ast_agg__same_store_all_store"} */


  create  table
    "cfa"."public"."ast_agg__same_store_all_store__dbt_tmp"
    
    
    
  as (
    with transaction_same_store as (
  select a.*,b.same_store_eligible,b.actual_days,b.avail_days
  from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback" a
  left join "cfa"."public"."lcarr_sosx_stg__fct_same_store" b
  on a.location_num = b.location_num
  and a.look_back_period = b.look_back_period
  and a.monthend_date = b.monthend_date
  order by dma_name,location_num,look_back_period,location_type_code,daypart,destination_desc,monthend_date
), transaction_agg_all_stores as ( 
  select quarter,
  monthend_date,look_back_period,'All Stores' as same_store,service_team_name,
  location_type_code,daypart,destination_desc,
  sum(sales_sub_total) as sales_sub_total,
  sum(transactions) as transactions,sum(purchaser_visits) as purchaser_visits,
  sum(credit_txn) as credit_txn,sum(total_items_promo_count) as total_items_promo_count,
  sum(total_items_sold_count) as total_items_sold_count,
  sum(actual_days) as actual_days, 
  sum(avail_days) as avail_days
  from transaction_same_store
  group by 1,2,3,4,5,6,7,8
), transaction_agg_same_stores as ( 
  select quarter,
  monthend_date,look_back_period,'Same Stores' as same_store,service_team_name,
  location_type_code,daypart,destination_desc,
  sum(sales_sub_total) as sales_sub_total,
  sum(transactions) as transactions,sum(purchaser_visits) as purchaser_visits,
  sum(credit_txn) as credit_txn,sum(total_items_promo_count) as total_items_promo_count,
  sum(total_items_sold_count) as total_items_sold_count,
  sum(actual_days) as actual_days,
  sum(avail_days) as avail_days
  from transaction_same_store
  where same_store_eligible = 1 
  group by 1,2,3,4,5,6,7,8
), union_all_same_market_transactions as ( 
  select * from transaction_agg_all_stores
  union
  select * from transaction_agg_same_stores
)
select * from union_all_same_market_transactions
  );
19:24:26.354712 [debug] [Thread-2  ]: SQL status: SELECT in 4.61 seconds
19:24:26.358229 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__same_store_all_store"
19:24:26.358506 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.ast_agg__same_store_all_store: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.ast_agg__same_store_all_store"} */
alter table "cfa"."public"."lcarr_sosx_ast_agg__same_store_all_store" rename to "ast_agg__same_store_all_store__dbt_backup"
19:24:26.416558 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.06 seconds
19:24:26.420275 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__same_store_all_store"
19:24:26.420591 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.ast_agg__same_store_all_store: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.ast_agg__same_store_all_store"} */
alter table "cfa"."public"."ast_agg__same_store_all_store__dbt_tmp" rename to "lcarr_sosx_ast_agg__same_store_all_store"
19:24:26.477147 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.06 seconds
19:24:26.480049 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.ast_agg__same_store_all_store: COMMIT
19:24:26.480555 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__same_store_all_store"
19:24:26.481008 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.ast_agg__same_store_all_store: COMMIT
19:24:28.111194 [debug] [Thread-2  ]: SQL status: COMMIT in 1.63 seconds
19:24:28.111855 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__same_store_all_store"
19:24:28.112150 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.ast_agg__same_store_all_store: BEGIN
19:24:28.172046 [debug] [Thread-2  ]: SQL status: BEGIN in 0.06 seconds
19:24:28.175281 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__same_store_all_store"
19:24:28.175559 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.ast_agg__same_store_all_store: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.ast_agg__same_store_all_store"} */
drop table if exists "cfa"."public"."ast_agg__same_store_all_store__dbt_backup" cascade
19:24:28.234276 [debug] [Thread-2  ]: SQL status: DROP TABLE in 0.06 seconds
19:24:28.235703 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.ast_agg__same_store_all_store: COMMIT
19:24:28.235955 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__same_store_all_store"
19:24:28.236147 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.ast_agg__same_store_all_store: COMMIT
19:24:29.425705 [debug] [Thread-2  ]: SQL status: COMMIT in 1.19 seconds
19:24:29.426097 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__same_store_all_store"
19:24:29.426319 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.ast_agg__same_store_all_store: BEGIN
19:24:29.491395 [debug] [Thread-2  ]: SQL status: BEGIN in 0.06 seconds
19:24:29.492489 [debug] [Thread-2  ]: finished collecting timing info
19:24:29.492772 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.ast_agg__same_store_all_store: ROLLBACK
19:24:29.594292 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.ast_agg__same_store_all_store: Close
19:24:29.595273 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '63ee258f-d6ca-4c92-9774-31337beb4a19', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe906582070>]}
19:24:29.595749 [info ] [Thread-2  ]: 3 of 3 OK created table model public.lcarr_sosx_ast_agg__same_store_all_store... [[32mSELECT[0m in 8.57s]
19:24:29.596167 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.ast_agg__same_store_all_store
19:24:29.597895 [debug] [MainThread]: Acquiring new redshift connection "master"
19:24:29.598386 [debug] [MainThread]: Using redshift connection "master"
19:24:29.598710 [debug] [MainThread]: On master: BEGIN
19:24:29.599002 [debug] [MainThread]: Opening a new connection, currently in state closed
19:24:29.599311 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:24:30.379764 [debug] [MainThread]: SQL status: BEGIN in 0.78 seconds
19:24:30.380124 [debug] [MainThread]: On master: COMMIT
19:24:30.380328 [debug] [MainThread]: Using redshift connection "master"
19:24:30.380508 [debug] [MainThread]: On master: COMMIT
19:24:30.602134 [debug] [MainThread]: SQL status: COMMIT in 0.22 seconds
19:24:30.602491 [debug] [MainThread]: On master: Close
19:24:30.603258 [info ] [MainThread]: 
19:24:30.603658 [info ] [MainThread]: Finished running 3 table models in 137.19s.
19:24:30.604063 [debug] [MainThread]: Connection 'master' was properly closed.
19:24:30.604257 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.ast_agg__all_groupings' was properly closed.
19:24:30.604433 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.ast_agg__month_lookback' was properly closed.
19:24:30.604605 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.ast_agg__same_store_all_store' was properly closed.
19:24:30.619353 [info ] [MainThread]: 
19:24:30.619855 [info ] [MainThread]: [32mCompleted successfully[0m
19:24:30.620297 [info ] [MainThread]: 
19:24:30.620662 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
19:24:30.621104 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe90649dc70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe90649dca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe90649df70>]}


============================== 2022-06-24 19:25:03.053644 | c5593319-6f0d-4844-b131-96ab26a9f505 ==============================
19:25:03.053644 [info ] [MainThread]: Running with dbt=1.0.4
19:25:03.055159 [debug] [MainThread]: running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=None, defer=None, event_buffer_size=None, exclude=None, fail_fast=True, full_refresh=False, log_cache_events=False, log_format=None, partial_parse=None, printer_width=None, profile=None, profiles_dir='/Users/lindsay.carr/DBT/environments/redshift_discovery_crn_svc/', project_dir=None, record_timing_info=None, rpc_method='run', select=['ast.aggregations_distinct'], selector_name=None, send_anonymous_usage_stats=None, single_threaded=False, state=None, static_parser=None, target=None, threads=None, use_colors=None, use_experimental_parser=None, vars='{}', version_check=None, warn_error=None, which='run', write_json=None)
19:25:03.055661 [debug] [MainThread]: Tracking: tracking
19:25:03.114913 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd903c81760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd903c81d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd903c81820>]}
19:25:03.295810 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
19:25:03.296258 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
19:25:03.300306 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.source_of_sales_change_lcarr.market.aggregations_distinct
- models.source_of_sales_change_lcarr.market.aggregations
- models.source_of_sales_change_lcarr.market.final_output

19:25:03.325281 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c5593319-6f0d-4844-b131-96ab26a9f505', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd903dde9a0>]}
19:25:03.356752 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c5593319-6f0d-4844-b131-96ab26a9f505', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd903234100>]}
19:25:03.357429 [info ] [MainThread]: Found 49 models, 4 tests, 0 snapshots, 0 analyses, 192 macros, 0 operations, 0 seed files, 11 sources, 0 exposures, 0 metrics
19:25:03.363019 [info ] [MainThread]: 
19:25:03.364126 [debug] [MainThread]: Acquiring new redshift connection "master"
19:25:03.365925 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa"
19:25:03.388083 [debug] [ThreadPool]: Using redshift connection "list_cfa"
19:25:03.388539 [debug] [ThreadPool]: On list_cfa: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa"} */

    select distinct nspname from pg_namespace
  
19:25:03.388883 [debug] [ThreadPool]: Opening a new connection, currently in state init
19:25:03.389351 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:25:04.172413 [debug] [ThreadPool]: SQL status: SELECT in 0.78 seconds
19:25:04.185051 [debug] [ThreadPool]: On list_cfa: Close
19:25:04.192467 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa_public"
19:25:04.205079 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
19:25:04.205504 [debug] [ThreadPool]: On list_cfa_public: BEGIN
19:25:04.205817 [debug] [ThreadPool]: Opening a new connection, currently in state closed
19:25:04.206132 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:25:04.988022 [debug] [ThreadPool]: SQL status: BEGIN in 0.78 seconds
19:25:04.988488 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
19:25:04.988823 [debug] [ThreadPool]: On list_cfa_public: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa_public"} */
select
      'cfa' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'cfa' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
19:25:05.300959 [debug] [ThreadPool]: SQL status: SELECT in 0.31 seconds
19:25:05.390297 [debug] [ThreadPool]: On list_cfa_public: ROLLBACK
19:25:05.487732 [debug] [ThreadPool]: On list_cfa_public: Close
19:25:05.539550 [debug] [MainThread]: Using redshift connection "master"
19:25:05.539981 [debug] [MainThread]: On master: BEGIN
19:25:05.540305 [debug] [MainThread]: Opening a new connection, currently in state init
19:25:05.540620 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:25:06.200993 [debug] [MainThread]: SQL status: BEGIN in 0.66 seconds
19:25:06.201452 [debug] [MainThread]: Using redshift connection "master"
19:25:06.201779 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
19:25:07.026680 [debug] [MainThread]: SQL status: SELECT in 0.82 seconds
19:25:07.043712 [debug] [MainThread]: On master: ROLLBACK
19:25:07.142813 [debug] [MainThread]: Using redshift connection "master"
19:25:07.143290 [debug] [MainThread]: On master: BEGIN
19:25:07.462615 [debug] [MainThread]: SQL status: BEGIN in 0.32 seconds
19:25:07.463342 [debug] [MainThread]: On master: COMMIT
19:25:07.463758 [debug] [MainThread]: Using redshift connection "master"
19:25:07.464231 [debug] [MainThread]: On master: COMMIT
19:25:07.567373 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
19:25:07.567992 [debug] [MainThread]: On master: Close
19:25:07.568973 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
19:25:07.569480 [info ] [MainThread]: 
19:25:07.576151 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct
19:25:07.576663 [info ] [Thread-1  ]: 1 of 4 START table model public.lcarr_sosx_ast_agg__month_lookback_distinct..... [RUN]
19:25:07.577414 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct"
19:25:07.577701 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct
19:25:07.578192 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct
19:25:07.583006 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct"
19:25:07.584507 [debug] [Thread-1  ]: finished collecting timing info
19:25:07.584881 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct
19:25:07.683054 [debug] [Thread-1  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct"
19:25:07.686017 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct"
19:25:07.686351 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct: BEGIN
19:25:07.686523 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
19:25:07.686706 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:25:08.404367 [debug] [Thread-1  ]: SQL status: BEGIN in 0.72 seconds
19:25:08.404983 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct"
19:25:08.405263 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct"} */


  create  table
    "cfa"."public"."ast_agg__month_lookback_distinct__dbt_tmp"
    
    
    
  as (
    with one_month_set_up as (
  select a.region_name,a.service_team_name,a.dma_name,
  a.location_num,a.monthend_date,'1 month' as look_back_period,
  a.trans_id,a.cfa_one_id,a.customer_hash,
  a.location_type_code,a.daypart,a.destination_desc,
  b.same_store_eligible
  from "cfa"."public"."lcarr_sosx_trans_item" a
  inner join "cfa"."public"."lcarr_sosx_stg__fct_same_store" b
  on a.location_num = b.location_num
  and a.monthend_date = b.monthend_date 
  and b.look_back_period = '1 month'
)
select * from one_month_set_up
  );
19:25:31.785847 [debug] [Thread-1  ]: SQL status: SELECT in 23.38 seconds
19:25:31.796479 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct"
19:25:31.796855 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct"} */
alter table "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct" rename to "ast_agg__month_lookback_distinct__dbt_backup"
19:25:31.898012 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
19:25:31.901108 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct"
19:25:31.901373 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct"} */
alter table "cfa"."public"."ast_agg__month_lookback_distinct__dbt_tmp" rename to "lcarr_sosx_ast_agg__month_lookback_distinct"
19:25:31.962327 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.06 seconds
19:25:31.977253 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct: COMMIT
19:25:31.977735 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct"
19:25:31.978100 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct: COMMIT
19:25:34.981235 [debug] [Thread-1  ]: SQL status: COMMIT in 3.0 seconds
19:25:34.982154 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct"
19:25:34.982451 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct: BEGIN
19:25:35.115808 [debug] [Thread-1  ]: SQL status: BEGIN in 0.13 seconds
19:25:35.124313 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct"
19:25:35.124642 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct"} */
drop table if exists "cfa"."public"."ast_agg__month_lookback_distinct__dbt_backup" cascade
19:25:35.185253 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.06 seconds
19:25:35.186848 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct: COMMIT
19:25:35.187233 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct"
19:25:35.187687 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct: COMMIT
19:25:36.394719 [debug] [Thread-1  ]: SQL status: COMMIT in 1.21 seconds
19:25:36.395324 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct"
19:25:36.395615 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct: BEGIN
19:25:36.462672 [debug] [Thread-1  ]: SQL status: BEGIN in 0.07 seconds
19:25:36.463645 [debug] [Thread-1  ]: finished collecting timing info
19:25:36.463932 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct: ROLLBACK
19:25:36.583998 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct: Close
19:25:36.585520 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c5593319-6f0d-4844-b131-96ab26a9f505', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd904238e20>]}
19:25:36.586064 [info ] [Thread-1  ]: 1 of 4 OK created table model public.lcarr_sosx_ast_agg__month_lookback_distinct [[32mSELECT[0m in 29.01s]
19:25:36.586547 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct
19:25:36.587323 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.ast_agg__distinct_calcs
19:25:36.587774 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs
19:25:36.588237 [info ] [Thread-3  ]: 2 of 4 START table model public.lcarr_sosx_ast_agg__distinct_calcs.............. [RUN]
19:25:36.588718 [info ] [Thread-4  ]: 3 of 4 START table model public.lcarr_sosx_ast_agg__hash_base_calcs............. [RUN]
19:25:36.589554 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.ast_agg__distinct_calcs"
19:25:36.590216 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs"
19:25:36.590492 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.ast_agg__distinct_calcs
19:25:36.590749 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs
19:25:36.591017 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.ast_agg__distinct_calcs
19:25:36.591277 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs
19:25:36.599532 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.ast_agg__distinct_calcs"
19:25:36.606931 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs"
19:25:36.608482 [debug] [Thread-3  ]: finished collecting timing info
19:25:36.608938 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.ast_agg__distinct_calcs
19:25:36.615475 [debug] [Thread-4  ]: finished collecting timing info
19:25:36.621427 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs
19:25:36.720999 [debug] [Thread-3  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.ast_agg__distinct_calcs"
19:25:36.732251 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__distinct_calcs"
19:25:36.733771 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.ast_agg__distinct_calcs: BEGIN
19:25:36.733203 [debug] [Thread-4  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs"
19:25:36.734023 [debug] [Thread-3  ]: Opening a new connection, currently in state init
19:25:36.734481 [debug] [Thread-3  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:25:36.736546 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs"
19:25:36.737117 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs: BEGIN
19:25:36.737617 [debug] [Thread-4  ]: Opening a new connection, currently in state init
19:25:36.737978 [debug] [Thread-4  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:25:37.699429 [debug] [Thread-4  ]: SQL status: BEGIN in 0.96 seconds
19:25:37.700042 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs"
19:25:37.700350 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs"} */


  create  table
    "cfa"."public"."ast_agg__hash_base_calcs__dbt_tmp"
    
    
    
  as (
    with hash_base_calcs_all_store as (
    select monthend_date,look_back_period,'All Stores' as same_store,service_team_name,
    location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,service_team_name,
    location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,service_team_name,
    location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,service_team_name,
    location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,service_team_name,
    'All' as location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,service_team_name,
    'All' as location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,service_team_name,
    'All' as location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,service_team_name,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6,7
), hash_base_calcs_same_store as (
    select monthend_date,look_back_period,'Same Stores' as same_store,service_team_name,
    location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,service_team_name,
    location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,service_team_name,
    location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,service_team_name,
    location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,service_team_name,
    'All' as location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,service_team_name,
    'All' as location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,service_team_name,
    'All' as location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,service_team_name,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6,7
)

select * from hash_base_calcs_all_store 
union 
select * from hash_base_calcs_same_store
  );
19:25:37.774070 [debug] [Thread-3  ]: SQL status: BEGIN in 1.04 seconds
19:25:37.774710 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__distinct_calcs"
19:25:37.774987 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.ast_agg__distinct_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.ast_agg__distinct_calcs"} */


  create  table
    "cfa"."public"."ast_agg__distinct_calcs__dbt_tmp"
    
    
    
  as (
    with distinct_calcs_all_store as (
    select monthend_date,look_back_period,'All Stores' as same_store,service_team_name,
    location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,service_team_name,
    location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,service_team_name,
    location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,service_team_name,
    location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,service_team_name,
    'All' as location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,service_team_name,
    'All' as location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,service_team_name,
    'All' as location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,service_team_name,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6,7
), distinct_calcs_same_store as (
    select monthend_date,look_back_period,'Same Stores' as same_store,service_team_name,
    location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,service_team_name,
    location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,service_team_name,
    location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,service_team_name,
    location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,service_team_name,
    'All' as location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,service_team_name,
    'All' as location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,service_team_name,
    'All' as location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,service_team_name,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6,7
)

select * from distinct_calcs_all_store 
union 
select * from distinct_calcs_same_store
  );
19:27:07.930641 [debug] [Thread-4  ]: SQL status: SELECT in 90.23 seconds
19:27:07.936945 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs"
19:27:07.937267 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs"} */
alter table "cfa"."public"."lcarr_sosx_ast_agg__hash_base_calcs" rename to "ast_agg__hash_base_calcs__dbt_backup"
19:27:07.995133 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.06 seconds
19:27:07.998748 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs"
19:27:07.999057 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs"} */
alter table "cfa"."public"."ast_agg__hash_base_calcs__dbt_tmp" rename to "lcarr_sosx_ast_agg__hash_base_calcs"
19:27:08.055531 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.06 seconds
19:27:08.058686 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs: COMMIT
19:27:08.059086 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs"
19:27:08.059308 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs: COMMIT
19:27:10.333710 [debug] [Thread-4  ]: SQL status: COMMIT in 2.27 seconds
19:27:10.334353 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs"
19:27:10.334604 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs: BEGIN
19:27:10.388858 [debug] [Thread-4  ]: SQL status: BEGIN in 0.05 seconds
19:27:10.394912 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs"
19:27:10.395355 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs"} */
drop table if exists "cfa"."public"."ast_agg__hash_base_calcs__dbt_backup" cascade
19:27:10.461436 [debug] [Thread-4  ]: SQL status: DROP TABLE in 0.07 seconds
19:27:10.463101 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs: COMMIT
19:27:10.463411 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs"
19:27:10.463680 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs: COMMIT
19:27:11.924418 [debug] [Thread-4  ]: SQL status: COMMIT in 1.46 seconds
19:27:11.925108 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs"
19:27:11.925416 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs: BEGIN
19:27:11.985955 [debug] [Thread-4  ]: SQL status: BEGIN in 0.06 seconds
19:27:11.986944 [debug] [Thread-4  ]: finished collecting timing info
19:27:11.987240 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs: ROLLBACK
19:27:12.118927 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs: Close
19:27:12.120389 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c5593319-6f0d-4844-b131-96ab26a9f505', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd9042dd250>]}
19:27:12.121013 [info ] [Thread-4  ]: 3 of 4 OK created table model public.lcarr_sosx_ast_agg__hash_base_calcs........ [[32mSELECT[0m in 95.53s]
19:27:12.121588 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs
19:34:42.283262 [debug] [Thread-3  ]: SQL status: SELECT in 544.51 seconds
19:34:42.288636 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__distinct_calcs"
19:34:42.288966 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.ast_agg__distinct_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.ast_agg__distinct_calcs"} */
alter table "cfa"."public"."ast_agg__distinct_calcs__dbt_tmp" rename to "lcarr_sosx_ast_agg__distinct_calcs"
19:34:42.346227 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.06 seconds
19:34:42.348242 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.ast_agg__distinct_calcs: COMMIT
19:34:42.348537 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__distinct_calcs"
19:34:42.348756 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.ast_agg__distinct_calcs: COMMIT
19:34:43.333257 [debug] [Thread-3  ]: SQL status: COMMIT in 0.98 seconds
19:34:43.334069 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__distinct_calcs"
19:34:43.334316 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.ast_agg__distinct_calcs: BEGIN
19:34:43.396386 [debug] [Thread-3  ]: SQL status: BEGIN in 0.06 seconds
19:34:43.399164 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__distinct_calcs"
19:34:43.399557 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.ast_agg__distinct_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.ast_agg__distinct_calcs"} */
drop table if exists "cfa"."public"."ast_agg__distinct_calcs__dbt_backup" cascade
19:34:43.462477 [debug] [Thread-3  ]: SQL status: DROP TABLE in 0.06 seconds
19:34:43.464132 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.ast_agg__distinct_calcs: COMMIT
19:34:43.464440 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__distinct_calcs"
19:34:43.464714 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.ast_agg__distinct_calcs: COMMIT
19:34:43.643338 [debug] [Thread-3  ]: SQL status: COMMIT in 0.18 seconds
19:34:43.644034 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__distinct_calcs"
19:34:43.644327 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.ast_agg__distinct_calcs: BEGIN
19:34:43.732868 [debug] [Thread-3  ]: SQL status: BEGIN in 0.09 seconds
19:34:43.734016 [debug] [Thread-3  ]: finished collecting timing info
19:34:43.734355 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.ast_agg__distinct_calcs: ROLLBACK
19:34:43.831551 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.ast_agg__distinct_calcs: Close
19:34:43.832942 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c5593319-6f0d-4844-b131-96ab26a9f505', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd9042fd190>]}
19:34:43.833558 [info ] [Thread-3  ]: 2 of 4 OK created table model public.lcarr_sosx_ast_agg__distinct_calcs......... [[32mSELECT[0m in 547.24s]
19:34:43.834126 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.ast_agg__distinct_calcs
19:34:43.834935 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.ast_agg__distinct_join
19:34:43.835565 [info ] [Thread-1  ]: 4 of 4 START table model public.lcarr_sosx_ast_agg__distinct_join............... [RUN]
19:34:43.836390 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.ast_agg__distinct_join"
19:34:43.836651 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.ast_agg__distinct_join
19:34:43.836890 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.ast_agg__distinct_join
19:34:43.840305 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.ast_agg__distinct_join"
19:34:43.843461 [debug] [Thread-1  ]: finished collecting timing info
19:34:43.843864 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.ast_agg__distinct_join
19:34:43.908451 [debug] [Thread-1  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.ast_agg__distinct_join"
19:34:43.910680 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__distinct_join"
19:34:43.910991 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__distinct_join: BEGIN
19:34:43.911178 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
19:34:43.911376 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:34:44.782753 [debug] [Thread-1  ]: SQL status: BEGIN in 0.87 seconds
19:34:44.783552 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__distinct_join"
19:34:44.783856 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__distinct_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.ast_agg__distinct_join"} */


  create  table
    "cfa"."public"."ast_agg__distinct_join__dbt_tmp"
    
    
    
  as (
    with distinct_calcs_join as (
    select a.monthend_date,a.look_back_period,a.same_store,a.service_team_name,
    a.location_type_code,a.daypart,a.destination_desc,
    a.unique_cfa_one_ids,a.unique_hashes,a.hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_ast_agg__distinct_calcs" a
    inner join "cfa"."public"."lcarr_sosx_ast_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period
    and a.same_store = b.same_store
    and a.service_team_name = b.service_team_name 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
) 
select * from distinct_calcs_join
  );
19:34:51.341791 [debug] [Thread-1  ]: SQL status: SELECT in 6.56 seconds
19:34:51.344987 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__distinct_join"
19:34:51.345273 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__distinct_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.ast_agg__distinct_join"} */
alter table "cfa"."public"."ast_agg__distinct_join__dbt_tmp" rename to "lcarr_sosx_ast_agg__distinct_join"
19:34:51.406590 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.06 seconds
19:34:51.408814 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__distinct_join: COMMIT
19:34:51.409081 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__distinct_join"
19:34:51.409291 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__distinct_join: COMMIT
19:34:53.473564 [debug] [Thread-1  ]: SQL status: COMMIT in 2.06 seconds
19:34:53.474391 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__distinct_join"
19:34:53.474701 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__distinct_join: BEGIN
19:34:53.528891 [debug] [Thread-1  ]: SQL status: BEGIN in 0.05 seconds
19:34:53.531097 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__distinct_join"
19:34:53.531352 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__distinct_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.ast_agg__distinct_join"} */
drop table if exists "cfa"."public"."ast_agg__distinct_join__dbt_backup" cascade
19:34:53.589482 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.06 seconds
19:34:53.591087 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__distinct_join: COMMIT
19:34:53.591401 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__distinct_join"
19:34:53.591732 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__distinct_join: COMMIT
19:34:54.618016 [debug] [Thread-1  ]: SQL status: COMMIT in 1.03 seconds
19:34:54.618614 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast_agg__distinct_join"
19:34:54.619280 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__distinct_join: BEGIN
19:34:54.682614 [debug] [Thread-1  ]: SQL status: BEGIN in 0.06 seconds
19:34:54.683791 [debug] [Thread-1  ]: finished collecting timing info
19:34:54.684125 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__distinct_join: ROLLBACK
19:34:54.972605 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast_agg__distinct_join: Close
19:34:54.973710 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c5593319-6f0d-4844-b131-96ab26a9f505', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd90425b8e0>]}
19:34:54.974206 [info ] [Thread-1  ]: 4 of 4 OK created table model public.lcarr_sosx_ast_agg__distinct_join.......... [[32mSELECT[0m in 11.14s]
19:34:54.974651 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.ast_agg__distinct_join
19:34:54.976300 [debug] [MainThread]: Acquiring new redshift connection "master"
19:34:54.976649 [debug] [MainThread]: Using redshift connection "master"
19:34:54.976875 [debug] [MainThread]: On master: BEGIN
19:34:54.977064 [debug] [MainThread]: Opening a new connection, currently in state closed
19:34:54.977267 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:34:55.722759 [debug] [MainThread]: SQL status: BEGIN in 0.75 seconds
19:34:55.723318 [debug] [MainThread]: On master: COMMIT
19:34:55.723701 [debug] [MainThread]: Using redshift connection "master"
19:34:55.723983 [debug] [MainThread]: On master: COMMIT
19:34:55.861775 [debug] [MainThread]: SQL status: COMMIT in 0.14 seconds
19:34:55.862334 [debug] [MainThread]: On master: Close
19:34:55.863359 [info ] [MainThread]: 
19:34:55.863877 [info ] [MainThread]: Finished running 4 table models in 592.50s.
19:34:55.864411 [debug] [MainThread]: Connection 'master' was properly closed.
19:34:55.864734 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.ast_agg__distinct_join' was properly closed.
19:34:55.865119 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.ast_agg__distinct_calcs' was properly closed.
19:34:55.865464 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs' was properly closed.
19:34:55.909394 [info ] [MainThread]: 
19:34:55.910110 [info ] [MainThread]: [32mCompleted successfully[0m
19:34:55.910721 [info ] [MainThread]: 
19:34:55.911182 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
19:34:55.912058 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd90426e040>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd90426e2b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd90428fbb0>]}


============================== 2022-06-24 19:35:33.608066 | d37f35df-79f4-4ed5-a13a-9b06dba6806a ==============================
19:35:33.608066 [info ] [MainThread]: Running with dbt=1.0.4
19:35:33.609660 [debug] [MainThread]: running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=None, defer=None, event_buffer_size=None, exclude=None, fail_fast=True, full_refresh=False, log_cache_events=False, log_format=None, partial_parse=None, printer_width=None, profile=None, profiles_dir='/Users/lindsay.carr/DBT/environments/redshift_discovery_crn_svc/', project_dir=None, record_timing_info=None, rpc_method='run', select=['ast.final_output'], selector_name=None, send_anonymous_usage_stats=None, single_threaded=False, state=None, static_parser=None, target=None, threads=None, use_colors=None, use_experimental_parser=None, vars='{}', version_check=None, warn_error=None, which='run', write_json=None)
19:35:33.610329 [debug] [MainThread]: Tracking: tracking
19:35:33.648068 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa62f4796d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa62f479ac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa62f45b0d0>]}
19:35:33.866598 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
19:35:33.872928 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
19:35:33.875572 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.source_of_sales_change_lcarr.market.aggregations
- models.source_of_sales_change_lcarr.market.final_output
- models.source_of_sales_change_lcarr.market.aggregations_distinct

19:35:33.884506 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd37f35df-79f4-4ed5-a13a-9b06dba6806a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa62f6e3910>]}
19:35:33.904710 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd37f35df-79f4-4ed5-a13a-9b06dba6806a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa62eb2b0a0>]}
19:35:33.905509 [info ] [MainThread]: Found 49 models, 4 tests, 0 snapshots, 0 analyses, 192 macros, 0 operations, 0 seed files, 11 sources, 0 exposures, 0 metrics
19:35:33.908818 [info ] [MainThread]: 
19:35:33.909556 [debug] [MainThread]: Acquiring new redshift connection "master"
19:35:33.911045 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa"
19:35:33.932622 [debug] [ThreadPool]: Using redshift connection "list_cfa"
19:35:33.933033 [debug] [ThreadPool]: On list_cfa: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa"} */

    select distinct nspname from pg_namespace
  
19:35:33.933306 [debug] [ThreadPool]: Opening a new connection, currently in state init
19:35:33.933570 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:35:34.972130 [debug] [ThreadPool]: SQL status: SELECT in 1.04 seconds
19:35:34.980451 [debug] [ThreadPool]: On list_cfa: Close
19:35:34.985185 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa_public"
19:35:34.992908 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
19:35:34.993187 [debug] [ThreadPool]: On list_cfa_public: BEGIN
19:35:34.993377 [debug] [ThreadPool]: Opening a new connection, currently in state closed
19:35:34.993556 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:35:35.608577 [debug] [ThreadPool]: SQL status: BEGIN in 0.62 seconds
19:35:35.609287 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
19:35:35.609721 [debug] [ThreadPool]: On list_cfa_public: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa_public"} */
select
      'cfa' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'cfa' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
19:35:35.871816 [debug] [ThreadPool]: SQL status: SELECT in 0.26 seconds
19:35:35.921559 [debug] [ThreadPool]: On list_cfa_public: ROLLBACK
19:35:36.073700 [debug] [ThreadPool]: On list_cfa_public: Close
19:35:36.106612 [debug] [MainThread]: Using redshift connection "master"
19:35:36.106905 [debug] [MainThread]: On master: BEGIN
19:35:36.107095 [debug] [MainThread]: Opening a new connection, currently in state init
19:35:36.107276 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:35:36.822470 [debug] [MainThread]: SQL status: BEGIN in 0.72 seconds
19:35:36.822980 [debug] [MainThread]: Using redshift connection "master"
19:35:36.823249 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
19:35:37.517901 [debug] [MainThread]: SQL status: SELECT in 0.69 seconds
19:35:37.541684 [debug] [MainThread]: On master: ROLLBACK
19:35:37.645644 [debug] [MainThread]: Using redshift connection "master"
19:35:37.646108 [debug] [MainThread]: On master: BEGIN
19:35:37.765463 [debug] [MainThread]: SQL status: BEGIN in 0.12 seconds
19:35:37.766146 [debug] [MainThread]: On master: COMMIT
19:35:37.766454 [debug] [MainThread]: Using redshift connection "master"
19:35:37.766889 [debug] [MainThread]: On master: COMMIT
19:35:37.865760 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
19:35:37.866368 [debug] [MainThread]: On master: Close
19:35:37.867362 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
19:35:37.867822 [info ] [MainThread]: 
19:35:37.885474 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.ast__big_join
19:35:37.885991 [info ] [Thread-1  ]: 1 of 2 START table model public.lcarr_sosx_ast__big_join........................ [RUN]
19:35:37.887830 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.ast__big_join"
19:35:37.888500 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.ast__big_join
19:35:37.888934 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.ast__big_join
19:35:37.893354 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.ast__big_join"
19:35:37.895482 [debug] [Thread-1  ]: finished collecting timing info
19:35:37.895760 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.ast__big_join
19:35:38.026480 [debug] [Thread-1  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.ast__big_join"
19:35:38.027787 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast__big_join"
19:35:38.028043 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast__big_join: BEGIN
19:35:38.028236 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
19:35:38.028430 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:35:38.836720 [debug] [Thread-1  ]: SQL status: BEGIN in 0.81 seconds
19:35:38.837214 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast__big_join"
19:35:38.837555 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast__big_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.ast__big_join"} */


  create  table
    "cfa"."public"."ast__big_join__dbt_tmp"
    
    
    
  as (
    with big_join as ( 
  select a.*, e.unique_cfa_one_ids, e.unique_hashes, e.hash_transactions, e.hash_per_customer,
  b.price_index, 
  d.previous_year_monthend_date
  from "cfa"."public"."lcarr_sosx_ast_agg__same_store_all_store" a
  inner join "cfa"."public"."lcarr_sosx_calc__dim_price_index_3" b
  on a.look_back_period = b.look_back_period
  and a.monthend_date = b.monthend_date
  and a.same_store = b.same_store
  inner join "cfa"."public"."lcarr_sosx_calc__dim_monthend_date" d
  on a.monthend_date = d.monthend_date
  inner join "cfa"."public"."lcarr_sosx_ast_agg__distinct_join" e
  on a.monthend_date = e.monthend_date
  and a.look_back_period = e.look_back_period
  and a.same_store = e.same_store
  and a.service_team_name = e.service_team_name
  and a.location_type_code = e.location_type_code
  and a.daypart = e.daypart
  and a.destination_desc = e.destination_desc
)
select * from big_join
  );
19:36:07.203182 [debug] [Thread-1  ]: SQL status: SELECT in 28.37 seconds
19:36:07.212096 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast__big_join"
19:36:07.212426 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast__big_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.ast__big_join"} */
alter table "cfa"."public"."ast__big_join__dbt_tmp" rename to "lcarr_sosx_ast__big_join"
19:36:07.268525 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.06 seconds
19:36:07.283238 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast__big_join: COMMIT
19:36:07.283564 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast__big_join"
19:36:07.283769 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast__big_join: COMMIT
19:36:08.356090 [debug] [Thread-1  ]: SQL status: COMMIT in 1.07 seconds
19:36:08.357095 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast__big_join"
19:36:08.357511 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast__big_join: BEGIN
19:36:08.431263 [debug] [Thread-1  ]: SQL status: BEGIN in 0.07 seconds
19:36:08.440582 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast__big_join"
19:36:08.440875 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast__big_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.ast__big_join"} */
drop table if exists "cfa"."public"."ast__big_join__dbt_backup" cascade
19:36:08.501579 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.06 seconds
19:36:08.503058 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast__big_join: COMMIT
19:36:08.503375 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast__big_join"
19:36:08.503638 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast__big_join: COMMIT
19:36:08.614752 [debug] [Thread-1  ]: SQL status: COMMIT in 0.11 seconds
19:36:08.615446 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast__big_join"
19:36:08.615743 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast__big_join: BEGIN
19:36:08.683146 [debug] [Thread-1  ]: SQL status: BEGIN in 0.07 seconds
19:36:08.684089 [debug] [Thread-1  ]: finished collecting timing info
19:36:08.684426 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast__big_join: ROLLBACK
19:36:08.784449 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.ast__big_join: Close
19:36:08.785631 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd37f35df-79f4-4ed5-a13a-9b06dba6806a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa62faf4e50>]}
19:36:08.786167 [info ] [Thread-1  ]: 1 of 2 OK created table model public.lcarr_sosx_ast__big_join................... [[32mSELECT[0m in 30.90s]
19:36:08.786643 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.ast__big_join
19:36:08.787413 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.ast__final_output
19:36:08.788094 [info ] [Thread-3  ]: 2 of 2 START table model public.lcarr_sosx_ast__final_output.................... [RUN]
19:36:08.788844 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.ast__final_output"
19:36:08.789252 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.ast__final_output
19:36:08.789860 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.ast__final_output
19:36:08.793687 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.ast__final_output"
19:36:08.795260 [debug] [Thread-3  ]: finished collecting timing info
19:36:08.795629 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.ast__final_output
19:36:08.866845 [debug] [Thread-3  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.ast__final_output"
19:36:08.867588 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast__final_output"
19:36:08.867917 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.ast__final_output: BEGIN
19:36:08.868089 [debug] [Thread-3  ]: Opening a new connection, currently in state init
19:36:08.868270 [debug] [Thread-3  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:36:09.949418 [debug] [Thread-3  ]: SQL status: BEGIN in 1.08 seconds
19:36:09.950031 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast__final_output"
19:36:09.950314 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.ast__final_output: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.ast__final_output"} */


  create  table
    "cfa"."public"."ast__final_output__dbt_tmp"
    
    
    
  as (
    with twentytwo as (
select *
from "cfa"."public"."lcarr_sosx_ast__big_join" 
where monthend_date = cast('02-28-2022' as date) 
), twentyone as ( 
select * 
from "cfa"."public"."lcarr_sosx_ast__big_join"
where monthend_date = cast('02-28-2021' as date)
) 

select a.quarter,
a.look_back_period,a.same_store,
'AST' as geolevel, 
a.service_team_name as geolevel_detail,
a.location_type_code,a.daypart,a.destination_desc,
a.monthend_date as current_monthend_date,
a.sales_sub_total as current_sales_sub_total,
a.transactions as current_transactions,
a.purchaser_visits as current_purchaser_visits,
a.credit_txn as current_credit_txn,
a.total_items_promo_count as current_total_items_promo_count,
a.total_items_sold_count as current_total_items_sold_count,
a.actual_days as current_actual_days,
a.avail_days as current_avail_days,
a.price_index as current_price_index,
a.unique_cfa_one_ids as current_unique_cfa_one_ids,
a.unique_hashes as current_unique_hashes,
a.hash_transactions as current_hash_transactions,
a.hash_per_customer as current_hash_per_customer,
a.previous_year_monthend_date as check_date,
b.monthend_date as previous_monthend_date,
b.sales_sub_total as previous_sales_sub_total,
b.transactions as previous_transactions,
b.purchaser_visits as previous_purchaser_visits,
b.credit_txn as previous_credit_txn,
b.total_items_promo_count as previous_total_items_promo_count,
b.total_items_sold_count as previous_total_items_sold_count,
b.actual_days as previous_actual_days,
b.avail_days as previous_avail_days,
b.price_index as previous_price_index,
b.unique_cfa_one_ids as previous_unique_cfa_one_ids,
b.unique_hashes as previous_unique_hashes,
b.hash_transactions as previous_hash_transactions,
b.hash_per_customer as previous_hash_per_customer
from twentytwo a 
inner join twentyone b
on a.look_back_period = b.look_back_period 
and a.same_store = b.same_store 
and a.service_team_name = b.service_team_name
and a.location_type_code = b.location_type_code 
and a.daypart = b.daypart
and a.destination_desc = b.destination_desc
and a.previous_year_monthend_date = b.monthend_date
order by same_store,location_type_code,daypart,destination_desc
  );
19:36:21.946099 [debug] [Thread-3  ]: SQL status: SELECT in 12.0 seconds
19:36:21.949365 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast__final_output"
19:36:21.949621 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.ast__final_output: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.ast__final_output"} */
alter table "cfa"."public"."ast__final_output__dbt_tmp" rename to "lcarr_sosx_ast__final_output"
19:36:22.007345 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.06 seconds
19:36:22.009653 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.ast__final_output: COMMIT
19:36:22.010005 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast__final_output"
19:36:22.010271 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.ast__final_output: COMMIT
19:36:24.406664 [debug] [Thread-3  ]: SQL status: COMMIT in 2.4 seconds
19:36:24.407217 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast__final_output"
19:36:24.407449 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.ast__final_output: BEGIN
19:36:24.466818 [debug] [Thread-3  ]: SQL status: BEGIN in 0.06 seconds
19:36:24.469596 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast__final_output"
19:36:24.469908 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.ast__final_output: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.ast__final_output"} */
drop table if exists "cfa"."public"."ast__final_output__dbt_backup" cascade
19:36:24.528232 [debug] [Thread-3  ]: SQL status: DROP TABLE in 0.06 seconds
19:36:24.529604 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.ast__final_output: COMMIT
19:36:24.529916 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast__final_output"
19:36:24.530161 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.ast__final_output: COMMIT
19:36:24.714452 [debug] [Thread-3  ]: SQL status: COMMIT in 0.18 seconds
19:36:24.715081 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.ast__final_output"
19:36:24.715375 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.ast__final_output: BEGIN
19:36:24.793165 [debug] [Thread-3  ]: SQL status: BEGIN in 0.08 seconds
19:36:24.794162 [debug] [Thread-3  ]: finished collecting timing info
19:36:24.794552 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.ast__final_output: ROLLBACK
19:36:24.895951 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.ast__final_output: Close
19:36:24.897197 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd37f35df-79f4-4ed5-a13a-9b06dba6806a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa62fc35df0>]}
19:36:24.897741 [info ] [Thread-3  ]: 2 of 2 OK created table model public.lcarr_sosx_ast__final_output............... [[32mSELECT[0m in 16.11s]
19:36:24.898208 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.ast__final_output
19:36:24.900071 [debug] [MainThread]: Acquiring new redshift connection "master"
19:36:24.900414 [debug] [MainThread]: Using redshift connection "master"
19:36:24.900624 [debug] [MainThread]: On master: BEGIN
19:36:24.900803 [debug] [MainThread]: Opening a new connection, currently in state closed
19:36:24.900996 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:36:25.926661 [debug] [MainThread]: SQL status: BEGIN in 1.03 seconds
19:36:25.927450 [debug] [MainThread]: On master: COMMIT
19:36:25.927740 [debug] [MainThread]: Using redshift connection "master"
19:36:25.927956 [debug] [MainThread]: On master: COMMIT
19:36:26.029853 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
19:36:26.030468 [debug] [MainThread]: On master: Close
19:36:26.031609 [info ] [MainThread]: 
19:36:26.032115 [info ] [MainThread]: Finished running 2 table models in 52.12s.
19:36:26.032629 [debug] [MainThread]: Connection 'master' was properly closed.
19:36:26.032869 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.ast__big_join' was properly closed.
19:36:26.033073 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.ast__final_output' was properly closed.
19:36:26.050915 [info ] [MainThread]: 
19:36:26.051415 [info ] [MainThread]: [32mCompleted successfully[0m
19:36:26.051986 [info ] [MainThread]: 
19:36:26.052431 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
19:36:26.052935 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa62fb03e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa62fb03fa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa62fb03fd0>]}


============================== 2022-06-24 19:42:15.826498 | eebbe285-a5ca-4528-aaa8-652c2b063d40 ==============================
19:42:15.826498 [info ] [MainThread]: Running with dbt=1.0.4
19:42:15.836802 [debug] [MainThread]: running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=None, defer=None, event_buffer_size=None, exclude=None, fail_fast=True, full_refresh=False, log_cache_events=False, log_format=None, partial_parse=None, printer_width=None, profile=None, profiles_dir='/Users/lindsay.carr/DBT/environments/redshift_discovery_crn_svc/', project_dir=None, record_timing_info=None, rpc_method='run', select=['market.aggregations'], selector_name=None, send_anonymous_usage_stats=None, single_threaded=False, state=None, static_parser=None, target=None, threads=None, use_colors=None, use_experimental_parser=None, vars='{}', version_check=None, warn_error=None, which='run', write_json=None)
19:42:15.837392 [debug] [MainThread]: Tracking: tracking
19:42:15.916000 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf8a4a3640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf8a4a3a30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf8a4b1070>]}
19:42:16.112212 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 9 files added, 0 files changed.
19:42:16.113226 [debug] [MainThread]: Partial parsing: added file: source_of_sales_change_lcarr://models/market/aggregations/market_agg__same_store_all_store.sql
19:42:16.113694 [debug] [MainThread]: Partial parsing: added file: source_of_sales_change_lcarr://models/market/aggregations_distinct/market_agg__month_lookback_distinct.sql
19:42:16.114113 [debug] [MainThread]: Partial parsing: added file: source_of_sales_change_lcarr://models/market/aggregations_distinct/market_agg__distinct_calcs.sql
19:42:16.114510 [debug] [MainThread]: Partial parsing: added file: source_of_sales_change_lcarr://models/market/final_output/market__big_join.sql
19:42:16.114903 [debug] [MainThread]: Partial parsing: added file: source_of_sales_change_lcarr://models/market/aggregations_distinct/market_agg__distinct_join.sql
19:42:16.115292 [debug] [MainThread]: Partial parsing: added file: source_of_sales_change_lcarr://models/market/aggregations_distinct/market_agg__hash_base_calcs.sql
19:42:16.115767 [debug] [MainThread]: Partial parsing: added file: source_of_sales_change_lcarr://models/market/aggregations/market_agg__month_lookback.sql
19:42:16.116158 [debug] [MainThread]: Partial parsing: added file: source_of_sales_change_lcarr://models/market/aggregations/market_agg__all_groupings.sql
19:42:16.116565 [debug] [MainThread]: Partial parsing: added file: source_of_sales_change_lcarr://models/market/final_output/market__final_output.sql
19:42:16.152367 [debug] [MainThread]: 1699: static parser successfully parsed market/aggregations/market_agg__same_store_all_store.sql
19:42:16.184578 [debug] [MainThread]: 1699: static parser successfully parsed market/aggregations_distinct/market_agg__month_lookback_distinct.sql
19:42:16.189507 [debug] [MainThread]: 1603: static parser failed on market/aggregations_distinct/market_agg__distinct_calcs.sql
19:42:16.202371 [debug] [MainThread]: 1602: parser fallback to jinja rendering on market/aggregations_distinct/market_agg__distinct_calcs.sql
19:42:16.204832 [debug] [MainThread]: 1699: static parser successfully parsed market/final_output/market__big_join.sql
19:42:16.209561 [debug] [MainThread]: 1699: static parser successfully parsed market/aggregations_distinct/market_agg__distinct_join.sql
19:42:16.215265 [debug] [MainThread]: 1603: static parser failed on market/aggregations_distinct/market_agg__hash_base_calcs.sql
19:42:16.227440 [debug] [MainThread]: 1602: parser fallback to jinja rendering on market/aggregations_distinct/market_agg__hash_base_calcs.sql
19:42:16.229910 [debug] [MainThread]: 1699: static parser successfully parsed market/aggregations/market_agg__month_lookback.sql
19:42:16.234541 [debug] [MainThread]: 1603: static parser failed on market/aggregations/market_agg__all_groupings.sql
19:42:16.243919 [debug] [MainThread]: 1602: parser fallback to jinja rendering on market/aggregations/market_agg__all_groupings.sql
19:42:16.246886 [debug] [MainThread]: 1699: static parser successfully parsed market/final_output/market__final_output.sql
19:42:16.283417 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'eebbe285-a5ca-4528-aaa8-652c2b063d40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf8a4e6ee0>]}
19:42:16.318734 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'eebbe285-a5ca-4528-aaa8-652c2b063d40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf8a526f70>]}
19:42:16.319386 [info ] [MainThread]: Found 58 models, 4 tests, 0 snapshots, 0 analyses, 192 macros, 0 operations, 0 seed files, 11 sources, 0 exposures, 0 metrics
19:42:16.326065 [info ] [MainThread]: 
19:42:16.331107 [debug] [MainThread]: Acquiring new redshift connection "master"
19:42:16.332801 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa"
19:42:16.353819 [debug] [ThreadPool]: Using redshift connection "list_cfa"
19:42:16.354288 [debug] [ThreadPool]: On list_cfa: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa"} */

    select distinct nspname from pg_namespace
  
19:42:16.354644 [debug] [ThreadPool]: Opening a new connection, currently in state init
19:42:16.354998 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:42:17.168695 [debug] [ThreadPool]: SQL status: SELECT in 0.81 seconds
19:42:17.177329 [debug] [ThreadPool]: On list_cfa: Close
19:42:17.182777 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa_public"
19:42:17.189991 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
19:42:17.190257 [debug] [ThreadPool]: On list_cfa_public: BEGIN
19:42:17.190432 [debug] [ThreadPool]: Opening a new connection, currently in state closed
19:42:17.190608 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:42:18.309594 [debug] [ThreadPool]: SQL status: BEGIN in 1.12 seconds
19:42:18.310383 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
19:42:18.310666 [debug] [ThreadPool]: On list_cfa_public: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa_public"} */
select
      'cfa' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'cfa' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
19:42:18.569208 [debug] [ThreadPool]: SQL status: SELECT in 0.26 seconds
19:42:18.620559 [debug] [ThreadPool]: On list_cfa_public: ROLLBACK
19:42:18.721811 [debug] [ThreadPool]: On list_cfa_public: Close
19:42:18.755797 [debug] [MainThread]: Using redshift connection "master"
19:42:18.756073 [debug] [MainThread]: On master: BEGIN
19:42:18.756253 [debug] [MainThread]: Opening a new connection, currently in state init
19:42:18.756434 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:42:19.449274 [debug] [MainThread]: SQL status: BEGIN in 0.69 seconds
19:42:19.449896 [debug] [MainThread]: Using redshift connection "master"
19:42:19.450174 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
19:42:20.265776 [debug] [MainThread]: SQL status: SELECT in 0.82 seconds
19:42:20.284607 [debug] [MainThread]: On master: ROLLBACK
19:42:20.383199 [debug] [MainThread]: Using redshift connection "master"
19:42:20.383849 [debug] [MainThread]: On master: BEGIN
19:42:20.500973 [debug] [MainThread]: SQL status: BEGIN in 0.12 seconds
19:42:20.501611 [debug] [MainThread]: On master: COMMIT
19:42:20.501911 [debug] [MainThread]: Using redshift connection "master"
19:42:20.502251 [debug] [MainThread]: On master: COMMIT
19:42:20.709191 [debug] [MainThread]: SQL status: COMMIT in 0.21 seconds
19:42:20.709684 [debug] [MainThread]: On master: Close
19:42:20.710817 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
19:42:20.711411 [info ] [MainThread]: 
19:42:20.718140 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.market_agg__all_groupings
19:42:20.718657 [info ] [Thread-1  ]: 1 of 3 START table model public.lcarr_sosx_market_agg__all_groupings............ [RUN]
19:42:20.719439 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.market_agg__all_groupings"
19:42:20.719708 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.market_agg__all_groupings
19:42:20.719962 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.market_agg__all_groupings
19:42:20.727085 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.market_agg__all_groupings"
19:42:20.730162 [debug] [Thread-1  ]: finished collecting timing info
19:42:20.730477 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.market_agg__all_groupings
19:42:20.832132 [debug] [Thread-1  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.market_agg__all_groupings"
19:42:20.837130 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__all_groupings"
19:42:20.837490 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__all_groupings: BEGIN
19:42:20.837735 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
19:42:20.837937 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:42:21.603524 [debug] [Thread-1  ]: SQL status: BEGIN in 0.77 seconds
19:42:21.604058 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__all_groupings"
19:42:21.604337 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__all_groupings: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__all_groupings"} */


  create  table
    "cfa"."public"."market_agg__all_groupings__dbt_tmp"
    
    
    
  as (
    with aggregations_all_groupings as (
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    location_type_code,daypart,destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    location_type_code,'All' as daypart,destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    location_type_code,'All' as daypart,'All' as destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    location_type_code,daypart,'All' as destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    'All' as location_type_code,daypart,'All' as destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    'All' as location_type_code,daypart,destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    'All' as location_type_code,'All' as daypart,destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
) 
select * from aggregations_all_groupings
  );
19:43:37.874805 [debug] [Thread-1  ]: SQL status: SELECT in 76.27 seconds
19:43:37.885424 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__all_groupings"
19:43:37.885743 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__all_groupings: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__all_groupings"} */
alter table "cfa"."public"."lcarr_sosx_market_agg__all_groupings" rename to "market_agg__all_groupings__dbt_backup"
19:43:37.942655 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.06 seconds
19:43:37.946085 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__all_groupings"
19:43:37.946350 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__all_groupings: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__all_groupings"} */
alter table "cfa"."public"."market_agg__all_groupings__dbt_tmp" rename to "lcarr_sosx_market_agg__all_groupings"
19:43:38.009498 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.06 seconds
19:43:38.024714 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__all_groupings: COMMIT
19:43:38.025036 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__all_groupings"
19:43:38.025226 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__all_groupings: COMMIT
19:43:38.999585 [debug] [Thread-1  ]: SQL status: COMMIT in 0.97 seconds
19:43:39.000468 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__all_groupings"
19:43:39.000765 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__all_groupings: BEGIN
19:43:39.065517 [debug] [Thread-1  ]: SQL status: BEGIN in 0.06 seconds
19:43:39.072954 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__all_groupings"
19:43:39.073240 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__all_groupings: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__all_groupings"} */
drop table if exists "cfa"."public"."market_agg__all_groupings__dbt_backup" cascade
19:43:39.133670 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.06 seconds
19:43:39.135051 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__all_groupings: COMMIT
19:43:39.135329 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__all_groupings"
19:43:39.135541 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__all_groupings: COMMIT
19:43:40.123822 [debug] [Thread-1  ]: SQL status: COMMIT in 0.99 seconds
19:43:40.124210 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__all_groupings"
19:43:40.124425 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__all_groupings: BEGIN
19:43:40.180996 [debug] [Thread-1  ]: SQL status: BEGIN in 0.06 seconds
19:43:40.182041 [debug] [Thread-1  ]: finished collecting timing info
19:43:40.182361 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__all_groupings: ROLLBACK
19:43:40.283022 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__all_groupings: Close
19:43:40.284452 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eebbe285-a5ca-4528-aaa8-652c2b063d40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf8ac452e0>]}
19:43:40.285030 [info ] [Thread-1  ]: 1 of 3 OK created table model public.lcarr_sosx_market_agg__all_groupings....... [[32mSELECT[0m in 79.57s]
19:43:40.285511 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.market_agg__all_groupings
19:43:40.286292 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.market_agg__month_lookback
19:43:40.286811 [info ] [Thread-3  ]: 2 of 3 START table model public.lcarr_sosx_market_agg__month_lookback........... [RUN]
19:43:40.287659 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback"
19:43:40.287915 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.market_agg__month_lookback
19:43:40.288153 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.market_agg__month_lookback
19:43:40.291382 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.market_agg__month_lookback"
19:43:40.294768 [debug] [Thread-3  ]: finished collecting timing info
19:43:40.295136 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.market_agg__month_lookback
19:43:40.360152 [debug] [Thread-3  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.market_agg__month_lookback"
19:43:40.364868 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback"
19:43:40.365241 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback: BEGIN
19:43:40.365486 [debug] [Thread-3  ]: Opening a new connection, currently in state init
19:43:40.365688 [debug] [Thread-3  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:43:41.161469 [debug] [Thread-3  ]: SQL status: BEGIN in 0.8 seconds
19:43:41.161933 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback"
19:43:41.162223 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__month_lookback"} */


  create  table
    "cfa"."public"."market_agg__month_lookback__dbt_tmp"
    
    
    
  as (
    with add_month_lookback as (
  select quarter,region_name,service_team_name,dma_name,location_num,
  monthend_date,'1 month' as look_back_period,
  location_type_code,daypart,destination_desc,sales_sub_total,
  transactions,purchaser_visits,credit_txn,
  total_items_promo_count,total_items_sold_count
  from "cfa"."public"."lcarr_sosx_market_agg__all_groupings"
)
select * from add_month_lookback
  );
19:43:42.897618 [debug] [Thread-3  ]: SQL status: SELECT in 1.74 seconds
19:43:42.901948 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback"
19:43:42.902228 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__month_lookback"} */
alter table "cfa"."public"."lcarr_sosx_market_agg__month_lookback" rename to "market_agg__month_lookback__dbt_backup"
19:43:42.963836 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.06 seconds
19:43:42.968732 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback"
19:43:42.969033 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__month_lookback"} */
alter table "cfa"."public"."market_agg__month_lookback__dbt_tmp" rename to "lcarr_sosx_market_agg__month_lookback"
19:43:43.028495 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.06 seconds
19:43:43.030886 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback: COMMIT
19:43:43.031199 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback"
19:43:43.031463 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback: COMMIT
19:43:43.913274 [debug] [Thread-3  ]: SQL status: COMMIT in 0.88 seconds
19:43:43.914177 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback"
19:43:43.914486 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback: BEGIN
19:43:43.972553 [debug] [Thread-3  ]: SQL status: BEGIN in 0.06 seconds
19:43:43.976677 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback"
19:43:43.976938 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__month_lookback"} */
drop table if exists "cfa"."public"."market_agg__month_lookback__dbt_backup" cascade
19:43:44.036493 [debug] [Thread-3  ]: SQL status: DROP TABLE in 0.06 seconds
19:43:44.038389 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback: COMMIT
19:43:44.038700 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback"
19:43:44.038967 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback: COMMIT
19:43:44.938210 [debug] [Thread-3  ]: SQL status: COMMIT in 0.9 seconds
19:43:44.938953 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback"
19:43:44.939239 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback: BEGIN
19:43:44.999557 [debug] [Thread-3  ]: SQL status: BEGIN in 0.06 seconds
19:43:45.000506 [debug] [Thread-3  ]: finished collecting timing info
19:43:45.000839 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback: ROLLBACK
19:43:45.102959 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback: Close
19:43:45.104261 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eebbe285-a5ca-4528-aaa8-652c2b063d40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf8acf5af0>]}
19:43:45.104810 [info ] [Thread-3  ]: 2 of 3 OK created table model public.lcarr_sosx_market_agg__month_lookback...... [[32mSELECT[0m in 4.82s]
19:43:45.105311 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.market_agg__month_lookback
19:43:45.106345 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.market_agg__same_store_all_store
19:43:45.106893 [info ] [Thread-2  ]: 3 of 3 START table model public.lcarr_sosx_market_agg__same_store_all_store..... [RUN]
19:43:45.107894 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.market_agg__same_store_all_store"
19:43:45.108164 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.market_agg__same_store_all_store
19:43:45.108394 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.market_agg__same_store_all_store
19:43:45.111894 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.market_agg__same_store_all_store"
19:43:45.114275 [debug] [Thread-2  ]: finished collecting timing info
19:43:45.114646 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.market_agg__same_store_all_store
19:43:45.180461 [debug] [Thread-2  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.market_agg__same_store_all_store"
19:43:45.183789 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__same_store_all_store"
19:43:45.184148 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.market_agg__same_store_all_store: BEGIN
19:43:45.184403 [debug] [Thread-2  ]: Opening a new connection, currently in state init
19:43:45.184612 [debug] [Thread-2  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:43:45.872212 [debug] [Thread-2  ]: SQL status: BEGIN in 0.69 seconds
19:43:45.872823 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__same_store_all_store"
19:43:45.873102 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.market_agg__same_store_all_store: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__same_store_all_store"} */


  create  table
    "cfa"."public"."market_agg__same_store_all_store__dbt_tmp"
    
    
    
  as (
    with transaction_same_store as (
  select a.*,b.same_store_eligible,b.actual_days,b.avail_days
  from "cfa"."public"."lcarr_sosx_market_agg__month_lookback" a
  left join "cfa"."public"."lcarr_sosx_stg__fct_same_store" b
  on a.location_num = b.location_num
  and a.look_back_period = b.look_back_period
  and a.monthend_date = b.monthend_date
  order by dma_name,location_num,look_back_period,location_type_code,daypart,destination_desc,monthend_date
), transaction_agg_all_stores as ( 
  select quarter,
  monthend_date,look_back_period,'All Stores' as same_store,dma_name,
  location_type_code,daypart,destination_desc,
  sum(sales_sub_total) as sales_sub_total,
  sum(transactions) as transactions,sum(purchaser_visits) as purchaser_visits,
  sum(credit_txn) as credit_txn,sum(total_items_promo_count) as total_items_promo_count,
  sum(total_items_sold_count) as total_items_sold_count,
  sum(actual_days) as actual_days, 
  sum(avail_days) as avail_days
  from transaction_same_store
  group by 1,2,3,4,5,6,7,8
), transaction_agg_same_stores as ( 
  select quarter,
  monthend_date,look_back_period,'Same Stores' as same_store,market,
  location_type_code,daypart,destination_desc,
  sum(sales_sub_total) as sales_sub_total,
  sum(transactions) as transactions,sum(purchaser_visits) as purchaser_visits,
  sum(credit_txn) as credit_txn,sum(total_items_promo_count) as total_items_promo_count,
  sum(total_items_sold_count) as total_items_sold_count,
  sum(actual_days) as actual_days,
  sum(avail_days) as avail_days
  from transaction_same_store
  where same_store_eligible = 1 
  group by 1,2,3,4,5,6,7,8
), union_all_same_market_transactions as ( 
  select * from transaction_agg_all_stores
  union
  select * from transaction_agg_same_stores
)
select * from union_all_same_market_transactions
  );
19:43:46.015538 [debug] [Thread-2  ]: Postgres adapter: Postgres error: column "market" does not exist in transaction_same_store

19:43:46.016153 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.market_agg__same_store_all_store: ROLLBACK
19:43:46.074819 [debug] [Thread-2  ]: finished collecting timing info
19:43:46.075242 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.market_agg__same_store_all_store: Close
19:43:46.076104 [debug] [Thread-2  ]: Database Error in model market_agg__same_store_all_store (models/market/aggregations/market_agg__same_store_all_store.sql)
  column "market" does not exist in transaction_same_store
  compiled SQL at target/run/source_of_sales_change_lcarr/models/market/aggregations/market_agg__same_store_all_store.sql
19:43:46.076583 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eebbe285-a5ca-4528-aaa8-652c2b063d40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf8ac45700>]}
19:43:46.077121 [error] [Thread-2  ]: 3 of 3 ERROR creating table model public.lcarr_sosx_market_agg__same_store_all_store [[31mERROR[0m in 0.97s]
19:43:46.077696 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.market_agg__same_store_all_store
19:43:46.079588 [debug] [MainThread]: Acquiring new redshift connection "master"
19:43:46.079964 [error] [MainThread]: CANCEL query model.source_of_sales_change_lcarr.market_agg__all_groupings....... [[31mCANCEL[0m]
19:43:46.080411 [error] [MainThread]: CANCEL query model.source_of_sales_change_lcarr.market_agg__month_lookback...... [[31mCANCEL[0m]
19:43:46.080861 [error] [MainThread]: CANCEL query model.source_of_sales_change_lcarr.market_agg__same_store_all_store [[31mCANCEL[0m]
19:43:46.081566 [info ] [MainThread]: 
19:43:46.082005 [error] [MainThread]: [33mDatabase Error in model market_agg__same_store_all_store (models/market/aggregations/market_agg__same_store_all_store.sql)[0m
19:43:46.082384 [error] [MainThread]:   column "market" does not exist in transaction_same_store
19:43:46.082725 [error] [MainThread]:   compiled SQL at target/run/source_of_sales_change_lcarr/models/market/aggregations/market_agg__same_store_all_store.sql
19:43:46.083089 [debug] [MainThread]: Connection 'master' was properly closed.
19:43:46.083302 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.market_agg__all_groupings' was properly closed.
19:43:46.083496 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.market_agg__month_lookback' was properly closed.
19:43:46.083743 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.market_agg__same_store_all_store' was properly closed.
19:43:46.084077 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf8ad04be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf8a526310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdf8ad19d60>]}


============================== 2022-06-24 19:44:23.265755 | fda14212-25bc-489b-9acd-e81bdac758c0 ==============================
19:44:23.265755 [info ] [MainThread]: Running with dbt=1.0.4
19:44:23.273776 [debug] [MainThread]: running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=None, defer=None, event_buffer_size=None, exclude=None, fail_fast=True, full_refresh=False, log_cache_events=False, log_format=None, partial_parse=None, printer_width=None, profile=None, profiles_dir='/Users/lindsay.carr/DBT/environments/redshift_discovery_crn_svc/', project_dir=None, record_timing_info=None, rpc_method='run', select=['market.aggregations'], selector_name=None, send_anonymous_usage_stats=None, single_threaded=False, state=None, static_parser=None, target=None, threads=None, use_colors=None, use_experimental_parser=None, vars='{}', version_check=None, warn_error=None, which='run', write_json=None)
19:44:23.274659 [debug] [MainThread]: Tracking: tracking
19:44:23.304916 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb5e7ca3760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb5e7ca3d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb5e7ca3820>]}
19:44:23.540910 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
19:44:23.541731 [debug] [MainThread]: Partial parsing: updated file: source_of_sales_change_lcarr://models/market/aggregations/market_agg__same_store_all_store.sql
19:44:23.555789 [debug] [MainThread]: 1699: static parser successfully parsed market/aggregations/market_agg__same_store_all_store.sql
19:44:23.586232 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fda14212-25bc-489b-9acd-e81bdac758c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb5e7e64a00>]}
19:44:23.605817 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fda14212-25bc-489b-9acd-e81bdac758c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb5e7cc8520>]}
19:44:23.606278 [info ] [MainThread]: Found 58 models, 4 tests, 0 snapshots, 0 analyses, 192 macros, 0 operations, 0 seed files, 11 sources, 0 exposures, 0 metrics
19:44:23.609473 [info ] [MainThread]: 
19:44:23.610143 [debug] [MainThread]: Acquiring new redshift connection "master"
19:44:23.611107 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa"
19:44:23.623085 [debug] [ThreadPool]: Using redshift connection "list_cfa"
19:44:23.623450 [debug] [ThreadPool]: On list_cfa: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa"} */

    select distinct nspname from pg_namespace
  
19:44:23.623742 [debug] [ThreadPool]: Opening a new connection, currently in state init
19:44:23.623965 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:44:24.622176 [debug] [ThreadPool]: SQL status: SELECT in 1.0 seconds
19:44:24.631234 [debug] [ThreadPool]: On list_cfa: Close
19:44:24.638192 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa_public"
19:44:24.645754 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
19:44:24.646054 [debug] [ThreadPool]: On list_cfa_public: BEGIN
19:44:24.646239 [debug] [ThreadPool]: Opening a new connection, currently in state closed
19:44:24.646421 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:44:25.382901 [debug] [ThreadPool]: SQL status: BEGIN in 0.74 seconds
19:44:25.383376 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
19:44:25.383622 [debug] [ThreadPool]: On list_cfa_public: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa_public"} */
select
      'cfa' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'cfa' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
19:44:25.661187 [debug] [ThreadPool]: SQL status: SELECT in 0.28 seconds
19:44:25.709827 [debug] [ThreadPool]: On list_cfa_public: ROLLBACK
19:44:25.938344 [debug] [ThreadPool]: On list_cfa_public: Close
19:44:25.972081 [debug] [MainThread]: Using redshift connection "master"
19:44:25.972381 [debug] [MainThread]: On master: BEGIN
19:44:25.972559 [debug] [MainThread]: Opening a new connection, currently in state init
19:44:25.972737 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:44:26.628211 [debug] [MainThread]: SQL status: BEGIN in 0.66 seconds
19:44:26.628886 [debug] [MainThread]: Using redshift connection "master"
19:44:26.629172 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
19:44:27.444554 [debug] [MainThread]: SQL status: SELECT in 0.82 seconds
19:44:27.461887 [debug] [MainThread]: On master: ROLLBACK
19:44:27.579529 [debug] [MainThread]: Using redshift connection "master"
19:44:27.580153 [debug] [MainThread]: On master: BEGIN
19:44:27.715930 [debug] [MainThread]: SQL status: BEGIN in 0.14 seconds
19:44:27.716497 [debug] [MainThread]: On master: COMMIT
19:44:27.716748 [debug] [MainThread]: Using redshift connection "master"
19:44:27.716957 [debug] [MainThread]: On master: COMMIT
19:44:27.818110 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
19:44:27.818780 [debug] [MainThread]: On master: Close
19:44:27.819885 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
19:44:27.820401 [info ] [MainThread]: 
19:44:27.828157 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.market_agg__all_groupings
19:44:27.828780 [info ] [Thread-1  ]: 1 of 3 START table model public.lcarr_sosx_market_agg__all_groupings............ [RUN]
19:44:27.829839 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.market_agg__all_groupings"
19:44:27.830231 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.market_agg__all_groupings
19:44:27.830479 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.market_agg__all_groupings
19:44:27.837341 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.market_agg__all_groupings"
19:44:27.841455 [debug] [Thread-1  ]: finished collecting timing info
19:44:27.841867 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.market_agg__all_groupings
19:44:27.947448 [debug] [Thread-1  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.market_agg__all_groupings"
19:44:27.948518 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__all_groupings"
19:44:27.948761 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__all_groupings: BEGIN
19:44:27.948932 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
19:44:27.949113 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:44:28.849710 [debug] [Thread-1  ]: SQL status: BEGIN in 0.9 seconds
19:44:28.850295 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__all_groupings"
19:44:28.850582 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__all_groupings: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__all_groupings"} */


  create  table
    "cfa"."public"."market_agg__all_groupings__dbt_tmp"
    
    
    
  as (
    with aggregations_all_groupings as (
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    location_type_code,daypart,destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    location_type_code,'All' as daypart,destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    location_type_code,'All' as daypart,'All' as destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    location_type_code,daypart,'All' as destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    'All' as location_type_code,daypart,'All' as destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    'All' as location_type_code,daypart,destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    'All' as location_type_code,'All' as daypart,destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
) 
select * from aggregations_all_groupings
  );
19:45:26.927190 [debug] [Thread-1  ]: SQL status: SELECT in 58.08 seconds
19:45:26.937815 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__all_groupings"
19:45:26.938131 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__all_groupings: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__all_groupings"} */
alter table "cfa"."public"."lcarr_sosx_market_agg__all_groupings" rename to "market_agg__all_groupings__dbt_backup"
19:45:27.008514 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.07 seconds
19:45:27.012138 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__all_groupings"
19:45:27.012597 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__all_groupings: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__all_groupings"} */
alter table "cfa"."public"."market_agg__all_groupings__dbt_tmp" rename to "lcarr_sosx_market_agg__all_groupings"
19:45:27.072596 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.06 seconds
19:45:27.088838 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__all_groupings: COMMIT
19:45:27.089301 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__all_groupings"
19:45:27.089624 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__all_groupings: COMMIT
19:45:27.928490 [debug] [Thread-1  ]: SQL status: COMMIT in 0.84 seconds
19:45:27.929399 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__all_groupings"
19:45:27.929684 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__all_groupings: BEGIN
19:45:28.000621 [debug] [Thread-1  ]: SQL status: BEGIN in 0.07 seconds
19:45:28.008789 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__all_groupings"
19:45:28.009077 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__all_groupings: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__all_groupings"} */
drop table if exists "cfa"."public"."market_agg__all_groupings__dbt_backup" cascade
19:45:28.154170 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.14 seconds
19:45:28.155892 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__all_groupings: COMMIT
19:45:28.156193 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__all_groupings"
19:45:28.156401 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__all_groupings: COMMIT
19:45:52.460185 [debug] [Thread-1  ]: SQL status: COMMIT in 24.3 seconds
19:45:52.462700 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__all_groupings"
19:45:52.463120 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__all_groupings: BEGIN
19:45:52.592600 [debug] [Thread-1  ]: SQL status: BEGIN in 0.13 seconds
19:45:52.593778 [debug] [Thread-1  ]: finished collecting timing info
19:45:52.594114 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__all_groupings: ROLLBACK
19:45:53.036818 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__all_groupings: Close
19:45:53.038232 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fda14212-25bc-489b-9acd-e81bdac758c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb5e845a0a0>]}
19:45:53.038841 [info ] [Thread-1  ]: 1 of 3 OK created table model public.lcarr_sosx_market_agg__all_groupings....... [[32mSELECT[0m in 85.21s]
19:45:53.039338 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.market_agg__all_groupings
19:45:53.040127 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.market_agg__month_lookback
19:45:53.040744 [info ] [Thread-3  ]: 2 of 3 START table model public.lcarr_sosx_market_agg__month_lookback........... [RUN]
19:45:53.041499 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback"
19:45:53.041764 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.market_agg__month_lookback
19:45:53.042003 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.market_agg__month_lookback
19:45:53.045337 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.market_agg__month_lookback"
19:45:53.047864 [debug] [Thread-3  ]: finished collecting timing info
19:45:53.048224 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.market_agg__month_lookback
19:45:53.139126 [debug] [Thread-3  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.market_agg__month_lookback"
19:45:53.140798 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback"
19:45:53.141208 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback: BEGIN
19:45:53.141510 [debug] [Thread-3  ]: Opening a new connection, currently in state init
19:45:53.141824 [debug] [Thread-3  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:45:54.181822 [debug] [Thread-3  ]: SQL status: BEGIN in 1.04 seconds
19:45:54.182406 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback"
19:45:54.182684 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__month_lookback"} */


  create  table
    "cfa"."public"."market_agg__month_lookback__dbt_tmp"
    
    
    
  as (
    with add_month_lookback as (
  select quarter,region_name,service_team_name,dma_name,location_num,
  monthend_date,'1 month' as look_back_period,
  location_type_code,daypart,destination_desc,sales_sub_total,
  transactions,purchaser_visits,credit_txn,
  total_items_promo_count,total_items_sold_count
  from "cfa"."public"."lcarr_sosx_market_agg__all_groupings"
)
select * from add_month_lookback
  );
19:45:56.110143 [debug] [Thread-3  ]: SQL status: SELECT in 1.93 seconds
19:45:56.113575 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback"
19:45:56.113871 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__month_lookback"} */
alter table "cfa"."public"."lcarr_sosx_market_agg__month_lookback" rename to "market_agg__month_lookback__dbt_backup"
19:45:56.173271 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.06 seconds
19:45:56.176262 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback"
19:45:56.176569 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__month_lookback"} */
alter table "cfa"."public"."market_agg__month_lookback__dbt_tmp" rename to "lcarr_sosx_market_agg__month_lookback"
19:45:56.243596 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.07 seconds
19:45:56.245804 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback: COMMIT
19:45:56.246112 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback"
19:45:56.246370 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback: COMMIT
19:45:57.031078 [debug] [Thread-3  ]: SQL status: COMMIT in 0.78 seconds
19:45:57.031888 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback"
19:45:57.032200 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback: BEGIN
19:45:57.124648 [debug] [Thread-3  ]: SQL status: BEGIN in 0.09 seconds
19:45:57.128152 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback"
19:45:57.128434 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__month_lookback"} */
drop table if exists "cfa"."public"."market_agg__month_lookback__dbt_backup" cascade
19:45:57.194331 [debug] [Thread-3  ]: SQL status: DROP TABLE in 0.07 seconds
19:45:57.195962 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback: COMMIT
19:45:57.196271 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback"
19:45:57.196535 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback: COMMIT
19:45:57.977552 [debug] [Thread-3  ]: SQL status: COMMIT in 0.78 seconds
19:45:57.978307 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback"
19:45:57.978595 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback: BEGIN
19:45:58.038528 [debug] [Thread-3  ]: SQL status: BEGIN in 0.06 seconds
19:45:58.039677 [debug] [Thread-3  ]: finished collecting timing info
19:45:58.040005 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback: ROLLBACK
19:45:58.138320 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback: Close
19:45:58.139408 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fda14212-25bc-489b-9acd-e81bdac758c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb5e8424370>]}
19:45:58.140006 [info ] [Thread-3  ]: 2 of 3 OK created table model public.lcarr_sosx_market_agg__month_lookback...... [[32mSELECT[0m in 5.10s]
19:45:58.140524 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.market_agg__month_lookback
19:45:58.141199 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.market_agg__same_store_all_store
19:45:58.141860 [info ] [Thread-2  ]: 3 of 3 START table model public.lcarr_sosx_market_agg__same_store_all_store..... [RUN]
19:45:58.143026 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.market_agg__same_store_all_store"
19:45:58.143435 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.market_agg__same_store_all_store
19:45:58.143788 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.market_agg__same_store_all_store
19:45:58.149180 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.market_agg__same_store_all_store"
19:45:58.150617 [debug] [Thread-2  ]: finished collecting timing info
19:45:58.151102 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.market_agg__same_store_all_store
19:45:58.223360 [debug] [Thread-2  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.market_agg__same_store_all_store"
19:45:58.224938 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__same_store_all_store"
19:45:58.225263 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.market_agg__same_store_all_store: BEGIN
19:45:58.225436 [debug] [Thread-2  ]: Opening a new connection, currently in state init
19:45:58.225614 [debug] [Thread-2  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:45:59.047082 [debug] [Thread-2  ]: SQL status: BEGIN in 0.82 seconds
19:45:59.047684 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__same_store_all_store"
19:45:59.048058 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.market_agg__same_store_all_store: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__same_store_all_store"} */


  create  table
    "cfa"."public"."market_agg__same_store_all_store__dbt_tmp"
    
    
    
  as (
    with transaction_same_store as (
  select a.*,b.same_store_eligible,b.actual_days,b.avail_days
  from "cfa"."public"."lcarr_sosx_market_agg__month_lookback" a
  left join "cfa"."public"."lcarr_sosx_stg__fct_same_store" b
  on a.location_num = b.location_num
  and a.look_back_period = b.look_back_period
  and a.monthend_date = b.monthend_date
  order by dma_name,location_num,look_back_period,location_type_code,daypart,destination_desc,monthend_date
), transaction_agg_all_stores as ( 
  select quarter,
  monthend_date,look_back_period,'All Stores' as same_store,dma_name,
  location_type_code,daypart,destination_desc,
  sum(sales_sub_total) as sales_sub_total,
  sum(transactions) as transactions,sum(purchaser_visits) as purchaser_visits,
  sum(credit_txn) as credit_txn,sum(total_items_promo_count) as total_items_promo_count,
  sum(total_items_sold_count) as total_items_sold_count,
  sum(actual_days) as actual_days, 
  sum(avail_days) as avail_days
  from transaction_same_store
  group by 1,2,3,4,5,6,7,8
), transaction_agg_same_stores as ( 
  select quarter,
  monthend_date,look_back_period,'Same Stores' as same_store,dma_name,
  location_type_code,daypart,destination_desc,
  sum(sales_sub_total) as sales_sub_total,
  sum(transactions) as transactions,sum(purchaser_visits) as purchaser_visits,
  sum(credit_txn) as credit_txn,sum(total_items_promo_count) as total_items_promo_count,
  sum(total_items_sold_count) as total_items_sold_count,
  sum(actual_days) as actual_days,
  sum(avail_days) as avail_days
  from transaction_same_store
  where same_store_eligible = 1 
  group by 1,2,3,4,5,6,7,8
), union_all_same_market_transactions as ( 
  select * from transaction_agg_all_stores
  union
  select * from transaction_agg_same_stores
)
select * from union_all_same_market_transactions
  );
19:46:12.083524 [debug] [Thread-2  ]: SQL status: SELECT in 13.04 seconds
19:46:12.087128 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__same_store_all_store"
19:46:12.087404 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.market_agg__same_store_all_store: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__same_store_all_store"} */
alter table "cfa"."public"."lcarr_sosx_market_agg__same_store_all_store" rename to "market_agg__same_store_all_store__dbt_backup"
19:46:12.152657 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.07 seconds
19:46:12.157894 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__same_store_all_store"
19:46:12.158198 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.market_agg__same_store_all_store: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__same_store_all_store"} */
alter table "cfa"."public"."market_agg__same_store_all_store__dbt_tmp" rename to "lcarr_sosx_market_agg__same_store_all_store"
19:46:12.307413 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.15 seconds
19:46:12.309771 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.market_agg__same_store_all_store: COMMIT
19:46:12.310083 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__same_store_all_store"
19:46:12.310339 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.market_agg__same_store_all_store: COMMIT
19:46:13.928093 [debug] [Thread-2  ]: SQL status: COMMIT in 1.62 seconds
19:46:13.928936 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__same_store_all_store"
19:46:13.929219 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.market_agg__same_store_all_store: BEGIN
19:46:14.014890 [debug] [Thread-2  ]: SQL status: BEGIN in 0.09 seconds
19:46:14.019183 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__same_store_all_store"
19:46:14.019447 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.market_agg__same_store_all_store: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__same_store_all_store"} */
drop table if exists "cfa"."public"."market_agg__same_store_all_store__dbt_backup" cascade
19:46:14.183065 [debug] [Thread-2  ]: SQL status: DROP TABLE in 0.16 seconds
19:46:14.184834 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.market_agg__same_store_all_store: COMMIT
19:46:14.185236 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__same_store_all_store"
19:46:14.185503 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.market_agg__same_store_all_store: COMMIT
19:46:15.155643 [debug] [Thread-2  ]: SQL status: COMMIT in 0.97 seconds
19:46:15.156187 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__same_store_all_store"
19:46:15.156438 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.market_agg__same_store_all_store: BEGIN
19:46:15.213680 [debug] [Thread-2  ]: SQL status: BEGIN in 0.06 seconds
19:46:15.214780 [debug] [Thread-2  ]: finished collecting timing info
19:46:15.215111 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.market_agg__same_store_all_store: ROLLBACK
19:46:15.371440 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.market_agg__same_store_all_store: Close
19:46:15.372779 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fda14212-25bc-489b-9acd-e81bdac758c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb5e84f4bb0>]}
19:46:15.373387 [info ] [Thread-2  ]: 3 of 3 OK created table model public.lcarr_sosx_market_agg__same_store_all_store [[32mSELECT[0m in 17.23s]
19:46:15.373949 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.market_agg__same_store_all_store
19:46:15.375772 [debug] [MainThread]: Acquiring new redshift connection "master"
19:46:15.376151 [debug] [MainThread]: Using redshift connection "master"
19:46:15.376398 [debug] [MainThread]: On master: BEGIN
19:46:15.376607 [debug] [MainThread]: Opening a new connection, currently in state closed
19:46:15.376829 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:46:16.297020 [debug] [MainThread]: SQL status: BEGIN in 0.92 seconds
19:46:16.297750 [debug] [MainThread]: On master: COMMIT
19:46:16.298037 [debug] [MainThread]: Using redshift connection "master"
19:46:16.298292 [debug] [MainThread]: On master: COMMIT
19:46:16.574954 [debug] [MainThread]: SQL status: COMMIT in 0.28 seconds
19:46:16.575444 [debug] [MainThread]: On master: Close
19:46:16.576413 [info ] [MainThread]: 
19:46:16.576890 [info ] [MainThread]: Finished running 3 table models in 112.97s.
19:46:16.577387 [debug] [MainThread]: Connection 'master' was properly closed.
19:46:16.577623 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.market_agg__all_groupings' was properly closed.
19:46:16.577828 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.market_agg__month_lookback' was properly closed.
19:46:16.578023 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.market_agg__same_store_all_store' was properly closed.
19:46:16.596057 [info ] [MainThread]: 
19:46:16.596625 [info ] [MainThread]: [32mCompleted successfully[0m
19:46:16.597152 [info ] [MainThread]: 
19:46:16.597659 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
19:46:16.598175 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb5e723b130>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb5e723b040>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb5e723b0d0>]}


============================== 2022-06-24 19:46:36.531802 | c6f88827-4e77-48cd-b2b2-46ea6e98695b ==============================
19:46:36.531802 [info ] [MainThread]: Running with dbt=1.0.4
19:46:36.532519 [debug] [MainThread]: running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=None, defer=None, event_buffer_size=None, exclude=None, fail_fast=True, full_refresh=False, log_cache_events=False, log_format=None, partial_parse=None, printer_width=None, profile=None, profiles_dir='/Users/lindsay.carr/DBT/environments/redshift_discovery_crn_svc/', project_dir=None, record_timing_info=None, rpc_method='run', select=['market.aggregations_distinct'], selector_name=None, send_anonymous_usage_stats=None, single_threaded=False, state=None, static_parser=None, target=None, threads=None, use_colors=None, use_experimental_parser=None, vars='{}', version_check=None, warn_error=None, which='run', write_json=None)
19:46:36.533017 [debug] [MainThread]: Tracking: tracking
19:46:36.571703 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc48f4a36d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc48f4a3ac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc48f489340>]}
19:46:36.886248 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
19:46:36.886584 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
19:46:36.897340 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c6f88827-4e77-48cd-b2b2-46ea6e98695b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc48f4c0760>]}
19:46:36.915923 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c6f88827-4e77-48cd-b2b2-46ea6e98695b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc48f53e370>]}
19:46:36.916384 [info ] [MainThread]: Found 58 models, 4 tests, 0 snapshots, 0 analyses, 192 macros, 0 operations, 0 seed files, 11 sources, 0 exposures, 0 metrics
19:46:36.919661 [info ] [MainThread]: 
19:46:36.920370 [debug] [MainThread]: Acquiring new redshift connection "master"
19:46:36.921457 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa"
19:46:36.933123 [debug] [ThreadPool]: Using redshift connection "list_cfa"
19:46:36.933425 [debug] [ThreadPool]: On list_cfa: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa"} */

    select distinct nspname from pg_namespace
  
19:46:36.933615 [debug] [ThreadPool]: Opening a new connection, currently in state init
19:46:36.933809 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:46:37.677866 [debug] [ThreadPool]: SQL status: SELECT in 0.74 seconds
19:46:37.687389 [debug] [ThreadPool]: On list_cfa: Close
19:46:37.692381 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa_public"
19:46:37.699598 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
19:46:37.699855 [debug] [ThreadPool]: On list_cfa_public: BEGIN
19:46:37.700038 [debug] [ThreadPool]: Opening a new connection, currently in state closed
19:46:37.700216 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:46:38.560405 [debug] [ThreadPool]: SQL status: BEGIN in 0.86 seconds
19:46:38.561007 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
19:46:38.561292 [debug] [ThreadPool]: On list_cfa_public: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa_public"} */
select
      'cfa' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'cfa' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
19:46:38.831286 [debug] [ThreadPool]: SQL status: SELECT in 0.27 seconds
19:46:38.877230 [debug] [ThreadPool]: On list_cfa_public: ROLLBACK
19:46:38.976646 [debug] [ThreadPool]: On list_cfa_public: Close
19:46:39.008390 [debug] [MainThread]: Using redshift connection "master"
19:46:39.008698 [debug] [MainThread]: On master: BEGIN
19:46:39.008881 [debug] [MainThread]: Opening a new connection, currently in state init
19:46:39.009126 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:46:39.652620 [debug] [MainThread]: SQL status: BEGIN in 0.64 seconds
19:46:39.653272 [debug] [MainThread]: Using redshift connection "master"
19:46:39.653764 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
19:46:40.455631 [debug] [MainThread]: SQL status: SELECT in 0.8 seconds
19:46:40.473917 [debug] [MainThread]: On master: ROLLBACK
19:46:40.572257 [debug] [MainThread]: Using redshift connection "master"
19:46:40.572604 [debug] [MainThread]: On master: BEGIN
19:46:40.693890 [debug] [MainThread]: SQL status: BEGIN in 0.12 seconds
19:46:40.694465 [debug] [MainThread]: On master: COMMIT
19:46:40.694759 [debug] [MainThread]: Using redshift connection "master"
19:46:40.695020 [debug] [MainThread]: On master: COMMIT
19:46:40.944248 [debug] [MainThread]: SQL status: COMMIT in 0.25 seconds
19:46:40.944906 [debug] [MainThread]: On master: Close
19:46:40.945815 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
19:46:40.946270 [info ] [MainThread]: 
19:46:40.958758 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct
19:46:40.959414 [info ] [Thread-1  ]: 1 of 4 START table model public.lcarr_sosx_market_agg__month_lookback_distinct.. [RUN]
19:46:40.960484 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct"
19:46:40.960945 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct
19:46:40.961437 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct
19:46:40.964458 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct"
19:46:40.972545 [debug] [Thread-1  ]: finished collecting timing info
19:46:40.973293 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct
19:46:41.073178 [debug] [Thread-1  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct"
19:46:41.076518 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct"
19:46:41.076904 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct: BEGIN
19:46:41.077174 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
19:46:41.077402 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:46:42.015744 [debug] [Thread-1  ]: SQL status: BEGIN in 0.94 seconds
19:46:42.016354 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct"
19:46:42.016640 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct"} */


  create  table
    "cfa"."public"."market_agg__month_lookback_distinct__dbt_tmp"
    
    
    
  as (
    with one_month_set_up as (
  select a.region_name,a.service_team_name,a.dma_name,
  a.location_num,a.monthend_date,'1 month' as look_back_period,
  a.trans_id,a.cfa_one_id,a.customer_hash,
  a.location_type_code,a.daypart,a.destination_desc,
  b.same_store_eligible
  from "cfa"."public"."lcarr_sosx_trans_item" a
  inner join "cfa"."public"."lcarr_sosx_stg__fct_same_store" b
  on a.location_num = b.location_num
  and a.monthend_date = b.monthend_date 
  and b.look_back_period = '1 month'
)
select * from one_month_set_up
  );
19:47:01.952941 [debug] [Thread-1  ]: SQL status: SELECT in 19.94 seconds
19:47:01.964560 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct"
19:47:01.967314 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct"} */
alter table "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct" rename to "market_agg__month_lookback_distinct__dbt_backup"
19:47:02.027762 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.06 seconds
19:47:02.031259 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct"
19:47:02.031563 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct"} */
alter table "cfa"."public"."market_agg__month_lookback_distinct__dbt_tmp" rename to "lcarr_sosx_market_agg__month_lookback_distinct"
19:47:02.089715 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.06 seconds
19:47:02.104607 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct: COMMIT
19:47:02.104951 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct"
19:47:02.105153 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct: COMMIT
19:47:04.922725 [debug] [Thread-1  ]: SQL status: COMMIT in 2.82 seconds
19:47:04.923630 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct"
19:47:04.923929 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct: BEGIN
19:47:04.983025 [debug] [Thread-1  ]: SQL status: BEGIN in 0.06 seconds
19:47:04.991308 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct"
19:47:04.991611 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct"} */
drop table if exists "cfa"."public"."market_agg__month_lookback_distinct__dbt_backup" cascade
19:47:05.050451 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.06 seconds
19:47:05.052117 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct: COMMIT
19:47:05.052427 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct"
19:47:05.052697 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct: COMMIT
19:47:06.149561 [debug] [Thread-1  ]: SQL status: COMMIT in 1.1 seconds
19:47:06.150268 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct"
19:47:06.150563 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct: BEGIN
19:47:06.208522 [debug] [Thread-1  ]: SQL status: BEGIN in 0.06 seconds
19:47:06.209589 [debug] [Thread-1  ]: finished collecting timing info
19:47:06.209869 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct: ROLLBACK
19:47:06.310405 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct: Close
19:47:06.311618 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c6f88827-4e77-48cd-b2b2-46ea6e98695b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc48fc22580>]}
19:47:06.312167 [info ] [Thread-1  ]: 1 of 4 OK created table model public.lcarr_sosx_market_agg__month_lookback_distinct [[32mSELECT[0m in 25.35s]
19:47:06.312653 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct
19:47:06.313499 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.market_agg__distinct_calcs
19:47:06.313882 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.market_agg__hash_base_calcs
19:47:06.314337 [info ] [Thread-3  ]: 2 of 4 START table model public.lcarr_sosx_market_agg__distinct_calcs........... [RUN]
19:47:06.314712 [info ] [Thread-4  ]: 3 of 4 START table model public.lcarr_sosx_market_agg__hash_base_calcs.......... [RUN]
19:47:06.315548 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.market_agg__distinct_calcs"
19:47:06.316204 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.market_agg__hash_base_calcs"
19:47:06.316471 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.market_agg__distinct_calcs
19:47:06.316714 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.market_agg__hash_base_calcs
19:47:06.316967 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.market_agg__distinct_calcs
19:47:06.317210 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.market_agg__hash_base_calcs
19:47:06.325328 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.market_agg__distinct_calcs"
19:47:06.332609 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.market_agg__hash_base_calcs"
19:47:06.334836 [debug] [Thread-4  ]: finished collecting timing info
19:47:06.335345 [debug] [Thread-3  ]: finished collecting timing info
19:47:06.335576 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.market_agg__hash_base_calcs
19:47:06.335832 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.market_agg__distinct_calcs
19:47:06.440936 [debug] [Thread-4  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.market_agg__hash_base_calcs"
19:47:06.459221 [debug] [Thread-3  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.market_agg__distinct_calcs"
19:47:06.461106 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__hash_base_calcs"
19:47:06.461486 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market_agg__hash_base_calcs: BEGIN
19:47:06.461765 [debug] [Thread-4  ]: Opening a new connection, currently in state init
19:47:06.462035 [debug] [Thread-4  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:47:06.462494 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__distinct_calcs"
19:47:06.462827 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_calcs: BEGIN
19:47:06.463180 [debug] [Thread-3  ]: Opening a new connection, currently in state init
19:47:06.463463 [debug] [Thread-3  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:47:07.211764 [debug] [Thread-4  ]: SQL status: BEGIN in 0.75 seconds
19:47:07.212361 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__hash_base_calcs"
19:47:07.212635 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market_agg__hash_base_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__hash_base_calcs"} */


  create  table
    "cfa"."public"."market_agg__hash_base_calcs__dbt_tmp"
    
    
    
  as (
    with hash_base_calcs_all_store as (
    select monthend_date,look_back_period,'All Stores' as same_store,dma_name,
    location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,dma_name,
    location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,dma_name,
    location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,dma_name,
    location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,dma_name,
    'All' as location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,dma_name,
    'All' as location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,dma_name,
    'All' as location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,dma_name,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6,7
), hash_base_calcs_same_store as (
    select monthend_date,look_back_period,'Same Stores' as same_store,dma_name,
    location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,dma_name,
    location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,dma_name,
    location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,dma_name,
    location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,dma_name,
    'All' as location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,dma_name,
    'All' as location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,dma_name,
    'All' as location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,dma_name,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6,7
)

select * from hash_base_calcs_all_store 
union 
select * from hash_base_calcs_same_store
  );
19:47:07.252629 [debug] [Thread-3  ]: SQL status: BEGIN in 0.79 seconds
19:47:07.253243 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__distinct_calcs"
19:47:07.253520 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__distinct_calcs"} */


  create  table
    "cfa"."public"."market_agg__distinct_calcs__dbt_tmp"
    
    
    
  as (
    with distinct_calcs_all_store as (
    select monthend_date,look_back_period,'All Stores' as same_store,service_team_name,
    location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,service_team_name,
    location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,service_team_name,
    location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,service_team_name,
    location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,service_team_name,
    'All' as location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,service_team_name,
    'All' as location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,service_team_name,
    'All' as location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,service_team_name,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6,7
), distinct_calcs_same_store as (
    select monthend_date,look_back_period,'Same Stores' as same_store,dma_name,
    location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,dma_name,
    location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,dma_name,
    location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,dma_name,
    location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,dma_name,
    'All' as location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,dma_name,
    'All' as location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,dma_name,
    'All' as location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,dma_name,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6,7
)

select * from distinct_calcs_all_store 
union 
select * from distinct_calcs_same_store
  );
19:48:02.988151 [debug] [Thread-4  ]: SQL status: SELECT in 55.78 seconds
19:48:02.993884 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__hash_base_calcs"
19:48:02.994203 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market_agg__hash_base_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__hash_base_calcs"} */
alter table "cfa"."public"."lcarr_sosx_market_agg__hash_base_calcs" rename to "market_agg__hash_base_calcs__dbt_backup"
19:48:03.054284 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.06 seconds
19:48:03.058178 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__hash_base_calcs"
19:48:03.058505 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market_agg__hash_base_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__hash_base_calcs"} */
alter table "cfa"."public"."market_agg__hash_base_calcs__dbt_tmp" rename to "lcarr_sosx_market_agg__hash_base_calcs"
19:48:03.115839 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.06 seconds
19:48:03.117654 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market_agg__hash_base_calcs: COMMIT
19:48:03.117911 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__hash_base_calcs"
19:48:03.118109 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market_agg__hash_base_calcs: COMMIT
19:48:04.518649 [debug] [Thread-4  ]: SQL status: COMMIT in 1.4 seconds
19:48:04.519475 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__hash_base_calcs"
19:48:04.519793 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market_agg__hash_base_calcs: BEGIN
19:48:04.579265 [debug] [Thread-4  ]: SQL status: BEGIN in 0.06 seconds
19:48:04.583610 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__hash_base_calcs"
19:48:04.583891 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market_agg__hash_base_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__hash_base_calcs"} */
drop table if exists "cfa"."public"."market_agg__hash_base_calcs__dbt_backup" cascade
19:48:04.643125 [debug] [Thread-4  ]: SQL status: DROP TABLE in 0.06 seconds
19:48:04.644805 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market_agg__hash_base_calcs: COMMIT
19:48:04.645115 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__hash_base_calcs"
19:48:04.645456 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market_agg__hash_base_calcs: COMMIT
19:48:06.052932 [debug] [Thread-4  ]: SQL status: COMMIT in 1.41 seconds
19:48:06.053545 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__hash_base_calcs"
19:48:06.053841 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market_agg__hash_base_calcs: BEGIN
19:48:06.113634 [debug] [Thread-4  ]: SQL status: BEGIN in 0.06 seconds
19:48:06.114743 [debug] [Thread-4  ]: finished collecting timing info
19:48:06.115474 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market_agg__hash_base_calcs: ROLLBACK
19:48:06.220535 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market_agg__hash_base_calcs: Close
19:48:06.221942 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c6f88827-4e77-48cd-b2b2-46ea6e98695b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc48fcfb220>]}
19:48:06.222614 [info ] [Thread-4  ]: 3 of 4 OK created table model public.lcarr_sosx_market_agg__hash_base_calcs..... [[32mSELECT[0m in 59.91s]
19:48:06.223265 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.market_agg__hash_base_calcs
19:55:08.175697 [debug] [Thread-3  ]: SQL status: SELECT in 480.92 seconds
19:55:08.190106 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__distinct_calcs"
19:55:08.190592 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__distinct_calcs"} */
alter table "cfa"."public"."lcarr_sosx_market_agg__distinct_calcs" rename to "market_agg__distinct_calcs__dbt_backup"
19:55:08.267271 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.08 seconds
19:55:08.274578 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__distinct_calcs"
19:55:08.275030 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__distinct_calcs"} */
alter table "cfa"."public"."market_agg__distinct_calcs__dbt_tmp" rename to "lcarr_sosx_market_agg__distinct_calcs"
19:55:08.331286 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.06 seconds
19:55:08.333851 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_calcs: COMMIT
19:55:08.334186 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__distinct_calcs"
19:55:08.334462 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_calcs: COMMIT
19:55:09.385307 [debug] [Thread-3  ]: SQL status: COMMIT in 1.05 seconds
19:55:09.386148 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__distinct_calcs"
19:55:09.386445 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_calcs: BEGIN
19:55:09.444455 [debug] [Thread-3  ]: SQL status: BEGIN in 0.06 seconds
19:55:09.449094 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__distinct_calcs"
19:55:09.449449 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__distinct_calcs"} */
drop table if exists "cfa"."public"."market_agg__distinct_calcs__dbt_backup" cascade
19:55:09.510761 [debug] [Thread-3  ]: SQL status: DROP TABLE in 0.06 seconds
19:55:09.512369 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_calcs: COMMIT
19:55:09.512682 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__distinct_calcs"
19:55:09.512948 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_calcs: COMMIT
19:55:10.522398 [debug] [Thread-3  ]: SQL status: COMMIT in 1.01 seconds
19:55:10.522865 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__distinct_calcs"
19:55:10.523269 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_calcs: BEGIN
19:55:10.600138 [debug] [Thread-3  ]: SQL status: BEGIN in 0.08 seconds
19:55:10.601243 [debug] [Thread-3  ]: finished collecting timing info
19:55:10.601574 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_calcs: ROLLBACK
19:55:10.739930 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_calcs: Close
19:55:10.748574 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c6f88827-4e77-48cd-b2b2-46ea6e98695b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc48fc9d460>]}
19:55:10.749331 [info ] [Thread-3  ]: 2 of 4 OK created table model public.lcarr_sosx_market_agg__distinct_calcs...... [[32mSELECT[0m in 484.43s]
19:55:10.750004 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.market_agg__distinct_calcs
19:55:10.765992 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.market_agg__distinct_join
19:55:10.768697 [info ] [Thread-1  ]: 4 of 4 START table model public.lcarr_sosx_market_agg__distinct_join............ [RUN]
19:55:10.772078 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.market_agg__distinct_join"
19:55:10.773291 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.market_agg__distinct_join
19:55:10.776295 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.market_agg__distinct_join
19:55:10.790834 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.market_agg__distinct_join"
19:55:10.813925 [debug] [Thread-1  ]: finished collecting timing info
19:55:10.814235 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.market_agg__distinct_join
19:55:10.886809 [debug] [Thread-1  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.market_agg__distinct_join"
19:55:10.888316 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__distinct_join"
19:55:10.888645 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_join: BEGIN
19:55:10.888886 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
19:55:10.889199 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:55:12.016037 [debug] [Thread-1  ]: SQL status: BEGIN in 1.13 seconds
19:55:12.016574 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__distinct_join"
19:55:12.016965 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__distinct_join"} */


  create  table
    "cfa"."public"."market_agg__distinct_join__dbt_tmp"
    
    
    
  as (
    with distinct_calcs_join as (
    select a.monthend_date,a.look_back_period,a.same_store,a.dma_name,
    a.location_type_code,a.daypart,a.destination_desc,
    a.unique_cfa_one_ids,a.unique_hashes,a.hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_market_agg__distinct_calcs" a
    inner join "cfa"."public"."lcarr_sosx_market_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period
    and a.same_store = b.same_store
    and a.dma_name = b.dma_name 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
) 
select * from distinct_calcs_join
  );
19:55:12.183554 [debug] [Thread-1  ]: Postgres adapter: Postgres error: column a.dma_name does not exist

19:55:12.184178 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_join: ROLLBACK
19:55:12.267246 [debug] [Thread-1  ]: finished collecting timing info
19:55:12.267689 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_join: Close
19:55:12.268851 [debug] [Thread-1  ]: Database Error in model market_agg__distinct_join (models/market/aggregations_distinct/market_agg__distinct_join.sql)
  column a.dma_name does not exist
  compiled SQL at target/run/source_of_sales_change_lcarr/models/market/aggregations_distinct/market_agg__distinct_join.sql
19:55:12.269405 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c6f88827-4e77-48cd-b2b2-46ea6e98695b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc48fcb4ca0>]}
19:55:12.269931 [error] [Thread-1  ]: 4 of 4 ERROR creating table model public.lcarr_sosx_market_agg__distinct_join... [[31mERROR[0m in 1.50s]
19:55:12.271254 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.market_agg__distinct_join
19:55:12.287672 [debug] [MainThread]: Acquiring new redshift connection "master"
19:55:12.288059 [error] [MainThread]: CANCEL query model.source_of_sales_change_lcarr.market_agg__distinct_join....... [[31mCANCEL[0m]
19:55:12.288429 [error] [MainThread]: CANCEL query model.source_of_sales_change_lcarr.market_agg__distinct_calcs...... [[31mCANCEL[0m]
19:55:12.288850 [error] [MainThread]: CANCEL query model.source_of_sales_change_lcarr.market_agg__hash_base_calcs..... [[31mCANCEL[0m]
19:55:12.290499 [info ] [MainThread]: 
19:55:12.291355 [error] [MainThread]: [33mDatabase Error in model market_agg__distinct_join (models/market/aggregations_distinct/market_agg__distinct_join.sql)[0m
19:55:12.291848 [error] [MainThread]:   column a.dma_name does not exist
19:55:12.292295 [error] [MainThread]:   compiled SQL at target/run/source_of_sales_change_lcarr/models/market/aggregations_distinct/market_agg__distinct_join.sql
19:55:12.292810 [debug] [MainThread]: Connection 'master' was properly closed.
19:55:12.293049 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.market_agg__distinct_join' was properly closed.
19:55:12.293221 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.market_agg__distinct_calcs' was properly closed.
19:55:12.293380 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.market_agg__hash_base_calcs' was properly closed.
19:55:12.294693 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc48fced040>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc48fd00b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc48fd00bb0>]}


============================== 2022-06-24 19:59:21.315094 | b58db8d3-5039-4f48-b378-60169bb0fc7e ==============================
19:59:21.315094 [info ] [MainThread]: Running with dbt=1.0.4
19:59:21.339094 [debug] [MainThread]: running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=None, defer=None, event_buffer_size=None, exclude=None, fail_fast=True, full_refresh=False, log_cache_events=False, log_format=None, partial_parse=None, printer_width=None, profile=None, profiles_dir='/Users/lindsay.carr/DBT/environments/redshift_discovery_crn_svc/', project_dir=None, record_timing_info=None, rpc_method='run', select=['market.aggregations_distinct'], selector_name=None, send_anonymous_usage_stats=None, single_threaded=False, state=None, static_parser=None, target=None, threads=None, use_colors=None, use_experimental_parser=None, vars='{}', version_check=None, warn_error=None, which='run', write_json=None)
19:59:21.339680 [debug] [MainThread]: Tracking: tracking
19:59:21.406432 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb98dca45b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb98dca49a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb98dc9d3a0>]}
19:59:21.615138 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
19:59:21.616401 [debug] [MainThread]: Partial parsing: updated file: source_of_sales_change_lcarr://models/market/aggregations_distinct/market_agg__distinct_calcs.sql
19:59:21.640555 [debug] [MainThread]: 1603: static parser failed on market/aggregations_distinct/market_agg__distinct_calcs.sql
19:59:21.669814 [debug] [MainThread]: 1602: parser fallback to jinja rendering on market/aggregations_distinct/market_agg__distinct_calcs.sql
19:59:21.709205 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b58db8d3-5039-4f48-b378-60169bb0fc7e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb98dcd5d00>]}
19:59:21.741447 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b58db8d3-5039-4f48-b378-60169bb0fc7e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb98de020d0>]}
19:59:21.741897 [info ] [MainThread]: Found 58 models, 4 tests, 0 snapshots, 0 analyses, 192 macros, 0 operations, 0 seed files, 11 sources, 0 exposures, 0 metrics
19:59:21.747222 [info ] [MainThread]: 
19:59:21.748316 [debug] [MainThread]: Acquiring new redshift connection "master"
19:59:21.750252 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa"
19:59:21.772904 [debug] [ThreadPool]: Using redshift connection "list_cfa"
19:59:21.773535 [debug] [ThreadPool]: On list_cfa: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa"} */

    select distinct nspname from pg_namespace
  
19:59:21.773896 [debug] [ThreadPool]: Opening a new connection, currently in state init
19:59:21.774246 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:59:22.623407 [debug] [ThreadPool]: SQL status: SELECT in 0.85 seconds
19:59:22.631512 [debug] [ThreadPool]: On list_cfa: Close
19:59:22.636807 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa_public"
19:59:22.644243 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
19:59:22.644511 [debug] [ThreadPool]: On list_cfa_public: BEGIN
19:59:22.644687 [debug] [ThreadPool]: Opening a new connection, currently in state closed
19:59:22.644865 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:59:23.360176 [debug] [ThreadPool]: SQL status: BEGIN in 0.72 seconds
19:59:23.360818 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
19:59:23.361097 [debug] [ThreadPool]: On list_cfa_public: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa_public"} */
select
      'cfa' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'cfa' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
19:59:23.789017 [debug] [ThreadPool]: SQL status: SELECT in 0.43 seconds
19:59:23.837538 [debug] [ThreadPool]: On list_cfa_public: ROLLBACK
19:59:23.946829 [debug] [ThreadPool]: On list_cfa_public: Close
19:59:23.979318 [debug] [MainThread]: Using redshift connection "master"
19:59:23.979596 [debug] [MainThread]: On master: BEGIN
19:59:23.979778 [debug] [MainThread]: Opening a new connection, currently in state init
19:59:23.979960 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:59:24.770357 [debug] [MainThread]: SQL status: BEGIN in 0.79 seconds
19:59:24.770970 [debug] [MainThread]: Using redshift connection "master"
19:59:24.771247 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
19:59:25.483009 [debug] [MainThread]: SQL status: SELECT in 0.71 seconds
19:59:25.500460 [debug] [MainThread]: On master: ROLLBACK
19:59:25.605401 [debug] [MainThread]: Using redshift connection "master"
19:59:25.605979 [debug] [MainThread]: On master: BEGIN
19:59:25.730688 [debug] [MainThread]: SQL status: BEGIN in 0.12 seconds
19:59:25.731292 [debug] [MainThread]: On master: COMMIT
19:59:25.731591 [debug] [MainThread]: Using redshift connection "master"
19:59:25.731852 [debug] [MainThread]: On master: COMMIT
19:59:25.893086 [debug] [MainThread]: SQL status: COMMIT in 0.16 seconds
19:59:25.895672 [debug] [MainThread]: On master: Close
19:59:25.896837 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
19:59:25.897367 [info ] [MainThread]: 
19:59:25.909815 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct
19:59:25.910436 [info ] [Thread-1  ]: 1 of 4 START table model public.lcarr_sosx_market_agg__month_lookback_distinct.. [RUN]
19:59:25.911429 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct"
19:59:25.911762 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct
19:59:25.912004 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct
19:59:25.916125 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct"
19:59:25.918121 [debug] [Thread-1  ]: finished collecting timing info
19:59:25.918520 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct
19:59:26.017366 [debug] [Thread-1  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct"
19:59:26.020200 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct"
19:59:26.020562 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct: BEGIN
19:59:26.020813 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
19:59:26.021015 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:59:26.982294 [debug] [Thread-1  ]: SQL status: BEGIN in 0.96 seconds
19:59:26.982881 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct"
19:59:26.983160 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct"} */


  create  table
    "cfa"."public"."market_agg__month_lookback_distinct__dbt_tmp"
    
    
    
  as (
    with one_month_set_up as (
  select a.region_name,a.service_team_name,a.dma_name,
  a.location_num,a.monthend_date,'1 month' as look_back_period,
  a.trans_id,a.cfa_one_id,a.customer_hash,
  a.location_type_code,a.daypart,a.destination_desc,
  b.same_store_eligible
  from "cfa"."public"."lcarr_sosx_trans_item" a
  inner join "cfa"."public"."lcarr_sosx_stg__fct_same_store" b
  on a.location_num = b.location_num
  and a.monthend_date = b.monthend_date 
  and b.look_back_period = '1 month'
)
select * from one_month_set_up
  );
19:59:51.084219 [debug] [Thread-1  ]: SQL status: SELECT in 24.1 seconds
19:59:51.094259 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct"
19:59:51.094572 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct"} */
alter table "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct" rename to "market_agg__month_lookback_distinct__dbt_backup"
19:59:51.179345 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.08 seconds
19:59:51.182598 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct"
19:59:51.182882 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct"} */
alter table "cfa"."public"."market_agg__month_lookback_distinct__dbt_tmp" rename to "lcarr_sosx_market_agg__month_lookback_distinct"
19:59:51.253015 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.07 seconds
19:59:51.268618 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct: COMMIT
19:59:51.268952 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct"
19:59:51.269146 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct: COMMIT
19:59:53.848589 [debug] [Thread-1  ]: SQL status: COMMIT in 2.58 seconds
19:59:53.849296 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct"
19:59:53.849615 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct: BEGIN
19:59:53.911746 [debug] [Thread-1  ]: SQL status: BEGIN in 0.06 seconds
19:59:53.921113 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct"
19:59:53.921445 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct"} */
drop table if exists "cfa"."public"."market_agg__month_lookback_distinct__dbt_backup" cascade
19:59:53.982088 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.06 seconds
19:59:53.983678 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct: COMMIT
19:59:53.983991 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct"
19:59:53.984256 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct: COMMIT
19:59:54.955795 [debug] [Thread-1  ]: SQL status: COMMIT in 0.97 seconds
19:59:54.956588 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct"
19:59:54.956892 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct: BEGIN
19:59:55.016385 [debug] [Thread-1  ]: SQL status: BEGIN in 0.06 seconds
19:59:55.017657 [debug] [Thread-1  ]: finished collecting timing info
19:59:55.018116 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct: ROLLBACK
19:59:55.121468 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct: Close
19:59:55.122797 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b58db8d3-5039-4f48-b378-60169bb0fc7e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb98e520100>]}
19:59:55.123440 [info ] [Thread-1  ]: 1 of 4 OK created table model public.lcarr_sosx_market_agg__month_lookback_distinct [[32mSELECT[0m in 29.21s]
19:59:55.124050 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct
19:59:55.125382 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.market_agg__distinct_calcs
19:59:55.125857 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.market_agg__hash_base_calcs
19:59:55.126673 [info ] [Thread-3  ]: 2 of 4 START table model public.lcarr_sosx_market_agg__distinct_calcs........... [RUN]
19:59:55.127305 [info ] [Thread-4  ]: 3 of 4 START table model public.lcarr_sosx_market_agg__hash_base_calcs.......... [RUN]
19:59:55.128105 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.market_agg__distinct_calcs"
19:59:55.128715 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.market_agg__hash_base_calcs"
19:59:55.128966 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.market_agg__distinct_calcs
19:59:55.129412 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.market_agg__hash_base_calcs
19:59:55.129721 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.market_agg__distinct_calcs
19:59:55.130383 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.market_agg__hash_base_calcs
19:59:55.142084 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.market_agg__distinct_calcs"
19:59:55.148713 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.market_agg__hash_base_calcs"
19:59:55.150090 [debug] [Thread-3  ]: finished collecting timing info
19:59:55.150372 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.market_agg__distinct_calcs
19:59:55.161376 [debug] [Thread-4  ]: finished collecting timing info
19:59:55.167125 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.market_agg__hash_base_calcs
19:59:55.257405 [debug] [Thread-3  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.market_agg__distinct_calcs"
19:59:55.278502 [debug] [Thread-4  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.market_agg__hash_base_calcs"
19:59:55.279594 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__distinct_calcs"
19:59:55.279997 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_calcs: BEGIN
19:59:55.280237 [debug] [Thread-3  ]: Opening a new connection, currently in state init
19:59:55.280515 [debug] [Thread-3  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:59:55.281303 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__hash_base_calcs"
19:59:55.281713 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market_agg__hash_base_calcs: BEGIN
19:59:55.282056 [debug] [Thread-4  ]: Opening a new connection, currently in state init
19:59:55.282403 [debug] [Thread-4  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:59:56.165589 [debug] [Thread-4  ]: SQL status: BEGIN in 0.88 seconds
19:59:56.166444 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__hash_base_calcs"
19:59:56.166789 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market_agg__hash_base_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__hash_base_calcs"} */


  create  table
    "cfa"."public"."market_agg__hash_base_calcs__dbt_tmp"
    
    
    
  as (
    with hash_base_calcs_all_store as (
    select monthend_date,look_back_period,'All Stores' as same_store,dma_name,
    location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,dma_name,
    location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,dma_name,
    location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,dma_name,
    location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,dma_name,
    'All' as location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,dma_name,
    'All' as location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,dma_name,
    'All' as location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,dma_name,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6,7
), hash_base_calcs_same_store as (
    select monthend_date,look_back_period,'Same Stores' as same_store,dma_name,
    location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,dma_name,
    location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,dma_name,
    location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,dma_name,
    location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,dma_name,
    'All' as location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,dma_name,
    'All' as location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,dma_name,
    'All' as location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,dma_name,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6,7
)

select * from hash_base_calcs_all_store 
union 
select * from hash_base_calcs_same_store
  );
19:59:56.192669 [debug] [Thread-3  ]: SQL status: BEGIN in 0.91 seconds
19:59:56.193298 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__distinct_calcs"
19:59:56.193582 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__distinct_calcs"} */


  create  table
    "cfa"."public"."market_agg__distinct_calcs__dbt_tmp"
    
    
    
  as (
    with distinct_calcs_all_store as (
    select monthend_date,look_back_period,'All Stores' as same_store,dma_name,
    location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,dma_name,
    location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,dma_name,
    location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,dma_name,
    location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,dma_name,
    'All' as location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,dma_name,
    'All' as location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,dma_name,
    'All' as location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'All Stores' as same_store,dma_name,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_ast_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6,7
), distinct_calcs_same_store as (
    select monthend_date,look_back_period,'Same Stores' as same_store,dma_name,
    location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,dma_name,
    location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,dma_name,
    location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,dma_name,
    location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,dma_name,
    'All' as location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,dma_name,
    'All' as location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,dma_name,
    'All' as location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6,7
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,dma_name,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_market_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6,7
)

select * from distinct_calcs_all_store 
union 
select * from distinct_calcs_same_store
  );
20:02:17.663430 [debug] [Thread-4  ]: SQL status: SELECT in 141.5 seconds
20:02:17.679004 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__hash_base_calcs"
20:02:17.679380 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market_agg__hash_base_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__hash_base_calcs"} */
alter table "cfa"."public"."lcarr_sosx_market_agg__hash_base_calcs" rename to "market_agg__hash_base_calcs__dbt_backup"
20:02:17.745967 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.07 seconds
20:02:17.749913 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__hash_base_calcs"
20:02:17.750235 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market_agg__hash_base_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__hash_base_calcs"} */
alter table "cfa"."public"."market_agg__hash_base_calcs__dbt_tmp" rename to "lcarr_sosx_market_agg__hash_base_calcs"
20:02:17.912204 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.16 seconds
20:02:17.915142 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market_agg__hash_base_calcs: COMMIT
20:02:17.915578 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__hash_base_calcs"
20:02:17.915883 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market_agg__hash_base_calcs: COMMIT
20:02:18.972282 [debug] [Thread-4  ]: SQL status: COMMIT in 1.06 seconds
20:02:18.973473 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__hash_base_calcs"
20:02:18.973886 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market_agg__hash_base_calcs: BEGIN
20:02:19.035694 [debug] [Thread-4  ]: SQL status: BEGIN in 0.06 seconds
20:02:19.047080 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__hash_base_calcs"
20:02:19.047436 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market_agg__hash_base_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__hash_base_calcs"} */
drop table if exists "cfa"."public"."market_agg__hash_base_calcs__dbt_backup" cascade
20:02:19.109566 [debug] [Thread-4  ]: SQL status: DROP TABLE in 0.06 seconds
20:02:19.111220 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market_agg__hash_base_calcs: COMMIT
20:02:19.111554 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__hash_base_calcs"
20:02:19.111975 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market_agg__hash_base_calcs: COMMIT
20:02:20.057216 [debug] [Thread-4  ]: SQL status: COMMIT in 0.94 seconds
20:02:20.057911 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__hash_base_calcs"
20:02:20.058200 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market_agg__hash_base_calcs: BEGIN
20:02:20.524292 [debug] [Thread-4  ]: SQL status: BEGIN in 0.47 seconds
20:02:20.525398 [debug] [Thread-4  ]: finished collecting timing info
20:02:20.525742 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market_agg__hash_base_calcs: ROLLBACK
20:02:20.632555 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.market_agg__hash_base_calcs: Close
20:02:20.634234 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b58db8d3-5039-4f48-b378-60169bb0fc7e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb98e63cb20>]}
20:02:20.634770 [info ] [Thread-4  ]: 3 of 4 OK created table model public.lcarr_sosx_market_agg__hash_base_calcs..... [[32mSELECT[0m in 145.51s]
20:02:20.635350 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.market_agg__hash_base_calcs
20:07:17.513437 [debug] [Thread-3  ]: SQL status: SELECT in 441.32 seconds
20:07:17.522753 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__distinct_calcs"
20:07:17.523120 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__distinct_calcs"} */
alter table "cfa"."public"."lcarr_sosx_market_agg__distinct_calcs" rename to "market_agg__distinct_calcs__dbt_backup"
20:07:17.579930 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.06 seconds
20:07:17.585414 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__distinct_calcs"
20:07:17.585760 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__distinct_calcs"} */
alter table "cfa"."public"."market_agg__distinct_calcs__dbt_tmp" rename to "lcarr_sosx_market_agg__distinct_calcs"
20:07:17.644566 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.06 seconds
20:07:17.647234 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_calcs: COMMIT
20:07:17.647647 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__distinct_calcs"
20:07:17.648057 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_calcs: COMMIT
20:07:19.098998 [debug] [Thread-3  ]: SQL status: COMMIT in 1.45 seconds
20:07:19.100083 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__distinct_calcs"
20:07:19.100381 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_calcs: BEGIN
20:07:19.159583 [debug] [Thread-3  ]: SQL status: BEGIN in 0.06 seconds
20:07:19.166766 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__distinct_calcs"
20:07:19.167165 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__distinct_calcs"} */
drop table if exists "cfa"."public"."market_agg__distinct_calcs__dbt_backup" cascade
20:07:20.116513 [debug] [Thread-3  ]: SQL status: DROP TABLE in 0.95 seconds
20:07:20.118156 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_calcs: COMMIT
20:07:20.118455 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__distinct_calcs"
20:07:20.118676 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_calcs: COMMIT
20:07:22.994385 [debug] [Thread-3  ]: SQL status: COMMIT in 2.88 seconds
20:07:22.994990 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__distinct_calcs"
20:07:22.995230 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_calcs: BEGIN
20:07:23.112240 [debug] [Thread-3  ]: SQL status: BEGIN in 0.12 seconds
20:07:23.113324 [debug] [Thread-3  ]: finished collecting timing info
20:07:23.113662 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_calcs: ROLLBACK
20:07:23.292010 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_calcs: Close
20:07:23.293301 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b58db8d3-5039-4f48-b378-60169bb0fc7e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb98e632370>]}
20:07:23.293922 [info ] [Thread-3  ]: 2 of 4 OK created table model public.lcarr_sosx_market_agg__distinct_calcs...... [[32mSELECT[0m in 448.17s]
20:07:23.294420 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.market_agg__distinct_calcs
20:07:23.296987 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.market_agg__distinct_join
20:07:23.297535 [info ] [Thread-1  ]: 4 of 4 START table model public.lcarr_sosx_market_agg__distinct_join............ [RUN]
20:07:23.300423 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.market_agg__distinct_join"
20:07:23.301131 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.market_agg__distinct_join
20:07:23.301565 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.market_agg__distinct_join
20:07:23.308725 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.market_agg__distinct_join"
20:07:23.311638 [debug] [Thread-1  ]: finished collecting timing info
20:07:23.312050 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.market_agg__distinct_join
20:07:23.381375 [debug] [Thread-1  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.market_agg__distinct_join"
20:07:23.382257 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__distinct_join"
20:07:23.382562 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_join: BEGIN
20:07:23.382772 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
20:07:23.382973 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
20:07:24.268188 [debug] [Thread-1  ]: SQL status: BEGIN in 0.89 seconds
20:07:24.268759 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__distinct_join"
20:07:24.269073 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__distinct_join"} */


  create  table
    "cfa"."public"."market_agg__distinct_join__dbt_tmp"
    
    
    
  as (
    with distinct_calcs_join as (
    select a.monthend_date,a.look_back_period,a.same_store,a.dma_name,
    a.location_type_code,a.daypart,a.destination_desc,
    a.unique_cfa_one_ids,a.unique_hashes,a.hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_market_agg__distinct_calcs" a
    inner join "cfa"."public"."lcarr_sosx_market_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period
    and a.same_store = b.same_store
    and a.dma_name = b.dma_name 
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
) 
select * from distinct_calcs_join
  );
20:07:39.213647 [debug] [Thread-1  ]: SQL status: SELECT in 14.94 seconds
20:07:39.218287 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__distinct_join"
20:07:39.218833 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__distinct_join"} */
alter table "cfa"."public"."market_agg__distinct_join__dbt_tmp" rename to "lcarr_sosx_market_agg__distinct_join"
20:07:39.277826 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.06 seconds
20:07:39.279516 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_join: COMMIT
20:07:39.279789 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__distinct_join"
20:07:39.280043 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_join: COMMIT
20:07:41.431112 [debug] [Thread-1  ]: SQL status: COMMIT in 2.15 seconds
20:07:41.431940 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__distinct_join"
20:07:41.432295 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_join: BEGIN
20:07:41.501309 [debug] [Thread-1  ]: SQL status: BEGIN in 0.07 seconds
20:07:41.504708 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__distinct_join"
20:07:41.505000 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market_agg__distinct_join"} */
drop table if exists "cfa"."public"."market_agg__distinct_join__dbt_backup" cascade
20:07:41.563840 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.06 seconds
20:07:41.566261 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_join: COMMIT
20:07:41.566582 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__distinct_join"
20:07:41.566784 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_join: COMMIT
20:07:41.725866 [debug] [Thread-1  ]: SQL status: COMMIT in 0.16 seconds
20:07:41.726606 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market_agg__distinct_join"
20:07:41.727326 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_join: BEGIN
20:07:41.809713 [debug] [Thread-1  ]: SQL status: BEGIN in 0.08 seconds
20:07:41.810774 [debug] [Thread-1  ]: finished collecting timing info
20:07:41.811272 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_join: ROLLBACK
20:07:41.917296 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market_agg__distinct_join: Close
20:07:41.918703 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b58db8d3-5039-4f48-b378-60169bb0fc7e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb98e5cfd00>]}
20:07:41.921411 [info ] [Thread-1  ]: 4 of 4 OK created table model public.lcarr_sosx_market_agg__distinct_join....... [[32mSELECT[0m in 18.62s]
20:07:41.922847 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.market_agg__distinct_join
20:07:41.926949 [debug] [MainThread]: Acquiring new redshift connection "master"
20:07:41.927378 [debug] [MainThread]: Using redshift connection "master"
20:07:41.927623 [debug] [MainThread]: On master: BEGIN
20:07:41.927836 [debug] [MainThread]: Opening a new connection, currently in state closed
20:07:41.928065 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
20:07:42.735405 [debug] [MainThread]: SQL status: BEGIN in 0.81 seconds
20:07:42.736003 [debug] [MainThread]: On master: COMMIT
20:07:42.736405 [debug] [MainThread]: Using redshift connection "master"
20:07:42.736764 [debug] [MainThread]: On master: COMMIT
20:07:42.953552 [debug] [MainThread]: SQL status: COMMIT in 0.22 seconds
20:07:42.954230 [debug] [MainThread]: On master: Close
20:07:42.955261 [info ] [MainThread]: 
20:07:42.955838 [info ] [MainThread]: Finished running 4 table models in 501.21s.
20:07:42.958279 [debug] [MainThread]: Connection 'master' was properly closed.
20:07:42.958596 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.market_agg__distinct_join' was properly closed.
20:07:42.958804 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.market_agg__distinct_calcs' was properly closed.
20:07:42.959000 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.market_agg__hash_base_calcs' was properly closed.
20:07:42.990403 [info ] [MainThread]: 
20:07:42.990894 [info ] [MainThread]: [32mCompleted successfully[0m
20:07:42.991488 [info ] [MainThread]: 
20:07:42.993813 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
20:07:42.994518 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb98e525f70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb98e56ef40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb98e56ebb0>]}


============================== 2022-06-24 20:20:56.283941 | ac3822ab-6a17-4cef-8e5e-b430c9210064 ==============================
20:20:56.283941 [info ] [MainThread]: Running with dbt=1.0.4
20:20:56.289092 [debug] [MainThread]: running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=None, defer=None, event_buffer_size=None, exclude=None, fail_fast=True, full_refresh=False, log_cache_events=False, log_format=None, partial_parse=None, printer_width=None, profile=None, profiles_dir='/Users/lindsay.carr/DBT/environments/redshift_discovery_crn_svc/', project_dir=None, record_timing_info=None, rpc_method='run', select=['market.final_output'], selector_name=None, send_anonymous_usage_stats=None, single_threaded=False, state=None, static_parser=None, target=None, threads=None, use_colors=None, use_experimental_parser=None, vars='{}', version_check=None, warn_error=None, which='run', write_json=None)
20:20:56.289741 [debug] [MainThread]: Tracking: tracking
20:20:56.357671 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa8e1b82670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa8e1b82a60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa8e1b67ee0>]}
20:20:56.720430 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
20:20:56.720883 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
20:20:56.744910 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ac3822ab-6a17-4cef-8e5e-b430c9210064', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa8e1d00700>]}
20:20:56.821586 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ac3822ab-6a17-4cef-8e5e-b430c9210064', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa8e1bc3910>]}
20:20:56.822242 [info ] [MainThread]: Found 58 models, 4 tests, 0 snapshots, 0 analyses, 192 macros, 0 operations, 0 seed files, 11 sources, 0 exposures, 0 metrics
20:20:56.828018 [info ] [MainThread]: 
20:20:56.829977 [debug] [MainThread]: Acquiring new redshift connection "master"
20:20:56.832504 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa"
20:20:56.858207 [debug] [ThreadPool]: Using redshift connection "list_cfa"
20:20:56.858673 [debug] [ThreadPool]: On list_cfa: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa"} */

    select distinct nspname from pg_namespace
  
20:20:56.859022 [debug] [ThreadPool]: Opening a new connection, currently in state init
20:20:56.859376 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
20:20:57.955774 [debug] [ThreadPool]: SQL status: SELECT in 1.1 seconds
20:20:57.965739 [debug] [ThreadPool]: On list_cfa: Close
20:20:57.974883 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa_public"
20:20:57.988902 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
20:20:57.989322 [debug] [ThreadPool]: On list_cfa_public: BEGIN
20:20:57.989639 [debug] [ThreadPool]: Opening a new connection, currently in state closed
20:20:57.989960 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
20:20:58.811629 [debug] [ThreadPool]: SQL status: BEGIN in 0.82 seconds
20:20:58.812303 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
20:20:58.812662 [debug] [ThreadPool]: On list_cfa_public: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa_public"} */
select
      'cfa' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'cfa' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
20:20:59.175587 [debug] [ThreadPool]: SQL status: SELECT in 0.36 seconds
20:20:59.276987 [debug] [ThreadPool]: On list_cfa_public: ROLLBACK
20:20:59.377749 [debug] [ThreadPool]: On list_cfa_public: Close
20:20:59.435801 [debug] [MainThread]: Using redshift connection "master"
20:20:59.436247 [debug] [MainThread]: On master: BEGIN
20:20:59.436571 [debug] [MainThread]: Opening a new connection, currently in state init
20:20:59.436886 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
20:21:00.316790 [debug] [MainThread]: SQL status: BEGIN in 0.88 seconds
20:21:00.317251 [debug] [MainThread]: Using redshift connection "master"
20:21:00.317580 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
20:21:01.302484 [debug] [MainThread]: SQL status: SELECT in 0.98 seconds
20:21:01.321096 [debug] [MainThread]: On master: ROLLBACK
20:21:01.721139 [debug] [MainThread]: Using redshift connection "master"
20:21:01.721671 [debug] [MainThread]: On master: BEGIN
20:21:01.841023 [debug] [MainThread]: SQL status: BEGIN in 0.12 seconds
20:21:01.841942 [debug] [MainThread]: On master: COMMIT
20:21:01.842962 [debug] [MainThread]: Using redshift connection "master"
20:21:01.843210 [debug] [MainThread]: On master: COMMIT
20:21:02.103651 [debug] [MainThread]: SQL status: COMMIT in 0.26 seconds
20:21:02.104186 [debug] [MainThread]: On master: Close
20:21:02.105114 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
20:21:02.105592 [info ] [MainThread]: 
20:21:02.112794 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.market__big_join
20:21:02.113093 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.market__final_output
20:21:02.113716 [info ] [Thread-1  ]: 1 of 2 START table model public.lcarr_sosx_market__big_join..................... [RUN]
20:21:02.114288 [info ] [Thread-2  ]: 2 of 2 START table model public.lcarr_sosx_market__final_output................. [RUN]
20:21:02.115347 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.market__big_join"
20:21:02.115980 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.market__final_output"
20:21:02.116250 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.market__big_join
20:21:02.116690 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.market__final_output
20:21:02.117074 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.market__big_join
20:21:02.117300 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.market__final_output
20:21:02.123676 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.market__big_join"
20:21:02.128770 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.market__final_output"
20:21:02.136757 [debug] [Thread-1  ]: finished collecting timing info
20:21:02.137308 [debug] [Thread-2  ]: finished collecting timing info
20:21:02.137978 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.market__big_join
20:21:02.138333 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.market__final_output
20:21:02.345782 [debug] [Thread-1  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.market__big_join"
20:21:02.349019 [debug] [Thread-2  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.market__final_output"
20:21:02.354189 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market__big_join"
20:21:02.354572 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.market__final_output"
20:21:02.354807 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market__big_join: BEGIN
20:21:02.355167 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.market__final_output: BEGIN
20:21:02.355551 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
20:21:02.355835 [debug] [Thread-2  ]: Opening a new connection, currently in state init
20:21:02.356090 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
20:21:02.356348 [debug] [Thread-2  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
20:21:03.109842 [debug] [Thread-2  ]: SQL status: BEGIN in 0.75 seconds
20:21:03.110391 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.market__final_output"
20:21:03.110700 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.market__final_output: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market__final_output"} */


  create  table
    "cfa"."public"."market__final_output__dbt_tmp"
    
    
    
  as (
    with twentytwo as (
select *
from "cfa"."public"."lcarr_sosx_ast__big_join" 
where monthend_date = cast('02-28-2022' as date) 
), twentyone as ( 
select * 
from "cfa"."public"."lcarr_sosx_ast__big_join"
where monthend_date = cast('02-28-2021' as date)
) 

select a.quarter,
a.look_back_period,a.same_store,
'AST' as geolevel, 
a.dma_name as geolevel_detail,
a.location_type_code,a.daypart,a.destination_desc,
a.monthend_date as current_monthend_date,
a.sales_sub_total as current_sales_sub_total,
a.transactions as current_transactions,
a.purchaser_visits as current_purchaser_visits,
a.credit_txn as current_credit_txn,
a.total_items_promo_count as current_total_items_promo_count,
a.total_items_sold_count as current_total_items_sold_count,
a.actual_days as current_actual_days,
a.avail_days as current_avail_days,
a.price_index as current_price_index,
a.unique_cfa_one_ids as current_unique_cfa_one_ids,
a.unique_hashes as current_unique_hashes,
a.hash_transactions as current_hash_transactions,
a.hash_per_customer as current_hash_per_customer,
a.previous_year_monthend_date as check_date,
b.monthend_date as previous_monthend_date,
b.sales_sub_total as previous_sales_sub_total,
b.transactions as previous_transactions,
b.purchaser_visits as previous_purchaser_visits,
b.credit_txn as previous_credit_txn,
b.total_items_promo_count as previous_total_items_promo_count,
b.total_items_sold_count as previous_total_items_sold_count,
b.actual_days as previous_actual_days,
b.avail_days as previous_avail_days,
b.price_index as previous_price_index,
b.unique_cfa_one_ids as previous_unique_cfa_one_ids,
b.unique_hashes as previous_unique_hashes,
b.hash_transactions as previous_hash_transactions,
b.hash_per_customer as previous_hash_per_customer
from twentytwo a 
inner join twentyone b
on a.look_back_period = b.look_back_period 
and a.same_store = b.same_store 
and a.dma_name = b.dma_name
and a.location_type_code = b.location_type_code 
and a.daypart = b.daypart
and a.destination_desc = b.destination_desc
and a.previous_year_monthend_date = b.monthend_date
order by same_store,location_type_code,daypart,destination_desc
  );
20:21:03.169601 [debug] [Thread-1  ]: SQL status: BEGIN in 0.81 seconds
20:21:03.170069 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market__big_join"
20:21:03.170370 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market__big_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market__big_join"} */


  create  table
    "cfa"."public"."market__big_join__dbt_tmp"
    
    
    
  as (
    with big_join as ( 
  select a.*, e.unique_cfa_one_ids, e.unique_hashes, e.hash_transactions, e.hash_per_customer,
  b.price_index, 
  d.previous_year_monthend_date
  from "cfa"."public"."lcarr_sosx_market_agg__same_store_all_store" a
  inner join "cfa"."public"."lcarr_sosx_calc__dim_price_index_3" b
  on a.look_back_period = b.look_back_period
  and a.monthend_date = b.monthend_date
  and a.same_store = b.same_store
  inner join "cfa"."public"."lcarr_sosx_calc__dim_monthend_date" d
  on a.monthend_date = d.monthend_date
  inner join "cfa"."public"."lcarr_sosx_market_agg__distinct_join" e
  on a.monthend_date = e.monthend_date
  and a.look_back_period = e.look_back_period
  and a.same_store = e.same_store
  and a.dma_name = e.dma_name
  and a.location_type_code = e.location_type_code
  and a.daypart = e.daypart
  and a.destination_desc = e.destination_desc
)
select * from big_join
  );
20:21:03.220162 [debug] [Thread-2  ]: Postgres adapter: Postgres error: column a.dma_name does not exist

20:21:03.220645 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.market__final_output: ROLLBACK
20:21:03.309638 [debug] [Thread-2  ]: finished collecting timing info
20:21:03.310631 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.market__final_output: Close
20:21:03.312518 [debug] [Thread-2  ]: Database Error in model market__final_output (models/market/final_output/market__final_output.sql)
  column a.dma_name does not exist
  compiled SQL at target/run/source_of_sales_change_lcarr/models/market/final_output/market__final_output.sql
20:21:03.313053 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ac3822ab-6a17-4cef-8e5e-b430c9210064', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa8e238a0d0>]}
20:21:03.313691 [error] [Thread-2  ]: 2 of 2 ERROR creating table model public.lcarr_sosx_market__final_output........ [[31mERROR[0m in 1.20s]
20:21:03.314312 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.market__final_output
20:21:03.317401 [debug] [MainThread]: Acquiring new redshift connection "master"
20:21:03.317778 [debug] [MainThread]: Postgres adapter: Cancelling query 'model.source_of_sales_change_lcarr.market__big_join' (1094265519)
20:21:03.318043 [debug] [MainThread]: Using redshift connection "master"
20:21:03.318292 [debug] [MainThread]: On master: BEGIN
20:21:03.318534 [debug] [MainThread]: Opening a new connection, currently in state closed
20:21:03.318748 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
20:21:04.195037 [debug] [MainThread]: SQL status: BEGIN in 0.88 seconds
20:21:04.195495 [debug] [MainThread]: Using redshift connection "master"
20:21:04.195886 [debug] [MainThread]: On master: select pg_terminate_backend(1094265519)
20:21:04.256925 [debug] [MainThread]: SQL status: SELECT in 0.06 seconds
20:21:04.257744 [debug] [MainThread]: Postgres adapter: Cancel query 'model.source_of_sales_change_lcarr.market__big_join': (1,)
20:21:04.258077 [error] [MainThread]: CANCEL query model.source_of_sales_change_lcarr.market__big_join................ [[31mCANCEL[0m]
20:21:04.258498 [error] [MainThread]: CANCEL query model.source_of_sales_change_lcarr.market__final_output............ [[31mCANCEL[0m]
20:21:04.259021 [debug] [MainThread]: On master: ROLLBACK
20:21:04.363322 [debug] [MainThread]: On master: Close
20:21:04.446928 [debug] [Thread-1  ]: Postgres adapter: Postgres error: terminating connection due to administrator command
SSL connection has been closed unexpectedly

20:21:04.448301 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market__big_join: ROLLBACK
20:21:04.449433 [debug] [Thread-1  ]: Failed to rollback 'model.source_of_sales_change_lcarr.market__big_join'
20:21:04.450119 [debug] [Thread-1  ]: finished collecting timing info
20:21:04.450436 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market__big_join: Close
20:21:04.450894 [debug] [Thread-1  ]: Database Error in model market__big_join (models/market/final_output/market__big_join.sql)
  terminating connection due to administrator command
  SSL connection has been closed unexpectedly
  compiled SQL at target/run/source_of_sales_change_lcarr/models/market/final_output/market__big_join.sql
20:21:04.451412 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ac3822ab-6a17-4cef-8e5e-b430c9210064', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa8e237fa60>]}
20:21:04.452000 [error] [Thread-1  ]: 1 of 2 ERROR creating table model public.lcarr_sosx_market__big_join............ [[31mERROR[0m in 2.34s]
20:21:04.452506 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.market__big_join
20:21:04.453051 [info ] [MainThread]: 
20:21:04.453473 [error] [MainThread]: [33mDatabase Error in model market__final_output (models/market/final_output/market__final_output.sql)[0m
20:21:04.453983 [error] [MainThread]:   column a.dma_name does not exist
20:21:04.454468 [error] [MainThread]:   compiled SQL at target/run/source_of_sales_change_lcarr/models/market/final_output/market__final_output.sql
20:21:04.455003 [debug] [MainThread]: Connection 'master' was properly closed.
20:21:04.455286 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.market__big_join' was properly closed.
20:21:04.455492 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.market__final_output' was properly closed.
20:21:04.455795 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa8e1bc34c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa8e2360c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa8e23605e0>]}


============================== 2022-06-27 14:17:59.734608 | 76d57e87-aa81-4ac3-89cc-573def30733b ==============================
14:17:59.734608 [info ] [MainThread]: Running with dbt=1.0.4
14:17:59.737376 [debug] [MainThread]: running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=None, defer=None, event_buffer_size=None, exclude=None, fail_fast=True, full_refresh=False, log_cache_events=False, log_format=None, partial_parse=None, printer_width=None, profile=None, profiles_dir='/Users/lindsay.carr/DBT/environments/redshift_discovery_crn_svc/', project_dir=None, record_timing_info=None, rpc_method='run', select=['market.final_output'], selector_name=None, send_anonymous_usage_stats=None, single_threaded=False, state=None, static_parser=None, target=None, threads=None, use_colors=None, use_experimental_parser=None, vars='{}', version_check=None, warn_error=None, which='run', write_json=None)
14:17:59.738819 [debug] [MainThread]: Tracking: tracking
14:17:59.820802 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff1e95636a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff1e9563a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff1e9549040>]}
14:18:00.132543 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
14:18:00.135203 [debug] [MainThread]: Partial parsing: updated file: source_of_sales_change_lcarr://models/market/final_output/market__final_output.sql
14:18:00.186664 [debug] [MainThread]: 1699: static parser successfully parsed market/final_output/market__final_output.sql
14:18:00.245879 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '76d57e87-aa81-4ac3-89cc-573def30733b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff1e9722940>]}
14:18:00.310194 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '76d57e87-aa81-4ac3-89cc-573def30733b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff1e9583eb0>]}
14:18:00.310995 [info ] [MainThread]: Found 58 models, 4 tests, 0 snapshots, 0 analyses, 192 macros, 0 operations, 0 seed files, 11 sources, 0 exposures, 0 metrics
14:18:00.329405 [info ] [MainThread]: 
14:18:00.330605 [debug] [MainThread]: Acquiring new redshift connection "master"
14:18:00.332188 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa"
14:18:00.357507 [debug] [ThreadPool]: Using redshift connection "list_cfa"
14:18:00.358019 [debug] [ThreadPool]: On list_cfa: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa"} */

    select distinct nspname from pg_namespace
  
14:18:00.358457 [debug] [ThreadPool]: Opening a new connection, currently in state init
14:18:00.358907 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
14:18:01.146753 [debug] [ThreadPool]: SQL status: SELECT in 0.79 seconds
14:18:01.162284 [debug] [ThreadPool]: On list_cfa: Close
14:18:01.177825 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa_public"
14:18:01.191617 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
14:18:01.191934 [debug] [ThreadPool]: On list_cfa_public: BEGIN
14:18:01.192145 [debug] [ThreadPool]: Opening a new connection, currently in state closed
14:18:01.192357 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
14:18:01.751960 [debug] [ThreadPool]: SQL status: BEGIN in 0.56 seconds
14:18:01.752636 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
14:18:01.752959 [debug] [ThreadPool]: On list_cfa_public: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa_public"} */
select
      'cfa' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'cfa' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
14:18:02.014573 [debug] [ThreadPool]: SQL status: SELECT in 0.26 seconds
14:18:02.070685 [debug] [ThreadPool]: On list_cfa_public: ROLLBACK
14:18:02.167654 [debug] [ThreadPool]: On list_cfa_public: Close
14:18:02.203908 [debug] [MainThread]: Using redshift connection "master"
14:18:02.204223 [debug] [MainThread]: On master: BEGIN
14:18:02.204433 [debug] [MainThread]: Opening a new connection, currently in state init
14:18:02.204647 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
14:18:02.709624 [debug] [MainThread]: SQL status: BEGIN in 0.51 seconds
14:18:02.710201 [debug] [MainThread]: Using redshift connection "master"
14:18:02.710480 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
14:18:03.528565 [debug] [MainThread]: SQL status: SELECT in 0.82 seconds
14:18:03.548873 [debug] [MainThread]: On master: ROLLBACK
14:18:03.644672 [debug] [MainThread]: Using redshift connection "master"
14:18:03.645683 [debug] [MainThread]: On master: BEGIN
14:18:03.737266 [debug] [MainThread]: SQL status: BEGIN in 0.09 seconds
14:18:03.737860 [debug] [MainThread]: On master: COMMIT
14:18:03.738189 [debug] [MainThread]: Using redshift connection "master"
14:18:03.738451 [debug] [MainThread]: On master: COMMIT
14:18:03.830509 [debug] [MainThread]: SQL status: COMMIT in 0.09 seconds
14:18:03.831041 [debug] [MainThread]: On master: Close
14:18:03.831870 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
14:18:03.832313 [info ] [MainThread]: 
14:18:03.839043 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.market__big_join
14:18:03.839349 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.market__final_output
14:18:03.839814 [info ] [Thread-1  ]: 1 of 2 START table model public.lcarr_sosx_market__big_join..................... [RUN]
14:18:03.840227 [info ] [Thread-2  ]: 2 of 2 START table model public.lcarr_sosx_market__final_output................. [RUN]
14:18:03.841163 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.market__big_join"
14:18:03.841880 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.market__big_join
14:18:03.842631 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.market__final_output"
14:18:03.843030 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.market__big_join
14:18:03.843511 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.market__final_output
14:18:03.851036 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.market__big_join"
14:18:03.851435 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.market__final_output
14:18:03.856643 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.market__final_output"
14:18:03.857248 [debug] [Thread-1  ]: finished collecting timing info
14:18:03.857718 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.market__big_join
14:18:03.863944 [debug] [Thread-2  ]: finished collecting timing info
14:18:03.877130 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.market__final_output
14:18:04.324282 [debug] [Thread-1  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.market__big_join"
14:18:04.326406 [debug] [Thread-2  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.market__final_output"
14:18:04.328322 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market__big_join"
14:18:04.329390 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.market__final_output"
14:18:04.330199 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market__big_join: BEGIN
14:18:04.330632 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.market__final_output: BEGIN
14:18:04.331046 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
14:18:04.331444 [debug] [Thread-2  ]: Opening a new connection, currently in state init
14:18:04.331877 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
14:18:04.332501 [debug] [Thread-2  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
14:18:04.854393 [debug] [Thread-2  ]: SQL status: BEGIN in 0.52 seconds
14:18:04.854943 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.market__final_output"
14:18:04.855175 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.market__final_output: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market__final_output"} */


  create  table
    "cfa"."public"."market__final_output__dbt_tmp"
    
    
    
  as (
    with twentytwo as (
select *
from "cfa"."public"."lcarr_sosx_ast__big_join" 
where monthend_date = cast('02-28-2022' as date) 
), twentyone as ( 
select * 
from "cfa"."public"."lcarr_sosx_ast__big_join"
where monthend_date = cast('02-28-2021' as date)
) 

select a.quarter,
a.look_back_period,a.same_store,
'Market' as geolevel, 
a.dma_name as geolevel_detail,
a.location_type_code,a.daypart,a.destination_desc,
a.monthend_date as current_monthend_date,
a.sales_sub_total as current_sales_sub_total,
a.transactions as current_transactions,
a.purchaser_visits as current_purchaser_visits,
a.credit_txn as current_credit_txn,
a.total_items_promo_count as current_total_items_promo_count,
a.total_items_sold_count as current_total_items_sold_count,
a.actual_days as current_actual_days,
a.avail_days as current_avail_days,
a.price_index as current_price_index,
a.unique_cfa_one_ids as current_unique_cfa_one_ids,
a.unique_hashes as current_unique_hashes,
a.hash_transactions as current_hash_transactions,
a.hash_per_customer as current_hash_per_customer,
a.previous_year_monthend_date as check_date,
b.monthend_date as previous_monthend_date,
b.sales_sub_total as previous_sales_sub_total,
b.transactions as previous_transactions,
b.purchaser_visits as previous_purchaser_visits,
b.credit_txn as previous_credit_txn,
b.total_items_promo_count as previous_total_items_promo_count,
b.total_items_sold_count as previous_total_items_sold_count,
b.actual_days as previous_actual_days,
b.avail_days as previous_avail_days,
b.price_index as previous_price_index,
b.unique_cfa_one_ids as previous_unique_cfa_one_ids,
b.unique_hashes as previous_unique_hashes,
b.hash_transactions as previous_hash_transactions,
b.hash_per_customer as previous_hash_per_customer
from twentytwo a 
inner join twentyone b
on a.look_back_period = b.look_back_period 
and a.same_store = b.same_store 
and a.dma_name = b.dma_name
and a.location_type_code = b.location_type_code 
and a.daypart = b.daypart
and a.destination_desc = b.destination_desc
and a.previous_year_monthend_date = b.monthend_date
order by same_store,location_type_code,daypart,destination_desc
  );
14:18:04.896291 [debug] [Thread-1  ]: SQL status: BEGIN in 0.57 seconds
14:18:04.896671 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market__big_join"
14:18:04.896971 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market__big_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market__big_join"} */


  create  table
    "cfa"."public"."market__big_join__dbt_tmp"
    
    
    
  as (
    with big_join as ( 
  select a.*, e.unique_cfa_one_ids, e.unique_hashes, e.hash_transactions, e.hash_per_customer,
  b.price_index, 
  d.previous_year_monthend_date
  from "cfa"."public"."lcarr_sosx_market_agg__same_store_all_store" a
  inner join "cfa"."public"."lcarr_sosx_calc__dim_price_index_3" b
  on a.look_back_period = b.look_back_period
  and a.monthend_date = b.monthend_date
  and a.same_store = b.same_store
  inner join "cfa"."public"."lcarr_sosx_calc__dim_monthend_date" d
  on a.monthend_date = d.monthend_date
  inner join "cfa"."public"."lcarr_sosx_market_agg__distinct_join" e
  on a.monthend_date = e.monthend_date
  and a.look_back_period = e.look_back_period
  and a.same_store = e.same_store
  and a.dma_name = e.dma_name
  and a.location_type_code = e.location_type_code
  and a.daypart = e.daypart
  and a.destination_desc = e.destination_desc
)
select * from big_join
  );
14:18:04.958213 [debug] [Thread-2  ]: Postgres adapter: Postgres error: column a.dma_name does not exist

14:18:04.958852 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.market__final_output: ROLLBACK
14:18:05.048091 [debug] [Thread-2  ]: finished collecting timing info
14:18:05.048466 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.market__final_output: Close
14:18:05.049752 [debug] [Thread-2  ]: Database Error in model market__final_output (models/market/final_output/market__final_output.sql)
  column a.dma_name does not exist
  compiled SQL at target/run/source_of_sales_change_lcarr/models/market/final_output/market__final_output.sql
14:18:05.050484 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '76d57e87-aa81-4ac3-89cc-573def30733b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff1e9c96760>]}
14:18:05.051009 [error] [Thread-2  ]: 2 of 2 ERROR creating table model public.lcarr_sosx_market__final_output........ [[31mERROR[0m in 1.21s]
14:18:05.051592 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.market__final_output
14:18:05.058454 [debug] [MainThread]: Acquiring new redshift connection "master"
14:18:05.058921 [debug] [MainThread]: Postgres adapter: Cancelling query 'model.source_of_sales_change_lcarr.market__big_join' (1080782783)
14:18:05.059314 [debug] [MainThread]: Using redshift connection "master"
14:18:05.059592 [debug] [MainThread]: On master: BEGIN
14:18:05.059824 [debug] [MainThread]: Opening a new connection, currently in state closed
14:18:05.060051 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
14:18:05.692363 [debug] [MainThread]: SQL status: BEGIN in 0.63 seconds
14:18:05.693029 [debug] [MainThread]: Using redshift connection "master"
14:18:05.693402 [debug] [MainThread]: On master: select pg_terminate_backend(1080782783)
14:18:05.743175 [debug] [MainThread]: SQL status: SELECT in 0.05 seconds
14:18:05.743634 [debug] [MainThread]: Postgres adapter: Cancel query 'model.source_of_sales_change_lcarr.market__big_join': (1,)
14:18:05.743919 [error] [MainThread]: CANCEL query model.source_of_sales_change_lcarr.market__big_join................ [[31mCANCEL[0m]
14:18:05.744337 [error] [MainThread]: CANCEL query model.source_of_sales_change_lcarr.market__final_output............ [[31mCANCEL[0m]
14:18:05.744840 [debug] [MainThread]: On master: ROLLBACK
14:18:05.857328 [debug] [MainThread]: On master: Close
14:18:06.022234 [debug] [Thread-1  ]: Postgres adapter: Postgres error: terminating connection due to administrator command
SSL connection has been closed unexpectedly

14:18:06.022619 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market__big_join: ROLLBACK
14:18:06.022869 [debug] [Thread-1  ]: Failed to rollback 'model.source_of_sales_change_lcarr.market__big_join'
14:18:06.023238 [debug] [Thread-1  ]: finished collecting timing info
14:18:06.023465 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market__big_join: Close
14:18:06.023864 [debug] [Thread-1  ]: Database Error in model market__big_join (models/market/final_output/market__big_join.sql)
  terminating connection due to administrator command
  SSL connection has been closed unexpectedly
  compiled SQL at target/run/source_of_sales_change_lcarr/models/market/final_output/market__big_join.sql
14:18:06.024208 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '76d57e87-aa81-4ac3-89cc-573def30733b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff1e9cb5460>]}
14:18:06.024632 [error] [Thread-1  ]: 1 of 2 ERROR creating table model public.lcarr_sosx_market__big_join............ [[31mERROR[0m in 2.18s]
14:18:06.025091 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.market__big_join
14:18:06.025679 [info ] [MainThread]: 
14:18:06.026319 [error] [MainThread]: [33mDatabase Error in model market__final_output (models/market/final_output/market__final_output.sql)[0m
14:18:06.026862 [error] [MainThread]:   column a.dma_name does not exist
14:18:06.027423 [error] [MainThread]:   compiled SQL at target/run/source_of_sales_change_lcarr/models/market/final_output/market__final_output.sql
14:18:06.027832 [debug] [MainThread]: Connection 'master' was properly closed.
14:18:06.028061 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.market__big_join' was properly closed.
14:18:06.028248 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.market__final_output' was properly closed.
14:18:06.028541 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff1e9583ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff1e9cb5850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff1e9cb5820>]}


============================== 2022-06-27 14:18:28.418380 | 01668413-e615-4e74-a9e7-fc4cee77182c ==============================
14:18:28.418380 [info ] [MainThread]: Running with dbt=1.0.4
14:18:28.419114 [debug] [MainThread]: running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=None, defer=None, event_buffer_size=None, exclude=None, fail_fast=True, full_refresh=False, log_cache_events=False, log_format=None, partial_parse=None, printer_width=None, profile=None, profiles_dir='/Users/lindsay.carr/DBT/environments/redshift_discovery_crn_svc/', project_dir=None, record_timing_info=None, rpc_method='run', select=['market.final_output'], selector_name=None, send_anonymous_usage_stats=None, single_threaded=False, state=None, static_parser=None, target=None, threads=None, use_colors=None, use_experimental_parser=None, vars='{}', version_check=None, warn_error=None, which='run', write_json=None)
14:18:28.419500 [debug] [MainThread]: Tracking: tracking
14:18:28.449817 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f91cfca26d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f91cfca2ac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f91cfc89340>]}
14:18:28.584868 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
14:18:28.585723 [debug] [MainThread]: Partial parsing: updated file: source_of_sales_change_lcarr://models/market/final_output/market__final_output.sql
14:18:28.601402 [debug] [MainThread]: 1699: static parser successfully parsed market/final_output/market__final_output.sql
14:18:28.632676 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '01668413-e615-4e74-a9e7-fc4cee77182c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f91cfe4c970>]}
14:18:28.654906 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '01668413-e615-4e74-a9e7-fc4cee77182c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f91cfcc3ca0>]}
14:18:28.655402 [info ] [MainThread]: Found 58 models, 4 tests, 0 snapshots, 0 analyses, 192 macros, 0 operations, 0 seed files, 11 sources, 0 exposures, 0 metrics
14:18:28.659011 [info ] [MainThread]: 
14:18:28.659703 [debug] [MainThread]: Acquiring new redshift connection "master"
14:18:28.660763 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa"
14:18:28.674680 [debug] [ThreadPool]: Using redshift connection "list_cfa"
14:18:28.675006 [debug] [ThreadPool]: On list_cfa: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa"} */

    select distinct nspname from pg_namespace
  
14:18:28.675226 [debug] [ThreadPool]: Opening a new connection, currently in state init
14:18:28.675452 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
14:18:29.274929 [debug] [ThreadPool]: SQL status: SELECT in 0.6 seconds
14:18:29.283215 [debug] [ThreadPool]: On list_cfa: Close
14:18:29.289236 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa_public"
14:18:29.297871 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
14:18:29.298198 [debug] [ThreadPool]: On list_cfa_public: BEGIN
14:18:29.298413 [debug] [ThreadPool]: Opening a new connection, currently in state closed
14:18:29.298630 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
14:18:29.798250 [debug] [ThreadPool]: SQL status: BEGIN in 0.5 seconds
14:18:29.798717 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
14:18:29.798956 [debug] [ThreadPool]: On list_cfa_public: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa_public"} */
select
      'cfa' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'cfa' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
14:18:30.056087 [debug] [ThreadPool]: SQL status: SELECT in 0.26 seconds
14:18:30.111495 [debug] [ThreadPool]: On list_cfa_public: ROLLBACK
14:18:30.207938 [debug] [ThreadPool]: On list_cfa_public: Close
14:18:30.243788 [debug] [MainThread]: Using redshift connection "master"
14:18:30.244105 [debug] [MainThread]: On master: BEGIN
14:18:30.244314 [debug] [MainThread]: Opening a new connection, currently in state init
14:18:30.244523 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
14:18:30.745760 [debug] [MainThread]: SQL status: BEGIN in 0.5 seconds
14:18:30.746460 [debug] [MainThread]: Using redshift connection "master"
14:18:30.746734 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
14:18:31.455178 [debug] [MainThread]: SQL status: SELECT in 0.71 seconds
14:18:31.475027 [debug] [MainThread]: On master: ROLLBACK
14:18:31.599469 [debug] [MainThread]: Using redshift connection "master"
14:18:31.600155 [debug] [MainThread]: On master: BEGIN
14:18:31.694265 [debug] [MainThread]: SQL status: BEGIN in 0.09 seconds
14:18:31.694925 [debug] [MainThread]: On master: COMMIT
14:18:31.695209 [debug] [MainThread]: Using redshift connection "master"
14:18:31.695439 [debug] [MainThread]: On master: COMMIT
14:18:31.789295 [debug] [MainThread]: SQL status: COMMIT in 0.09 seconds
14:18:31.790020 [debug] [MainThread]: On master: Close
14:18:31.790945 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
14:18:31.791476 [info ] [MainThread]: 
14:18:31.798003 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.market__big_join
14:18:31.798659 [info ] [Thread-1  ]: 1 of 2 START table model public.lcarr_sosx_market__big_join..................... [RUN]
14:18:31.799546 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.market__big_join"
14:18:31.799852 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.market__big_join
14:18:31.800184 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.market__big_join
14:18:31.806665 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.market__big_join"
14:18:31.807653 [debug] [Thread-1  ]: finished collecting timing info
14:18:31.808069 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.market__big_join
14:18:31.927234 [debug] [Thread-1  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.market__big_join"
14:18:31.928440 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market__big_join"
14:18:31.929089 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market__big_join: BEGIN
14:18:31.929494 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
14:18:31.929713 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
14:18:32.435411 [debug] [Thread-1  ]: SQL status: BEGIN in 0.51 seconds
14:18:32.435815 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market__big_join"
14:18:32.436078 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market__big_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market__big_join"} */


  create  table
    "cfa"."public"."market__big_join__dbt_tmp"
    
    
    
  as (
    with big_join as ( 
  select a.*, e.unique_cfa_one_ids, e.unique_hashes, e.hash_transactions, e.hash_per_customer,
  b.price_index, 
  d.previous_year_monthend_date
  from "cfa"."public"."lcarr_sosx_market_agg__same_store_all_store" a
  inner join "cfa"."public"."lcarr_sosx_calc__dim_price_index_3" b
  on a.look_back_period = b.look_back_period
  and a.monthend_date = b.monthend_date
  and a.same_store = b.same_store
  inner join "cfa"."public"."lcarr_sosx_calc__dim_monthend_date" d
  on a.monthend_date = d.monthend_date
  inner join "cfa"."public"."lcarr_sosx_market_agg__distinct_join" e
  on a.monthend_date = e.monthend_date
  and a.look_back_period = e.look_back_period
  and a.same_store = e.same_store
  and a.dma_name = e.dma_name
  and a.location_type_code = e.location_type_code
  and a.daypart = e.daypart
  and a.destination_desc = e.destination_desc
)
select * from big_join
  );
14:19:33.361883 [debug] [Thread-1  ]: SQL status: SELECT in 60.92 seconds
14:19:33.387442 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market__big_join"
14:19:33.387801 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market__big_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market__big_join"} */
alter table "cfa"."public"."lcarr_sosx_market__big_join" rename to "market__big_join__dbt_backup"
14:19:33.435749 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.05 seconds
14:19:33.439319 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market__big_join"
14:19:33.439622 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market__big_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market__big_join"} */
alter table "cfa"."public"."market__big_join__dbt_tmp" rename to "lcarr_sosx_market__big_join"
14:19:33.486471 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.05 seconds
14:19:33.505010 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market__big_join: COMMIT
14:19:33.505390 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market__big_join"
14:19:33.505598 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market__big_join: COMMIT
14:19:35.004624 [debug] [Thread-1  ]: SQL status: COMMIT in 1.5 seconds
14:19:35.005516 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market__big_join"
14:19:35.005759 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market__big_join: BEGIN
14:19:35.055652 [debug] [Thread-1  ]: SQL status: BEGIN in 0.05 seconds
14:19:35.065864 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market__big_join"
14:19:35.066195 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market__big_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market__big_join"} */
drop table if exists "cfa"."public"."market__big_join__dbt_backup" cascade
14:19:35.117488 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.05 seconds
14:19:35.119055 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market__big_join: COMMIT
14:19:35.119372 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market__big_join"
14:19:35.119633 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market__big_join: COMMIT
14:19:36.314662 [debug] [Thread-1  ]: SQL status: COMMIT in 1.19 seconds
14:19:36.315131 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.market__big_join"
14:19:36.315420 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market__big_join: BEGIN
14:19:36.363350 [debug] [Thread-1  ]: SQL status: BEGIN in 0.05 seconds
14:19:36.364861 [debug] [Thread-1  ]: finished collecting timing info
14:19:36.365196 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market__big_join: ROLLBACK
14:19:36.463162 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.market__big_join: Close
14:19:36.466928 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '01668413-e615-4e74-a9e7-fc4cee77182c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f91cfe110a0>]}
14:19:36.468913 [info ] [Thread-1  ]: 1 of 2 OK created table model public.lcarr_sosx_market__big_join................ [[32mSELECT[0m in 64.67s]
14:19:36.469856 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.market__big_join
14:19:36.472125 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.market__final_output
14:19:36.472695 [info ] [Thread-3  ]: 2 of 2 START table model public.lcarr_sosx_market__final_output................. [RUN]
14:19:36.473466 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.market__final_output"
14:19:36.473780 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.market__final_output
14:19:36.474062 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.market__final_output
14:19:36.478040 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.market__final_output"
14:19:36.478928 [debug] [Thread-3  ]: finished collecting timing info
14:19:36.479264 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.market__final_output
14:19:36.551172 [debug] [Thread-3  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.market__final_output"
14:19:36.552012 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.market__final_output"
14:19:36.552251 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market__final_output: BEGIN
14:19:36.552486 [debug] [Thread-3  ]: Opening a new connection, currently in state init
14:19:36.552748 [debug] [Thread-3  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
14:19:37.108692 [debug] [Thread-3  ]: SQL status: BEGIN in 0.56 seconds
14:19:37.109348 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.market__final_output"
14:19:37.109624 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market__final_output: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market__final_output"} */


  create  table
    "cfa"."public"."market__final_output__dbt_tmp"
    
    
    
  as (
    with twentytwo as (
select *
from "cfa"."public"."lcarr_sosx_market__big_join" 
where monthend_date = cast('02-28-2022' as date) 
), twentyone as ( 
select * 
from "cfa"."public"."lcarr_sosx_market__big_join"
where monthend_date = cast('02-28-2021' as date)
) 

select a.quarter,
a.look_back_period,a.same_store,
'Market' as geolevel, 
a.dma_name as geolevel_detail,
a.location_type_code,a.daypart,a.destination_desc,
a.monthend_date as current_monthend_date,
a.sales_sub_total as current_sales_sub_total,
a.transactions as current_transactions,
a.purchaser_visits as current_purchaser_visits,
a.credit_txn as current_credit_txn,
a.total_items_promo_count as current_total_items_promo_count,
a.total_items_sold_count as current_total_items_sold_count,
a.actual_days as current_actual_days,
a.avail_days as current_avail_days,
a.price_index as current_price_index,
a.unique_cfa_one_ids as current_unique_cfa_one_ids,
a.unique_hashes as current_unique_hashes,
a.hash_transactions as current_hash_transactions,
a.hash_per_customer as current_hash_per_customer,
a.previous_year_monthend_date as check_date,
b.monthend_date as previous_monthend_date,
b.sales_sub_total as previous_sales_sub_total,
b.transactions as previous_transactions,
b.purchaser_visits as previous_purchaser_visits,
b.credit_txn as previous_credit_txn,
b.total_items_promo_count as previous_total_items_promo_count,
b.total_items_sold_count as previous_total_items_sold_count,
b.actual_days as previous_actual_days,
b.avail_days as previous_avail_days,
b.price_index as previous_price_index,
b.unique_cfa_one_ids as previous_unique_cfa_one_ids,
b.unique_hashes as previous_unique_hashes,
b.hash_transactions as previous_hash_transactions,
b.hash_per_customer as previous_hash_per_customer
from twentytwo a 
inner join twentyone b
on a.look_back_period = b.look_back_period 
and a.same_store = b.same_store 
and a.dma_name = b.dma_name
and a.location_type_code = b.location_type_code 
and a.daypart = b.daypart
and a.destination_desc = b.destination_desc
and a.previous_year_monthend_date = b.monthend_date
order by same_store,location_type_code,daypart,destination_desc
  );
14:19:50.649663 [debug] [Thread-3  ]: SQL status: SELECT in 13.54 seconds
14:19:50.654039 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.market__final_output"
14:19:50.654362 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market__final_output: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market__final_output"} */
alter table "cfa"."public"."lcarr_sosx_market__final_output" rename to "market__final_output__dbt_backup"
14:19:50.756230 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.1 seconds
14:19:50.759603 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.market__final_output"
14:19:50.760038 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market__final_output: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market__final_output"} */
alter table "cfa"."public"."market__final_output__dbt_tmp" rename to "lcarr_sosx_market__final_output"
14:19:50.808862 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.05 seconds
14:19:50.810862 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market__final_output: COMMIT
14:19:50.811107 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.market__final_output"
14:19:50.811306 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market__final_output: COMMIT
14:19:53.414456 [debug] [Thread-3  ]: SQL status: COMMIT in 2.6 seconds
14:19:53.415183 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.market__final_output"
14:19:53.415452 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market__final_output: BEGIN
14:19:53.461986 [debug] [Thread-3  ]: SQL status: BEGIN in 0.05 seconds
14:19:53.466303 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.market__final_output"
14:19:53.466623 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market__final_output: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.market__final_output"} */
drop table if exists "cfa"."public"."market__final_output__dbt_backup" cascade
14:19:53.518831 [debug] [Thread-3  ]: SQL status: DROP TABLE in 0.05 seconds
14:19:53.523147 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market__final_output: COMMIT
14:19:53.523541 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.market__final_output"
14:19:53.523806 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market__final_output: COMMIT
14:19:54.745729 [debug] [Thread-3  ]: SQL status: COMMIT in 1.22 seconds
14:19:54.746299 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.market__final_output"
14:19:54.746598 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market__final_output: BEGIN
14:19:54.793184 [debug] [Thread-3  ]: SQL status: BEGIN in 0.05 seconds
14:19:54.794343 [debug] [Thread-3  ]: finished collecting timing info
14:19:54.794677 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market__final_output: ROLLBACK
14:19:54.889534 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.market__final_output: Close
14:19:54.890840 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '01668413-e615-4e74-a9e7-fc4cee77182c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f91d053f280>]}
14:19:54.891425 [info ] [Thread-3  ]: 2 of 2 OK created table model public.lcarr_sosx_market__final_output............ [[32mSELECT[0m in 18.42s]
14:19:54.891873 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.market__final_output
14:19:54.894572 [debug] [MainThread]: Acquiring new redshift connection "master"
14:19:54.894975 [debug] [MainThread]: Using redshift connection "master"
14:19:54.895214 [debug] [MainThread]: On master: BEGIN
14:19:54.895537 [debug] [MainThread]: Opening a new connection, currently in state closed
14:19:54.895872 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
14:19:55.414942 [debug] [MainThread]: SQL status: BEGIN in 0.52 seconds
14:19:55.415626 [debug] [MainThread]: On master: COMMIT
14:19:55.415921 [debug] [MainThread]: Using redshift connection "master"
14:19:55.416177 [debug] [MainThread]: On master: COMMIT
14:19:55.511035 [debug] [MainThread]: SQL status: COMMIT in 0.09 seconds
14:19:55.511683 [debug] [MainThread]: On master: Close
14:19:55.514826 [info ] [MainThread]: 
14:19:55.515512 [info ] [MainThread]: Finished running 2 table models in 86.85s.
14:19:55.515969 [debug] [MainThread]: Connection 'master' was properly closed.
14:19:55.516181 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.market__big_join' was properly closed.
14:19:55.516377 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.market__final_output' was properly closed.
14:19:55.532064 [info ] [MainThread]: 
14:19:55.532668 [info ] [MainThread]: [32mCompleted successfully[0m
14:19:55.533185 [info ] [MainThread]: 
14:19:55.533630 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
14:19:55.534313 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f91d0632e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f91d0632f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f91d0632d90>]}


============================== 2022-06-27 16:14:00.221897 | 98971e86-422b-4b66-9a14-894c7111736e ==============================
16:14:00.221897 [info ] [MainThread]: Running with dbt=1.0.4
16:14:00.224265 [debug] [MainThread]: running dbt with arguments Namespace(cls=<class 'dbt.task.generate.GenerateTask'>, compile=True, debug=None, defer=None, event_buffer_size=None, exclude=None, fail_fast=True, log_cache_events=False, log_format=None, partial_parse=None, printer_width=None, profile=None, profiles_dir='/Users/lindsay.carr/DBT/environments/redshift_discovery_crn_svc/', project_dir=None, record_timing_info=None, rpc_method='docs.generate', select=None, selector_name=None, send_anonymous_usage_stats=None, single_threaded=False, state=None, static_parser=None, target=None, threads=None, use_colors=None, use_experimental_parser=None, vars='{}', version_check=None, warn_error=None, which='generate', write_json=None)
16:14:00.225399 [debug] [MainThread]: Tracking: tracking
16:14:00.346672 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f784c4a3640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f784c4a3a30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f784c488070>]}
16:14:00.614161 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
16:14:00.614679 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
16:14:00.634349 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '98971e86-422b-4b66-9a14-894c7111736e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f784c623700>]}
16:14:00.669629 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '98971e86-422b-4b66-9a14-894c7111736e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f784c533940>]}
16:14:00.670336 [info ] [MainThread]: Found 58 models, 4 tests, 0 snapshots, 0 analyses, 192 macros, 0 operations, 0 seed files, 11 sources, 0 exposures, 0 metrics
16:14:00.679174 [info ] [MainThread]: 
16:14:00.680562 [debug] [MainThread]: Acquiring new redshift connection "master"
16:14:00.686867 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa_public"
16:14:00.711210 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
16:14:00.711694 [debug] [ThreadPool]: On list_cfa_public: BEGIN
16:14:00.712212 [debug] [ThreadPool]: Opening a new connection, currently in state init
16:14:00.712991 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
16:14:01.487865 [debug] [ThreadPool]: SQL status: BEGIN in 0.78 seconds
16:14:01.488714 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
16:14:01.489078 [debug] [ThreadPool]: On list_cfa_public: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa_public"} */
select
      'cfa' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'cfa' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
16:14:01.910480 [debug] [ThreadPool]: SQL status: SELECT in 0.42 seconds
16:14:02.006878 [debug] [ThreadPool]: On list_cfa_public: ROLLBACK
16:14:02.108766 [debug] [ThreadPool]: On list_cfa_public: Close
16:14:02.166695 [debug] [MainThread]: Using redshift connection "master"
16:14:02.167143 [debug] [MainThread]: On master: BEGIN
16:14:02.167466 [debug] [MainThread]: Opening a new connection, currently in state init
16:14:02.167793 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
16:14:02.691541 [debug] [MainThread]: SQL status: BEGIN in 0.52 seconds
16:14:02.692009 [debug] [MainThread]: Using redshift connection "master"
16:14:02.692352 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
16:14:03.528077 [debug] [MainThread]: SQL status: SELECT in 0.84 seconds
16:14:03.562910 [debug] [MainThread]: On master: ROLLBACK
16:14:03.664937 [debug] [MainThread]: On master: Close
16:14:03.666199 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
16:14:03.666932 [info ] [MainThread]: 
16:14:03.676634 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.calc__dim_monthend_date
16:14:03.677125 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.stg__dim_adj_sales
16:14:03.677564 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.stg__dim_daypart
16:14:03.677906 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.stg__dim_destination
16:14:03.678613 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.calc__dim_monthend_date"
16:14:03.679373 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.stg__dim_adj_sales"
16:14:03.680069 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.stg__dim_daypart"
16:14:03.680764 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.stg__dim_destination"
16:14:03.681184 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.calc__dim_monthend_date
16:14:03.681574 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.stg__dim_adj_sales
16:14:03.681933 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.stg__dim_daypart
16:14:03.682304 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.stg__dim_destination
16:14:03.682715 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.calc__dim_monthend_date
16:14:03.683091 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.stg__dim_adj_sales
16:14:03.683446 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.stg__dim_daypart
16:14:03.684071 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.stg__dim_destination
16:14:03.689637 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.calc__dim_monthend_date"
16:14:03.697548 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.stg__dim_adj_sales"
16:14:03.704291 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.stg__dim_daypart"
16:14:03.709896 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.stg__dim_destination"
16:14:03.712009 [debug] [Thread-2  ]: finished collecting timing info
16:14:03.712436 [debug] [Thread-3  ]: finished collecting timing info
16:14:03.712764 [debug] [Thread-1  ]: finished collecting timing info
16:14:03.713200 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.stg__dim_adj_sales
16:14:03.713545 [debug] [Thread-4  ]: finished collecting timing info
16:14:03.713958 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.stg__dim_daypart
16:14:03.714354 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.calc__dim_monthend_date
16:14:03.714781 [debug] [Thread-2  ]: finished collecting timing info
16:14:03.715160 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.stg__dim_destination
16:14:03.715553 [debug] [Thread-3  ]: finished collecting timing info
16:14:03.715972 [debug] [Thread-1  ]: finished collecting timing info
16:14:03.716778 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.stg__dim_adj_sales
16:14:03.717187 [debug] [Thread-4  ]: finished collecting timing info
16:14:03.717910 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.stg__dim_daypart
16:14:03.718605 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.calc__dim_monthend_date
16:14:03.719054 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig
16:14:03.719924 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.stg__dim_destination
16:14:03.720394 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.stg__dim_item
16:14:03.720993 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.stg__dim_location
16:14:03.721847 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig"
16:14:03.722451 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.stg__dim_transaction_status
16:14:03.723292 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.stg__dim_item"
16:14:03.723976 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.stg__dim_location"
16:14:03.724379 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig
16:14:03.725015 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.stg__dim_transaction_status"
16:14:03.725392 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.stg__dim_item
16:14:03.725763 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.stg__dim_location
16:14:03.726152 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig
16:14:03.726528 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.stg__dim_transaction_status
16:14:03.726903 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.stg__dim_item
16:14:03.727405 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.stg__dim_location
16:14:03.735414 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig"
16:14:03.736141 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.stg__dim_transaction_status
16:14:03.740678 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.stg__dim_item"
16:14:03.745594 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.stg__dim_location"
16:14:03.750540 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.stg__dim_transaction_status"
16:14:03.751485 [debug] [Thread-2  ]: finished collecting timing info
16:14:03.751999 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig
16:14:03.752458 [debug] [Thread-2  ]: finished collecting timing info
16:14:03.753331 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig
16:14:03.753692 [debug] [Thread-3  ]: finished collecting timing info
16:14:03.754001 [debug] [Thread-4  ]: finished collecting timing info
16:14:03.754308 [debug] [Thread-1  ]: finished collecting timing info
16:14:03.754677 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.stg__fct_transaction
16:14:03.755267 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.stg__dim_item
16:14:03.755802 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.stg__dim_transaction_status
16:14:03.756199 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.stg__dim_location
16:14:03.756951 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.stg__fct_transaction"
16:14:03.757388 [debug] [Thread-3  ]: finished collecting timing info
16:14:03.757798 [debug] [Thread-4  ]: finished collecting timing info
16:14:03.758185 [debug] [Thread-1  ]: finished collecting timing info
16:14:03.758557 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.stg__fct_transaction
16:14:03.759392 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.stg__dim_item
16:14:03.760091 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.stg__dim_transaction_status
16:14:03.760887 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.stg__dim_location
16:14:03.761314 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.stg__fct_transaction
16:14:03.761785 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.calc__error
16:14:03.762379 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.stg__dim_same_store
16:14:03.774878 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.calc__dim_price_index_1
16:14:03.777754 [info ] [Thread-2  ]: 2022-02-01
16:14:03.778489 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.calc__error"
16:14:03.779193 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.stg__dim_same_store"
16:14:03.779850 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_1"
16:14:03.780612 [info ] [Thread-2  ]: 2022-02-28
16:14:03.780934 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.calc__error
16:14:03.781561 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.stg__dim_same_store
16:14:03.781938 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.calc__dim_price_index_1
16:14:03.782721 [info ] [Thread-2  ]: 
16:14:03.783053 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.calc__error
16:14:03.783436 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.stg__dim_same_store
16:14:03.783847 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.calc__dim_price_index_1
16:14:03.785059 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.stg__fct_transaction"
16:14:03.790771 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.calc__error"
16:14:03.796137 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.stg__dim_same_store"
16:14:03.804856 [debug] [Thread-4  ]: finished collecting timing info
16:14:03.805293 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.stg__dim_same_store
16:14:03.805665 [debug] [Thread-4  ]: finished collecting timing info
16:14:03.801446 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.calc__dim_price_index_1"
16:14:03.806437 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.stg__dim_same_store
16:14:03.807292 [debug] [Thread-1  ]: finished collecting timing info
16:14:03.808470 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.calc__dim_price_index_1
16:14:03.807739 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.stg__fct_item
16:14:03.808856 [debug] [Thread-1  ]: finished collecting timing info
16:14:03.812640 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.stg__fct_item"
16:14:03.814833 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.stg__fct_item
16:14:03.803884 [debug] [Thread-3  ]: finished collecting timing info
16:14:03.814378 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.calc__dim_price_index_1
16:14:03.815227 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.stg__fct_item
16:14:03.815644 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.calc__error
16:14:03.816112 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.stg__fct_tender
16:14:03.823818 [debug] [Thread-3  ]: finished collecting timing info
16:14:03.830226 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.stg__fct_item"
16:14:03.831416 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.stg__fct_tender"
16:14:03.832717 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.calc__error
16:14:03.833745 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.stg__fct_tender
16:14:03.836082 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.stg__fct_tender
16:14:03.835487 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.stg__fct_same_store
16:14:03.834409 [debug] [Thread-4  ]: finished collecting timing info
16:14:03.843799 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.stg__fct_item
16:14:03.843313 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.stg__fct_same_store"
16:14:03.848357 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.stg__fct_same_store
16:14:03.844187 [debug] [Thread-4  ]: finished collecting timing info
16:14:03.848723 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.stg__fct_same_store
16:14:03.849484 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.stg__fct_item
16:14:03.847849 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.stg__fct_tender"
16:14:03.855241 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.stg__fct_same_store"
16:14:03.856226 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.item
16:14:03.857498 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.item"
16:14:03.857896 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.item
16:14:03.802538 [debug] [Thread-2  ]: finished collecting timing info
16:14:03.859787 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.stg__fct_transaction
16:14:03.860157 [debug] [Thread-2  ]: finished collecting timing info
16:14:03.858290 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.item
16:14:03.860858 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.stg__fct_transaction
16:14:03.858859 [debug] [Thread-3  ]: finished collecting timing info
16:14:03.866906 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.item"
16:14:03.859397 [debug] [Thread-1  ]: finished collecting timing info
16:14:03.869804 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.stg__fct_tender
16:14:03.870178 [debug] [Thread-1  ]: finished collecting timing info
16:14:03.870895 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.stg__fct_tender
16:14:03.869377 [debug] [Thread-4  ]: finished collecting timing info
16:14:03.871684 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.item
16:14:03.872403 [debug] [Thread-4  ]: finished collecting timing info
16:14:03.873055 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.item
16:14:03.872075 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.tender
16:14:03.867932 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.stg__fct_same_store
16:14:03.868418 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.transaction
16:14:03.873956 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.tender"
16:14:03.874472 [debug] [Thread-4  ]: Began running node test.source_of_sales_change_lcarr.not_null_item_trans_id.f3230ec97f
16:14:03.876520 [debug] [Thread-4  ]: Acquiring new redshift connection "test.source_of_sales_change_lcarr.not_null_item_trans_id.f3230ec97f"
16:14:03.876866 [debug] [Thread-4  ]: Began compiling node test.source_of_sales_change_lcarr.not_null_item_trans_id.f3230ec97f
16:14:03.877203 [debug] [Thread-4  ]: Compiling test.source_of_sales_change_lcarr.not_null_item_trans_id.f3230ec97f
16:14:03.874862 [debug] [Thread-3  ]: finished collecting timing info
16:14:03.890832 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.stg__fct_same_store
16:14:03.875890 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.tender
16:14:03.899179 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.tender
16:14:03.891314 [debug] [Thread-3  ]: Began running node test.source_of_sales_change_lcarr.unique_item_trans_id.31db52b29b
16:14:03.905344 [debug] [Thread-3  ]: Acquiring new redshift connection "test.source_of_sales_change_lcarr.unique_item_trans_id.31db52b29b"
16:14:03.905706 [debug] [Thread-3  ]: Began compiling node test.source_of_sales_change_lcarr.unique_item_trans_id.31db52b29b
16:14:03.906055 [debug] [Thread-3  ]: Compiling test.source_of_sales_change_lcarr.unique_item_trans_id.31db52b29b
16:14:03.904542 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.tender"
16:14:03.916220 [debug] [Thread-1  ]: finished collecting timing info
16:14:03.916763 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.tender
16:14:03.898601 [debug] [Thread-4  ]: Writing injected SQL for node "test.source_of_sales_change_lcarr.not_null_item_trans_id.f3230ec97f"
16:14:03.917194 [debug] [Thread-1  ]: finished collecting timing info
16:14:03.920596 [debug] [Thread-3  ]: Writing injected SQL for node "test.source_of_sales_change_lcarr.unique_item_trans_id.31db52b29b"
16:14:03.875508 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.transaction"
16:14:03.921794 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.tender
16:14:03.922642 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.transaction
16:14:03.924013 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.transaction
16:14:03.923453 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.calc__dim_price_index_2
16:14:03.922999 [debug] [Thread-3  ]: finished collecting timing info
16:14:03.933336 [debug] [Thread-3  ]: Began executing node test.source_of_sales_change_lcarr.unique_item_trans_id.31db52b29b
16:14:03.933775 [debug] [Thread-3  ]: finished collecting timing info
16:14:03.930984 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.transaction"
16:14:03.931839 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_2"
16:14:03.934879 [debug] [Thread-3  ]: Finished running node test.source_of_sales_change_lcarr.unique_item_trans_id.31db52b29b
16:14:03.936334 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.calc__dim_price_index_2
16:14:03.937941 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.calc__dim_price_index_2
16:14:03.936996 [debug] [Thread-2  ]: finished collecting timing info
16:14:03.943558 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.calc__dim_price_index_2"
16:14:03.944061 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.transaction
16:14:03.944972 [debug] [Thread-1  ]: finished collecting timing info
16:14:03.945372 [debug] [Thread-2  ]: finished collecting timing info
16:14:03.932204 [debug] [Thread-4  ]: finished collecting timing info
16:14:03.946961 [debug] [Thread-4  ]: Began executing node test.source_of_sales_change_lcarr.not_null_item_trans_id.f3230ec97f
16:14:03.947325 [debug] [Thread-4  ]: finished collecting timing info
16:14:03.946573 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.transaction
16:14:03.947945 [debug] [Thread-4  ]: Finished running node test.source_of_sales_change_lcarr.not_null_item_trans_id.f3230ec97f
16:14:03.945793 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.calc__dim_price_index_2
16:14:03.949381 [debug] [Thread-1  ]: finished collecting timing info
16:14:03.948722 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.trans_detail
16:14:03.950116 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.calc__dim_price_index_2
16:14:03.950856 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.trans_detail"
16:14:03.951653 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.trans_detail
16:14:03.952033 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.trans_detail
16:14:03.959822 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.trans_detail"
16:14:03.960742 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.calc__dim_price_index_3
16:14:03.961886 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_3"
16:14:03.962259 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.calc__dim_price_index_3
16:14:03.962600 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.calc__dim_price_index_3
16:14:03.961195 [debug] [Thread-3  ]: finished collecting timing info
16:14:03.968969 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.trans_detail
16:14:03.969394 [debug] [Thread-3  ]: finished collecting timing info
16:14:03.970132 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.trans_detail
16:14:03.968458 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.calc__dim_price_index_3"
16:14:03.971323 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.trans_item
16:14:03.972142 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.trans_item"
16:14:03.972665 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.trans_item
16:14:03.973033 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.trans_item
16:14:03.978659 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.trans_item"
16:14:03.979680 [debug] [Thread-1  ]: finished collecting timing info
16:14:03.980068 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.trans_item
16:14:03.980511 [debug] [Thread-1  ]: finished collecting timing info
16:14:03.981282 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.trans_item
16:14:03.981743 [debug] [Thread-1  ]: Began running node test.source_of_sales_change_lcarr.not_null_trans_detail_trans_id.39702ad66f
16:14:03.982564 [debug] [Thread-1  ]: Acquiring new redshift connection "test.source_of_sales_change_lcarr.not_null_trans_detail_trans_id.39702ad66f"
16:14:03.982980 [debug] [Thread-1  ]: Began compiling node test.source_of_sales_change_lcarr.not_null_trans_detail_trans_id.39702ad66f
16:14:03.983389 [debug] [Thread-1  ]: Compiling test.source_of_sales_change_lcarr.not_null_trans_detail_trans_id.39702ad66f
16:14:03.983738 [debug] [Thread-2  ]: Began running node test.source_of_sales_change_lcarr.unique_trans_detail_trans_id.bf19cf4015
16:14:03.992548 [debug] [Thread-2  ]: Acquiring new redshift connection "test.source_of_sales_change_lcarr.unique_trans_detail_trans_id.bf19cf4015"
16:14:03.992916 [debug] [Thread-2  ]: Began compiling node test.source_of_sales_change_lcarr.unique_trans_detail_trans_id.bf19cf4015
16:14:03.993269 [debug] [Thread-2  ]: Compiling test.source_of_sales_change_lcarr.unique_trans_detail_trans_id.bf19cf4015
16:14:03.984686 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.ast_agg__all_groupings
16:14:04.000966 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.ast_agg__all_groupings"
16:14:04.001365 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.ast_agg__all_groupings
16:14:04.001724 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.ast_agg__all_groupings
16:14:04.000256 [debug] [Thread-2  ]: Writing injected SQL for node "test.source_of_sales_change_lcarr.unique_trans_detail_trans_id.bf19cf4015"
16:14:04.010465 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.ast_agg__all_groupings"
16:14:04.011995 [debug] [Thread-3  ]: finished collecting timing info
16:14:04.012388 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.ast_agg__all_groupings
16:14:04.012758 [debug] [Thread-3  ]: finished collecting timing info
16:14:04.013510 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.ast_agg__all_groupings
16:14:04.013983 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct
16:14:04.014619 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct"
16:14:04.014975 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct
16:14:04.015662 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct
16:14:04.021031 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct"
16:14:04.022043 [debug] [Thread-2  ]: finished collecting timing info
16:14:04.022721 [debug] [Thread-2  ]: Began executing node test.source_of_sales_change_lcarr.unique_trans_detail_trans_id.bf19cf4015
16:14:04.023116 [debug] [Thread-2  ]: finished collecting timing info
16:14:03.991764 [debug] [Thread-1  ]: Writing injected SQL for node "test.source_of_sales_change_lcarr.not_null_trans_detail_trans_id.39702ad66f"
16:14:04.023910 [debug] [Thread-2  ]: Finished running node test.source_of_sales_change_lcarr.unique_trans_detail_trans_id.bf19cf4015
16:14:04.024704 [debug] [Thread-3  ]: finished collecting timing info
16:14:04.025728 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct
16:14:04.026108 [debug] [Thread-3  ]: finished collecting timing info
16:14:04.026797 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct
16:14:04.025131 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.market_agg__all_groupings
16:14:04.027202 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct
16:14:04.029792 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct"
16:14:04.030173 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct
16:14:04.030525 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct
16:14:04.029100 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.market_agg__all_groupings"
16:14:04.036664 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.market_agg__all_groupings
16:14:04.037039 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.market_agg__all_groupings
16:14:04.036166 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct"
16:14:04.028220 [debug] [Thread-1  ]: finished collecting timing info
16:14:04.045853 [debug] [Thread-1  ]: Began executing node test.source_of_sales_change_lcarr.not_null_trans_detail_trans_id.39702ad66f
16:14:04.046272 [debug] [Thread-1  ]: finished collecting timing info
16:14:04.046988 [debug] [Thread-1  ]: Finished running node test.source_of_sales_change_lcarr.not_null_trans_detail_trans_id.39702ad66f
16:14:04.045181 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.market_agg__all_groupings"
16:14:04.047400 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.national_agg__all_groupings
16:14:04.048606 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national_agg__all_groupings"
16:14:04.048988 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.national_agg__all_groupings
16:14:04.049352 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.national_agg__all_groupings
16:14:03.985203 [debug] [Thread-4  ]: finished collecting timing info
16:14:04.057484 [debug] [Thread-2  ]: finished collecting timing info
16:14:04.059941 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.market_agg__all_groupings
16:14:04.060337 [debug] [Thread-2  ]: finished collecting timing info
16:14:04.059425 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.calc__dim_price_index_3
16:14:04.061646 [debug] [Thread-4  ]: finished collecting timing info
16:14:04.061165 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.market_agg__all_groupings
16:14:04.062341 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.calc__dim_price_index_3
16:14:04.062795 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct
16:14:04.064359 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
16:14:04.064734 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct
16:14:04.065409 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct
16:14:04.063520 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.region_agg__all_groupings
16:14:04.071187 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.region_agg__all_groupings"
16:14:04.071565 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.region_agg__all_groupings
16:14:04.071907 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.region_agg__all_groupings
16:14:04.070344 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
16:14:04.078925 [debug] [Thread-2  ]: finished collecting timing info
16:14:04.079386 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct
16:14:04.079774 [debug] [Thread-2  ]: finished collecting timing info
16:14:04.080528 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct
16:14:04.080943 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct
16:14:04.081609 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct"
16:14:04.065097 [debug] [Thread-3  ]: finished collecting timing info
16:14:04.085378 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct
16:14:04.084261 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.region_agg__all_groupings"
16:14:04.084946 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct
16:14:04.085756 [debug] [Thread-3  ]: finished collecting timing info
16:14:04.058930 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national_agg__all_groupings"
16:14:04.086702 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct
16:14:04.087488 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct
16:14:04.088281 [debug] [Thread-4  ]: finished collecting timing info
16:14:04.095382 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.region_agg__all_groupings
16:14:04.095859 [debug] [Thread-4  ]: finished collecting timing info
16:14:04.096589 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.region_agg__all_groupings
16:14:04.093598 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct"
16:14:04.096993 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.ast_agg__distinct_calcs
16:14:04.099268 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.ast_agg__distinct_calcs"
16:14:04.099639 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.ast_agg__distinct_calcs
16:14:04.099992 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.ast_agg__distinct_calcs
16:14:04.098528 [debug] [Thread-2  ]: finished collecting timing info
16:14:04.112112 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct
16:14:04.112519 [debug] [Thread-2  ]: finished collecting timing info
16:14:04.097509 [debug] [Thread-1  ]: finished collecting timing info
16:14:04.113712 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.national_agg__all_groupings
16:14:04.114082 [debug] [Thread-1  ]: finished collecting timing info
16:14:04.114760 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.national_agg__all_groupings
16:14:04.113297 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct
16:14:04.115235 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs
16:14:04.116817 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs"
16:14:04.117270 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs
16:14:04.117642 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs
16:14:04.115683 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.market_agg__month_lookback
16:14:04.094585 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.ast_agg__month_lookback
16:14:04.111571 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.ast_agg__distinct_calcs"
16:14:04.130776 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback"
16:14:04.133015 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs"
16:14:04.134013 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.ast_agg__month_lookback"
16:14:04.134654 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.market_agg__month_lookback
16:14:04.135196 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.ast_agg__month_lookback
16:14:04.135647 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.market_agg__month_lookback
16:14:04.136048 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.ast_agg__month_lookback
16:14:04.136638 [debug] [Thread-4  ]: finished collecting timing info
16:14:04.141688 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.market_agg__month_lookback"
16:14:04.142189 [debug] [Thread-1  ]: finished collecting timing info
16:14:04.148321 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.ast_agg__month_lookback"
16:14:04.152118 [debug] [Thread-3  ]: finished collecting timing info
16:14:04.150464 [debug] [Thread-2  ]: finished collecting timing info
16:14:04.153079 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.market_agg__month_lookback
16:14:04.150974 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs
16:14:04.153574 [debug] [Thread-2  ]: finished collecting timing info
16:14:04.154412 [debug] [Thread-1  ]: finished collecting timing info
16:14:04.155366 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.market_agg__month_lookback
16:14:04.152600 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.ast_agg__month_lookback
16:14:04.156539 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs
16:14:04.157106 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.national_agg__distinct_calcs
16:14:04.149062 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.ast_agg__distinct_calcs
16:14:04.160018 [debug] [Thread-3  ]: finished collecting timing info
16:14:04.162336 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.national_agg__hash_base_calcs
16:14:04.166245 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
16:14:04.169358 [debug] [Thread-4  ]: finished collecting timing info
16:14:04.172308 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.ast_agg__month_lookback
16:14:04.173120 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
16:14:04.173574 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.national_agg__distinct_calcs
16:14:04.176499 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.national_agg__distinct_calcs
16:14:04.175292 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.market_agg__distinct_calcs
16:14:04.183006 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.market_agg__distinct_calcs"
16:14:04.183442 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.market_agg__distinct_calcs
16:14:04.183797 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.market_agg__distinct_calcs
16:14:04.174742 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.ast_agg__distinct_calcs
16:14:04.201846 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.market_agg__hash_base_calcs
16:14:04.205300 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.market_agg__hash_base_calcs"
16:14:04.206952 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.market_agg__hash_base_calcs
16:14:04.207348 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.market_agg__hash_base_calcs
16:14:04.206480 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
16:14:04.176033 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.national_agg__hash_base_calcs
16:14:04.204300 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.market_agg__distinct_calcs"
16:14:04.215711 [debug] [Thread-2  ]: finished collecting timing info
16:14:04.223098 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.market_agg__hash_base_calcs"
16:14:04.223645 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.national_agg__hash_base_calcs
16:14:04.224514 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.national_agg__distinct_calcs
16:14:04.238883 [debug] [Thread-2  ]: finished collecting timing info
16:14:04.237997 [debug] [Thread-4  ]: finished collecting timing info
16:14:04.240140 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.market_agg__hash_base_calcs
16:14:04.239720 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.national_agg__distinct_calcs
16:14:04.240506 [debug] [Thread-4  ]: finished collecting timing info
16:14:04.240946 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.region_agg__month_lookback
16:14:04.241823 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.market_agg__hash_base_calcs
16:14:04.242454 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.region_agg__month_lookback"
16:14:04.242890 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.national_agg__month_lookback
16:14:04.243999 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback"
16:14:04.244413 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.national_agg__month_lookback
16:14:04.244767 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.national_agg__month_lookback
16:14:04.237322 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
16:14:04.249366 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national_agg__month_lookback"
16:14:04.243362 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.region_agg__month_lookback
16:14:04.238537 [debug] [Thread-3  ]: finished collecting timing info
16:14:04.250487 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.region_agg__month_lookback
16:14:04.251116 [debug] [Thread-4  ]: finished collecting timing info
16:14:04.258060 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.national_agg__month_lookback
16:14:04.252139 [debug] [Thread-1  ]: finished collecting timing info
16:14:04.258843 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.national_agg__hash_base_calcs
16:14:04.259201 [debug] [Thread-1  ]: finished collecting timing info
16:14:04.259922 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.national_agg__hash_base_calcs
16:14:04.257514 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.region_agg__month_lookback"
16:14:04.258472 [debug] [Thread-4  ]: finished collecting timing info
16:14:04.262321 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.national_agg__month_lookback
16:14:04.262818 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.region_agg__hash_base_calcs
16:14:04.260666 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.region_agg__distinct_calcs
16:14:04.263791 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.region_agg__hash_base_calcs"
16:14:04.264430 [debug] [Thread-2  ]: finished collecting timing info
16:14:04.265178 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.region_agg__distinct_calcs"
16:14:04.266505 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.region_agg__distinct_calcs
16:14:04.266096 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.region_agg__month_lookback
16:14:04.266885 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.region_agg__distinct_calcs
16:14:04.265605 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.region_agg__hash_base_calcs
16:14:04.273511 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.region_agg__hash_base_calcs
16:14:04.267746 [debug] [Thread-2  ]: finished collecting timing info
16:14:04.287152 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.region_agg__month_lookback
16:14:04.286232 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.region_agg__distinct_calcs"
16:14:04.287598 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.market_agg__same_store_all_store
16:14:04.251775 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.market_agg__distinct_calcs
16:14:04.294604 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.region_agg__hash_base_calcs"
16:14:04.295951 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.market_agg__same_store_all_store"
16:14:04.298709 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.market_agg__same_store_all_store
16:14:04.298171 [debug] [Thread-4  ]: finished collecting timing info
16:14:04.299187 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.market_agg__same_store_all_store
16:14:04.299767 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.region_agg__hash_base_calcs
16:14:04.316645 [debug] [Thread-4  ]: finished collecting timing info
16:14:04.296882 [debug] [Thread-3  ]: finished collecting timing info
16:14:04.318788 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.market_agg__distinct_calcs
16:14:04.306429 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.market_agg__same_store_all_store"
16:14:04.319235 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.ast_agg__same_store_all_store
16:14:04.320265 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.ast_agg__same_store_all_store"
16:14:04.320626 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.ast_agg__same_store_all_store
16:14:04.320973 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.ast_agg__same_store_all_store
16:14:04.326361 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.ast_agg__same_store_all_store"
16:14:04.300235 [debug] [Thread-1  ]: finished collecting timing info
16:14:04.327798 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.region_agg__distinct_calcs
16:14:04.328259 [debug] [Thread-1  ]: finished collecting timing info
16:14:04.329105 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.region_agg__distinct_calcs
16:14:04.329568 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.ast_agg__distinct_join
16:14:04.330203 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.ast_agg__distinct_join"
16:14:04.330569 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.ast_agg__distinct_join
16:14:04.331310 [debug] [Thread-2  ]: finished collecting timing info
16:14:04.332129 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.market_agg__same_store_all_store
16:14:04.332498 [debug] [Thread-2  ]: finished collecting timing info
16:14:04.332857 [debug] [Thread-3  ]: finished collecting timing info
16:14:04.333982 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.ast_agg__same_store_all_store
16:14:04.334368 [debug] [Thread-3  ]: finished collecting timing info
16:14:04.335034 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.ast_agg__same_store_all_store
16:14:04.333576 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.market_agg__same_store_all_store
16:14:04.335448 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.national_agg__distinct_join
16:14:04.336756 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_join"
16:14:04.337106 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.national_agg__distinct_join
16:14:04.337460 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.national_agg__distinct_join
16:14:04.331750 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.ast_agg__distinct_join
16:14:04.348680 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.ast_agg__distinct_join"
16:14:04.350861 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national_agg__distinct_join"
16:14:04.336003 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.national_agg__same_store_all_store
16:14:04.352090 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"
16:14:04.352518 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.national_agg__same_store_all_store
16:14:04.352883 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.national_agg__same_store_all_store
16:14:04.358050 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"
16:14:04.359039 [debug] [Thread-2  ]: finished collecting timing info
16:14:04.359429 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.national_agg__same_store_all_store
16:14:04.359793 [debug] [Thread-2  ]: finished collecting timing info
16:14:04.360496 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.national_agg__same_store_all_store
16:14:04.361363 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.region_agg__same_store_all_store
16:14:04.362121 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.region_agg__same_store_all_store"
16:14:04.317828 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.region_agg__hash_base_calcs
16:14:04.364252 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.market_agg__distinct_join
16:14:04.365250 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.market_agg__distinct_join"
16:14:04.365630 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.market_agg__distinct_join
16:14:04.365982 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.market_agg__distinct_join
16:14:04.363264 [debug] [Thread-3  ]: finished collecting timing info
16:14:04.372637 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.national_agg__distinct_join
16:14:04.373043 [debug] [Thread-3  ]: finished collecting timing info
16:14:04.363754 [debug] [Thread-1  ]: finished collecting timing info
16:14:04.373729 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.national_agg__distinct_join
16:14:04.374752 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.region_agg__distinct_join
16:14:04.375524 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.region_agg__distinct_join"
16:14:04.375995 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.region_agg__distinct_join
16:14:04.374091 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.ast_agg__distinct_join
16:14:04.376389 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.region_agg__distinct_join
16:14:04.376795 [debug] [Thread-1  ]: finished collecting timing info
16:14:04.383114 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.ast_agg__distinct_join
16:14:04.382250 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.region_agg__distinct_join"
16:14:04.383537 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.national__big_join
16:14:04.384970 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national__big_join"
16:14:04.385380 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.national__big_join
16:14:04.385737 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.national__big_join
16:14:04.391864 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national__big_join"
16:14:04.392808 [debug] [Thread-3  ]: finished collecting timing info
16:14:04.393340 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.region_agg__distinct_join
16:14:04.393943 [debug] [Thread-3  ]: finished collecting timing info
16:14:04.394784 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.region_agg__distinct_join
16:14:04.395291 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.ast__big_join
16:14:04.396040 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.ast__big_join"
16:14:04.396403 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.ast__big_join
16:14:04.396752 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.ast__big_join
16:14:04.403239 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.ast__big_join"
16:14:04.403922 [debug] [Thread-1  ]: finished collecting timing info
16:14:04.404317 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.national__big_join
16:14:04.404699 [debug] [Thread-1  ]: finished collecting timing info
16:14:04.405410 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.national__big_join
16:14:04.406358 [debug] [Thread-3  ]: finished collecting timing info
16:14:04.406735 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.ast__big_join
16:14:04.407090 [debug] [Thread-3  ]: finished collecting timing info
16:14:04.407795 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.ast__big_join
16:14:04.408223 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.national__final_output
16:14:04.408986 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national__final_output"
16:14:04.409500 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.national__final_output
16:14:04.410229 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.national__final_output
16:14:04.409904 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.ast__final_output
16:14:04.416172 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national__final_output"
16:14:04.417909 [debug] [Thread-3  ]: finished collecting timing info
16:14:04.418302 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.national__final_output
16:14:04.418645 [debug] [Thread-3  ]: finished collecting timing info
16:14:04.419353 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.national__final_output
16:14:04.416964 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.ast__final_output"
16:14:04.419929 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.ast__final_output
16:14:04.420288 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.ast__final_output
16:14:04.425768 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.ast__final_output"
16:14:04.372111 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.market_agg__distinct_join"
16:14:04.362532 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.region_agg__same_store_all_store
16:14:04.428813 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.region_agg__same_store_all_store
16:14:04.434123 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.region_agg__same_store_all_store"
16:14:04.426773 [debug] [Thread-1  ]: finished collecting timing info
16:14:04.434794 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.ast__final_output
16:14:04.435222 [debug] [Thread-1  ]: finished collecting timing info
16:14:04.435961 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.ast__final_output
16:14:04.436789 [debug] [Thread-2  ]: finished collecting timing info
16:14:04.437175 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.region_agg__same_store_all_store
16:14:04.437543 [debug] [Thread-2  ]: finished collecting timing info
16:14:04.438233 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.region_agg__same_store_all_store
16:14:04.439074 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.region__big_join
16:14:04.439864 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.region__big_join"
16:14:04.440233 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.region__big_join
16:14:04.440666 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.region__big_join
16:14:04.446980 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.region__big_join"
16:14:04.447423 [debug] [Thread-4  ]: finished collecting timing info
16:14:04.448208 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.market_agg__distinct_join
16:14:04.448629 [debug] [Thread-4  ]: finished collecting timing info
16:14:04.449436 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.market_agg__distinct_join
16:14:04.450272 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.market__big_join
16:14:04.450971 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.market__big_join"
16:14:04.451346 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.market__big_join
16:14:04.451692 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.market__big_join
16:14:04.458315 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.market__big_join"
16:14:04.459130 [debug] [Thread-3  ]: finished collecting timing info
16:14:04.459538 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.region__big_join
16:14:04.459924 [debug] [Thread-3  ]: finished collecting timing info
16:14:04.461266 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.region__big_join
16:14:04.462155 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.region__final_output
16:14:04.463081 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.region__final_output"
16:14:04.463502 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.region__final_output
16:14:04.463874 [debug] [Thread-2  ]: finished collecting timing info
16:14:04.464211 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.region__final_output
16:14:04.464627 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.market__big_join
16:14:04.473453 [debug] [Thread-2  ]: finished collecting timing info
16:14:04.472305 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.region__final_output"
16:14:04.474406 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.market__big_join
16:14:04.477579 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.market__final_output
16:14:04.481456 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.market__final_output"
16:14:04.481890 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.market__final_output
16:14:04.482253 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.market__final_output
16:14:04.488059 [debug] [Thread-4  ]: finished collecting timing info
16:14:04.488836 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.region__final_output
16:14:04.489748 [debug] [Thread-4  ]: finished collecting timing info
16:14:04.491056 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.region__final_output
16:14:04.493304 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.market__final_output"
16:14:04.494948 [debug] [Thread-3  ]: finished collecting timing info
16:14:04.495390 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.market__final_output
16:14:04.495871 [debug] [Thread-3  ]: finished collecting timing info
16:14:04.496629 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.market__final_output
16:14:04.498731 [debug] [MainThread]: Connection 'master' was properly closed.
16:14:04.499197 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.ast__final_output' was properly closed.
16:14:04.499559 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.market__big_join' was properly closed.
16:14:04.499890 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.market__final_output' was properly closed.
16:14:04.500208 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.region__final_output' was properly closed.
16:14:04.585095 [info ] [MainThread]: Done.
16:14:04.603516 [debug] [MainThread]: Acquiring new redshift connection "generate_catalog"
16:14:04.603968 [info ] [MainThread]: Building catalog
16:14:04.627965 [debug] [ThreadPool]: Acquiring new redshift connection "cfa.information_schema"
16:14:04.654350 [debug] [ThreadPool]: Using redshift connection "cfa.information_schema"
16:14:04.654804 [debug] [ThreadPool]: On cfa.information_schema: BEGIN
16:14:04.655159 [debug] [ThreadPool]: Opening a new connection, currently in state init
16:14:04.655503 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
16:14:05.190170 [debug] [ThreadPool]: SQL status: BEGIN in 0.53 seconds
16:14:05.190665 [debug] [ThreadPool]: Using redshift connection "cfa.information_schema"
16:14:05.191011 [debug] [ThreadPool]: On cfa.information_schema: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "cfa.information_schema"} */

    

    with late_binding as (
      select
        'cfa'::varchar as table_database,
        table_schema,
        table_name,
        'LATE BINDING VIEW'::varchar as table_type,
        null::text as table_comment,

        column_name,
        column_index,
        column_type,
        null::text as column_comment
      from pg_get_late_binding_view_cols()
        cols(table_schema name, table_name name, column_name name,
             column_type varchar,
             column_index int)
        order by "column_index"
    ),

    early_binding as (
        select
            'cfa'::varchar as table_database,
            sch.nspname as table_schema,
            tbl.relname as table_name,
            case tbl.relkind
                when 'v' then 'VIEW'
                else 'BASE TABLE'
            end as table_type,
            tbl_desc.description as table_comment,
            col.attname as column_name,
            col.attnum as column_index,
            pg_catalog.format_type(col.atttypid, col.atttypmod) as column_type,
            col_desc.description as column_comment

        from pg_catalog.pg_namespace sch
        join pg_catalog.pg_class tbl on tbl.relnamespace = sch.oid
        join pg_catalog.pg_attribute col on col.attrelid = tbl.oid
        left outer join pg_catalog.pg_description tbl_desc on (tbl_desc.objoid = tbl.oid and tbl_desc.objsubid = 0)
        left outer join pg_catalog.pg_description col_desc on (col_desc.objoid = tbl.oid and col_desc.objsubid = col.attnum)
        where (upper(sch.nspname) = upper('fin_lh') or upper(sch.nspname) = upper('pos') or upper(sch.nspname) = upper('common') or upper(sch.nspname) = upper('public') or upper(sch.nspname) = upper('apps') or upper(sch.nspname) = upper('prodmix_dl'))
            and tbl.relkind in ('r', 'v', 'f', 'p')
            and col.attnum > 0
            and not col.attisdropped
    ),

    table_owners as (

        select
            'cfa'::varchar as table_database,
            schemaname as table_schema,
            tablename as table_name,
            tableowner as table_owner

        from pg_tables

        union all

        select
            'cfa'::varchar as table_database,
            schemaname as table_schema,
            viewname as table_name,
            viewowner as table_owner

        from pg_views

    ),

    unioned as (

        select *
        from early_binding

        union all

        select *
        from late_binding

    )

    select *,
        table_database || '.' || table_schema || '.' || table_name as table_id

    from unioned
    join table_owners using (table_database, table_schema, table_name)

    where (upper(table_schema) = upper('fin_lh') or upper(table_schema) = upper('pos') or upper(table_schema) = upper('common') or upper(table_schema) = upper('public') or upper(table_schema) = upper('apps') or upper(table_schema) = upper('prodmix_dl'))

    order by "column_index"
16:14:33.060248 [debug] [ThreadPool]: SQL status: SELECT in 27.87 seconds
16:14:34.834487 [debug] [ThreadPool]: Using redshift connection "cfa.information_schema"
16:14:34.834898 [debug] [ThreadPool]: On cfa.information_schema: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "cfa.information_schema"} */
select has_table_privilege(current_user, 'svv_table_info', 'SELECT') as can_select
16:14:34.960543 [debug] [ThreadPool]: SQL status: SELECT in 0.13 seconds
16:14:34.965279 [info ] [ThreadPool]: 

    Warning: The database user "crn_svc" has insufficient permissions to
    query the "svv_table_info" table. Please grant SELECT permissions on this table
    to the "crn_svc" user to fetch extended table details from Redshift.

    
16:14:37.173990 [debug] [ThreadPool]: On cfa.information_schema: ROLLBACK
16:14:37.325903 [debug] [ThreadPool]: On cfa.information_schema: Close
16:14:40.130934 [info ] [MainThread]: Catalog written to /Users/lindsay.carr/DBT/dbt_source_of_sales_change_lcarr/target/catalog.json
16:14:40.171274 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f784c4a3640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7850041d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7850041c40>]}
16:14:40.398046 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
16:14:40.398441 [debug] [MainThread]: Connection 'cfa.information_schema' was properly closed.


============================== 2022-06-27 16:16:23.729848 | c9e0b90a-cefe-4eee-8b90-c27992d4f719 ==============================
16:16:23.729848 [info ] [MainThread]: Running with dbt=1.0.4
16:16:23.730454 [debug] [MainThread]: running dbt with arguments Namespace(cls=<class 'dbt.task.serve.ServeTask'>, debug=None, defer=None, event_buffer_size=None, fail_fast=True, log_cache_events=False, log_format=None, open_browser=True, partial_parse=None, port=8080, printer_width=None, profile=None, profiles_dir='/Users/lindsay.carr/DBT/environments/redshift_discovery_crn_svc/', project_dir=None, record_timing_info=None, rpc_method=None, send_anonymous_usage_stats=None, single_threaded=False, state=None, static_parser=None, target=None, use_colors=None, use_experimental_parser=None, vars='{}', version_check=None, warn_error=None, which='serve', write_json=None)
16:16:23.730819 [debug] [MainThread]: Tracking: tracking
16:16:23.759916 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f801d463670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f801d463a60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f801d448e80>]}
16:16:23.768139 [info ] [MainThread]: Serving docs at 0.0.0.0:8080
16:16:23.769808 [info ] [MainThread]: To access from your browser, navigate to:  http://localhost:8080
16:16:23.770489 [info ] [MainThread]: 
16:16:23.771141 [info ] [MainThread]: 
16:16:23.771780 [info ] [MainThread]: Press Ctrl+C to exit.


============================== 2022-06-27 16:19:59.061397 | 539a08b6-c008-4086-92e7-e097dfb810a4 ==============================
16:19:59.061397 [info ] [MainThread]: Running with dbt=1.0.4
16:19:59.062563 [debug] [MainThread]: running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=None, defer=None, event_buffer_size=None, exclude=None, fail_fast=True, full_refresh=False, log_cache_events=False, log_format=None, partial_parse=None, printer_width=None, profile=None, profiles_dir='/Users/lindsay.carr/DBT/environments/redshift_discovery_crn_svc/', project_dir=None, record_timing_info=None, rpc_method='run', select=['national.aggregations'], selector_name=None, send_anonymous_usage_stats=None, single_threaded=False, state=None, static_parser=None, target=None, threads=None, use_colors=None, use_experimental_parser=None, vars='{}', version_check=None, warn_error=None, which='run', write_json=None)
16:19:59.062979 [debug] [MainThread]: Tracking: tracking
16:19:59.126772 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbd485a3670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbd485a3a60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbd48589190>]}
16:19:59.505187 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
16:19:59.505522 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
16:19:59.517285 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '539a08b6-c008-4086-92e7-e097dfb810a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbd485c0700>]}
16:19:59.546066 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '539a08b6-c008-4086-92e7-e097dfb810a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbd4863c940>]}
16:19:59.546617 [info ] [MainThread]: Found 58 models, 4 tests, 0 snapshots, 0 analyses, 192 macros, 0 operations, 0 seed files, 11 sources, 0 exposures, 0 metrics
16:19:59.550054 [info ] [MainThread]: 
16:19:59.550807 [debug] [MainThread]: Acquiring new redshift connection "master"
16:19:59.551894 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa"
16:19:59.566071 [debug] [ThreadPool]: Using redshift connection "list_cfa"
16:19:59.566394 [debug] [ThreadPool]: On list_cfa: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa"} */

    select distinct nspname from pg_namespace
  
16:19:59.566749 [debug] [ThreadPool]: Opening a new connection, currently in state init
16:19:59.567063 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
16:20:00.275665 [debug] [ThreadPool]: SQL status: SELECT in 0.71 seconds
16:20:00.284295 [debug] [ThreadPool]: On list_cfa: Close
16:20:00.289854 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa_public"
16:20:00.299174 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
16:20:00.299897 [debug] [ThreadPool]: On list_cfa_public: BEGIN
16:20:00.300181 [debug] [ThreadPool]: Opening a new connection, currently in state closed
16:20:00.300459 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
16:20:00.822429 [debug] [ThreadPool]: SQL status: BEGIN in 0.52 seconds
16:20:00.822891 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
16:20:00.823214 [debug] [ThreadPool]: On list_cfa_public: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa_public"} */
select
      'cfa' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'cfa' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
16:20:01.094140 [debug] [ThreadPool]: SQL status: SELECT in 0.27 seconds
16:20:01.148394 [debug] [ThreadPool]: On list_cfa_public: ROLLBACK
16:20:01.250423 [debug] [ThreadPool]: On list_cfa_public: Close
16:20:01.287978 [debug] [MainThread]: Using redshift connection "master"
16:20:01.288288 [debug] [MainThread]: On master: BEGIN
16:20:01.288501 [debug] [MainThread]: Opening a new connection, currently in state init
16:20:01.288712 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
16:20:01.814569 [debug] [MainThread]: SQL status: BEGIN in 0.53 seconds
16:20:01.815027 [debug] [MainThread]: Using redshift connection "master"
16:20:01.815301 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
16:20:02.561450 [debug] [MainThread]: SQL status: SELECT in 0.75 seconds
16:20:02.581196 [debug] [MainThread]: On master: ROLLBACK
16:20:02.681589 [debug] [MainThread]: Using redshift connection "master"
16:20:02.682013 [debug] [MainThread]: On master: BEGIN
16:20:02.778537 [debug] [MainThread]: SQL status: BEGIN in 0.1 seconds
16:20:02.779057 [debug] [MainThread]: On master: COMMIT
16:20:02.779464 [debug] [MainThread]: Using redshift connection "master"
16:20:02.780004 [debug] [MainThread]: On master: COMMIT
16:20:02.879391 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
16:20:02.879989 [debug] [MainThread]: On master: Close
16:20:02.880792 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
16:20:02.881273 [info ] [MainThread]: 
16:20:02.887452 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.national_agg__all_groupings
16:20:02.888125 [info ] [Thread-1  ]: 1 of 3 START table model public.lcarr_sosx_national_agg__all_groupings.......... [RUN]
16:20:02.889251 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national_agg__all_groupings"
16:20:02.889677 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.national_agg__all_groupings
16:20:02.890097 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.national_agg__all_groupings
16:20:02.899564 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national_agg__all_groupings"
16:20:02.902773 [debug] [Thread-1  ]: finished collecting timing info
16:20:02.903165 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.national_agg__all_groupings
16:20:03.039321 [debug] [Thread-1  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.national_agg__all_groupings"
16:20:03.043364 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__all_groupings"
16:20:03.043730 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__all_groupings: BEGIN
16:20:03.043984 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
16:20:03.044200 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
16:20:03.568209 [debug] [Thread-1  ]: SQL status: BEGIN in 0.52 seconds
16:20:03.568803 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__all_groupings"
16:20:03.569279 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__all_groupings: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__all_groupings"} */


  create  table
    "cfa"."public"."national_agg__all_groupings__dbt_tmp"
    
    
    
  as (
    with aggregations_all_groupings as (
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    location_type_code,daypart,destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    location_type_code,'All' as daypart,destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    location_type_code,'All' as daypart,'All' as destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    location_type_code,daypart,'All' as destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    'All' as location_type_code,daypart,'All' as destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    'All' as location_type_code,daypart,destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    'All' as location_type_code,'All' as daypart,destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
) 
select * from aggregations_all_groupings
  );
16:23:48.219000 [debug] [Thread-1  ]: SQL status: SELECT in 224.65 seconds
16:23:48.229368 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__all_groupings"
16:23:48.229681 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__all_groupings: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__all_groupings"} */
alter table "cfa"."public"."lcarr_sosx_national_agg__all_groupings" rename to "national_agg__all_groupings__dbt_backup"
16:23:48.278897 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.05 seconds
16:23:48.288155 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__all_groupings"
16:23:48.288899 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__all_groupings: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__all_groupings"} */
alter table "cfa"."public"."national_agg__all_groupings__dbt_tmp" rename to "lcarr_sosx_national_agg__all_groupings"
16:23:48.351763 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.06 seconds
16:23:48.376661 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__all_groupings: COMMIT
16:23:48.377341 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__all_groupings"
16:23:48.377998 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__all_groupings: COMMIT
16:23:49.652228 [debug] [Thread-1  ]: SQL status: COMMIT in 1.27 seconds
16:23:49.654030 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__all_groupings"
16:23:49.654501 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__all_groupings: BEGIN
16:23:49.703290 [debug] [Thread-1  ]: SQL status: BEGIN in 0.05 seconds
16:23:49.721735 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__all_groupings"
16:23:49.722217 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__all_groupings: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__all_groupings"} */
drop table if exists "cfa"."public"."national_agg__all_groupings__dbt_backup" cascade
16:23:49.776402 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.05 seconds
16:23:49.777641 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__all_groupings: COMMIT
16:23:49.777903 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__all_groupings"
16:23:49.778111 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__all_groupings: COMMIT
16:23:50.606347 [debug] [Thread-1  ]: SQL status: COMMIT in 0.83 seconds
16:23:50.606961 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__all_groupings"
16:23:50.607272 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__all_groupings: BEGIN
16:23:50.666876 [debug] [Thread-1  ]: SQL status: BEGIN in 0.06 seconds
16:23:50.669109 [debug] [Thread-1  ]: finished collecting timing info
16:23:50.669551 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__all_groupings: ROLLBACK
16:23:50.934552 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__all_groupings: Close
16:23:50.960455 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '539a08b6-c008-4086-92e7-e097dfb810a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbd48c04580>]}
16:23:50.961954 [info ] [Thread-1  ]: 1 of 3 OK created table model public.lcarr_sosx_national_agg__all_groupings..... [[32mSELECT[0m in 228.07s]
16:23:50.962876 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.national_agg__all_groupings
16:23:50.990457 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.national_agg__month_lookback
16:23:50.991173 [info ] [Thread-3  ]: 2 of 3 START table model public.lcarr_sosx_national_agg__month_lookback......... [RUN]
16:23:50.992124 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback"
16:23:50.992395 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.national_agg__month_lookback
16:23:50.992719 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.national_agg__month_lookback
16:23:51.002145 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national_agg__month_lookback"
16:23:51.004621 [debug] [Thread-3  ]: finished collecting timing info
16:23:51.005164 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.national_agg__month_lookback
16:23:51.163243 [debug] [Thread-3  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.national_agg__month_lookback"
16:23:51.165249 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback"
16:23:51.165741 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback: BEGIN
16:23:51.166091 [debug] [Thread-3  ]: Opening a new connection, currently in state init
16:23:51.166419 [debug] [Thread-3  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
16:23:51.785974 [debug] [Thread-3  ]: SQL status: BEGIN in 0.62 seconds
16:23:51.786616 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback"
16:23:51.787066 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__month_lookback"} */


  create  table
    "cfa"."public"."national_agg__month_lookback__dbt_tmp"
    
    
    
  as (
    with add_month_lookback as (
  select quarter,region_name,service_team_name,dma_name,location_num,
  monthend_date,'1 month' as look_back_period,
  location_type_code,daypart,destination_desc,sales_sub_total,
  transactions,purchaser_visits,credit_txn,
  total_items_promo_count,total_items_sold_count
  from "cfa"."public"."lcarr_sosx_national_agg__all_groupings"
)
select * from add_month_lookback
  );
16:23:53.657695 [debug] [Thread-3  ]: SQL status: SELECT in 1.87 seconds
16:23:53.710728 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback"
16:23:53.711899 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__month_lookback"} */
alter table "cfa"."public"."lcarr_sosx_national_agg__month_lookback" rename to "national_agg__month_lookback__dbt_backup"
16:23:53.803871 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.09 seconds
16:23:53.836793 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback"
16:23:53.837279 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__month_lookback"} */
alter table "cfa"."public"."national_agg__month_lookback__dbt_tmp" rename to "lcarr_sosx_national_agg__month_lookback"
16:23:53.887929 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.05 seconds
16:23:53.892493 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback: COMMIT
16:23:53.893051 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback"
16:23:53.894032 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback: COMMIT
16:23:55.389835 [debug] [Thread-3  ]: SQL status: COMMIT in 1.5 seconds
16:23:55.390644 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback"
16:23:55.391020 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback: BEGIN
16:23:55.440093 [debug] [Thread-3  ]: SQL status: BEGIN in 0.05 seconds
16:23:55.447669 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback"
16:23:55.448717 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__month_lookback"} */
drop table if exists "cfa"."public"."national_agg__month_lookback__dbt_backup" cascade
16:23:55.522728 [debug] [Thread-3  ]: SQL status: DROP TABLE in 0.07 seconds
16:23:55.524353 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback: COMMIT
16:23:55.524633 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback"
16:23:55.524848 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback: COMMIT
16:23:56.922773 [debug] [Thread-3  ]: SQL status: COMMIT in 1.4 seconds
16:23:56.923437 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback"
16:23:56.923721 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback: BEGIN
16:23:56.971699 [debug] [Thread-3  ]: SQL status: BEGIN in 0.05 seconds
16:23:56.972872 [debug] [Thread-3  ]: finished collecting timing info
16:23:56.973212 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback: ROLLBACK
16:23:57.072998 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback: Close
16:23:57.074282 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '539a08b6-c008-4086-92e7-e097dfb810a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbd48cd4760>]}
16:23:57.076968 [info ] [Thread-3  ]: 2 of 3 OK created table model public.lcarr_sosx_national_agg__month_lookback.... [[32mSELECT[0m in 6.08s]
16:23:57.077663 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.national_agg__month_lookback
16:23:57.078677 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.national_agg__same_store_all_store
16:23:57.079225 [info ] [Thread-2  ]: 3 of 3 START table model public.lcarr_sosx_national_agg__same_store_all_store... [RUN]
16:23:57.080019 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"
16:23:57.080298 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.national_agg__same_store_all_store
16:23:57.080541 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.national_agg__same_store_all_store
16:23:57.084349 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"
16:23:57.086476 [debug] [Thread-2  ]: finished collecting timing info
16:23:57.086843 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.national_agg__same_store_all_store
16:23:57.165141 [debug] [Thread-2  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"
16:23:57.167834 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"
16:23:57.168227 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__same_store_all_store: BEGIN
16:23:57.168490 [debug] [Thread-2  ]: Opening a new connection, currently in state init
16:23:57.168709 [debug] [Thread-2  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
16:23:57.689973 [debug] [Thread-2  ]: SQL status: BEGIN in 0.52 seconds
16:23:57.690646 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"
16:23:57.690930 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__same_store_all_store: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"} */


  create  table
    "cfa"."public"."national_agg__same_store_all_store__dbt_tmp"
    
    
    
  as (
    with transaction_same_store as (
  select a.*,b.same_store_eligible,b.actual_days,b.avail_days
  from "cfa"."public"."lcarr_sosx_national_agg__month_lookback" a
  left join "cfa"."public"."lcarr_sosx_stg__fct_same_store" b
  on a.location_num = b.location_num
  and a.look_back_period = b.look_back_period
  and a.monthend_date = b.monthend_date
  order by dma_name,location_num,look_back_period,location_type_code,daypart,destination_desc,monthend_date
), transaction_agg_all_stores as ( 
  select quarter,
  monthend_date,look_back_period,'All Stores' as same_store,
  location_type_code,daypart,destination_desc,
  sum(sales_sub_total) as sales_sub_total,
  sum(transactions) as transactions,sum(purchaser_visits) as purchaser_visits,
  sum(credit_txn) as credit_txn,sum(total_items_promo_count) as total_items_promo_count,
  sum(total_items_sold_count) as total_items_sold_count,
  sum(actual_days) as actual_days, 
  sum(avail_days) as avail_days
  from transaction_same_store
  group by 1,2,3,4,5,6,7
), transaction_agg_same_stores as ( 
  select quarter,
  monthend_date,look_back_period,'Same Stores' as same_store,
  location_type_code,daypart,destination_desc,
  sum(sales_sub_total) as sales_sub_total,
  sum(transactions) as transactions,sum(purchaser_visits) as purchaser_visits,
  sum(credit_txn) as credit_txn,sum(total_items_promo_count) as total_items_promo_count,
  sum(total_items_sold_count) as total_items_sold_count,
  sum(actual_days) as actual_days,
  sum(avail_days) as avail_days
  from transaction_same_store
  where same_store_eligible = 1 
  group by 1,2,3,4,5,6,7
), union_all_same_market_transactions as ( 
  select * from transaction_agg_all_stores
  union
  select * fromtransaction_agg_same_stores
)
select * from union_all_same_market_transactions
  );
16:23:57.793903 [debug] [Thread-2  ]: Postgres adapter: Postgres error: syntax error at or near "fromtransaction_agg_same_stores"
LINE 46:   select * fromtransaction_agg_same_stores
                    ^

16:23:57.794320 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__same_store_all_store: ROLLBACK
16:23:57.843152 [debug] [Thread-2  ]: finished collecting timing info
16:23:57.843574 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__same_store_all_store: Close
16:23:57.845494 [debug] [Thread-2  ]: Database Error in model national_agg__same_store_all_store (models/national/aggregations/national_agg__same_store_all_store.sql)
  syntax error at or near "fromtransaction_agg_same_stores"
  LINE 46:   select * fromtransaction_agg_same_stores
                      ^
  compiled SQL at target/run/source_of_sales_change_lcarr/models/national/aggregations/national_agg__same_store_all_store.sql
16:23:57.846234 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '539a08b6-c008-4086-92e7-e097dfb810a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbd48c6d430>]}
16:23:57.846875 [error] [Thread-2  ]: 3 of 3 ERROR creating table model public.lcarr_sosx_national_agg__same_store_all_store [[31mERROR[0m in 0.77s]
16:23:57.847473 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.national_agg__same_store_all_store
16:23:57.854968 [debug] [MainThread]: Acquiring new redshift connection "master"
16:23:57.855340 [error] [MainThread]: CANCEL query model.source_of_sales_change_lcarr.national_agg__all_groupings..... [[31mCANCEL[0m]
16:23:57.855772 [error] [MainThread]: CANCEL query model.source_of_sales_change_lcarr.national_agg__month_lookback.... [[31mCANCEL[0m]
16:23:57.856241 [error] [MainThread]: CANCEL query model.source_of_sales_change_lcarr.national_agg__same_store_all_store [[31mCANCEL[0m]
16:23:57.856953 [info ] [MainThread]: 
16:23:57.857356 [error] [MainThread]: [33mDatabase Error in model national_agg__same_store_all_store (models/national/aggregations/national_agg__same_store_all_store.sql)[0m
16:23:57.857792 [error] [MainThread]:   syntax error at or near "fromtransaction_agg_same_stores"
16:23:57.858232 [error] [MainThread]:   LINE 46:   select * fromtransaction_agg_same_stores
16:23:57.858796 [error] [MainThread]:                       ^
16:23:57.859178 [error] [MainThread]:   compiled SQL at target/run/source_of_sales_change_lcarr/models/national/aggregations/national_agg__same_store_all_store.sql
16:23:57.859569 [debug] [MainThread]: Connection 'master' was properly closed.
16:23:57.859791 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.national_agg__all_groupings' was properly closed.
16:23:57.859978 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.national_agg__month_lookback' was properly closed.
16:23:57.860217 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.national_agg__same_store_all_store' was properly closed.
16:23:57.861513 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbd48ce5850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbd48559130>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbd48bfeaf0>]}


============================== 2022-06-27 16:24:25.846199 | e9fad32f-2a4a-4a70-81e0-9e2597e69b31 ==============================
16:24:25.846199 [info ] [MainThread]: Running with dbt=1.0.4
16:24:25.847056 [debug] [MainThread]: running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=None, defer=None, event_buffer_size=None, exclude=None, fail_fast=True, full_refresh=False, log_cache_events=False, log_format=None, partial_parse=None, printer_width=None, profile=None, profiles_dir='/Users/lindsay.carr/DBT/environments/redshift_discovery_crn_svc/', project_dir=None, record_timing_info=None, rpc_method='run', select=['national.aggregations'], selector_name=None, send_anonymous_usage_stats=None, single_threaded=False, state=None, static_parser=None, target=None, threads=None, use_colors=None, use_experimental_parser=None, vars='{}', version_check=None, warn_error=None, which='run', write_json=None)
16:24:25.847527 [debug] [MainThread]: Tracking: tracking
16:24:25.882131 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb931ba3700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb931ba3af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb931b892b0>]}
16:24:26.094340 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
16:24:26.095187 [debug] [MainThread]: Partial parsing: updated file: source_of_sales_change_lcarr://models/national/aggregations/national_agg__same_store_all_store.sql
16:24:26.118872 [debug] [MainThread]: 1699: static parser successfully parsed national/aggregations/national_agg__same_store_all_store.sql
16:24:26.152303 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e9fad32f-2a4a-4a70-81e0-9e2597e69b31', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb931e63a00>]}
16:24:26.173634 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e9fad32f-2a4a-4a70-81e0-9e2597e69b31', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb931d08520>]}
16:24:26.174521 [info ] [MainThread]: Found 58 models, 4 tests, 0 snapshots, 0 analyses, 192 macros, 0 operations, 0 seed files, 11 sources, 0 exposures, 0 metrics
16:24:26.178202 [info ] [MainThread]: 
16:24:26.178970 [debug] [MainThread]: Acquiring new redshift connection "master"
16:24:26.180038 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa"
16:24:26.194047 [debug] [ThreadPool]: Using redshift connection "list_cfa"
16:24:26.194378 [debug] [ThreadPool]: On list_cfa: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa"} */

    select distinct nspname from pg_namespace
  
16:24:26.194624 [debug] [ThreadPool]: Opening a new connection, currently in state init
16:24:26.194930 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
16:24:26.861137 [debug] [ThreadPool]: SQL status: SELECT in 0.67 seconds
16:24:26.870104 [debug] [ThreadPool]: On list_cfa: Close
16:24:26.876201 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa_public"
16:24:26.884658 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
16:24:26.884965 [debug] [ThreadPool]: On list_cfa_public: BEGIN
16:24:26.885207 [debug] [ThreadPool]: Opening a new connection, currently in state closed
16:24:26.885418 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
16:24:27.407829 [debug] [ThreadPool]: SQL status: BEGIN in 0.52 seconds
16:24:27.408298 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
16:24:27.408706 [debug] [ThreadPool]: On list_cfa_public: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa_public"} */
select
      'cfa' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'cfa' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
16:24:27.683533 [debug] [ThreadPool]: SQL status: SELECT in 0.27 seconds
16:24:27.779136 [debug] [ThreadPool]: On list_cfa_public: ROLLBACK
16:24:27.880896 [debug] [ThreadPool]: On list_cfa_public: Close
16:24:27.937990 [debug] [MainThread]: Using redshift connection "master"
16:24:27.938314 [debug] [MainThread]: On master: BEGIN
16:24:27.938547 [debug] [MainThread]: Opening a new connection, currently in state init
16:24:27.938870 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
16:24:28.456919 [debug] [MainThread]: SQL status: BEGIN in 0.52 seconds
16:24:28.457425 [debug] [MainThread]: Using redshift connection "master"
16:24:28.457813 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
16:24:29.299261 [debug] [MainThread]: SQL status: SELECT in 0.84 seconds
16:24:29.319944 [debug] [MainThread]: On master: ROLLBACK
16:24:29.419344 [debug] [MainThread]: Using redshift connection "master"
16:24:29.419708 [debug] [MainThread]: On master: BEGIN
16:24:29.514189 [debug] [MainThread]: SQL status: BEGIN in 0.09 seconds
16:24:29.514563 [debug] [MainThread]: On master: COMMIT
16:24:29.514801 [debug] [MainThread]: Using redshift connection "master"
16:24:29.515002 [debug] [MainThread]: On master: COMMIT
16:24:29.614204 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
16:24:29.614673 [debug] [MainThread]: On master: Close
16:24:29.615452 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
16:24:29.615924 [info ] [MainThread]: 
16:24:29.623877 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.national_agg__all_groupings
16:24:29.624374 [info ] [Thread-1  ]: 1 of 3 START table model public.lcarr_sosx_national_agg__all_groupings.......... [RUN]
16:24:29.625092 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national_agg__all_groupings"
16:24:29.625336 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.national_agg__all_groupings
16:24:29.625655 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.national_agg__all_groupings
16:24:29.634916 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national_agg__all_groupings"
16:24:29.643315 [debug] [Thread-1  ]: finished collecting timing info
16:24:29.643649 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.national_agg__all_groupings
16:24:29.785650 [debug] [Thread-1  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.national_agg__all_groupings"
16:24:29.787697 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__all_groupings"
16:24:29.787973 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__all_groupings: BEGIN
16:24:29.788179 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
16:24:29.788391 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
16:24:30.306286 [debug] [Thread-1  ]: SQL status: BEGIN in 0.52 seconds
16:24:30.306769 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__all_groupings"
16:24:30.307154 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__all_groupings: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__all_groupings"} */


  create  table
    "cfa"."public"."national_agg__all_groupings__dbt_tmp"
    
    
    
  as (
    with aggregations_all_groupings as (
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    location_type_code,daypart,destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    location_type_code,'All' as daypart,destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    location_type_code,'All' as daypart,'All' as destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    location_type_code,daypart,'All' as destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    'All' as location_type_code,daypart,'All' as destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    'All' as location_type_code,daypart,destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    'All' as location_type_code,'All' as daypart,destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
    union
    select quarter,monthend_date,
    location_num,dma_name,region_name,service_team_name,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    sum(sales_sub_total) as sales_sub_total,
    count(distinct trans_id) as transactions,
    sum(visit_count) as purchaser_visits,
    sum(credit_flag) as credit_txn,
    sum(total_items_promo_count) as total_items_promo_count,
    sum(total_items_sold_count) as total_items_sold_count
    from "cfa"."public"."lcarr_sosx_trans_item"
    group by 1,2,3,4,5,6,7,8,9
) 
select * from aggregations_all_groupings
  );
16:28:15.680306 [debug] [Thread-1  ]: SQL status: SELECT in 225.37 seconds
16:28:15.691556 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__all_groupings"
16:28:15.691882 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__all_groupings: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__all_groupings"} */
alter table "cfa"."public"."lcarr_sosx_national_agg__all_groupings" rename to "national_agg__all_groupings__dbt_backup"
16:28:15.742424 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.05 seconds
16:28:15.745979 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__all_groupings"
16:28:15.746247 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__all_groupings: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__all_groupings"} */
alter table "cfa"."public"."national_agg__all_groupings__dbt_tmp" rename to "lcarr_sosx_national_agg__all_groupings"
16:28:15.796136 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.05 seconds
16:28:15.811906 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__all_groupings: COMMIT
16:28:15.812229 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__all_groupings"
16:28:15.812439 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__all_groupings: COMMIT
16:28:18.550391 [debug] [Thread-1  ]: SQL status: COMMIT in 2.74 seconds
16:28:18.551162 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__all_groupings"
16:28:18.551426 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__all_groupings: BEGIN
16:28:18.601588 [debug] [Thread-1  ]: SQL status: BEGIN in 0.05 seconds
16:28:18.610646 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__all_groupings"
16:28:18.610985 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__all_groupings: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__all_groupings"} */
drop table if exists "cfa"."public"."national_agg__all_groupings__dbt_backup" cascade
16:28:18.677697 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.07 seconds
16:28:18.679290 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__all_groupings: COMMIT
16:28:18.679592 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__all_groupings"
16:28:18.679853 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__all_groupings: COMMIT
16:28:19.574093 [debug] [Thread-1  ]: SQL status: COMMIT in 0.89 seconds
16:28:19.574650 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__all_groupings"
16:28:19.574943 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__all_groupings: BEGIN
16:28:19.624010 [debug] [Thread-1  ]: SQL status: BEGIN in 0.05 seconds
16:28:19.625112 [debug] [Thread-1  ]: finished collecting timing info
16:28:19.625466 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__all_groupings: ROLLBACK
16:28:19.724339 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__all_groupings: Close
16:28:19.726044 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e9fad32f-2a4a-4a70-81e0-9e2597e69b31', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb932574070>]}
16:28:19.726867 [info ] [Thread-1  ]: 1 of 3 OK created table model public.lcarr_sosx_national_agg__all_groupings..... [[32mSELECT[0m in 230.10s]
16:28:19.727876 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.national_agg__all_groupings
16:28:19.728730 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.national_agg__month_lookback
16:28:19.729349 [info ] [Thread-3  ]: 2 of 3 START table model public.lcarr_sosx_national_agg__month_lookback......... [RUN]
16:28:19.730101 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback"
16:28:19.730358 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.national_agg__month_lookback
16:28:19.730601 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.national_agg__month_lookback
16:28:19.735005 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national_agg__month_lookback"
16:28:19.736059 [debug] [Thread-3  ]: finished collecting timing info
16:28:19.736615 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.national_agg__month_lookback
16:28:19.814931 [debug] [Thread-3  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.national_agg__month_lookback"
16:28:19.818522 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback"
16:28:19.818904 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback: BEGIN
16:28:19.819194 [debug] [Thread-3  ]: Opening a new connection, currently in state init
16:28:19.819443 [debug] [Thread-3  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
16:28:20.485981 [debug] [Thread-3  ]: SQL status: BEGIN in 0.67 seconds
16:28:20.486511 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback"
16:28:20.486799 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__month_lookback"} */


  create  table
    "cfa"."public"."national_agg__month_lookback__dbt_tmp"
    
    
    
  as (
    with add_month_lookback as (
  select quarter,region_name,service_team_name,dma_name,location_num,
  monthend_date,'1 month' as look_back_period,
  location_type_code,daypart,destination_desc,sales_sub_total,
  transactions,purchaser_visits,credit_txn,
  total_items_promo_count,total_items_sold_count
  from "cfa"."public"."lcarr_sosx_national_agg__all_groupings"
)
select * from add_month_lookback
  );
16:28:22.646572 [debug] [Thread-3  ]: SQL status: SELECT in 2.16 seconds
16:28:22.650621 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback"
16:28:22.650911 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__month_lookback"} */
alter table "cfa"."public"."lcarr_sosx_national_agg__month_lookback" rename to "national_agg__month_lookback__dbt_backup"
16:28:22.702665 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.05 seconds
16:28:22.706190 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback"
16:28:22.706492 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__month_lookback"} */
alter table "cfa"."public"."national_agg__month_lookback__dbt_tmp" rename to "lcarr_sosx_national_agg__month_lookback"
16:28:22.760149 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.05 seconds
16:28:22.762109 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback: COMMIT
16:28:22.762369 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback"
16:28:22.762577 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback: COMMIT
16:28:23.818464 [debug] [Thread-3  ]: SQL status: COMMIT in 1.06 seconds
16:28:23.819366 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback"
16:28:23.819650 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback: BEGIN
16:28:23.868583 [debug] [Thread-3  ]: SQL status: BEGIN in 0.05 seconds
16:28:23.872227 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback"
16:28:23.872539 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__month_lookback"} */
drop table if exists "cfa"."public"."national_agg__month_lookback__dbt_backup" cascade
16:28:23.930313 [debug] [Thread-3  ]: SQL status: DROP TABLE in 0.06 seconds
16:28:23.932228 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback: COMMIT
16:28:23.932788 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback"
16:28:23.933228 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback: COMMIT
16:28:24.862681 [debug] [Thread-3  ]: SQL status: COMMIT in 0.93 seconds
16:28:24.863477 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback"
16:28:24.863763 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback: BEGIN
16:28:24.911617 [debug] [Thread-3  ]: SQL status: BEGIN in 0.05 seconds
16:28:24.912501 [debug] [Thread-3  ]: finished collecting timing info
16:28:24.912769 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback: ROLLBACK
16:28:25.015071 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback: Close
16:28:25.016560 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e9fad32f-2a4a-4a70-81e0-9e2597e69b31', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb93253c370>]}
16:28:25.017123 [info ] [Thread-3  ]: 2 of 3 OK created table model public.lcarr_sosx_national_agg__month_lookback.... [[32mSELECT[0m in 5.29s]
16:28:25.017588 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.national_agg__month_lookback
16:28:25.018545 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.national_agg__same_store_all_store
16:28:25.018966 [info ] [Thread-2  ]: 3 of 3 START table model public.lcarr_sosx_national_agg__same_store_all_store... [RUN]
16:28:25.019836 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"
16:28:25.020298 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.national_agg__same_store_all_store
16:28:25.020757 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.national_agg__same_store_all_store
16:28:25.024909 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"
16:28:25.025706 [debug] [Thread-2  ]: finished collecting timing info
16:28:25.026017 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.national_agg__same_store_all_store
16:28:25.106456 [debug] [Thread-2  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"
16:28:25.107951 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"
16:28:25.108308 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__same_store_all_store: BEGIN
16:28:25.108547 [debug] [Thread-2  ]: Opening a new connection, currently in state init
16:28:25.108763 [debug] [Thread-2  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
16:28:25.630687 [debug] [Thread-2  ]: SQL status: BEGIN in 0.52 seconds
16:28:25.631338 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"
16:28:25.631611 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__same_store_all_store: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"} */


  create  table
    "cfa"."public"."national_agg__same_store_all_store__dbt_tmp"
    
    
    
  as (
    with transaction_same_store as (
  select a.*,b.same_store_eligible,b.actual_days,b.avail_days
  from "cfa"."public"."lcarr_sosx_national_agg__month_lookback" a
  left join "cfa"."public"."lcarr_sosx_stg__fct_same_store" b
  on a.location_num = b.location_num
  and a.look_back_period = b.look_back_period
  and a.monthend_date = b.monthend_date
  order by dma_name,location_num,look_back_period,location_type_code,daypart,destination_desc,monthend_date
), transaction_agg_all_stores as ( 
  select quarter,
  monthend_date,look_back_period,'All Stores' as same_store,
  location_type_code,daypart,destination_desc,
  sum(sales_sub_total) as sales_sub_total,
  sum(transactions) as transactions,sum(purchaser_visits) as purchaser_visits,
  sum(credit_txn) as credit_txn,sum(total_items_promo_count) as total_items_promo_count,
  sum(total_items_sold_count) as total_items_sold_count,
  sum(actual_days) as actual_days, 
  sum(avail_days) as avail_days
  from transaction_same_store
  group by 1,2,3,4,5,6,7
), transaction_agg_same_stores as ( 
  select quarter,
  monthend_date,look_back_period,'Same Stores' as same_store,
  location_type_code,daypart,destination_desc,
  sum(sales_sub_total) as sales_sub_total,
  sum(transactions) as transactions,sum(purchaser_visits) as purchaser_visits,
  sum(credit_txn) as credit_txn,sum(total_items_promo_count) as total_items_promo_count,
  sum(total_items_sold_count) as total_items_sold_count,
  sum(actual_days) as actual_days,
  sum(avail_days) as avail_days
  from transaction_same_store
  where same_store_eligible = 1 
  group by 1,2,3,4,5,6,7
), union_all_same_market_transactions as ( 
  select * from transaction_agg_all_stores
  union
  select * from transaction_agg_same_stores
)
select * from union_all_same_market_transactions
  );
16:28:27.050153 [debug] [Thread-2  ]: SQL status: SELECT in 1.42 seconds
16:28:27.053961 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"
16:28:27.054284 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__same_store_all_store: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"} */
alter table "cfa"."public"."lcarr_sosx_national_agg__same_store_all_store" rename to "national_agg__same_store_all_store__dbt_backup"
16:28:27.107900 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.05 seconds
16:28:27.112736 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"
16:28:27.113027 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__same_store_all_store: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"} */
alter table "cfa"."public"."national_agg__same_store_all_store__dbt_tmp" rename to "lcarr_sosx_national_agg__same_store_all_store"
16:28:27.165131 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.05 seconds
16:28:27.167299 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__same_store_all_store: COMMIT
16:28:27.167605 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"
16:28:27.167863 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__same_store_all_store: COMMIT
16:28:28.276710 [debug] [Thread-2  ]: SQL status: COMMIT in 1.11 seconds
16:28:28.277279 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"
16:28:28.277515 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__same_store_all_store: BEGIN
16:28:28.326022 [debug] [Thread-2  ]: SQL status: BEGIN in 0.05 seconds
16:28:28.330066 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"
16:28:28.330379 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__same_store_all_store: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"} */
drop table if exists "cfa"."public"."national_agg__same_store_all_store__dbt_backup" cascade
16:28:28.382414 [debug] [Thread-2  ]: SQL status: DROP TABLE in 0.05 seconds
16:28:28.383994 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__same_store_all_store: COMMIT
16:28:28.384299 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"
16:28:28.384565 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__same_store_all_store: COMMIT
16:28:29.405153 [debug] [Thread-2  ]: SQL status: COMMIT in 1.02 seconds
16:28:29.405766 [debug] [Thread-2  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"
16:28:29.406086 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__same_store_all_store: BEGIN
16:28:29.454574 [debug] [Thread-2  ]: SQL status: BEGIN in 0.05 seconds
16:28:29.455479 [debug] [Thread-2  ]: finished collecting timing info
16:28:29.455766 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__same_store_all_store: ROLLBACK
16:28:29.557034 [debug] [Thread-2  ]: On model.source_of_sales_change_lcarr.national_agg__same_store_all_store: Close
16:28:29.558464 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e9fad32f-2a4a-4a70-81e0-9e2597e69b31', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb93260edf0>]}
16:28:29.559051 [info ] [Thread-2  ]: 3 of 3 OK created table model public.lcarr_sosx_national_agg__same_store_all_store [[32mSELECT[0m in 4.54s]
16:28:29.559515 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.national_agg__same_store_all_store
16:28:29.561770 [debug] [MainThread]: Acquiring new redshift connection "master"
16:28:29.562168 [debug] [MainThread]: Using redshift connection "master"
16:28:29.562422 [debug] [MainThread]: On master: BEGIN
16:28:29.562625 [debug] [MainThread]: Opening a new connection, currently in state closed
16:28:29.562850 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
16:28:30.097119 [debug] [MainThread]: SQL status: BEGIN in 0.53 seconds
16:28:30.098155 [debug] [MainThread]: On master: COMMIT
16:28:30.098615 [debug] [MainThread]: Using redshift connection "master"
16:28:30.098852 [debug] [MainThread]: On master: COMMIT
16:28:30.200342 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
16:28:30.200907 [debug] [MainThread]: On master: Close
16:28:30.201832 [info ] [MainThread]: 
16:28:30.202282 [info ] [MainThread]: Finished running 3 table models in 244.02s.
16:28:30.202734 [debug] [MainThread]: Connection 'master' was properly closed.
16:28:30.202963 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.national_agg__all_groupings' was properly closed.
16:28:30.203269 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.national_agg__month_lookback' was properly closed.
16:28:30.203474 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.national_agg__same_store_all_store' was properly closed.
16:28:30.218259 [info ] [MainThread]: 
16:28:30.218851 [info ] [MainThread]: [32mCompleted successfully[0m
16:28:30.219321 [info ] [MainThread]: 
16:28:30.219738 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
16:28:30.220410 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb931236160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb931236130>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb931236070>]}


============================== 2022-06-27 16:28:42.372633 | fd2dcb13-fe0f-4fe2-ae27-69e547581b30 ==============================
16:28:42.372633 [info ] [MainThread]: Running with dbt=1.0.4
16:28:42.392015 [debug] [MainThread]: running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=None, defer=None, event_buffer_size=None, exclude=None, fail_fast=True, full_refresh=False, log_cache_events=False, log_format=None, partial_parse=None, printer_width=None, profile=None, profiles_dir='/Users/lindsay.carr/DBT/environments/redshift_discovery_crn_svc/', project_dir=None, record_timing_info=None, rpc_method='run', select=['national.aggregations_distinct'], selector_name=None, send_anonymous_usage_stats=None, single_threaded=False, state=None, static_parser=None, target=None, threads=None, use_colors=None, use_experimental_parser=None, vars='{}', version_check=None, warn_error=None, which='run', write_json=None)
16:28:42.392641 [debug] [MainThread]: Tracking: tracking
16:28:42.465251 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcbe64b65e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcbe64b69d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcbe64c3220>]}
16:28:42.770976 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
16:28:42.771491 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
16:28:42.790391 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fd2dcb13-fe0f-4fe2-ae27-69e547581b30', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcbe64d3670>]}
16:28:42.824137 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fd2dcb13-fe0f-4fe2-ae27-69e547581b30', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcbe65488b0>]}
16:28:42.824801 [info ] [MainThread]: Found 58 models, 4 tests, 0 snapshots, 0 analyses, 192 macros, 0 operations, 0 seed files, 11 sources, 0 exposures, 0 metrics
16:28:42.829805 [info ] [MainThread]: 
16:28:42.830938 [debug] [MainThread]: Acquiring new redshift connection "master"
16:28:42.832824 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa"
16:28:42.852377 [debug] [ThreadPool]: Using redshift connection "list_cfa"
16:28:42.852833 [debug] [ThreadPool]: On list_cfa: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa"} */

    select distinct nspname from pg_namespace
  
16:28:42.853188 [debug] [ThreadPool]: Opening a new connection, currently in state init
16:28:42.853442 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
16:28:43.482214 [debug] [ThreadPool]: SQL status: SELECT in 0.63 seconds
16:28:43.496191 [debug] [ThreadPool]: On list_cfa: Close
16:28:43.504718 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa_public"
16:28:43.518255 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
16:28:43.518681 [debug] [ThreadPool]: On list_cfa_public: BEGIN
16:28:43.519019 [debug] [ThreadPool]: Opening a new connection, currently in state closed
16:28:43.519567 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
16:28:44.042961 [debug] [ThreadPool]: SQL status: BEGIN in 0.52 seconds
16:28:44.043449 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
16:28:44.043791 [debug] [ThreadPool]: On list_cfa_public: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa_public"} */
select
      'cfa' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'cfa' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
16:28:44.314631 [debug] [ThreadPool]: SQL status: SELECT in 0.27 seconds
16:28:44.414271 [debug] [ThreadPool]: On list_cfa_public: ROLLBACK
16:28:44.530425 [debug] [ThreadPool]: On list_cfa_public: Close
16:28:44.592512 [debug] [MainThread]: Using redshift connection "master"
16:28:44.592959 [debug] [MainThread]: On master: BEGIN
16:28:44.593293 [debug] [MainThread]: Opening a new connection, currently in state init
16:28:44.593625 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
16:28:45.108333 [debug] [MainThread]: SQL status: BEGIN in 0.52 seconds
16:28:45.108825 [debug] [MainThread]: Using redshift connection "master"
16:28:45.109180 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
16:28:45.980296 [debug] [MainThread]: SQL status: SELECT in 0.87 seconds
16:28:45.999495 [debug] [MainThread]: On master: ROLLBACK
16:28:46.126225 [debug] [MainThread]: Using redshift connection "master"
16:28:46.126909 [debug] [MainThread]: On master: BEGIN
16:28:46.222847 [debug] [MainThread]: SQL status: BEGIN in 0.1 seconds
16:28:46.223545 [debug] [MainThread]: On master: COMMIT
16:28:46.223975 [debug] [MainThread]: Using redshift connection "master"
16:28:46.224219 [debug] [MainThread]: On master: COMMIT
16:28:46.324527 [debug] [MainThread]: SQL status: COMMIT in 0.1 seconds
16:28:46.325250 [debug] [MainThread]: On master: Close
16:28:46.326183 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
16:28:46.326695 [info ] [MainThread]: 
16:28:46.343122 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct
16:28:46.343644 [info ] [Thread-1  ]: 1 of 4 START table model public.lcarr_sosx_national_agg__month_lookback_distinct [RUN]
16:28:46.344344 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
16:28:46.344579 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct
16:28:46.344864 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct
16:28:46.348236 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
16:28:46.350314 [debug] [Thread-1  ]: finished collecting timing info
16:28:46.350869 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct
16:28:46.469545 [debug] [Thread-1  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
16:28:46.473104 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
16:28:46.473485 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct: BEGIN
16:28:46.473744 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
16:28:46.473962 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
16:28:47.082696 [debug] [Thread-1  ]: SQL status: BEGIN in 0.61 seconds
16:28:47.083259 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
16:28:47.083531 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"} */


  create  table
    "cfa"."public"."national_agg__month_lookback_distinct__dbt_tmp"
    
    
    
  as (
    with one_month_set_up as (
  select a.region_name,a.service_team_name,a.dma_name,
  a.location_num,a.monthend_date,'1 month' as look_back_period,
  a.trans_id,a.cfa_one_id,a.customer_hash,
  a.location_type_code,a.daypart,a.destination_desc,
  b.same_store_eligible
  from "cfa"."public"."lcarr_sosx_trans_item" a
  inner join "cfa"."public"."lcarr_sosx_stg__fct_same_store" b
  on a.location_num = b.location_num
  and a.monthend_date = b.monthend_date 
  and b.look_back_period = '1 month'
)
select * from one_month_set_up
  );
16:29:56.753114 [debug] [Thread-1  ]: SQL status: SELECT in 69.67 seconds
16:29:56.763506 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
16:29:56.763829 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"} */
alter table "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct" rename to "national_agg__month_lookback_distinct__dbt_backup"
16:29:56.813164 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.05 seconds
16:29:56.816687 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
16:29:56.817002 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"} */
alter table "cfa"."public"."national_agg__month_lookback_distinct__dbt_tmp" rename to "lcarr_sosx_national_agg__month_lookback_distinct"
16:29:56.866945 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.05 seconds
16:29:56.882966 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct: COMMIT
16:29:56.883295 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
16:29:56.883508 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct: COMMIT
16:30:00.815845 [debug] [Thread-1  ]: SQL status: COMMIT in 3.93 seconds
16:30:00.816513 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
16:30:00.816801 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct: BEGIN
16:30:00.864510 [debug] [Thread-1  ]: SQL status: BEGIN in 0.05 seconds
16:30:00.872433 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
16:30:00.872748 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"} */
drop table if exists "cfa"."public"."national_agg__month_lookback_distinct__dbt_backup" cascade
16:30:00.925889 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.05 seconds
16:30:00.927631 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct: COMMIT
16:30:00.927937 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
16:30:00.928197 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct: COMMIT
16:30:02.485951 [debug] [Thread-1  ]: SQL status: COMMIT in 1.56 seconds
16:30:02.486528 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
16:30:02.486757 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct: BEGIN
16:30:02.534203 [debug] [Thread-1  ]: SQL status: BEGIN in 0.05 seconds
16:30:02.535205 [debug] [Thread-1  ]: finished collecting timing info
16:30:02.535534 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct: ROLLBACK
16:30:02.636050 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct: Close
16:30:02.637564 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fd2dcb13-fe0f-4fe2-ae27-69e547581b30', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcbe6b2f4f0>]}
16:30:02.638134 [info ] [Thread-1  ]: 1 of 4 OK created table model public.lcarr_sosx_national_agg__month_lookback_distinct [[32mSELECT[0m in 76.29s]
16:30:02.638626 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct
16:30:02.639396 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.national_agg__distinct_calcs
16:30:02.639818 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.national_agg__hash_base_calcs
16:30:02.640193 [info ] [Thread-3  ]: 2 of 4 START table model public.lcarr_sosx_national_agg__distinct_calcs......... [RUN]
16:30:02.640660 [info ] [Thread-4  ]: 3 of 4 START table model public.lcarr_sosx_national_agg__hash_base_calcs........ [RUN]
16:30:02.641447 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
16:30:02.642144 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
16:30:02.642427 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.national_agg__distinct_calcs
16:30:02.642675 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.national_agg__hash_base_calcs
16:30:02.642924 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.national_agg__distinct_calcs
16:30:02.643162 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.national_agg__hash_base_calcs
16:30:02.651249 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
16:30:02.659934 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
16:30:02.660887 [debug] [Thread-4  ]: finished collecting timing info
16:30:02.661152 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.national_agg__hash_base_calcs
16:30:02.690970 [debug] [Thread-3  ]: finished collecting timing info
16:30:02.696767 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.national_agg__distinct_calcs
16:30:02.810471 [debug] [Thread-4  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
16:30:02.841989 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
16:30:02.848684 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__hash_base_calcs: BEGIN
16:30:02.854210 [debug] [Thread-4  ]: Opening a new connection, currently in state init
16:30:02.857609 [debug] [Thread-3  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
16:30:02.857899 [debug] [Thread-4  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
16:30:02.860143 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
16:30:02.860627 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_calcs: BEGIN
16:30:02.861008 [debug] [Thread-3  ]: Opening a new connection, currently in state init
16:30:02.861383 [debug] [Thread-3  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
16:30:03.480037 [debug] [Thread-4  ]: SQL status: BEGIN in 0.63 seconds
16:30:03.480548 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
16:30:03.480852 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__hash_base_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"} */


  create  table
    "cfa"."public"."national_agg__hash_base_calcs__dbt_tmp"
    
    
    
  as (
    with hash_base_calcs_all_store as (
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
), hash_base_calcs_same_store as (
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
)

select * from hash_base_calcs_all_store 
union 
select * from hash_base_calcs_same_store
  );
16:30:03.524408 [debug] [Thread-3  ]: SQL status: BEGIN in 0.66 seconds
16:30:03.524838 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
16:30:03.525132 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"} */


  create  table
    "cfa"."public"."national_agg__distinct_calcs__dbt_tmp"
    
    
    
  as (
    with distinct_calcs_all_store as (
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
), distinct_calcs_same_store as (
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
)

select * from distinct_calcs_all_store 
union 
select * from distinct_calcs_same_store
  );
16:46:58.380938 [debug] [Thread-4  ]: SQL status: SELECT in 1014.9 seconds
16:46:58.387571 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
16:46:58.387908 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__hash_base_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"} */
alter table "cfa"."public"."lcarr_sosx_national_agg__hash_base_calcs" rename to "national_agg__hash_base_calcs__dbt_backup"
16:46:58.438307 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.05 seconds
16:46:58.441970 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
16:46:58.442270 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__hash_base_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"} */
alter table "cfa"."public"."national_agg__hash_base_calcs__dbt_tmp" rename to "lcarr_sosx_national_agg__hash_base_calcs"
16:46:58.490410 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.05 seconds
16:46:58.492599 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__hash_base_calcs: COMMIT
16:46:58.492862 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
16:46:58.493070 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__hash_base_calcs: COMMIT
16:47:01.760653 [debug] [Thread-4  ]: SQL status: COMMIT in 3.27 seconds
16:47:01.761274 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
16:47:01.761515 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__hash_base_calcs: BEGIN
16:47:01.809091 [debug] [Thread-4  ]: SQL status: BEGIN in 0.05 seconds
16:47:01.812533 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
16:47:01.812807 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__hash_base_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"} */
drop table if exists "cfa"."public"."national_agg__hash_base_calcs__dbt_backup" cascade
16:47:01.864419 [debug] [Thread-4  ]: SQL status: DROP TABLE in 0.05 seconds
16:47:01.865967 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__hash_base_calcs: COMMIT
16:47:01.866276 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
16:47:01.866537 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__hash_base_calcs: COMMIT
16:47:03.196848 [debug] [Thread-4  ]: SQL status: COMMIT in 1.33 seconds
16:47:03.197530 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
16:47:03.197890 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__hash_base_calcs: BEGIN
16:47:03.252878 [debug] [Thread-4  ]: SQL status: BEGIN in 0.05 seconds
16:47:03.253952 [debug] [Thread-4  ]: finished collecting timing info
16:47:03.254309 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__hash_base_calcs: ROLLBACK
16:47:03.351068 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__hash_base_calcs: Close
16:47:03.352665 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fd2dcb13-fe0f-4fe2-ae27-69e547581b30', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcbe6c11460>]}
16:47:03.353315 [info ] [Thread-4  ]: 3 of 4 OK created table model public.lcarr_sosx_national_agg__hash_base_calcs... [[32mSELECT[0m in 1020.71s]
16:47:03.353890 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.national_agg__hash_base_calcs
17:39:14.560120 [debug] [MainThread]: Acquiring new redshift connection "master"
17:39:14.599802 [debug] [MainThread]: Postgres adapter: Cancelling query 'model.source_of_sales_change_lcarr.national_agg__distinct_calcs' (1079022748)
17:39:14.602306 [debug] [MainThread]: Using redshift connection "master"
17:39:14.603387 [debug] [MainThread]: On master: BEGIN
17:39:14.603874 [debug] [MainThread]: Opening a new connection, currently in state closed
17:39:14.604580 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
17:39:24.690385 [debug] [MainThread]: Postgres adapter: Got an error when attempting to open a postgres connection: 'connection to server at "prod-useast1-discovery.c5ivm6rlzpod.us-east-1.redshift.amazonaws.com" (10.80.32.28), port 35439 failed: timeout expired
'
17:39:24.693008 [debug] [MainThread]: Postgres adapter: Error running SQL: BEGIN
17:39:24.694323 [debug] [MainThread]: Postgres adapter: Rolling back transaction.
17:39:24.705818 [debug] [MainThread]: On master: No close available on handle
17:39:24.711269 [debug] [MainThread]: Connection 'master' was properly closed.
17:39:24.711739 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct' was properly closed.
17:39:24.712154 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.national_agg__distinct_calcs' was left open.
17:39:24.713575 [debug] [MainThread]: On model.source_of_sales_change_lcarr.national_agg__distinct_calcs: ROLLBACK


============================== 2022-06-27 17:41:34.827633 | 42f2af2e-4d27-48d7-86a2-1b5606041826 ==============================
17:41:34.827633 [info ] [MainThread]: Running with dbt=1.0.4
17:41:34.829270 [debug] [MainThread]: running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=None, defer=None, event_buffer_size=None, exclude=None, fail_fast=True, full_refresh=False, log_cache_events=False, log_format=None, partial_parse=None, printer_width=None, profile=None, profiles_dir='/Users/lindsay.carr/DBT/environments/redshift_discovery_crn_svc/', project_dir=None, record_timing_info=None, rpc_method='run', select=['national.aggregations_distinct'], selector_name=None, send_anonymous_usage_stats=None, single_threaded=False, state=None, static_parser=None, target=None, threads=None, use_colors=None, use_experimental_parser=None, vars='{}', version_check=None, warn_error=None, which='run', write_json=None)
17:41:34.829830 [debug] [MainThread]: Tracking: tracking
17:41:34.906840 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7febd9463610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7febd9463a00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7febd9449c10>]}
17:41:35.157949 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
17:41:35.158501 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
17:41:35.176118 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '42f2af2e-4d27-48d7-86a2-1b5606041826', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7febd94806a0>]}
17:41:35.231412 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '42f2af2e-4d27-48d7-86a2-1b5606041826', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7febd96178e0>]}
17:41:35.232100 [info ] [MainThread]: Found 58 models, 4 tests, 0 snapshots, 0 analyses, 192 macros, 0 operations, 0 seed files, 11 sources, 0 exposures, 0 metrics
17:41:35.237353 [info ] [MainThread]: 
17:41:35.238433 [debug] [MainThread]: Acquiring new redshift connection "master"
17:41:35.240259 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa"
17:41:35.260056 [debug] [ThreadPool]: Using redshift connection "list_cfa"
17:41:35.260505 [debug] [ThreadPool]: On list_cfa: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa"} */

    select distinct nspname from pg_namespace
  
17:41:35.260841 [debug] [ThreadPool]: Opening a new connection, currently in state init
17:41:35.261266 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
17:41:36.750888 [debug] [ThreadPool]: SQL status: SELECT in 1.49 seconds
17:41:36.763961 [debug] [ThreadPool]: On list_cfa: Close
17:41:36.772552 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa_public"
17:41:36.783055 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
17:41:36.783364 [debug] [ThreadPool]: On list_cfa_public: BEGIN
17:41:36.783566 [debug] [ThreadPool]: Opening a new connection, currently in state closed
17:41:36.783758 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
17:41:37.602126 [debug] [ThreadPool]: SQL status: BEGIN in 0.82 seconds
17:41:37.602616 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
17:41:37.602996 [debug] [ThreadPool]: On list_cfa_public: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa_public"} */
select
      'cfa' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'cfa' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
17:41:37.999071 [debug] [ThreadPool]: SQL status: SELECT in 0.4 seconds
17:41:38.088573 [debug] [ThreadPool]: On list_cfa_public: ROLLBACK
17:41:38.197942 [debug] [ThreadPool]: On list_cfa_public: Close
17:41:38.251433 [debug] [MainThread]: Using redshift connection "master"
17:41:38.251866 [debug] [MainThread]: On master: BEGIN
17:41:38.252184 [debug] [MainThread]: Opening a new connection, currently in state init
17:41:38.252495 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
17:41:38.906855 [debug] [MainThread]: SQL status: BEGIN in 0.65 seconds
17:41:38.907317 [debug] [MainThread]: Using redshift connection "master"
17:41:38.907645 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
17:41:39.691181 [debug] [MainThread]: SQL status: SELECT in 0.78 seconds
17:41:39.723054 [debug] [MainThread]: On master: ROLLBACK
17:41:39.869432 [debug] [MainThread]: Using redshift connection "master"
17:41:39.872505 [debug] [MainThread]: On master: BEGIN
17:41:40.060412 [debug] [MainThread]: SQL status: BEGIN in 0.19 seconds
17:41:40.061105 [debug] [MainThread]: On master: COMMIT
17:41:40.061555 [debug] [MainThread]: Using redshift connection "master"
17:41:40.061913 [debug] [MainThread]: On master: COMMIT
17:41:40.180013 [debug] [MainThread]: SQL status: COMMIT in 0.12 seconds
17:41:40.180572 [debug] [MainThread]: On master: Close
17:41:40.181740 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
17:41:40.182461 [info ] [MainThread]: 
17:41:40.196059 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct
17:41:40.196744 [info ] [Thread-1  ]: 1 of 4 START table model public.lcarr_sosx_national_agg__month_lookback_distinct [RUN]
17:41:40.197723 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
17:41:40.198085 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct
17:41:40.198436 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct
17:41:40.203611 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
17:41:40.205307 [debug] [Thread-1  ]: finished collecting timing info
17:41:40.205738 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct
17:41:40.392251 [debug] [Thread-1  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
17:41:40.393380 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
17:41:40.393770 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct: BEGIN
17:41:40.394078 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
17:41:40.394356 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
17:41:42.447290 [debug] [Thread-1  ]: SQL status: BEGIN in 2.05 seconds
17:41:42.447854 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
17:41:42.448173 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"} */


  create  table
    "cfa"."public"."national_agg__month_lookback_distinct__dbt_tmp"
    
    
    
  as (
    with one_month_set_up as (
  select a.region_name,a.service_team_name,a.dma_name,
  a.location_num,a.monthend_date,'1 month' as look_back_period,
  a.trans_id,a.cfa_one_id,a.customer_hash,
  a.location_type_code,a.daypart,a.destination_desc,
  b.same_store_eligible
  from "cfa"."public"."lcarr_sosx_trans_item" a
  inner join "cfa"."public"."lcarr_sosx_stg__fct_same_store" b
  on a.location_num = b.location_num
  and a.monthend_date = b.monthend_date 
  and b.look_back_period = '1 month'
)
select * from one_month_set_up
  );
17:43:21.558487 [debug] [Thread-1  ]: SQL status: SELECT in 99.1 seconds
17:43:21.635880 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
17:43:21.636458 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"} */
alter table "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct" rename to "national_agg__month_lookback_distinct__dbt_backup"
18:34:32.124587 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 3070.48 seconds
18:34:32.175292 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
18:34:32.175665 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"} */
alter table "cfa"."public"."national_agg__month_lookback_distinct__dbt_tmp" rename to "lcarr_sosx_national_agg__month_lookback_distinct"
18:34:32.488417 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.31 seconds
18:34:32.562007 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct: COMMIT
18:34:32.563207 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
18:34:32.563852 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct: COMMIT
18:34:36.928041 [debug] [Thread-1  ]: SQL status: COMMIT in 4.36 seconds
18:34:36.930643 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
18:34:36.931095 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct: BEGIN
18:34:37.094893 [debug] [Thread-1  ]: SQL status: BEGIN in 0.16 seconds
18:34:37.112116 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
18:34:37.112551 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"} */
drop table if exists "cfa"."public"."national_agg__month_lookback_distinct__dbt_backup" cascade
18:34:37.396029 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.28 seconds
18:34:37.398378 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct: COMMIT
18:34:37.398791 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
18:34:37.399126 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct: COMMIT
18:34:39.988252 [debug] [Thread-1  ]: SQL status: COMMIT in 2.59 seconds
18:34:39.988798 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
18:34:39.989120 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct: BEGIN
18:34:40.394446 [debug] [Thread-1  ]: SQL status: BEGIN in 0.41 seconds
18:34:40.415090 [debug] [Thread-1  ]: finished collecting timing info
18:34:40.418381 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct: ROLLBACK
18:34:41.047182 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct: Close
18:34:41.060016 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '42f2af2e-4d27-48d7-86a2-1b5606041826', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7febd9ba4820>]}
18:34:41.064187 [info ] [Thread-1  ]: 1 of 4 OK created table model public.lcarr_sosx_national_agg__month_lookback_distinct [[32mSELECT[0m in 3180.86s]
18:34:41.067336 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct
18:34:41.087194 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.national_agg__distinct_calcs
18:34:41.088243 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.national_agg__hash_base_calcs
18:34:41.121421 [info ] [Thread-4  ]: 3 of 4 START table model public.lcarr_sosx_national_agg__hash_base_calcs........ [RUN]
18:34:41.123638 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
18:34:41.124285 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.national_agg__hash_base_calcs
18:34:41.119795 [info ] [Thread-3  ]: 2 of 4 START table model public.lcarr_sosx_national_agg__distinct_calcs......... [RUN]
18:34:41.126103 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.national_agg__hash_base_calcs
18:34:41.127554 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
18:34:41.135920 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.national_agg__distinct_calcs
18:34:41.136420 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.national_agg__distinct_calcs
18:34:41.153798 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
18:34:41.164190 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
18:34:41.168654 [debug] [Thread-4  ]: finished collecting timing info
18:34:41.169067 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.national_agg__hash_base_calcs
18:34:41.186151 [debug] [Thread-3  ]: finished collecting timing info
18:34:41.193194 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.national_agg__distinct_calcs
18:34:41.359708 [debug] [Thread-4  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
18:34:41.374886 [debug] [Thread-3  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
18:34:41.375576 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
18:34:41.375811 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__hash_base_calcs: BEGIN
18:34:41.397400 [debug] [Thread-4  ]: Opening a new connection, currently in state init
18:34:41.405231 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
18:34:41.405576 [debug] [Thread-4  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:34:41.405828 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_calcs: BEGIN
18:34:41.407104 [debug] [Thread-3  ]: Opening a new connection, currently in state init
18:34:41.407765 [debug] [Thread-3  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
18:34:43.918327 [debug] [Thread-3  ]: SQL status: BEGIN in 2.51 seconds
18:34:43.919221 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
18:34:43.920638 [debug] [Thread-4  ]: SQL status: BEGIN in 2.54 seconds
18:34:43.921116 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"} */


  create  table
    "cfa"."public"."national_agg__distinct_calcs__dbt_tmp"
    
    
    
  as (
    with distinct_calcs_all_store as (
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    group by 1,2,3,4,5,6
), distinct_calcs_same_store as (
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as unique_hashes,
    count(customer_hash) as hash_transactions
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where same_store_eligible = 1
    group by 1,2,3,4,5,6
)

select * from distinct_calcs_all_store 
union 
select * from distinct_calcs_same_store
  );
18:34:43.921503 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
18:34:43.921933 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__hash_base_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"} */


  create  table
    "cfa"."public"."national_agg__hash_base_calcs__dbt_tmp"
    
    
    
  as (
    with hash_base_calcs_all_store as (
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'All Stores' as same_store,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    group by 1,2,3,4,5,6
), hash_base_calcs_same_store as (
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,'All' as daypart,destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
    union
    select monthend_date,look_back_period,'Same Stores' as same_store,
    'All' as location_type_code,'All' as daypart,'All' as destination_desc,
    count(distinct cfa_one_id) as unique_cfa_one_ids, 
    count(distinct customer_hash) as cfa_one_hash_count
    from "cfa"."public"."lcarr_sosx_national_agg__month_lookback_distinct"
    where cfa_one_id is not null 
    and cfa_one_id <> ''
    and cfa_one_id <> ' '
    and customer_hash is not null
    and customer_hash <> ''
    and customer_hash <> ' '
    and same_store_eligible = 1
    group by 1,2,3,4,5,6
)

select * from hash_base_calcs_all_store 
union 
select * from hash_base_calcs_same_store
  );
18:51:37.108765 [debug] [Thread-4  ]: SQL status: SELECT in 1013.19 seconds
18:51:37.120755 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
18:51:37.121082 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__hash_base_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"} */
alter table "cfa"."public"."lcarr_sosx_national_agg__hash_base_calcs" rename to "national_agg__hash_base_calcs__dbt_backup"
18:51:37.384904 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.26 seconds
18:51:37.388437 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
18:51:37.388785 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__hash_base_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"} */
alter table "cfa"."public"."national_agg__hash_base_calcs__dbt_tmp" rename to "lcarr_sosx_national_agg__hash_base_calcs"
18:51:39.047154 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 1.66 seconds
18:51:39.049006 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__hash_base_calcs: COMMIT
18:51:39.049307 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
18:51:39.049521 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__hash_base_calcs: COMMIT
18:51:43.017526 [debug] [Thread-4  ]: SQL status: COMMIT in 3.97 seconds
18:51:43.018326 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
18:51:43.018574 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__hash_base_calcs: BEGIN
18:51:43.116777 [debug] [Thread-4  ]: SQL status: BEGIN in 0.1 seconds
18:51:43.120382 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
18:51:43.120699 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__hash_base_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"} */
drop table if exists "cfa"."public"."national_agg__hash_base_calcs__dbt_backup" cascade
18:51:43.359544 [debug] [Thread-4  ]: SQL status: DROP TABLE in 0.24 seconds
18:51:43.364954 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__hash_base_calcs: COMMIT
18:51:43.365756 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
18:51:43.365993 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__hash_base_calcs: COMMIT
18:51:44.569191 [debug] [Thread-4  ]: SQL status: COMMIT in 1.2 seconds
18:51:44.569900 [debug] [Thread-4  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
18:51:44.570315 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__hash_base_calcs: BEGIN
18:51:44.660302 [debug] [Thread-4  ]: SQL status: BEGIN in 0.09 seconds
18:51:44.661462 [debug] [Thread-4  ]: finished collecting timing info
18:51:44.661881 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__hash_base_calcs: ROLLBACK
18:51:44.795165 [debug] [Thread-4  ]: On model.source_of_sales_change_lcarr.national_agg__hash_base_calcs: Close
18:51:44.797826 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '42f2af2e-4d27-48d7-86a2-1b5606041826', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7febd9c606d0>]}
18:51:44.798529 [info ] [Thread-4  ]: 3 of 4 OK created table model public.lcarr_sosx_national_agg__hash_base_calcs... [[32mSELECT[0m in 1023.67s]
18:51:44.799100 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.national_agg__hash_base_calcs
19:25:29.147018 [debug] [Thread-3  ]: SQL status: SELECT in 3045.23 seconds
19:25:29.161091 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
19:25:29.161442 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"} */
alter table "cfa"."public"."lcarr_sosx_national_agg__distinct_calcs" rename to "national_agg__distinct_calcs__dbt_backup"
19:25:29.219584 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.06 seconds
19:25:29.227967 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
19:25:29.228327 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"} */
alter table "cfa"."public"."national_agg__distinct_calcs__dbt_tmp" rename to "lcarr_sosx_national_agg__distinct_calcs"
19:25:29.289566 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.06 seconds
19:25:29.291867 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_calcs: COMMIT
19:25:29.292193 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
19:25:29.292505 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_calcs: COMMIT
19:25:30.623780 [debug] [Thread-3  ]: SQL status: COMMIT in 1.33 seconds
19:25:30.624514 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
19:25:30.624808 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_calcs: BEGIN
19:25:30.680670 [debug] [Thread-3  ]: SQL status: BEGIN in 0.06 seconds
19:25:30.683999 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
19:25:30.684307 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_calcs: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"} */
drop table if exists "cfa"."public"."national_agg__distinct_calcs__dbt_backup" cascade
19:25:30.747372 [debug] [Thread-3  ]: SQL status: DROP TABLE in 0.06 seconds
19:25:30.751509 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_calcs: COMMIT
19:25:30.751874 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
19:25:30.752153 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_calcs: COMMIT
19:25:32.140542 [debug] [Thread-3  ]: SQL status: COMMIT in 1.39 seconds
19:25:32.141436 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
19:25:32.141780 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_calcs: BEGIN
19:25:32.202735 [debug] [Thread-3  ]: SQL status: BEGIN in 0.06 seconds
19:25:32.203915 [debug] [Thread-3  ]: finished collecting timing info
19:25:32.204283 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_calcs: ROLLBACK
19:25:32.314381 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_calcs: Close
19:25:32.315691 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '42f2af2e-4d27-48d7-86a2-1b5606041826', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7febd9c81e50>]}
19:25:32.318997 [info ] [Thread-3  ]: 2 of 4 OK created table model public.lcarr_sosx_national_agg__distinct_calcs.... [[32mSELECT[0m in 3051.19s]
19:25:32.319641 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.national_agg__distinct_calcs
19:25:32.321469 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.national_agg__distinct_join
19:25:32.322288 [info ] [Thread-1  ]: 4 of 4 START table model public.lcarr_sosx_national_agg__distinct_join.......... [RUN]
19:25:32.323093 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_join"
19:25:32.323676 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.national_agg__distinct_join
19:25:32.323967 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.national_agg__distinct_join
19:25:32.332155 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national_agg__distinct_join"
19:25:32.362364 [debug] [Thread-1  ]: finished collecting timing info
19:25:32.362888 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.national_agg__distinct_join
19:25:32.464689 [debug] [Thread-1  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.national_agg__distinct_join"
19:25:32.466119 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_join"
19:25:32.466407 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_join: BEGIN
19:25:32.466603 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
19:25:32.466802 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:25:33.290716 [debug] [Thread-1  ]: SQL status: BEGIN in 0.82 seconds
19:25:33.291151 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_join"
19:25:33.291434 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__distinct_join"} */


  create  table
    "cfa"."public"."national_agg__distinct_join__dbt_tmp"
    
    
    
  as (
    with distinct_calcs_join as (
    select a.monthend_date,a.look_back_period,a.same_store,
    a.location_type_code,a.daypart,a.destination_desc,
    a.unique_cfa_one_ids,a.unique_hashes,a.hash_transactions,
    cast(b.cfa_one_hash_count as decimal)/b.unique_cfa_one_ids as hash_per_customer
    from "cfa"."public"."lcarr_sosx_national_agg__distinct_calcs" a
    inner join "cfa"."public"."lcarr_sosx_national_agg__hash_base_calcs" b 
    on a.monthend_date = b.monthend_date
    and a.look_back_period = b.look_back_period
    and a.same_store = b.same_store
    and a.location_type_code = b.location_type_code 
    and a.daypart = b.daypart
    and a.destination_desc = b.destination_desc
) 
select * from distinct_calcs_join
  );
19:25:33.511557 [debug] [Thread-1  ]: SQL status: SELECT in 0.22 seconds
19:25:33.516262 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_join"
19:25:33.516578 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__distinct_join"} */
alter table "cfa"."public"."lcarr_sosx_national_agg__distinct_join" rename to "national_agg__distinct_join__dbt_backup"
19:25:33.577371 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.06 seconds
19:25:33.584563 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_join"
19:25:33.584904 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__distinct_join"} */
alter table "cfa"."public"."national_agg__distinct_join__dbt_tmp" rename to "lcarr_sosx_national_agg__distinct_join"
19:25:33.639673 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.05 seconds
19:25:33.642048 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_join: COMMIT
19:25:33.642354 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_join"
19:25:33.642562 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_join: COMMIT
19:25:34.704009 [debug] [Thread-1  ]: SQL status: COMMIT in 1.06 seconds
19:25:34.705001 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_join"
19:25:34.705328 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_join: BEGIN
19:25:34.772594 [debug] [Thread-1  ]: SQL status: BEGIN in 0.07 seconds
19:25:34.778318 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_join"
19:25:34.778749 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national_agg__distinct_join"} */
drop table if exists "cfa"."public"."national_agg__distinct_join__dbt_backup" cascade
19:25:34.850286 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.07 seconds
19:25:34.852359 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_join: COMMIT
19:25:34.852852 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_join"
19:25:34.853214 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_join: COMMIT
19:25:35.863564 [debug] [Thread-1  ]: SQL status: COMMIT in 1.01 seconds
19:25:35.863958 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_join"
19:25:35.864283 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_join: BEGIN
19:25:35.925218 [debug] [Thread-1  ]: SQL status: BEGIN in 0.06 seconds
19:25:35.926579 [debug] [Thread-1  ]: finished collecting timing info
19:25:35.926944 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_join: ROLLBACK
19:25:36.033806 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national_agg__distinct_join: Close
19:25:36.034984 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '42f2af2e-4d27-48d7-86a2-1b5606041826', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7febd9c25940>]}
19:25:36.038929 [info ] [Thread-1  ]: 4 of 4 OK created table model public.lcarr_sosx_national_agg__distinct_join..... [[32mSELECT[0m in 3.71s]
19:25:36.039781 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.national_agg__distinct_join
19:25:36.061237 [debug] [MainThread]: Acquiring new redshift connection "master"
19:25:36.067085 [debug] [MainThread]: Using redshift connection "master"
19:25:36.067850 [debug] [MainThread]: On master: BEGIN
19:25:36.068226 [debug] [MainThread]: Opening a new connection, currently in state closed
19:25:36.068571 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:25:36.820408 [debug] [MainThread]: SQL status: BEGIN in 0.75 seconds
19:25:36.820993 [debug] [MainThread]: On master: COMMIT
19:25:36.821318 [debug] [MainThread]: Using redshift connection "master"
19:25:36.821544 [debug] [MainThread]: On master: COMMIT
19:25:36.934801 [debug] [MainThread]: SQL status: COMMIT in 0.11 seconds
19:25:36.935367 [debug] [MainThread]: On master: Close
19:25:36.941378 [info ] [MainThread]: 
19:25:36.943229 [info ] [MainThread]: Finished running 4 table models in 6241.70s.
19:25:36.944219 [debug] [MainThread]: Connection 'master' was properly closed.
19:25:36.944645 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.national_agg__distinct_join' was properly closed.
19:25:36.944885 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.national_agg__hash_base_calcs' was properly closed.
19:25:36.945102 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.national_agg__distinct_calcs' was properly closed.
19:25:37.001816 [info ] [MainThread]: 
19:25:37.002647 [info ] [MainThread]: [32mCompleted successfully[0m
19:25:37.003907 [info ] [MainThread]: 
19:25:37.005448 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
19:25:37.013358 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7febd9b74040>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7febd9b58bb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7febd9b58c10>]}


============================== 2022-06-27 19:56:21.290411 | 4e48f0fb-36c7-4f9d-ad9b-e6971d9e6fae ==============================
19:56:21.290411 [info ] [MainThread]: Running with dbt=1.0.4
19:56:21.292515 [debug] [MainThread]: running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=None, defer=None, event_buffer_size=None, exclude=None, fail_fast=True, full_refresh=False, log_cache_events=False, log_format=None, partial_parse=None, printer_width=None, profile=None, profiles_dir='/Users/lindsay.carr/DBT/environments/redshift_discovery_crn_svc/', project_dir=None, record_timing_info=None, rpc_method='run', select=['national.final_output'], selector_name=None, send_anonymous_usage_stats=None, single_threaded=False, state=None, static_parser=None, target=None, threads=None, use_colors=None, use_experimental_parser=None, vars='{}', version_check=None, warn_error=None, which='run', write_json=None)
19:56:21.306063 [debug] [MainThread]: Tracking: tracking
19:56:21.426518 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f60ca3760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f60ca3d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f60ca3820>]}
19:56:21.708267 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
19:56:21.708722 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
19:56:21.727409 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4e48f0fb-36c7-4f9d-ad9b-e6971d9e6fae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f60e247f0>]}
19:56:21.782659 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4e48f0fb-36c7-4f9d-ad9b-e6971d9e6fae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f603380d0>]}
19:56:21.783362 [info ] [MainThread]: Found 58 models, 4 tests, 0 snapshots, 0 analyses, 192 macros, 0 operations, 0 seed files, 11 sources, 0 exposures, 0 metrics
19:56:21.790102 [info ] [MainThread]: 
19:56:21.791272 [debug] [MainThread]: Acquiring new redshift connection "master"
19:56:21.792574 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa"
19:56:21.812023 [debug] [ThreadPool]: Using redshift connection "list_cfa"
19:56:21.812457 [debug] [ThreadPool]: On list_cfa: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa"} */

    select distinct nspname from pg_namespace
  
19:56:21.816534 [debug] [ThreadPool]: Opening a new connection, currently in state init
19:56:21.816968 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:56:22.821660 [debug] [ThreadPool]: SQL status: SELECT in 1.01 seconds
19:56:22.835861 [debug] [ThreadPool]: On list_cfa: Close
19:56:22.844868 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa_public"
19:56:22.857381 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
19:56:22.857785 [debug] [ThreadPool]: On list_cfa_public: BEGIN
19:56:22.858372 [debug] [ThreadPool]: Opening a new connection, currently in state closed
19:56:22.858996 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:56:23.724673 [debug] [ThreadPool]: SQL status: BEGIN in 0.87 seconds
19:56:23.725267 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
19:56:23.725593 [debug] [ThreadPool]: On list_cfa_public: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa_public"} */
select
      'cfa' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'cfa' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
19:56:24.055195 [debug] [ThreadPool]: SQL status: SELECT in 0.33 seconds
19:56:24.152118 [debug] [ThreadPool]: On list_cfa_public: ROLLBACK
19:56:24.602842 [debug] [ThreadPool]: On list_cfa_public: Close
19:56:24.658922 [debug] [MainThread]: Using redshift connection "master"
19:56:24.659339 [debug] [MainThread]: On master: BEGIN
19:56:24.659652 [debug] [MainThread]: Opening a new connection, currently in state init
19:56:24.659960 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:56:25.352442 [debug] [MainThread]: SQL status: BEGIN in 0.69 seconds
19:56:25.353054 [debug] [MainThread]: Using redshift connection "master"
19:56:25.353366 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
19:56:26.144607 [debug] [MainThread]: SQL status: SELECT in 0.79 seconds
19:56:26.164489 [debug] [MainThread]: On master: ROLLBACK
19:56:26.267729 [debug] [MainThread]: Using redshift connection "master"
19:56:26.268645 [debug] [MainThread]: On master: BEGIN
19:56:26.389884 [debug] [MainThread]: SQL status: BEGIN in 0.12 seconds
19:56:26.390440 [debug] [MainThread]: On master: COMMIT
19:56:26.390839 [debug] [MainThread]: Using redshift connection "master"
19:56:26.391190 [debug] [MainThread]: On master: COMMIT
19:56:26.500447 [debug] [MainThread]: SQL status: COMMIT in 0.11 seconds
19:56:26.501586 [debug] [MainThread]: On master: Close
19:56:26.502624 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
19:56:26.503102 [info ] [MainThread]: 
19:56:26.512082 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.national__big_join
19:56:26.512687 [info ] [Thread-1  ]: 1 of 2 START table model public.lcarr_sosx_national__big_join................... [RUN]
19:56:26.514091 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national__big_join"
19:56:26.514495 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.national__big_join
19:56:26.514909 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.national__big_join
19:56:26.524887 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national__big_join"
19:56:26.527633 [debug] [Thread-1  ]: finished collecting timing info
19:56:26.528148 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.national__big_join
19:56:26.658724 [debug] [Thread-1  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.national__big_join"
19:56:26.660467 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national__big_join"
19:56:26.660767 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national__big_join: BEGIN
19:56:26.660963 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
19:56:26.661159 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:56:27.418839 [debug] [Thread-1  ]: SQL status: BEGIN in 0.76 seconds
19:56:27.419391 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national__big_join"
19:56:27.419782 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national__big_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national__big_join"} */


  create  table
    "cfa"."public"."national__big_join__dbt_tmp"
    
    
    
  as (
    with big_join as ( 
  select a.*, e.unique_cfa_one_ids, e.unique_hashes, e.hash_transactions, e.hash_per_customer,
  b.price_index, 
  d.previous_year_monthend_date
  from "cfa"."public"."lcarr_sosx_national_agg__same_store_all_store" a
  inner join "cfa"."public"."lcarr_sosx_calc__dim_price_index_3" b
  on a.look_back_period = b.look_back_period
  and a.monthend_date = b.monthend_date
  and a.same_store = b.same_store
  inner join "cfa"."public"."lcarr_sosx_calc__dim_monthend_date" d
  on a.monthend_date = d.monthend_date
  inner join "cfa"."public"."lcarr_sosx_national_agg__distinct_join" e
  on a.monthend_date = e.monthend_date
  and a.look_back_period = e.look_back_period
  and a.same_store = e.same_store
  and a.location_type_code = e.location_type_code
  and a.daypart = e.daypart
  and a.destination_desc = e.destination_desc
)
select * from big_join
  );
19:56:50.557825 [debug] [Thread-1  ]: SQL status: SELECT in 23.14 seconds
19:56:50.572210 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national__big_join"
19:56:50.573187 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national__big_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national__big_join"} */
alter table "cfa"."public"."lcarr_sosx_national__big_join" rename to "national__big_join__dbt_backup"
19:56:50.670243 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.1 seconds
19:56:50.674746 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national__big_join"
19:56:50.675774 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national__big_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national__big_join"} */
alter table "cfa"."public"."national__big_join__dbt_tmp" rename to "lcarr_sosx_national__big_join"
19:56:50.742271 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.07 seconds
19:56:50.758641 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national__big_join: COMMIT
19:56:50.758949 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national__big_join"
19:56:50.759147 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national__big_join: COMMIT
19:56:51.718020 [debug] [Thread-1  ]: SQL status: COMMIT in 0.96 seconds
19:56:51.718685 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national__big_join"
19:56:51.718956 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national__big_join: BEGIN
19:56:51.782358 [debug] [Thread-1  ]: SQL status: BEGIN in 0.06 seconds
19:56:51.789267 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national__big_join"
19:56:51.789555 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national__big_join: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national__big_join"} */
drop table if exists "cfa"."public"."national__big_join__dbt_backup" cascade
19:56:51.852335 [debug] [Thread-1  ]: SQL status: DROP TABLE in 0.06 seconds
19:56:51.854083 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national__big_join: COMMIT
19:56:51.854441 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national__big_join"
19:56:51.854711 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national__big_join: COMMIT
19:56:52.821347 [debug] [Thread-1  ]: SQL status: COMMIT in 0.97 seconds
19:56:52.821799 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.national__big_join"
19:56:52.822149 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national__big_join: BEGIN
19:56:52.881042 [debug] [Thread-1  ]: SQL status: BEGIN in 0.06 seconds
19:56:52.881951 [debug] [Thread-1  ]: finished collecting timing info
19:56:52.882236 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national__big_join: ROLLBACK
19:56:53.008616 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.national__big_join: Close
19:56:53.009770 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4e48f0fb-36c7-4f9d-ad9b-e6971d9e6fae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f61303820>]}
19:56:53.010313 [info ] [Thread-1  ]: 1 of 2 OK created table model public.lcarr_sosx_national__big_join.............. [[32mSELECT[0m in 26.50s]
19:56:53.010793 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.national__big_join
19:56:53.013228 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.national__final_output
19:56:53.014018 [info ] [Thread-3  ]: 2 of 2 START table model public.lcarr_sosx_national__final_output............... [RUN]
19:56:53.014995 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national__final_output"
19:56:53.015373 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.national__final_output
19:56:53.015689 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.national__final_output
19:56:53.021066 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national__final_output"
19:56:53.022012 [debug] [Thread-3  ]: finished collecting timing info
19:56:53.022360 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.national__final_output
19:56:53.093727 [debug] [Thread-3  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.national__final_output"
19:56:53.096937 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national__final_output"
19:56:53.097291 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national__final_output: BEGIN
19:56:53.097545 [debug] [Thread-3  ]: Opening a new connection, currently in state init
19:56:53.097979 [debug] [Thread-3  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:56:53.990171 [debug] [Thread-3  ]: SQL status: BEGIN in 0.89 seconds
19:56:53.990735 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national__final_output"
19:56:53.991017 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national__final_output: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national__final_output"} */


  create  table
    "cfa"."public"."national__final_output__dbt_tmp"
    
    
    
  as (
    with twentytwo as (
select *
from "cfa"."public"."lcarr_sosx_national__big_join" 
where monthend_date = cast('02-28-2022' as date) 
), twentyone as ( 
select * 
from "cfa"."public"."lcarr_sosx_national__big_join"
where monthend_date = cast('02-28-2021' as date)
) 

select a.quarter,
a.look_back_period,a.same_store,
'National' as geolevel, 
'National' as geolevel_detail,
a.location_type_code,a.daypart,a.destination_desc,
a.monthend_date as current_monthend_date,
a.sales_sub_total as current_sales_sub_total,
a.transactions as current_transactions,
a.purchaser_visits as current_purchaser_visits,
a.credit_txn as current_credit_txn,
a.total_items_promo_count as current_total_items_promo_count,
a.total_items_sold_count as current_total_items_sold_count,
a.actual_days as current_actual_days,
a.avail_days as current_avail_days,
a.price_index as current_price_index,
a.unique_cfa_one_ids as current_unique_cfa_one_ids,
a.unique_hashes as current_unique_hashes,
a.hash_transactions as current_hash_transactions,
a.hash_per_customer as current_hash_per_customer,
a.previous_year_monthend_date as check_date,
b.monthend_date as previous_monthend_date,
b.sales_sub_total as previous_sales_sub_total,
b.transactions as previous_transactions,
b.purchaser_visits as previous_purchaser_visits,
b.credit_txn as previous_credit_txn,
b.total_items_promo_count as previous_total_items_promo_count,
b.total_items_sold_count as previous_total_items_sold_count,
b.actual_days as previous_actual_days,
b.avail_days as previous_avail_days,
b.price_index as previous_price_index,
b.unique_cfa_one_ids as previous_unique_cfa_one_ids,
b.unique_hashes as previous_unique_hashes,
b.hash_transactions as previous_hash_transactions,
b.hash_per_customer as previous_hash_per_customer
from twentytwo a 
inner join twentyone b
on a.look_back_period = b.look_back_period 
and a.same_store = b.same_store 
and a.location_type_code = b.location_type_code 
and a.daypart = b.daypart
and a.destination_desc = b.destination_desc
and a.previous_year_monthend_date = b.monthend_date
order by same_store,location_type_code,daypart,destination_desc
  );
19:57:03.609522 [debug] [Thread-3  ]: SQL status: SELECT in 9.62 seconds
19:57:03.615242 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national__final_output"
19:57:03.615575 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national__final_output: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national__final_output"} */
alter table "cfa"."public"."lcarr_sosx_national__final_output" rename to "national__final_output__dbt_backup"
19:57:03.678085 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.06 seconds
19:57:03.682047 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national__final_output"
19:57:03.682391 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national__final_output: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national__final_output"} */
alter table "cfa"."public"."national__final_output__dbt_tmp" rename to "lcarr_sosx_national__final_output"
19:57:03.738902 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.06 seconds
19:57:03.741232 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national__final_output: COMMIT
19:57:03.741556 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national__final_output"
19:57:03.741780 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national__final_output: COMMIT
19:57:05.073732 [debug] [Thread-3  ]: SQL status: COMMIT in 1.33 seconds
19:57:05.074388 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national__final_output"
19:57:05.074688 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national__final_output: BEGIN
19:57:05.139254 [debug] [Thread-3  ]: SQL status: BEGIN in 0.06 seconds
19:57:05.142881 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national__final_output"
19:57:05.143157 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national__final_output: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.national__final_output"} */
drop table if exists "cfa"."public"."national__final_output__dbt_backup" cascade
19:57:05.231678 [debug] [Thread-3  ]: SQL status: DROP TABLE in 0.09 seconds
19:57:05.233836 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national__final_output: COMMIT
19:57:05.234158 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national__final_output"
19:57:05.234386 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national__final_output: COMMIT
19:57:06.813937 [debug] [Thread-3  ]: SQL status: COMMIT in 1.58 seconds
19:57:06.814521 [debug] [Thread-3  ]: Using redshift connection "model.source_of_sales_change_lcarr.national__final_output"
19:57:06.814740 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national__final_output: BEGIN
19:57:06.903995 [debug] [Thread-3  ]: SQL status: BEGIN in 0.09 seconds
19:57:06.904952 [debug] [Thread-3  ]: finished collecting timing info
19:57:06.905307 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national__final_output: ROLLBACK
19:57:07.020545 [debug] [Thread-3  ]: On model.source_of_sales_change_lcarr.national__final_output: Close
19:57:07.021938 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4e48f0fb-36c7-4f9d-ad9b-e6971d9e6fae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f613d5af0>]}
19:57:07.023451 [info ] [Thread-3  ]: 2 of 2 OK created table model public.lcarr_sosx_national__final_output.......... [[32mSELECT[0m in 14.01s]
19:57:07.023956 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.national__final_output
19:57:07.025733 [debug] [MainThread]: Acquiring new redshift connection "master"
19:57:07.026179 [debug] [MainThread]: Using redshift connection "master"
19:57:07.026431 [debug] [MainThread]: On master: BEGIN
19:57:07.026739 [debug] [MainThread]: Opening a new connection, currently in state closed
19:57:07.027143 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
19:57:07.959459 [debug] [MainThread]: SQL status: BEGIN in 0.93 seconds
19:57:07.959980 [debug] [MainThread]: On master: COMMIT
19:57:07.960296 [debug] [MainThread]: Using redshift connection "master"
19:57:07.960551 [debug] [MainThread]: On master: COMMIT
19:57:08.078810 [debug] [MainThread]: SQL status: COMMIT in 0.12 seconds
19:57:08.079249 [debug] [MainThread]: On master: Close
19:57:08.080145 [info ] [MainThread]: 
19:57:08.080650 [info ] [MainThread]: Finished running 2 table models in 46.29s.
19:57:08.081365 [debug] [MainThread]: Connection 'master' was properly closed.
19:57:08.083189 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.national__big_join' was properly closed.
19:57:08.083880 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.national__final_output' was properly closed.
19:57:08.100158 [info ] [MainThread]: 
19:57:08.101001 [info ] [MainThread]: [32mCompleted successfully[0m
19:57:08.101830 [info ] [MainThread]: 
19:57:08.103285 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
19:57:08.103817 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f60e01f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f60e01940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f60e01e80>]}


============================== 2022-06-27 20:12:20.988608 | 545b84e3-0b40-4b7d-af55-f3d012e69a16 ==============================
20:12:20.988608 [info ] [MainThread]: Running with dbt=1.0.4
20:12:20.990245 [debug] [MainThread]: running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=None, defer=None, event_buffer_size=None, exclude=None, fail_fast=True, full_refresh=False, log_cache_events=False, log_format=None, partial_parse=None, printer_width=None, profile=None, profiles_dir='/Users/lindsay.carr/DBT/environments/redshift_discovery_crn_svc/', project_dir=None, record_timing_info=None, rpc_method='run', select=['final_output_all'], selector_name=None, send_anonymous_usage_stats=None, single_threaded=False, state=None, static_parser=None, target=None, threads=None, use_colors=None, use_experimental_parser=None, vars='{}', version_check=None, warn_error=None, which='run', write_json=None)
20:12:20.990770 [debug] [MainThread]: Tracking: tracking
20:12:21.058817 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd61d4a3670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd61d4a3a60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd61d49e0a0>]}
20:12:21.397274 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
20:12:21.398585 [debug] [MainThread]: Partial parsing: added file: source_of_sales_change_lcarr://models/final_output_all.sql
20:12:21.457023 [debug] [MainThread]: 1699: static parser successfully parsed final_output_all.sql
20:12:21.553412 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '545b84e3-0b40-4b7d-af55-f3d012e69a16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd61d762970>]}
20:12:21.613550 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '545b84e3-0b40-4b7d-af55-f3d012e69a16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd61d608370>]}
20:12:21.614289 [info ] [MainThread]: Found 59 models, 4 tests, 0 snapshots, 0 analyses, 192 macros, 0 operations, 0 seed files, 11 sources, 0 exposures, 0 metrics
20:12:21.620836 [info ] [MainThread]: 
20:12:21.623314 [debug] [MainThread]: Acquiring new redshift connection "master"
20:12:21.624969 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa"
20:12:21.650896 [debug] [ThreadPool]: Using redshift connection "list_cfa"
20:12:21.651420 [debug] [ThreadPool]: On list_cfa: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa"} */

    select distinct nspname from pg_namespace
  
20:12:21.651773 [debug] [ThreadPool]: Opening a new connection, currently in state init
20:12:21.652218 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
20:12:22.764435 [debug] [ThreadPool]: SQL status: SELECT in 1.11 seconds
20:12:22.778615 [debug] [ThreadPool]: On list_cfa: Close
20:12:22.786717 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa_public"
20:12:22.795882 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
20:12:22.796199 [debug] [ThreadPool]: On list_cfa_public: BEGIN
20:12:22.796450 [debug] [ThreadPool]: Opening a new connection, currently in state closed
20:12:22.796783 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
20:12:23.679526 [debug] [ThreadPool]: SQL status: BEGIN in 0.88 seconds
20:12:23.680085 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
20:12:23.680379 [debug] [ThreadPool]: On list_cfa_public: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa_public"} */
select
      'cfa' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'cfa' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
20:12:23.962291 [debug] [ThreadPool]: SQL status: SELECT in 0.28 seconds
20:12:24.020594 [debug] [ThreadPool]: On list_cfa_public: ROLLBACK
20:12:24.131179 [debug] [ThreadPool]: On list_cfa_public: Close
20:12:24.172546 [debug] [MainThread]: Using redshift connection "master"
20:12:24.172865 [debug] [MainThread]: On master: BEGIN
20:12:24.173069 [debug] [MainThread]: Opening a new connection, currently in state init
20:12:24.173288 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
20:12:24.902851 [debug] [MainThread]: SQL status: BEGIN in 0.73 seconds
20:12:24.903333 [debug] [MainThread]: Using redshift connection "master"
20:12:24.903607 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
20:12:26.162272 [debug] [MainThread]: SQL status: SELECT in 1.26 seconds
20:12:26.183745 [debug] [MainThread]: On master: ROLLBACK
20:12:26.291219 [debug] [MainThread]: Using redshift connection "master"
20:12:26.291782 [debug] [MainThread]: On master: BEGIN
20:12:26.412287 [debug] [MainThread]: SQL status: BEGIN in 0.12 seconds
20:12:26.412859 [debug] [MainThread]: On master: COMMIT
20:12:26.413362 [debug] [MainThread]: Using redshift connection "master"
20:12:26.413750 [debug] [MainThread]: On master: COMMIT
20:12:26.530356 [debug] [MainThread]: SQL status: COMMIT in 0.12 seconds
20:12:26.531124 [debug] [MainThread]: On master: Close
20:12:26.532151 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
20:12:26.532669 [info ] [MainThread]: 
20:12:26.540938 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.final_output_all
20:12:26.541467 [info ] [Thread-1  ]: 1 of 1 START view model public.lcarr_sosx_final_output_all...................... [RUN]
20:12:26.542634 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.final_output_all"
20:12:26.542958 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.final_output_all
20:12:26.543311 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.final_output_all
20:12:26.552350 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.final_output_all"
20:12:26.553549 [debug] [Thread-1  ]: finished collecting timing info
20:12:26.553957 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.final_output_all
20:12:26.693111 [debug] [Thread-1  ]: Writing runtime SQL for node "model.source_of_sales_change_lcarr.final_output_all"
20:12:26.693959 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.final_output_all"
20:12:26.694319 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.final_output_all: BEGIN
20:12:26.694727 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
20:12:26.695130 [debug] [Thread-1  ]: Redshift adapter: Connecting to Redshift using 'database' credentials
20:12:27.479914 [debug] [Thread-1  ]: SQL status: BEGIN in 0.79 seconds
20:12:27.480445 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.final_output_all"
20:12:27.480725 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.final_output_all: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.final_output_all"} */


  create view "cfa"."public"."final_output_all__dbt_tmp" as (
    with final_output_all as ( 
    select * 
    from "cfa"."public"."lcarr_sosx_national__final_output"
    union 
    select * 
    from "cfa"."public"."lcarr_sosx_region__final_output"
    union 
    select * 
    from "cfa"."public"."lcarr_sosx_ast__final_output"
    union
    select * 
    from "cfa"."public"."lcarr_sosx_market__final_output"
) 

select * from final_output_all
  ) with no schema binding;

20:12:27.563714 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.08 seconds
20:12:27.573471 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.final_output_all"
20:12:27.573786 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.final_output_all: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.final_output_all"} */
alter table "cfa"."public"."final_output_all__dbt_tmp" rename to "lcarr_sosx_final_output_all"
20:12:27.630475 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.06 seconds
20:12:27.641819 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.final_output_all: COMMIT
20:12:27.642148 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.final_output_all"
20:12:27.642383 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.final_output_all: COMMIT
20:12:28.856309 [debug] [Thread-1  ]: SQL status: COMMIT in 1.21 seconds
20:12:28.857066 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.final_output_all"
20:12:28.857360 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.final_output_all: BEGIN
20:12:28.915957 [debug] [Thread-1  ]: SQL status: BEGIN in 0.06 seconds
20:12:28.922425 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.final_output_all"
20:12:28.922803 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.final_output_all: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "node_id": "model.source_of_sales_change_lcarr.final_output_all"} */
drop view if exists "cfa"."public"."final_output_all__dbt_backup" cascade
20:12:28.979230 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.06 seconds
20:12:28.980545 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.final_output_all: COMMIT
20:12:28.980815 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.final_output_all"
20:12:28.981046 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.final_output_all: COMMIT
20:12:29.109833 [debug] [Thread-1  ]: SQL status: COMMIT in 0.13 seconds
20:12:29.110414 [debug] [Thread-1  ]: Using redshift connection "model.source_of_sales_change_lcarr.final_output_all"
20:12:29.110900 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.final_output_all: BEGIN
20:12:29.167826 [debug] [Thread-1  ]: SQL status: BEGIN in 0.06 seconds
20:12:29.168863 [debug] [Thread-1  ]: finished collecting timing info
20:12:29.169219 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.final_output_all: ROLLBACK
20:12:29.402829 [debug] [Thread-1  ]: On model.source_of_sales_change_lcarr.final_output_all: Close
20:12:29.405028 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '545b84e3-0b40-4b7d-af55-f3d012e69a16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd61dd1abe0>]}
20:12:29.405696 [info ] [Thread-1  ]: 1 of 1 OK created view model public.lcarr_sosx_final_output_all................. [[32mCREATE VIEW[0m in 2.86s]
20:12:29.406203 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.final_output_all
20:12:29.408267 [debug] [MainThread]: Acquiring new redshift connection "master"
20:12:29.408718 [debug] [MainThread]: Using redshift connection "master"
20:12:29.408972 [debug] [MainThread]: On master: BEGIN
20:12:29.409188 [debug] [MainThread]: Opening a new connection, currently in state closed
20:12:29.409419 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
20:12:30.191692 [debug] [MainThread]: SQL status: BEGIN in 0.78 seconds
20:12:30.192292 [debug] [MainThread]: On master: COMMIT
20:12:30.192546 [debug] [MainThread]: Using redshift connection "master"
20:12:30.192755 [debug] [MainThread]: On master: COMMIT
20:12:30.428863 [debug] [MainThread]: SQL status: COMMIT in 0.24 seconds
20:12:30.429377 [debug] [MainThread]: On master: Close
20:12:30.430289 [info ] [MainThread]: 
20:12:30.430821 [info ] [MainThread]: Finished running 1 view model in 8.81s.
20:12:30.431494 [debug] [MainThread]: Connection 'master' was properly closed.
20:12:30.431938 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.final_output_all' was properly closed.
20:12:30.457560 [info ] [MainThread]: 
20:12:30.458234 [info ] [MainThread]: [32mCompleted successfully[0m
20:12:30.459608 [info ] [MainThread]: 
20:12:30.460180 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
20:12:30.460984 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd61d608670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd61d44bd30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd61d709550>]}


============================== 2022-06-27 20:28:35.033503 | 0d22697c-46a8-408f-926c-3ffd17a42bf0 ==============================
20:28:35.033503 [info ] [MainThread]: Running with dbt=1.0.4
20:28:35.063100 [debug] [MainThread]: running dbt with arguments Namespace(cls=<class 'dbt.task.generate.GenerateTask'>, compile=True, debug=None, defer=None, event_buffer_size=None, exclude=None, fail_fast=True, log_cache_events=False, log_format=None, partial_parse=None, printer_width=None, profile=None, profiles_dir='/Users/lindsay.carr/DBT/environments/redshift_discovery_crn_svc/', project_dir=None, record_timing_info=None, rpc_method='docs.generate', select=None, selector_name=None, send_anonymous_usage_stats=None, single_threaded=False, state=None, static_parser=None, target=None, threads=None, use_colors=None, use_experimental_parser=None, vars='{}', version_check=None, warn_error=None, which='generate', write_json=None)
20:28:35.064518 [debug] [MainThread]: Tracking: tracking
20:28:35.196894 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feb1b4a3610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feb1b4a3a00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feb1b488c10>]}
20:28:35.957731 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
20:28:35.958582 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
20:28:35.981732 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0d22697c-46a8-408f-926c-3ffd17a42bf0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feb1b4c2a30>]}
20:28:36.060512 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0d22697c-46a8-408f-926c-3ffd17a42bf0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feb1aac4460>]}
20:28:36.061215 [info ] [MainThread]: Found 59 models, 4 tests, 0 snapshots, 0 analyses, 192 macros, 0 operations, 0 seed files, 11 sources, 0 exposures, 0 metrics
20:28:36.071108 [info ] [MainThread]: 
20:28:36.072526 [debug] [MainThread]: Acquiring new redshift connection "master"
20:28:36.081076 [debug] [ThreadPool]: Acquiring new redshift connection "list_cfa_public"
20:28:36.104759 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
20:28:36.105219 [debug] [ThreadPool]: On list_cfa_public: BEGIN
20:28:36.105554 [debug] [ThreadPool]: Opening a new connection, currently in state init
20:28:36.105910 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
20:28:37.686758 [debug] [ThreadPool]: SQL status: BEGIN in 1.58 seconds
20:28:37.687523 [debug] [ThreadPool]: Using redshift connection "list_cfa_public"
20:28:37.687880 [debug] [ThreadPool]: On list_cfa_public: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "list_cfa_public"} */
select
      'cfa' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'cfa' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
  
20:28:38.219749 [debug] [ThreadPool]: SQL status: SELECT in 0.53 seconds
20:28:38.320923 [debug] [ThreadPool]: On list_cfa_public: ROLLBACK
20:28:38.437777 [debug] [ThreadPool]: On list_cfa_public: Close
20:28:38.506247 [debug] [MainThread]: Using redshift connection "master"
20:28:38.506707 [debug] [MainThread]: On master: BEGIN
20:28:38.507053 [debug] [MainThread]: Opening a new connection, currently in state init
20:28:38.507404 [debug] [MainThread]: Redshift adapter: Connecting to Redshift using 'database' credentials
20:28:39.266916 [debug] [MainThread]: SQL status: BEGIN in 0.76 seconds
20:28:39.267306 [debug] [MainThread]: Using redshift connection "master"
20:28:39.267619 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
20:28:40.067288 [debug] [MainThread]: SQL status: SELECT in 0.8 seconds
20:28:40.102526 [debug] [MainThread]: On master: ROLLBACK
20:28:40.303741 [debug] [MainThread]: On master: Close
20:28:40.304865 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
20:28:40.305546 [info ] [MainThread]: 
20:28:40.313861 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.calc__dim_monthend_date
20:28:40.314315 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.stg__dim_adj_sales
20:28:40.314680 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.stg__dim_daypart
20:28:40.315410 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.calc__dim_monthend_date"
20:28:40.315733 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.stg__dim_destination
20:28:40.316458 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.stg__dim_adj_sales"
20:28:40.317147 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.stg__dim_daypart"
20:28:40.317534 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.calc__dim_monthend_date
20:28:40.318209 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.stg__dim_destination"
20:28:40.318589 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.stg__dim_adj_sales
20:28:40.318945 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.stg__dim_daypart
20:28:40.319348 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.calc__dim_monthend_date
20:28:40.319698 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.stg__dim_destination
20:28:40.320564 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.stg__dim_adj_sales
20:28:40.320950 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.stg__dim_daypart
20:28:40.327130 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.calc__dim_monthend_date"
20:28:40.327622 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.stg__dim_destination
20:28:40.333940 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.stg__dim_adj_sales"
20:28:40.338587 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.stg__dim_daypart"
20:28:40.343614 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.stg__dim_destination"
20:28:40.345056 [debug] [Thread-1  ]: finished collecting timing info
20:28:40.345541 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.calc__dim_monthend_date
20:28:40.346084 [debug] [Thread-4  ]: finished collecting timing info
20:28:40.346417 [debug] [Thread-2  ]: finished collecting timing info
20:28:40.346778 [debug] [Thread-3  ]: finished collecting timing info
20:28:40.347164 [debug] [Thread-1  ]: finished collecting timing info
20:28:40.347636 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.stg__dim_destination
20:28:40.348095 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.stg__dim_adj_sales
20:28:40.348484 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.stg__dim_daypart
20:28:40.349248 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.calc__dim_monthend_date
20:28:40.349689 [debug] [Thread-4  ]: finished collecting timing info
20:28:40.350118 [debug] [Thread-2  ]: finished collecting timing info
20:28:40.350680 [debug] [Thread-3  ]: finished collecting timing info
20:28:40.351412 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig
20:28:40.352468 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.stg__dim_destination
20:28:40.354024 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.stg__dim_adj_sales
20:28:40.354803 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.stg__dim_daypart
20:28:40.355522 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig"
20:28:40.355994 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.stg__dim_item
20:28:40.356597 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.stg__dim_location
20:28:40.357260 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.stg__dim_transaction_status
20:28:40.357797 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig
20:28:40.358490 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.stg__dim_item"
20:28:40.359121 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.stg__dim_location"
20:28:40.359741 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.stg__dim_transaction_status"
20:28:40.360148 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig
20:28:40.360638 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.stg__dim_item
20:28:40.361004 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.stg__dim_location
20:28:40.361619 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.stg__dim_transaction_status
20:28:40.367458 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig"
20:28:40.368146 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.stg__dim_item
20:28:40.368608 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.stg__dim_location
20:28:40.369061 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.stg__dim_transaction_status
20:28:40.373886 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.stg__dim_item"
20:28:40.378597 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.stg__dim_location"
20:28:40.383265 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.stg__dim_transaction_status"
20:28:40.383710 [debug] [Thread-1  ]: finished collecting timing info
20:28:40.384645 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig
20:28:40.385179 [debug] [Thread-1  ]: finished collecting timing info
20:28:40.385964 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.stg__dim_fcr_loc_sales_elig
20:28:40.386425 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.stg__fct_transaction
20:28:40.386994 [debug] [Thread-2  ]: finished collecting timing info
20:28:40.387808 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.stg__fct_transaction"
20:28:40.388242 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.stg__dim_location
20:28:40.388654 [debug] [Thread-3  ]: finished collecting timing info
20:28:40.388971 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.stg__fct_transaction
20:28:40.389280 [debug] [Thread-4  ]: finished collecting timing info
20:28:40.389688 [debug] [Thread-2  ]: finished collecting timing info
20:28:40.390072 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.stg__dim_transaction_status
20:28:40.390448 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.stg__fct_transaction
20:28:40.390814 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.stg__dim_item
20:28:40.391547 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.stg__dim_location
20:28:40.391940 [debug] [Thread-3  ]: finished collecting timing info
20:28:40.404692 [debug] [Thread-4  ]: finished collecting timing info
20:28:40.405207 [info ] [Thread-1  ]: 2022-02-01
20:28:40.405696 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.calc__error
20:28:40.406610 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.stg__dim_transaction_status
20:28:40.407411 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.stg__dim_item
20:28:40.408120 [info ] [Thread-1  ]: 2022-02-28
20:28:40.408845 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.calc__error"
20:28:40.409298 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.stg__dim_same_store
20:28:40.409896 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.calc__dim_price_index_1
20:28:40.410977 [info ] [Thread-1  ]: 
20:28:40.411329 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.calc__error
20:28:40.412014 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.stg__dim_same_store"
20:28:40.412679 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_1"
20:28:40.413464 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.calc__error
20:28:40.414240 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.stg__fct_transaction"
20:28:40.414629 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.stg__dim_same_store
20:28:40.415008 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.calc__dim_price_index_1
20:28:40.420110 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.calc__error"
20:28:40.420721 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.stg__dim_same_store
20:28:40.421185 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.calc__dim_price_index_1
20:28:40.426511 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.stg__dim_same_store"
20:28:40.426930 [debug] [Thread-1  ]: finished collecting timing info
20:28:40.432242 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.calc__dim_price_index_1"
20:28:40.433191 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.stg__fct_transaction
20:28:40.433573 [debug] [Thread-2  ]: finished collecting timing info
20:28:40.434202 [debug] [Thread-1  ]: finished collecting timing info
20:28:40.434625 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.calc__error
20:28:40.434939 [debug] [Thread-3  ]: finished collecting timing info
20:28:40.435746 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.stg__fct_transaction
20:28:40.436194 [debug] [Thread-2  ]: finished collecting timing info
20:28:40.436586 [debug] [Thread-4  ]: finished collecting timing info
20:28:40.436885 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.stg__dim_same_store
20:28:40.437178 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.stg__fct_item
20:28:40.438058 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.calc__error
20:28:40.438602 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.calc__dim_price_index_1
20:28:40.439035 [debug] [Thread-3  ]: finished collecting timing info
20:28:40.439710 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.stg__fct_item"
20:28:40.440148 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.stg__fct_tender
20:28:40.440696 [debug] [Thread-4  ]: finished collecting timing info
20:28:40.441410 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.stg__dim_same_store
20:28:40.441793 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.stg__fct_item
20:28:40.442406 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.stg__fct_tender"
20:28:40.443078 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.calc__dim_price_index_1
20:28:40.443530 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.transaction
20:28:40.444061 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.stg__fct_item
20:28:40.444525 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.stg__fct_tender
20:28:40.444940 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.stg__fct_same_store
20:28:40.445691 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.transaction"
20:28:40.455581 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.stg__fct_item"
20:28:40.455984 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.stg__fct_tender
20:28:40.456712 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.stg__fct_same_store"
20:28:40.457112 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.transaction
20:28:40.467254 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.stg__fct_tender"
20:28:40.467841 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.stg__fct_same_store
20:28:40.468189 [debug] [Thread-1  ]: finished collecting timing info
20:28:40.468726 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.transaction
20:28:40.469267 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.stg__fct_same_store
20:28:40.469744 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.stg__fct_item
20:28:40.475807 [debug] [Thread-2  ]: finished collecting timing info
20:28:40.476768 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.transaction"
20:28:40.482622 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.stg__fct_same_store"
20:28:40.483214 [debug] [Thread-1  ]: finished collecting timing info
20:28:40.483660 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.stg__fct_tender
20:28:40.485041 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.stg__fct_item
20:28:40.486028 [debug] [Thread-2  ]: finished collecting timing info
20:28:40.486700 [debug] [Thread-3  ]: finished collecting timing info
20:28:40.487062 [debug] [Thread-4  ]: finished collecting timing info
20:28:40.487891 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.stg__fct_tender
20:28:40.488348 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.item
20:28:40.488786 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.transaction
20:28:40.489317 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.stg__fct_same_store
20:28:40.490450 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.item"
20:28:40.490981 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.tender
20:28:40.491443 [debug] [Thread-3  ]: finished collecting timing info
20:28:40.491851 [debug] [Thread-4  ]: finished collecting timing info
20:28:40.492220 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.item
20:28:40.494589 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.item
20:28:40.493558 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.transaction
20:28:40.492882 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.tender"
20:28:40.501573 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.tender
20:28:40.500783 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.item"
20:28:40.502030 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.tender
20:28:40.494206 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.stg__fct_same_store
20:28:40.507472 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.tender"
20:28:40.508579 [debug] [Thread-1  ]: finished collecting timing info
20:28:40.509013 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.calc__dim_price_index_2
20:28:40.509403 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.item
20:28:40.510169 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_2"
20:28:40.510481 [debug] [Thread-2  ]: finished collecting timing info
20:28:40.510861 [debug] [Thread-1  ]: finished collecting timing info
20:28:40.511212 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.calc__dim_price_index_2
20:28:40.511575 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.tender
20:28:40.512242 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.item
20:28:40.512606 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.calc__dim_price_index_2
20:28:40.513144 [debug] [Thread-2  ]: finished collecting timing info
20:28:40.519170 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.calc__dim_price_index_2"
20:28:40.519762 [debug] [Thread-4  ]: Began running node test.source_of_sales_change_lcarr.not_null_item_trans_id.f3230ec97f
20:28:40.520157 [debug] [Thread-1  ]: Began running node test.source_of_sales_change_lcarr.unique_item_trans_id.31db52b29b
20:28:40.523078 [debug] [Thread-1  ]: Acquiring new redshift connection "test.source_of_sales_change_lcarr.unique_item_trans_id.31db52b29b"
20:28:40.523445 [debug] [Thread-1  ]: Began compiling node test.source_of_sales_change_lcarr.unique_item_trans_id.31db52b29b
20:28:40.523801 [debug] [Thread-1  ]: Compiling test.source_of_sales_change_lcarr.unique_item_trans_id.31db52b29b
20:28:40.520851 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.tender
20:28:40.521807 [debug] [Thread-4  ]: Acquiring new redshift connection "test.source_of_sales_change_lcarr.not_null_item_trans_id.f3230ec97f"
20:28:40.530124 [debug] [Thread-4  ]: Began compiling node test.source_of_sales_change_lcarr.not_null_item_trans_id.f3230ec97f
20:28:40.530592 [debug] [Thread-4  ]: Compiling test.source_of_sales_change_lcarr.not_null_item_trans_id.f3230ec97f
20:28:40.522402 [debug] [Thread-3  ]: finished collecting timing info
20:28:40.543152 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.calc__dim_price_index_2
20:28:40.543592 [debug] [Thread-3  ]: finished collecting timing info
20:28:40.544348 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.calc__dim_price_index_2
20:28:40.544790 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.trans_detail
20:28:40.568117 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.trans_detail"
20:28:40.568618 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.trans_detail
20:28:40.573289 [debug] [Thread-1  ]: Writing injected SQL for node "test.source_of_sales_change_lcarr.unique_item_trans_id.31db52b29b"
20:28:40.573690 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.trans_detail
20:28:40.574101 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.calc__dim_price_index_3
20:28:40.593425 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.calc__dim_price_index_3"
20:28:40.593874 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.calc__dim_price_index_3
20:28:40.594248 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.calc__dim_price_index_3
20:28:40.583600 [debug] [Thread-4  ]: Writing injected SQL for node "test.source_of_sales_change_lcarr.not_null_item_trans_id.f3230ec97f"
20:28:40.623802 [debug] [Thread-4  ]: finished collecting timing info
20:28:40.622148 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.calc__dim_price_index_3"
20:28:40.622715 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.trans_detail"
20:28:40.624340 [debug] [Thread-4  ]: Began executing node test.source_of_sales_change_lcarr.not_null_item_trans_id.f3230ec97f
20:28:40.627200 [debug] [Thread-4  ]: finished collecting timing info
20:28:40.627997 [debug] [Thread-4  ]: Finished running node test.source_of_sales_change_lcarr.not_null_item_trans_id.f3230ec97f
20:28:40.592494 [debug] [Thread-1  ]: finished collecting timing info
20:28:40.629365 [debug] [Thread-1  ]: Began executing node test.source_of_sales_change_lcarr.unique_item_trans_id.31db52b29b
20:28:40.629744 [debug] [Thread-1  ]: finished collecting timing info
20:28:40.630408 [debug] [Thread-1  ]: Finished running node test.source_of_sales_change_lcarr.unique_item_trans_id.31db52b29b
20:28:40.628467 [debug] [Thread-3  ]: finished collecting timing info
20:28:40.631048 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.trans_detail
20:28:40.631415 [debug] [Thread-3  ]: finished collecting timing info
20:28:40.632078 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.trans_detail
20:28:40.628782 [debug] [Thread-2  ]: finished collecting timing info
20:28:40.633022 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.trans_item
20:28:40.633708 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.calc__dim_price_index_3
20:28:40.635853 [debug] [Thread-2  ]: finished collecting timing info
20:28:40.636538 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.calc__dim_price_index_3
20:28:40.635419 [debug] [Thread-3  ]: Began running node test.source_of_sales_change_lcarr.unique_trans_detail_trans_id.bf19cf4015
20:28:40.637533 [debug] [Thread-3  ]: Acquiring new redshift connection "test.source_of_sales_change_lcarr.unique_trans_detail_trans_id.bf19cf4015"
20:28:40.638047 [debug] [Thread-3  ]: Began compiling node test.source_of_sales_change_lcarr.unique_trans_detail_trans_id.bf19cf4015
20:28:40.638410 [debug] [Thread-3  ]: Compiling test.source_of_sales_change_lcarr.unique_trans_detail_trans_id.bf19cf4015
20:28:40.634033 [debug] [Thread-1  ]: Began running node test.source_of_sales_change_lcarr.not_null_trans_detail_trans_id.39702ad66f
20:28:40.723577 [debug] [Thread-3  ]: Writing injected SQL for node "test.source_of_sales_change_lcarr.unique_trans_detail_trans_id.bf19cf4015"
20:28:40.634909 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.trans_item"
20:28:40.725771 [debug] [Thread-1  ]: Acquiring new redshift connection "test.source_of_sales_change_lcarr.not_null_trans_detail_trans_id.39702ad66f"
20:28:40.726724 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.trans_item
20:28:40.727477 [debug] [Thread-3  ]: finished collecting timing info
20:28:40.727830 [debug] [Thread-1  ]: Began compiling node test.source_of_sales_change_lcarr.not_null_trans_detail_trans_id.39702ad66f
20:28:40.728691 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.trans_item
20:28:40.730022 [debug] [Thread-3  ]: Began executing node test.source_of_sales_change_lcarr.unique_trans_detail_trans_id.bf19cf4015
20:28:40.730469 [debug] [Thread-1  ]: Compiling test.source_of_sales_change_lcarr.not_null_trans_detail_trans_id.39702ad66f
20:28:40.738518 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.trans_item"
20:28:40.738947 [debug] [Thread-3  ]: finished collecting timing info
20:28:40.747250 [debug] [Thread-3  ]: Finished running node test.source_of_sales_change_lcarr.unique_trans_detail_trans_id.bf19cf4015
20:28:40.750735 [debug] [Thread-1  ]: Writing injected SQL for node "test.source_of_sales_change_lcarr.not_null_trans_detail_trans_id.39702ad66f"
20:28:40.751577 [debug] [Thread-4  ]: finished collecting timing info
20:28:40.754256 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.trans_item
20:28:40.754712 [debug] [Thread-4  ]: finished collecting timing info
20:28:40.755459 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.trans_item
20:28:40.756884 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.ast_agg__all_groupings
20:28:40.758141 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.ast_agg__all_groupings"
20:28:40.759829 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.ast_agg__all_groupings
20:28:40.760741 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.ast_agg__all_groupings
20:28:40.769727 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct
20:28:40.770647 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct"
20:28:40.771715 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct
20:28:40.772077 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct
20:28:40.778037 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct"
20:28:40.782209 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.ast_agg__all_groupings"
20:28:40.782951 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.market_agg__all_groupings
20:28:40.783740 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.market_agg__all_groupings"
20:28:40.784088 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.market_agg__all_groupings
20:28:40.784423 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.market_agg__all_groupings
20:28:40.793527 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.market_agg__all_groupings"
20:28:40.794313 [debug] [Thread-1  ]: finished collecting timing info
20:28:40.794722 [debug] [Thread-1  ]: Began executing node test.source_of_sales_change_lcarr.not_null_trans_detail_trans_id.39702ad66f
20:28:40.795106 [debug] [Thread-1  ]: finished collecting timing info
20:28:40.795828 [debug] [Thread-1  ]: Finished running node test.source_of_sales_change_lcarr.not_null_trans_detail_trans_id.39702ad66f
20:28:40.796249 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct
20:28:40.796875 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct"
20:28:40.797607 [debug] [Thread-2  ]: finished collecting timing info
20:28:40.798107 [debug] [Thread-3  ]: finished collecting timing info
20:28:40.798641 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct
20:28:40.800185 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct
20:28:40.799396 [debug] [Thread-4  ]: finished collecting timing info
20:28:40.806067 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.market_agg__all_groupings
20:28:40.806473 [debug] [Thread-4  ]: finished collecting timing info
20:28:40.799091 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.ast_agg__all_groupings
20:28:40.807195 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.market_agg__all_groupings
20:28:40.799767 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct
20:28:40.808952 [debug] [Thread-3  ]: finished collecting timing info
20:28:40.805586 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct"
20:28:40.808253 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.national_agg__all_groupings
20:28:40.807725 [debug] [Thread-2  ]: finished collecting timing info
20:28:40.812691 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.ast_agg__all_groupings
20:28:40.809770 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.ast_agg__month_lookback_distinct
20:28:40.814008 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.region_agg__all_groupings
20:28:40.813255 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct
20:28:40.810742 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national_agg__all_groupings"
20:28:40.814978 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.region_agg__all_groupings"
20:28:40.811432 [debug] [Thread-1  ]: finished collecting timing info
20:28:40.819728 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct
20:28:40.817488 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
20:28:40.818798 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.region_agg__all_groupings
20:28:40.820147 [debug] [Thread-1  ]: finished collecting timing info
20:28:40.821135 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct
20:28:40.817972 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.national_agg__all_groupings
20:28:40.821591 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.region_agg__all_groupings
20:28:40.823006 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.market_agg__month_lookback_distinct
20:28:40.824105 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct
20:28:40.824841 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.national_agg__all_groupings
20:28:40.831121 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct
20:28:40.849345 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct"
20:28:40.849760 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct
20:28:40.841477 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct"
20:28:40.850126 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct
20:28:40.835927 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.region_agg__all_groupings"
20:28:40.854374 [debug] [Thread-2  ]: finished collecting timing info
20:28:40.857597 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national_agg__all_groupings"
20:28:40.863069 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct"
20:28:40.864115 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct
20:28:40.865074 [debug] [Thread-3  ]: finished collecting timing info
20:28:40.865987 [debug] [Thread-2  ]: finished collecting timing info
20:28:40.868303 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.national_agg__month_lookback_distinct
20:28:40.866744 [debug] [Thread-4  ]: finished collecting timing info
20:28:40.868760 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.market_agg__month_lookback
20:28:40.871339 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.market_agg__month_lookback"
20:28:40.870228 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.national_agg__all_groupings
20:28:40.872092 [debug] [Thread-4  ]: finished collecting timing info
20:28:40.872749 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.national_agg__all_groupings
20:28:40.871714 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.market_agg__month_lookback
20:28:40.873166 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.ast_agg__month_lookback
20:28:40.874040 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.market_agg__month_lookback
20:28:40.870677 [debug] [Thread-1  ]: finished collecting timing info
20:28:40.867211 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.region_agg__all_groupings
20:28:40.874721 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.ast_agg__month_lookback"
20:28:40.887866 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.ast_agg__month_lookback
20:28:40.887028 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.market_agg__month_lookback"
20:28:40.887503 [debug] [Thread-3  ]: finished collecting timing info
20:28:40.888206 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.ast_agg__month_lookback
20:28:40.884759 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct
20:28:40.889676 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.region_agg__all_groupings
20:28:40.895411 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.ast_agg__month_lookback"
20:28:40.895885 [debug] [Thread-1  ]: finished collecting timing info
20:28:40.896171 [debug] [Thread-2  ]: finished collecting timing info
20:28:40.898255 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.ast_agg__distinct_calcs
20:28:40.901444 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.ast_agg__distinct_calcs"
20:28:40.900197 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.market_agg__month_lookback
20:28:40.899803 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.region_agg__month_lookback_distinct
20:28:40.902182 [debug] [Thread-4  ]: finished collecting timing info
20:28:40.902652 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.ast_agg__distinct_calcs
20:28:40.903101 [debug] [Thread-2  ]: finished collecting timing info
20:28:40.903601 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs
20:28:40.904354 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.ast_agg__month_lookback
20:28:40.904840 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.ast_agg__distinct_calcs
20:28:40.913888 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.market_agg__month_lookback
20:28:40.916090 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs"
20:28:40.916853 [debug] [Thread-4  ]: finished collecting timing info
20:28:40.932237 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.market_agg__distinct_calcs
20:28:40.959284 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs
20:28:40.961780 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.ast_agg__distinct_calcs"
20:28:40.963925 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.ast_agg__month_lookback
20:28:40.964853 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.market_agg__distinct_calcs"
20:28:40.965593 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs
20:28:40.966762 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.market_agg__hash_base_calcs
20:28:40.967516 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.market_agg__distinct_calcs
20:28:40.974193 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.market_agg__hash_base_calcs"
20:28:40.990199 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.market_agg__distinct_calcs
20:28:41.010399 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.market_agg__hash_base_calcs
20:28:41.009934 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs"
20:28:41.122935 [debug] [Thread-3  ]: finished collecting timing info
20:28:41.132344 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.market_agg__distinct_calcs"
20:28:41.133035 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.market_agg__hash_base_calcs
20:28:41.133729 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.ast_agg__distinct_calcs
20:28:41.147634 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.market_agg__hash_base_calcs"
20:28:41.148363 [debug] [Thread-2  ]: finished collecting timing info
20:28:41.148846 [debug] [Thread-3  ]: finished collecting timing info
20:28:41.151484 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.ast_agg__distinct_calcs
20:28:41.150402 [debug] [Thread-4  ]: finished collecting timing info
20:28:41.150736 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.market_agg__distinct_calcs
20:28:41.151902 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.national_agg__distinct_calcs
20:28:41.153609 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
20:28:41.153962 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.national_agg__distinct_calcs
20:28:41.154318 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.national_agg__distinct_calcs
20:28:41.152419 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.market_agg__hash_base_calcs
20:28:41.152821 [debug] [Thread-2  ]: finished collecting timing info
20:28:41.165940 [debug] [Thread-4  ]: finished collecting timing info
20:28:41.149730 [debug] [Thread-1  ]: finished collecting timing info
20:28:41.170016 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national_agg__distinct_calcs"
20:28:41.170874 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.market_agg__distinct_calcs
20:28:41.171564 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.market_agg__hash_base_calcs
20:28:41.171946 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs
20:28:41.173145 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.national_agg__hash_base_calcs
20:28:41.173855 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.national_agg__month_lookback
20:28:41.174853 [debug] [Thread-3  ]: finished collecting timing info
20:28:41.175280 [debug] [Thread-1  ]: finished collecting timing info
20:28:41.175968 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
20:28:41.176639 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national_agg__month_lookback"
20:28:41.177072 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.national_agg__distinct_calcs
20:28:41.179284 [debug] [Thread-3  ]: finished collecting timing info
20:28:41.178432 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.national_agg__hash_base_calcs
20:28:41.178806 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.national_agg__month_lookback
20:28:41.180557 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.national_agg__distinct_calcs
20:28:41.177884 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.ast_agg__hash_base_calcs
20:28:41.182690 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.national_agg__hash_base_calcs
20:28:41.183917 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.national_agg__month_lookback
20:28:41.184384 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.region_agg__month_lookback
20:28:41.184945 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.region_agg__distinct_calcs
20:28:41.205729 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national_agg__month_lookback"
20:28:41.220950 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national_agg__hash_base_calcs"
20:28:41.221682 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.region_agg__month_lookback"
20:28:41.223115 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.region_agg__month_lookback
20:28:41.223582 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.region_agg__month_lookback
20:28:41.230885 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.region_agg__month_lookback"
20:28:41.222363 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.region_agg__distinct_calcs"
20:28:41.231810 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.region_agg__distinct_calcs
20:28:41.234301 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.region_agg__distinct_calcs
20:28:41.240227 [debug] [Thread-4  ]: finished collecting timing info
20:28:41.240749 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.national_agg__month_lookback
20:28:41.241526 [debug] [Thread-4  ]: finished collecting timing info
20:28:41.241188 [debug] [Thread-3  ]: finished collecting timing info
20:28:41.242517 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.national_agg__month_lookback
20:28:41.242993 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.region_agg__month_lookback
20:28:41.243373 [debug] [Thread-2  ]: finished collecting timing info
20:28:41.243942 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.region_agg__hash_base_calcs
20:28:41.253414 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.region_agg__distinct_calcs"
20:28:41.254264 [debug] [Thread-3  ]: finished collecting timing info
20:28:41.255060 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.national_agg__hash_base_calcs
20:28:41.257952 [debug] [Thread-2  ]: finished collecting timing info
20:28:41.255759 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.region_agg__hash_base_calcs"
20:28:41.259005 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.region_agg__hash_base_calcs
20:28:41.257530 [debug] [Thread-1  ]: finished collecting timing info
20:28:41.259740 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.region_agg__distinct_calcs
20:28:41.259368 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.region_agg__hash_base_calcs
20:28:41.260101 [debug] [Thread-1  ]: finished collecting timing info
20:28:41.257046 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.region_agg__month_lookback
20:28:41.258628 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.national_agg__hash_base_calcs
20:28:41.272724 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.region_agg__distinct_calcs
20:28:41.273294 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.region_agg__hash_base_calcs"
20:28:41.274126 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.market_agg__same_store_all_store
20:28:41.274936 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.ast_agg__same_store_all_store
20:28:41.275803 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.market_agg__distinct_join
20:28:41.278376 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.market_agg__same_store_all_store"
20:28:41.282118 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.market_agg__same_store_all_store
20:28:41.282465 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.market_agg__same_store_all_store
20:28:41.281425 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.market_agg__distinct_join"
20:28:41.287909 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.market_agg__same_store_all_store"
20:28:41.288356 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.market_agg__distinct_join
20:28:41.281752 [debug] [Thread-4  ]: finished collecting timing info
20:28:41.280754 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.ast_agg__same_store_all_store"
20:28:41.289817 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.ast_agg__same_store_all_store
20:28:41.290182 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.ast_agg__same_store_all_store
20:28:41.288977 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.market_agg__distinct_join
20:28:41.296614 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.ast_agg__same_store_all_store"
20:28:41.302357 [debug] [Thread-3  ]: finished collecting timing info
20:28:41.289386 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.region_agg__hash_base_calcs
20:28:41.304189 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.market_agg__distinct_join"
20:28:41.304802 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.market_agg__same_store_all_store
20:28:41.305462 [debug] [Thread-2  ]: finished collecting timing info
20:28:41.306243 [debug] [Thread-4  ]: finished collecting timing info
20:28:41.308253 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.region_agg__hash_base_calcs
20:28:41.308730 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.ast_agg__distinct_join
20:28:41.309423 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.ast_agg__distinct_join"
20:28:41.309824 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.ast_agg__distinct_join
20:28:41.307460 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.ast_agg__same_store_all_store
20:28:41.311514 [debug] [Thread-2  ]: finished collecting timing info
20:28:41.306771 [debug] [Thread-3  ]: finished collecting timing info
20:28:41.311102 [debug] [Thread-1  ]: finished collecting timing info
20:28:41.314514 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.market_agg__distinct_join
20:28:41.313563 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.market_agg__same_store_all_store
20:28:41.315063 [debug] [Thread-1  ]: finished collecting timing info
20:28:41.310716 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.ast_agg__distinct_join
20:28:41.312788 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.ast_agg__same_store_all_store
20:28:41.315761 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.national_agg__same_store_all_store
20:28:41.317640 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.market_agg__distinct_join
20:28:41.324532 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.region_agg__same_store_all_store
20:28:41.323710 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.ast_agg__distinct_join"
20:28:41.326100 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"
20:28:41.326568 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.national_agg__distinct_join
20:28:41.327816 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.region_agg__same_store_all_store"
20:28:41.331364 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.region_agg__same_store_all_store
20:28:41.330931 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national_agg__distinct_join"
20:28:41.331738 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.region_agg__same_store_all_store
20:28:41.332300 [debug] [Thread-4  ]: finished collecting timing info
20:28:41.339541 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.ast_agg__distinct_join
20:28:41.330177 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.national_agg__same_store_all_store
20:28:41.339072 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.region_agg__same_store_all_store"
20:28:41.332672 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.national_agg__distinct_join
20:28:41.339938 [debug] [Thread-4  ]: finished collecting timing info
20:28:41.340317 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.national_agg__same_store_all_store
20:28:41.340990 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.national_agg__distinct_join
20:28:41.342343 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.ast_agg__distinct_join
20:28:41.342742 [debug] [Thread-2  ]: finished collecting timing info
20:28:41.355202 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national_agg__same_store_all_store"
20:28:41.355899 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.region_agg__distinct_join
20:28:41.359031 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.region_agg__distinct_join"
20:28:41.359390 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.region_agg__distinct_join
20:28:41.359727 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.region_agg__distinct_join
20:28:41.356444 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national_agg__distinct_join"
20:28:41.358301 [debug] [Thread-3  ]: finished collecting timing info
20:28:41.357156 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.region_agg__same_store_all_store
20:28:41.365922 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.region_agg__distinct_join"
20:28:41.366913 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.national_agg__same_store_all_store
20:28:41.367447 [debug] [Thread-2  ]: finished collecting timing info
20:28:41.367995 [debug] [Thread-1  ]: finished collecting timing info
20:28:41.370086 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.national_agg__distinct_join
20:28:41.370454 [debug] [Thread-1  ]: finished collecting timing info
20:28:41.368795 [debug] [Thread-3  ]: finished collecting timing info
20:28:41.371740 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.national_agg__same_store_all_store
20:28:41.372255 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.market__big_join
20:28:41.372977 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.market__big_join"
20:28:41.373348 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.market__big_join
20:28:41.373690 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.market__big_join
20:28:41.369691 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.region_agg__same_store_all_store
20:28:41.380456 [debug] [Thread-4  ]: finished collecting timing info
20:28:41.371103 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.national_agg__distinct_join
20:28:41.381505 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.market__big_join"
20:28:41.383011 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.ast__big_join
20:28:41.383836 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.region_agg__distinct_join
20:28:41.385070 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.national__big_join
20:28:41.387716 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national__big_join"
20:28:41.388061 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.national__big_join
20:28:41.388395 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.national__big_join
20:28:41.386144 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.ast__big_join"
20:28:41.394733 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national__big_join"
20:28:41.395314 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.ast__big_join
20:28:41.396687 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.ast__big_join
20:28:41.387069 [debug] [Thread-3  ]: finished collecting timing info
20:28:41.396294 [debug] [Thread-1  ]: finished collecting timing info
20:28:41.386748 [debug] [Thread-4  ]: finished collecting timing info
20:28:41.403652 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.ast__big_join"
20:28:41.404271 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.market__big_join
20:28:41.405053 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.national__big_join
20:28:41.406993 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.region_agg__distinct_join
20:28:41.407966 [debug] [Thread-3  ]: finished collecting timing info
20:28:41.408935 [debug] [Thread-1  ]: finished collecting timing info
20:28:41.409449 [debug] [Thread-2  ]: finished collecting timing info
20:28:41.412531 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.ast__big_join
20:28:41.412910 [debug] [Thread-2  ]: finished collecting timing info
20:28:41.410882 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.market__big_join
20:28:41.413557 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.ast__big_join
20:28:41.413989 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.region__big_join
20:28:41.411962 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.national__big_join
20:28:41.415281 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.region__big_join"
20:28:41.417809 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.region__big_join
20:28:41.418339 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.region__big_join
20:28:41.415755 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.market__final_output
20:28:41.427077 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.market__final_output"
20:28:41.427414 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.market__final_output
20:28:41.427731 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.market__final_output
20:28:41.426359 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.region__big_join"
20:28:41.437684 [debug] [Thread-3  ]: finished collecting timing info
20:28:41.435494 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.market__final_output"
20:28:41.438093 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.region__big_join
20:28:41.438648 [debug] [Thread-3  ]: finished collecting timing info
20:28:41.439748 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.region__big_join
20:28:41.440204 [debug] [Thread-3  ]: Began running node model.source_of_sales_change_lcarr.ast__final_output
20:28:41.440835 [debug] [Thread-3  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.ast__final_output"
20:28:41.441582 [debug] [Thread-1  ]: finished collecting timing info
20:28:41.443084 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.market__final_output
20:28:41.443445 [debug] [Thread-1  ]: finished collecting timing info
20:28:41.442373 [debug] [Thread-2  ]: Began running node model.source_of_sales_change_lcarr.region__final_output
20:28:41.444129 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.market__final_output
20:28:41.444738 [debug] [Thread-2  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.region__final_output"
20:28:41.445569 [debug] [Thread-2  ]: Began compiling node model.source_of_sales_change_lcarr.region__final_output
20:28:41.442720 [debug] [Thread-3  ]: Began compiling node model.source_of_sales_change_lcarr.ast__final_output
20:28:41.445964 [debug] [Thread-2  ]: Compiling model.source_of_sales_change_lcarr.region__final_output
20:28:41.442060 [debug] [Thread-4  ]: Began running node model.source_of_sales_change_lcarr.national__final_output
20:28:41.447912 [debug] [Thread-3  ]: Compiling model.source_of_sales_change_lcarr.ast__final_output
20:28:41.453871 [debug] [Thread-2  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.region__final_output"
20:28:41.454767 [debug] [Thread-4  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.national__final_output"
20:28:41.462165 [debug] [Thread-3  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.ast__final_output"
20:28:41.463228 [debug] [Thread-4  ]: Began compiling node model.source_of_sales_change_lcarr.national__final_output
20:28:41.463977 [debug] [Thread-4  ]: Compiling model.source_of_sales_change_lcarr.national__final_output
20:28:41.469815 [debug] [Thread-2  ]: finished collecting timing info
20:28:41.470467 [debug] [Thread-2  ]: Began executing node model.source_of_sales_change_lcarr.region__final_output
20:28:41.470909 [debug] [Thread-2  ]: finished collecting timing info
20:28:41.471659 [debug] [Thread-2  ]: Finished running node model.source_of_sales_change_lcarr.region__final_output
20:28:41.472280 [debug] [Thread-3  ]: finished collecting timing info
20:28:41.472666 [debug] [Thread-3  ]: Began executing node model.source_of_sales_change_lcarr.ast__final_output
20:28:41.473037 [debug] [Thread-3  ]: finished collecting timing info
20:28:41.474407 [debug] [Thread-3  ]: Finished running node model.source_of_sales_change_lcarr.ast__final_output
20:28:41.482237 [debug] [Thread-4  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.national__final_output"
20:28:41.483205 [debug] [Thread-4  ]: finished collecting timing info
20:28:41.483638 [debug] [Thread-4  ]: Began executing node model.source_of_sales_change_lcarr.national__final_output
20:28:41.484040 [debug] [Thread-4  ]: finished collecting timing info
20:28:41.484767 [debug] [Thread-4  ]: Finished running node model.source_of_sales_change_lcarr.national__final_output
20:28:41.487399 [debug] [Thread-1  ]: Began running node model.source_of_sales_change_lcarr.final_output_all
20:28:41.488604 [debug] [Thread-1  ]: Acquiring new redshift connection "model.source_of_sales_change_lcarr.final_output_all"
20:28:41.489011 [debug] [Thread-1  ]: Began compiling node model.source_of_sales_change_lcarr.final_output_all
20:28:41.489373 [debug] [Thread-1  ]: Compiling model.source_of_sales_change_lcarr.final_output_all
20:28:41.506293 [debug] [Thread-1  ]: Writing injected SQL for node "model.source_of_sales_change_lcarr.final_output_all"
20:28:41.507770 [debug] [Thread-1  ]: finished collecting timing info
20:28:41.508307 [debug] [Thread-1  ]: Began executing node model.source_of_sales_change_lcarr.final_output_all
20:28:41.508705 [debug] [Thread-1  ]: finished collecting timing info
20:28:41.512072 [debug] [Thread-1  ]: Finished running node model.source_of_sales_change_lcarr.final_output_all
20:28:41.515516 [debug] [MainThread]: Connection 'master' was properly closed.
20:28:41.515959 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.final_output_all' was properly closed.
20:28:41.516320 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.region__final_output' was properly closed.
20:28:41.516766 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.ast__final_output' was properly closed.
20:28:41.517130 [debug] [MainThread]: Connection 'model.source_of_sales_change_lcarr.national__final_output' was properly closed.
20:28:41.690476 [info ] [MainThread]: Done.
20:28:41.705808 [debug] [MainThread]: Acquiring new redshift connection "generate_catalog"
20:28:41.706254 [info ] [MainThread]: Building catalog
20:28:41.748787 [debug] [ThreadPool]: Acquiring new redshift connection "cfa.information_schema"
20:28:41.797048 [debug] [ThreadPool]: Using redshift connection "cfa.information_schema"
20:28:41.797532 [debug] [ThreadPool]: On cfa.information_schema: BEGIN
20:28:41.797872 [debug] [ThreadPool]: Opening a new connection, currently in state init
20:28:41.798229 [debug] [ThreadPool]: Redshift adapter: Connecting to Redshift using 'database' credentials
20:28:42.857891 [debug] [ThreadPool]: SQL status: BEGIN in 1.06 seconds
20:28:42.858540 [debug] [ThreadPool]: Using redshift connection "cfa.information_schema"
20:28:42.859209 [debug] [ThreadPool]: On cfa.information_schema: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "cfa.information_schema"} */

    

    with late_binding as (
      select
        'cfa'::varchar as table_database,
        table_schema,
        table_name,
        'LATE BINDING VIEW'::varchar as table_type,
        null::text as table_comment,

        column_name,
        column_index,
        column_type,
        null::text as column_comment
      from pg_get_late_binding_view_cols()
        cols(table_schema name, table_name name, column_name name,
             column_type varchar,
             column_index int)
        order by "column_index"
    ),

    early_binding as (
        select
            'cfa'::varchar as table_database,
            sch.nspname as table_schema,
            tbl.relname as table_name,
            case tbl.relkind
                when 'v' then 'VIEW'
                else 'BASE TABLE'
            end as table_type,
            tbl_desc.description as table_comment,
            col.attname as column_name,
            col.attnum as column_index,
            pg_catalog.format_type(col.atttypid, col.atttypmod) as column_type,
            col_desc.description as column_comment

        from pg_catalog.pg_namespace sch
        join pg_catalog.pg_class tbl on tbl.relnamespace = sch.oid
        join pg_catalog.pg_attribute col on col.attrelid = tbl.oid
        left outer join pg_catalog.pg_description tbl_desc on (tbl_desc.objoid = tbl.oid and tbl_desc.objsubid = 0)
        left outer join pg_catalog.pg_description col_desc on (col_desc.objoid = tbl.oid and col_desc.objsubid = col.attnum)
        where (upper(sch.nspname) = upper('fin_lh') or upper(sch.nspname) = upper('pos') or upper(sch.nspname) = upper('common') or upper(sch.nspname) = upper('prodmix_dl') or upper(sch.nspname) = upper('apps') or upper(sch.nspname) = upper('public'))
            and tbl.relkind in ('r', 'v', 'f', 'p')
            and col.attnum > 0
            and not col.attisdropped
    ),

    table_owners as (

        select
            'cfa'::varchar as table_database,
            schemaname as table_schema,
            tablename as table_name,
            tableowner as table_owner

        from pg_tables

        union all

        select
            'cfa'::varchar as table_database,
            schemaname as table_schema,
            viewname as table_name,
            viewowner as table_owner

        from pg_views

    ),

    unioned as (

        select *
        from early_binding

        union all

        select *
        from late_binding

    )

    select *,
        table_database || '.' || table_schema || '.' || table_name as table_id

    from unioned
    join table_owners using (table_database, table_schema, table_name)

    where (upper(table_schema) = upper('fin_lh') or upper(table_schema) = upper('pos') or upper(table_schema) = upper('common') or upper(table_schema) = upper('prodmix_dl') or upper(table_schema) = upper('apps') or upper(table_schema) = upper('public'))

    order by "column_index"
20:29:08.974609 [debug] [ThreadPool]: SQL status: SELECT in 26.12 seconds
20:29:10.866836 [debug] [ThreadPool]: Using redshift connection "cfa.information_schema"
20:29:10.867149 [debug] [ThreadPool]: On cfa.information_schema: /* {"app": "dbt", "dbt_version": "1.0.4", "profile_name": "basic", "target_name": "dev", "connection_name": "cfa.information_schema"} */
select has_table_privilege(current_user, 'svv_table_info', 'SELECT') as can_select
20:29:11.012413 [debug] [ThreadPool]: SQL status: SELECT in 0.15 seconds
20:29:11.016713 [info ] [ThreadPool]: 

    Warning: The database user "crn_svc" has insufficient permissions to
    query the "svv_table_info" table. Please grant SELECT permissions on this table
    to the "crn_svc" user to fetch extended table details from Redshift.

    
20:29:13.340770 [debug] [ThreadPool]: On cfa.information_schema: ROLLBACK
20:29:14.924375 [debug] [ThreadPool]: On cfa.information_schema: Close
20:29:17.810135 [info ] [MainThread]: Catalog written to /Users/lindsay.carr/DBT/dbt_source_of_sales_change_lcarr/target/catalog.json
20:29:17.849335 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feb1b4a3610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feb1b44ec40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feb1b696b80>]}
20:29:18.025914 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
20:29:18.026302 [debug] [MainThread]: Connection 'cfa.information_schema' was properly closed.


============================== 2022-06-27 20:29:46.284975 | 3abda7a0-2079-4652-9d47-e98f734a4755 ==============================
20:29:46.284975 [info ] [MainThread]: Running with dbt=1.0.4
20:29:46.285625 [debug] [MainThread]: running dbt with arguments Namespace(cls=<class 'dbt.task.serve.ServeTask'>, debug=None, defer=None, event_buffer_size=None, fail_fast=True, log_cache_events=False, log_format=None, open_browser=True, partial_parse=None, port=8080, printer_width=None, profile=None, profiles_dir='/Users/lindsay.carr/DBT/environments/redshift_discovery_crn_svc/', project_dir=None, record_timing_info=None, rpc_method=None, send_anonymous_usage_stats=None, single_threaded=False, state=None, static_parser=None, target=None, use_colors=None, use_experimental_parser=None, vars='{}', version_check=None, warn_error=None, which='serve', write_json=None)
20:29:46.286080 [debug] [MainThread]: Tracking: tracking
20:29:46.314474 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb58d5a3730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb58d5a3b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb58d5882e0>]}
20:29:46.321687 [info ] [MainThread]: Serving docs at 0.0.0.0:8080
20:29:46.322378 [info ] [MainThread]: To access from your browser, navigate to:  http://localhost:8080
20:29:46.322772 [info ] [MainThread]: 
20:29:46.323156 [info ] [MainThread]: 
20:29:46.323521 [info ] [MainThread]: Press Ctrl+C to exit.
